{php $footer_js = [DT_PATH.'file/script/config.js',DT_PATH.'file/script/common.js'];}
{template 'header2017'}
</div>
</div>
<link rel="stylesheet" type="text/css" href="{DT_SKIN}tc.reg.min.css" />
<div class="autoheight pd10 regbg">

<div class="reg-wrap">
    <!--注册步骤-->
    <div class="reg-step">
        <ul class="clearfix">
            <li class="active"><i>1</i>基本资料</li>
            <li class=""><i>2</i>信息登记</li>
            <li class=""><i>3</i>完成注册</li>
        </ul>
    </div>
    <!--注册步骤 end-->

    <!--注册-->
    <div class="reg-container clearfix">
        <div class="frm-wrap">
            <form id="regFormStep1" action="?" method="post">
            	<input type="hidden" name="submit" value="1" />
                <div class="frm-control-group">
                    <label class="frm-label">会员账号</label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="frmUserName" class="frm-input" type="text" tabindex="1"
                                   name="post[username]"
                                   data-rule="required;username;va_username;"
                                   data-tip="5-20个字符，小写字母、数字、中划线，且以小写字母或数字开头和结尾"
                            />
                        </span>
                        <span class="msg-box n-right" for="frmUserName"></span>
                    </div>
                </div>
                <div class="frm-control-group">
                    <label class="frm-label">登录密码 </label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="frmPassWord" class="frm-input" type="password" tabindex="2"
                                   name="post[password]"
                                   data-rule="required;length[6~20]"
                                   data-tip="6-20个字符，字母、数字、英文符号，区分大小写"
                            />
                        </span>
                        <span class="msg-box n-right" for="frmPassWord"></span>
                    </div>
                </div>
                <div class="frm-control-group">
                    <label class="frm-label">确认密码</label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="frmRePassWord" class="frm-input" type="password" tabindex="3"
                                   name="post[password_second]"
                                   data-rule="required;match(post[password])"
                                   data-msg-match="2次密码输入不一致"
                            />
                        </span>
                        <span class="msg-box n-right" for="frmRePassWord"></span>
                    </div>
                </div>

                <div class="frm-control-group verify-code">
                    <label class="frm-label">验证码</label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="frmCaptcha" class="frm-input" type="text" tabindex="4"
                                   name="post[captcha]"
                                   data-rule="required;va_captcha;"
                            />
                            <div class="verify-code-wrap">
                                <img class="verify-code-img" src="{DT_PATH}api/captcha.png.php?action=image&height=42">
                                <a href="javascript:;" class="change-verify-code" onclick="changeImgVerify();">换一张</a>
                            </div>
                        </span>
                        <span class="msg-box n-right" for="frmCaptcha"></span>
                    </div>
                </div>

                <div class="frm-control-group">
                    <label class="frm-label">手机号码</label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="frmMobile" class="frm-input" type="text" tabindex="5" onkeyup="inputBlur(this)"
                                   name="post[mobile]"
                                   data-rule="required;mobile;va_mobile;"
                                   data-msg-mobile="请输入正确的手机号码"
                            />
                        </span>
                        <span class="msg-box n-right" for="frmMobile"></span>
                    </div>

                </div>

                <div class="frm-control-group msg-verify-code">
                    <label class="frm-label">短信验证码</label>
                    <div class="frm-controls">
                        <span class="frm-input-box">
                            <input id="SMSCaptcha" class="frm-input"  type="text" tabindex="6"
                                   name="post[sms_code]"
                                   data-rule="required;"
                            />
                            <input type="button" class="msg-verify-btn" value="获取短信验证码" onclick="sendSMS(this);" />
                        </span>
                        <span class="msg-box n-right" for="SMSCaptcha"></span>
                    </div>
                </div>

                <div class="frm-btn-group">
                    <input type="submit" class="button btn-primary" value="下一步" />
                </div>

            </form>
        </div>
        {template 'third-login',$module}
    </div>
    <!--注册 end-->

</div>




<script type="text/javascript" src="{DT_PATH}file/script/jquery.js"></script>
<script type="text/javascript" src="{DT_PATH}file/script/jquery.validator.min.js"></script>
<script type="text/javascript" src="{DT_PATH}file/script/zh-CN.js"></script>
<script>
    // 更换图片验证码
    function changeImgVerify(){
        //var imgVerifyRandom = new Date().getTime();'{DT_PATH}api/captcha.png.php?action=image&refresh='+Math.random()
        $(".verify-code-img").attr("src","{DT_PATH}api/captcha.png.php?action=image&height=42&refresh="+Math.random());
    }
    // 表单验证
    $('#regFormStep1').validator({
        rules: {
			username:[/^[a-z0-9][a-z0-9-]{3,18}[a-z0-9]$/, '请输入正确的会员账号'],
            va_username: function(element){
                return $.ajax({
                    url: AJPath,
                    type: 'post',
                    data: 'action=member_check&job=username_or_mobile_exists&from=username&value='+element.value
                });
            },
            va_captcha: function(element){
                return $.ajax({
                    url: AJPath,
                    type: 'post',
                    data: 'action=captcha&result=string&captcha='+element.value
                });
            },
            va_mobile: function(element){
                return $.ajax({
                    url: AJPath,
                    type: 'post',
                    data: 'action=member_check&job=username_or_mobile_exists&from=mobile&value='+element.value
                });
            }
        }
    });
    // 自动失去焦点
    function inputBlur(ele){
        if( $(ele).val().length > 10){
            $(ele).blur();
        }
    }
    // 短信验证码倒计时
    var wait = 120;
    function settime(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.value="获取短信验证码";
            wait = 120;
            $(".msg-verify-btn").removeClass("msg-verify-btn-dis");
        } else {
            o.setAttribute("disabled", true);
            o.value="重新发送(" + wait + ")";
            wait--;
            setTimeout(function() {settime(o);},1000);
        }
    }
    // 发送验证码
    function  sendSMS(ele){
        var btnEle = ele;
        if($("#frmUserName,#frmMobile,#frmCaptcha").isValid()){
            $(btnEle).attr("disabled", true);
            $(btnEle).addClass("msg-verify-btn-dis");
            $(btnEle).val("正在发送中...");
            $.ajax({
                url: AJPath,
                type: 'post',
                data: 'action=sms&mobile='+$("#frmMobile").val()+'&username='+$("#frmUserName").val()+'&captcha='+$("#frmCaptcha").val(),
                success: function(d){
                    if(d == 6){
                        $('#regFormStep1').validator('showMsg', '#SMSCaptcha', {
                            type: "tip",
                            msg: "抱歉，短信验证码发送失败，请您稍后再试。"
                        });
                    }
                    if(d == 7){
                        $(btnEle).removeAttr("disabled");
                        $(btnEle).removeClass("msg-verify-btn-dis");
                        $(btnEle).val("获取短信验证码");
                        $('#regFormStep1').validator('showMsg', '#SMSCaptcha', {
                            type: "tip",
                            msg: "短信已发送到您的手机中，请留意接收。"
                        });
                    }
                    if(d == 0){
                        settime(btnEle);
                    }
                }
            });
        }
    }
</script>
<script src="{DT_PATH}file/script/tecenet.notify.min.js"></script>
<script>
function getCookie(name){
	var search = name + "="//查询检索的值
    var returnvalue = "";//返回值
    if (document.cookie.length > 0) {
    	sd = document.cookie.indexOf(search);
    	if (sd!= -1) {
        	sd += search.length;
        	end = document.cookie.indexOf(";", sd);
        	if (end == -1)
        	end = document.cookie.length;
         	//unescape() 函数可对通过 escape() 编码的字符串进行解码。
        returnvalue=document.cookie.substring(sd, end);
     }
   } 
   return decodeURIComponent(returnvalue);
}
function delCookie(name){
	 $.ajax({
	 	type:'POST',
	 	url:"{DT_PATH}ajax.php?action=delcookie&name="+name,
	 	success:function(){},
	 	error:function(){}
	 });
}

var tip = getCookie('errorTip');
if(tip){
	$.notify(tip, {
        type: "danger",
        offset: 0
    });
    delCookie('errorTip');
}
</script>
{template 'footer2017'}
