{php $head_css = [DT_SKIN.'tc.list.base.css',DT_SKIN.'tc.chanpin.base.css',DT_SKIN.'tc.chanpin.list.css']}
{php $footer_js = [DT_PATH.'file/script/jquery.SuperSlide.2.1.1.source.js',DT_PATH.'file/script/mall/tc.chanpin.list.js',DT_PATH.'lang/zh-cn/lang.js',DT_PATH.'file/script/config.js',DT_PATH.'file/script/common.js',DT_PATH.'file/script/page.js'];}
{template 'module-header'}
<style type="text/css">
	.f12{font-size:12px;}.f14{font-size:14px}.f16{font-size:16px}.f18{font-size:18px}.f20{font-size:20px}.f24{font-size:24px}
    a:link,a:visited {color:#333;}
    a:hover{color:#f05409;}
    .cut{overflow:hidden}
    .fl{float:left}.fr{float:right}
    .input{line-height:24px;height:24px;;font-size:14px;color:#888;text-indent:5px;width:140px;}
    .ml-5{margin-left:-5px;}
    .ml10{margin-left:10px;}.ml5{margin-left:5px;}
    .mr10{margin-right:10px;}.mg10{margin:10px;}.mr5{margin-right:5px;}
    .mt10{margin-top:10px;}.mt5{margin-top:5px;}
    .mb10{margin-bottom:10px;}.mb5{margin-bottom:5px;}
    .ml20{margin-left:20px;}
    .pd10{padding:10px;}.pd5{padding:5px;}.pd2{padding:2px;}
    .ti10{text-indent:10px;}.ti5{text-indent:5px;}
    .pt10{padding-top:10px;}.pt5{padding-top:5px;}.pl10{padding-left:10px;}.pl5{padding-left:5px;}.pb10{padding-bottom:10px;}.pb5{padding-bottom:5px;}
    .clear{line-height:0px; margin:0px; height:0px; font-size:0px;clear:both;overflow:hidden;display:inline;}
    .cart_foot {margin-top: 20px;border-top:#fdd591 1px solid;background:#fffdee;padding:20px 40px 20px 0;color:#ce0000;text-align:right;font-size:16px;}
    #cart_tip {width:350px;z-index:1000;position:absolute;margin:-40px 0 0 -15px;background:#FFFFFF;border:#A0BCCA 1px solid;padding:0 0 15px 0;}
    #cart_tip p {margin:0;background:#D2EDFF;padding:6px 4px 4px 6px;font-size:13px;font-weight:bold;}
    #cart_tip div {background:url('image/okay.gif') no-repeat 15px 10px;padding:15px 20px 10px 50px;font-size:13px;}
    #cart_tip span {color:#FF6600;font-weight:bold;}
    #cart_tip img {float:right;cursor:pointer;}
    .color,.color:link,.color:visited{color:#333}
    .hcolor,.hcolor:link,.hcolor:visited{color:#838383}
    .ocolor,.ocolor:link,.ocolor:visited,.f_red{color:#ff8800}
    .bcolor,.bcolor:link,.bcolor:visited{color:#137eb8}
    .wcolor,.wcolor:link,.wcolor:visited{color:white}
    .rcolor,.rcolor:link,.rcolor:visited{color:#cc3515}
    .gcolor,.gcolor:link,.gcolor:visited{color:#359A00}.highlight{color:#ff8800;font-weight:bold}
    .subm{vertical-align:middle;background:#f77602;font-size:16px;color:#fff;font-family: "微软雅黑";border:none;margin:0px;margin-left:-5px;height:32px;overflow:hidden}
    .your{width: 1200px;margin: 0 auto;padding: 20px 0;font-size: 12px;color: #888;}
    .your a{color: #666;margin:0 3px;}
    .buy-card table img{display: inline-block;}
    .buy-card table{border-spacing: 1px;}
    .buy-card table td,.buy-card table th,.buy-card table caption { padding: 10px; }
    .f_gray{font-size: 12px;color: #888;}
</style>
<script>
	function Dd(i) {return document.getElementById(i);}
</script>
<script type="text/javascript">
var errimg = '{DT_SKIN}image/nopic50.gif';
function check() {
	if(Dd('itemid').value == 0 || Dd('itemid').value == '') {
		alert('请输入商品ID');
		Dd('itemid').focus();
		return false;
	}
	return true;
}
</script>
{template 'lay','tag'}
<script type="text/javascript">
Dd('yourmdmore').innerText='购物车';Dd('yourmdmore').href='{DT_PATH}mall/cart.php';

</script>

<div class="autoheight pt5 whitebg w1200 buy-card box-center">
	{if $tags}
	<form method="post" action="{$MOD[linkurl]}buy.php" onsubmit="return check();">
	<input type="hidden" name="submit" value="1"/>
	<div class="pd10">
	<a href="{$MOD[linkurl]}cart.php" class="suba w120 fl">修改本次订单</a>
	</div>
	  <img src="{DT_SKIN}image/buy_1.gif" width="160" height="30" alt=""/> 
	<div style="margin:10px 40px 10px 40px;" class="c_b">
	<table cellpadding="6" cellspacing="1" width="100%" bgcolor="#E4E4E4">
	<tr align="center" bgcolor="#f2f5f9">
	<td width="60" height=30>图片</td>
	<td>商品</td>
	<td width="80">品牌</td>
	<td width="60">库存</td>
	<td width="60">价格</td>
	<td width="100">数量</td>
	<td width="90">小计</td>
	</tr>
	{loop $tags $i $t}
	<tr align="center" bgcolor="{if $i%2==1}#fafafa{else}#FFFFFF{/if}">
	<td><a href="{$t[linkurl]}" target="_blank"><img src="{$t[thumb]}" width="50" alt="{$t[alt]}"  onerror="this.src=errimg;"/></a></td>
	<td align="left">
	<a href="{$t[linkurl]}" target="_blank" class="f14 bcolor" title="{$t[alt]}">{$t[title]}</a><br/>

	{if $t[groupid]!='8'}<a href="{userurl($t[username])}" target="_blank"  class="color">{$t[company]}</a>{if $t[vip]} <img src="{DT_SKIN}image/vip.gif"/> <img src="{DT_SKIN}image/vip_{$t[vip]}.gif"/>
	{if $DT[im_web]}{im_web($t[username].'&mid='.$moduleid.'&itemid='.$t[itemid])} {/if}
	{if $t[qq] && $DT[im_qq]}{im_qq($t[qq])} {/if}
	{if $t[ali] && $DT[im_ali]}{im_ali($t[ali])} {/if}
	{if $t[msn] && $DT[im_msn]}{im_msn($t[msn])} {/if}
	{if $t[skype] && $DT[im_skype]}{im_skype($t[skype])}</a> {/if}
	{/if}{else}天成官方产品信息{/if}

	<div style="padding:8px 0 0 0;color:#666666;">
	{if check_dingzhi_member($t[username],'daili')}
	{php $seller=$t[username];}
	{php $userid=$db->get_one("select userid from {$db->pre}member where username='$seller'");}
	{php $uid=$userid['userid'];$daili=$db->get_one("select * from {$db->pre}friend where userid='$uid' and username='$_username' and isdaili=1");}
		{if $daili}
		<span>提示：{$_username}作为{$seller}的代理，可享受折扣<br/></span>
		{/if}
	{/if}
	备注：<input type="text" name="post[{$t[itemid]}][note]" value="{if $t[m1]!=''}{$t[n1]}:{$t[m1]} {/if}{if $t[m2]!=''}{$t[n2]}:{$t[m2]} {/if}{if $t[m3]!=''}{$t[n3]}:{$t[m3]} {/if}" size="20" style="border:#CCCCCC 1px solid;" maxlength="100" title="限100字以内"/> 
	</div>
	</td>
	<td>{if $t[brand]}{$t[brand]}{else}未填写{/if}</td>
	<td><span class="dsn" id="amount_{$t[itemid]}">{$t[amount]}</span></td>
	<td><span class="f_price" id="price_{$t[itemid]}">{$t[price]}</span></td>
	<td><img src="{DT_SKIN}image/arrow_l.gif" width="16" height="8" alt="减少" class="c_p" onclick="alter({$t[itemid]}, '-')"/> <input type="text" name="post[{$t[itemid]}][number]" value="{$t[number]}" size="3" class="cc_inp" id="number_{$t[itemid]}" onblur="calculate();"/> <img src="{DT_SKIN}image/arrow_r.gif" width="16" height="8" alt="增加" class="c_p" onclick="alter({$t[itemid]}, '+')"/><span class="dsn" id="amount_{$t[itemid]}">{$t[amount]}</span></td>
	<td><span class="f_price" id="total_{$t[itemid]}">{$t[price]}</span></td>
	</tr>
	{/loop}
	</table>
	<div class="divline"></div>
	<div class="ocolor pd10 whitebg f16">天成官方的产品价格仅为系统默认价格，实际成交价以客服修改确认后的价格为准。
	</div>
	<div class="divline"></div>
	<div class="cart_foot">
	共选中 <span class="ocolor f_b px16" id="total_good">{$total}</span> 种商品     总价：<span class="ocolor f_b px16" id="total_amount">{$total_amount}</span> 元</div>
	</div>
	<div class="b10"> </div>
	<div>  <img src="{DT_SKIN}image/buy_2.gif" width="160" height="30" alt=""/></div>
	<div style="padding:20px;margin:10px 40px 20px 40px;background:#fafafa;" class="c_b px13 grayb">
	<table cellpadding="10" cellspacing="0" width="100%">
	<tr>
	<td width="100"><span class="ocolor"> </span> 常用地址：</td>
	<td class="px13">
	{if $address}
		{loop $address $k $v}
		<div>
		{if $k == 0}<span class="f_r"><a href="{$MODULE[2][linkurl]}address.php?action=add" target="_blank" class="ocolor">[新增地址]</a>  <a href="{$MODULE[2][linkurl]}address.php" target="_blank" class="gcolor">[管理地址]</a></span>{/if}
		<input type="radio" name="addr" id="addr_{$k}" value="{$v[address]}|{$v[postcode]}|{$v[truename]}|{$v[mobile]}|{$v[telephone]}" onclick="Adr(this.value);"{if $k == 0} checked{/if}/><label for="addr_{$k}"> {$v[postcode]} {$v[address]} ({$v[truename]}) {$v[mobile]}</label></div>
		<div class="b5"></div>
		{/loop}
	{else}
		<strong>暂无常用收货地址</strong>  <a href="{$MODULE[2][linkurl]}address.php?action=add" target="_blank">[新增地址]</a>  <a href="{$MODULE[2][linkurl]}address.php" target="_blank">[管理地址]</a>
	{/if}
	</td>
	</tr>
	<tr>
	<td><span class="ocolor">*</span> 收货地址：</td>
	<td><span id="addr_areaid">{ajax_area_select('add[areaid]', '请选择', $user[areaid])} </span><input type="text" size="60" name="add[address]" id="address" value="{$user[address]}"/> <span id="daddress" class="ocolor"></span></td>
	</tr>
	<tr>
	<td><span class="ocolor">*</span> 邮政编码：</td>
	<td><input type="text" size="10" name="add[postcode]" id="postcode" value="{$user[postcode]}"/> <span id="dpostcode" class="ocolor"></span></td>
	</tr>
	<tr>
	<td><span class="ocolor">*</span> 真实姓名：</td>
	<td><input type="text" size="10" name="add[truename]" id="truename" value="{$user[truename]}"/> <span id="dtruename" class="ocolor"></span></td>
	</tr>
	<tr>
	<td><span class="ocolor">*</span> 手机号码：</td>
	<td><input type="text" size="20" name="add[mobile]" id="mobile" value="{$user[mobile]}"/> <span id="dmobile" class="ocolor"></span></td>
	</tr>
	<tr>
	<td><span class="ocolor"> </span> 电话号码：</td>
	<td><input type="text" size="20" name="add[telephone]" id="telephone" value="{$user[telephone]}"/> <span id="dtelephone" class="ocolor"></span></td>
	</tr>
	<tr>
	<td><span class="ocolor">*</span> 期望物流：</td>
	<td>
		<!--
		<input type="text" size="10" name="add[receive]" id="receive" value="不需要物流"/>
		<select onchange="Dd('receive').value=this.value;">
		<option value="">常用物流类型</option>
		{loop $send_types $v}
		<option value="{$v}">{$v}</option>
		{/loop}
		</select> <span id="dreceive" class="ocolor"></span>
		-->
		<input type="radio" name="add[receive]" value="0" checked="checked" />物流   <input type="radio" name="add[receive]" value="1" />快递
	</td>
	</tr>
	
	</table>
	</div>
	<table cellpadding="0" cellspacing="0" width="100%">
	<tr align="center">
	<td width="280"><input type="image" src="{DT_SKIN}image/btn_buynow.gif" title="提交订单"/></td>
	<td width="280"><a href="{$MOD[linkurl]}" onclick="return confirm('订单尚未完成，确定要离开此页面吗？');"><img src="{DT_SKIN}image/btn_browse.gif" width="106" height="33" alt="继续购物"/></a></td>
	<td > </td>
	</tr>
	<tr align="center">
	<td class="color">提交订单待卖家确认后，支付费用</td>
	<td class="color">您也可以返回到{$MOD[name]}首页，继续挑选商品</td>
	<td height="50"> </td>
	</tr>
	</table>
	</form>
	{else}
		<div style="padding:80px;" class="tc f16 ocolor">您还没有挑选商品，赶快行动吧！马上去 <a href="{$MOD[linkurl]}" class='bcolor'>挑选商品</a></div>
	{/if}
</div>
</div>
<script type="text/javascript">
function check() {
	
	f = 'address';
	l = Dd(f).value.length;
	if(l < 5) {
		Dmsg('请填写街道地址', f);
		return false;
	}
	//f = 'postcode';
	//l = Dd(f).value.length;
	//if(l < 6) {
	//	Dmsg('请填写邮政编码', f);
	//	return false;
	//}
	f = 'truename';
	l = Dd(f).value.length;
	if(l < 2) {
		Dmsg('请填写真实姓名', f);
		return false;
	}
	//f = 'mobile';
	//l = Dd(f).value.length;
	//if(l < 11) {
	//	Dmsg('请填写手机号码', f);
	//	return false;
	//}
	//f = 'receive';
	//l = Dd(f).value.length;
	//if(l < 2) {
	//	Dmsg('请填写期望物流', f);
	//	return false;
//	}
	return confirm('您确认商品及收货地址无误，提交此订单吗？');
}
function Adr(s) {
	var t = s.split('|');
	try {
		Dd('areaid_1').value = 0;
		Dh('addr_areaid');
		Dd('address').value = t[0];
		Dd('postcode').value = t[1];
		Dd('truename').value = t[2];
		Dd('mobile').value = t[3];
		Dd('telephone').value = t[4];		
	}
	catch (e) {}
}
{if $address}Adr(Dd('addr_0').value);{/if}
function alter(i, t) {
	if(t == '+') {
		var maxa = parseFloat(Dd('amount_'+i).innerHTML);
		if(maxa && Dd('number_'+i).value >= maxa) return;
		Dd('number_'+i).value =  parseInt(Dd('number_'+i).value) + 1;
	} else {
		var mina = 1;
		if(Dd('number_'+i).value <= mina) return;
		Dd('number_'+i).value =  parseInt(Dd('number_'+i).value) - 1;
	}
	calculate();
}
function calculate() {
	var itemids = [{$itemids}];
	var _good = itemid = 0;
	for(var i = 0; i < itemids.length; i++) {
		itemid = itemids[i];
		var num, good, maxa, mina;
		num = parseInt(Dd('number_'+itemid).value);
		maxa = parseFloat(Dd('amount_'+itemid).innerHTML);
		mina = 1;
		if(num < mina) Dd('number_'+itemid).value = num = mina;
		if(maxa && num > maxa) Dd('number_'+itemid).value = num = maxa;
		if(isNaN(num) || num < 0) Dd('number_'+itemid).value = num = mina;
		good = parseFloat(Dd('price_'+itemid).innerHTML)*num;
		Dd('total_'+itemid).innerHTML = good.toFixed(2);
		_good += good;
	}
	Dd('total_amount').innerHTML = _good.toFixed(2);
}
{if $tags}calculate();{/if}
</script>

{template 'footer2017'}