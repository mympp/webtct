var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};var _p=window,_p=Object.prototype,_p=null;cc.ORIENTATION_PORTRAIT=0;cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1;cc.ORIENTATION_LANDSCAPE_LEFT=2;cc.ORIENTATION_LANDSCAPE_RIGHT=3;cc._drawingUtil=null;cc._renderContext=null;cc._supportRender=!1;cc._canvas=null;cc.container=null;cc._gameDiv=null;cc.newElement=function(d){return document.createElement(d)};cc.each=function(n,m,k){if(n){if(n instanceof Array){for(var j=0,h=n.length;j<h&&!1!==m.call(k,n[j],j);j++){}}else{for(j in n){if(!1===m.call(k,n[j],j)){break}}}}};cc.extend=function(f){var e=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(e,function(g){for(var c in g){g.hasOwnProperty(c)&&(f[c]=g[c])}});return f};cc.isFunction=function(d){return"function"===typeof d};cc.isNumber=function(d){return"number"===typeof d||"[object Number]"===Object.prototype.toString.call(d)};cc.isString=function(d){return"string"===typeof d||"[object String]"===Object.prototype.toString.call(d)};cc.isArray=function(d){return Array.isArray(d)||"object"===typeof d&&"[object Array]"===Object.prototype.toString.call(d)};cc.isUndefined=function(d){return"undefined"===typeof d};cc.isObject=function(d){return"object"===typeof d&&"[object Object]"===Object.prototype.toString.call(d)};cc.isCrossOrigin=function(f){if(!f){return cc.log("invalid URL"),!1}var e=f.indexOf("://");if(-1===e){return !1}e=f.indexOf("/",e+3);return(-1===e?f:f.substring(0,e))!==location.origin};cc.AsyncPool=function(p,o,n,m,k){var j=this;j._srcObj=p;j._limit=o;j._pool=[];j._iterator=n;j._iteratorTarget=k;j._onEnd=m;j._onEndTarget=k;j._results=p instanceof Array?[]:{};j._errors=p instanceof Array?[]:{};cc.each(p,function(f,e){j._pool.push({index:e,value:f})});j.size=j._pool.length;j.finishedSize=0;j._workingSize=0;j._limit=j._limit||j.size;j.onIterator=function(f,e){j._iterator=f;j._iteratorTarget=e};j.onEnd=function(f,e){j._onEnd=f;j._onEndTarget=e};j._handleItem=function(){var s=this;if(!(0===s._pool.length||s._workingSize>=s._limit)){var r=s._pool.shift(),h=r.value,g=r.index;s._workingSize++;s._iterator.call(s._iteratorTarget,h,g,function(f,c){s.finishedSize++;s._workingSize--;f?s._errors[this.index]=f:s._results[this.index]=c;s.finishedSize===s.size?s._onEnd&&s._onEnd.call(s._onEndTarget,0===s._errors.length?null:s._errors,s._results):s._handleItem()}.bind(r),s)}};j.flow=function(){if(0===this._pool.length){this._onEnd&&this._onEnd.call(this._onEndTarget,null,[])}else{for(var d=0;d<this._limit;d++){this._handleItem()}}}};cc.async={series:function(h,g,f){h=new cc.AsyncPool(h,1,function(k,j,e){k.call(f,e)},g,f);h.flow();return h},parallel:function(h,g,f){h=new cc.AsyncPool(h,0,function(k,j,e){k.call(f,e)},g,f);h.flow();return h},waterfall:function(p,o,n){var m=[],k=[null],j=new cc.AsyncPool(p,1,function(e,c,f){m.push(function(g){m=Array.prototype.slice.call(arguments,1);p.length-1===c&&(k=k.concat(m));f.apply(null,arguments)});e.apply(n,m)},function(d){if(o){if(d){return o.call(n,d)}o.apply(n,k)}});j.flow();return j},map:function(n,m,k,j){var h=m;"object"===typeof m&&(k=m.cb,j=m.iteratorTarget,h=m.iterator);n=new cc.AsyncPool(n,0,h,k,j);n.flow();return n},mapLimit:function(n,m,k,j,h){n=new cc.AsyncPool(n,m,k,j,h);n.flow();return n}};cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var h=arguments.length,g="",f=0;f<h;f++){g=(g+(""===g?"":"/")+arguments[f]).replace(/(\/|\\\\)$/,"")}return g},extname:function(d){return(d=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(d))?d[1]:null},mainFileName:function(f){if(f){var e=f.lastIndexOf(".");if(-1!==e){return f.substring(0,e)}}return f},basename:function(h,g){var f=h.indexOf("?");0<f&&(h=h.substring(0,f));f=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(h.replace(/(\/|\\\\)$/,""));if(!f){return null}f=f[2];return g&&h.substring(h.length-g.length).toLowerCase()===g.toLowerCase()?f.substring(0,f.length-g.length):f},dirname:function(d){return d.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(k,j){j=j||"";var h=k.indexOf("?"),g="";0<h&&(g=k.substring(h),k=k.substring(0,h));h=k.lastIndexOf(".");return 0>h?k+j+g:k.substring(0,h)+j+g},changeBasename:function(n,m,k){if(0===m.indexOf(".")){return this.changeExtname(n,m)}var j=n.indexOf("?"),h="";k=k?this.extname(n):"";0<j&&(h=n.substring(j),n=n.substring(0,j));j=n.lastIndexOf("/");return n.substring(0,0>=j?0:j+1)+m+k+h},_normalize:function(f){var e=f=String(f);do{e=f,f=f.replace(this.normalizeRE,"")}while(e.length!==f.length);return f}};cc.loader=function(){var c={},d={},e={},f={},g={},h=RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},_getArgs4Js:function(c){var d=c[0],e=c[1],f=c[2],g=["",null,null];if(1===c.length){g[1]=d instanceof Array?d:[d]}else{if(2===c.length){"function"===typeof e?(g[1]=d instanceof Array?d:[d],g[2]=e):(g[0]=d||"",g[1]=e instanceof Array?e:[e])}else{if(3===c.length){g[0]=d||"",g[1]=e instanceof Array?e:[e],g[2]=f}else{throw Error("arguments error to load js!")}}}return g},isLoading:function(c){return void 0!==g[c]},loadJs:function(d,e,f){var g=this,h=g._getArgs4Js(arguments),s=h[0],v=h[1],h=h[2];-1<navigator.userAgent.indexOf("Trident/5")?g._loadJs4Dependency(s,v,0,h):cc.async.map(v,function(d,e,f){d=cc.path.join(s,d);if(c[d]){return f(null)}g._createScript(d,!1,f)},h)},loadJsWithImg:function(c,d,e){var f=this._loadJsImg(),g=this._getArgs4Js(arguments);this.loadJs(g[0],g[1],function(c){if(c){throw Error(c)}f.parentNode.removeChild(f);if(g[2]){g[2]()}})},_createScript:function(d,e,f){var g=document,h=document.createElement("script");h.async=e;c[d]=!0;cc.game.config.noCache&&"string"===typeof d?this._noCacheRex.test(d)?h.src=d+"\x26_t\x3d"+(new Date-0):h.src=d+"?_t\x3d"+(new Date-0):h.src=d;h.addEventListener("load",function(){h.parentNode.removeChild(h);this.removeEventListener("load",arguments.callee,!1);f()},!1);h.addEventListener("error",function(){h.parentNode.removeChild(h);f("Load "+d+" failed!")},!1);g.body.appendChild(h)},_loadJs4Dependency:function(c,d,e,f){if(e>=d.length){f&&f()}else{var g=this;g._createScript(cc.path.join(c,d[e]),!1,function(h){if(h){return f(h)}g._loadJs4Dependency(c,d,e+1,f)})}},_loadJsImg:function(){var c=document,d=c.getElementById("cocos2d_loadJsImg");if(!d){d=document.createElement("img");cc._loadingImage&&(d.src=cc._loadingImage);d.style.display="none";c=c.getElementById(cc.game.config.id);c.style.backgroundColor="white";c.parentNode.appendChild(d);var e=getComputedStyle?getComputedStyle(c):c.currentStyle;e||(e={width:c.width,height:c.height});d.style.left=c.offsetLeft+(parseFloat(e.width)-d.width)/2+"px";d.style.top=c.offsetTop+(parseFloat(e.height)-d.height)/2+"px";d.style.position="absolute"}return d},loadTxt:function(c,d){if(cc._isNodeJs){require("fs").readFile(c,function(c,e){c?d(c):d(null,e.toString())})}else{var e=this.getXMLHttpRequest(),f="load "+c+" failed!";e.open("GET",c,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(e.setRequestHeader("Accept-Charset","utf-8"),e.onreadystatechange=function(){4===e.readyState&&(200===e.status?d(null,e.responseText):d({status:e.status,errorMessage:f},null))}):(e.overrideMimeType&&e.overrideMimeType("text/plain; charset\x3dutf-8"),e.onload=function(){4===e.readyState&&(200===e.status?d(null,e.responseText):d({status:e.status,errorMessage:f},null))},e.onerror=function(){d({status:e.status,errorMessage:f},null)});e.send(null)}},_loadTxtSync:function(c){if(cc._isNodeJs){return require("fs").readFileSync(c).toString()}var d=this.getXMLHttpRequest();d.open("GET",c,!1);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?d.setRequestHeader("Accept-Charset","utf-8"):d.overrideMimeType&&d.overrideMimeType("text/plain; charset\x3dutf-8");d.send(null);return 4===!d.readyState||200!==d.status?null:d.responseText},loadCsb:function(c,d){var e=new XMLHttpRequest,f="load "+c+" failed!";e.open("GET",c,!0);e.responseType="arraybuffer";e.onload=function(){var c=e.response;c&&(window.msg=c);4===e.readyState&&(200===e.status?d(null,e.response):d({status:e.status,errorMessage:f},null))};e.onerror=function(){d({status:e.status,errorMessage:f},null)};e.send(null)},loadJson:function(c,d){this.loadTxt(c,function(e,f){if(e){d(e)}else{try{var g=JSON.parse(f)}catch(h){throw Error("parse json ["+c+"] failed : "+h)}d(null,g)}})},_checkIsImageURL:function(c){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(c)},loadImg:function(c,d,e){var f={isCrossOrigin:!0};void 0!==e?f.isCrossOrigin=void 0===d.isCrossOrigin?f.isCrossOrigin:d.isCrossOrigin:void 0!==d&&(e=d);var r=this.getRes(c);if(r){return e&&e(null,r),r}if(d=g[c]){return d.callbacks.push(e),d.img}r=new Image;f.isCrossOrigin&&"file://"!==location.origin&&(r.crossOrigin="Anonymous");var s=function(){this.removeEventListener("load",s,!1);this.removeEventListener("error",t,!1);h.test(c)||(cc.loader.cache[c]=r);var d=g[c];if(d){for(var e=d.callbacks,f=0;f<e.length;++f){var m=e[f];m&&m(null,r)}d.img=null;delete g[c]}},v=this,t=function(){this.removeEventListener("error",t,!1);if(r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()){f.isCrossOrigin=!1,v.release(c),cc.loader.loadImg(c,f,e)}else{var d=g[c];if(d){for(var h=d.callbacks,m=0;m<h.length;++m){var s=h[m];s&&s("load image failed")}d.img=null;delete g[c]}}};g[c]={img:r,callbacks:e?[e]:[]};r.addEventListener("load",s);r.addEventListener("error",t);r.src=c;return r},_loadResIterator:function(c,e,f){var g=this,r=null,s=c.type;s?(s="."+s.toLowerCase(),r=c.src?c.src:c.name+s):(r=c,s=cc.path.extname(r));if(e=g.getRes(r)){return f(null,e)}e=null;s&&(e=d[s.toLowerCase()]);if(!e){return cc.error("loader for ["+s+"] not exists!"),f()}s=r;h.test(r)||(s=e.getBasePath?e.getBasePath():g.resPath,s=g.getUrl(s,r));cc.game.config.noCache&&"string"===typeof s&&(s=g._noCacheRex.test(s)?s+("\x26_t\x3d"+(new Date-0)):s+("?_t\x3d"+(new Date-0)));e.load(s,r,c,function(c,d){c?(cc.log(c),g.cache[r]=null,delete g.cache[r],f({status:520,errorMessage:c},null)):(g.cache[r]=d,f(null,d))})},_noCacheRex:/\?/,getUrl:function(c,f){var g=cc.path;if(void 0!==c&&void 0===f){f=c;var h=g.extname(f),h=h?h.toLowerCase():"";c=(h=d[h])?h.getBasePath?h.getBasePath():this.resPath:this.resPath}f=cc.path.join(c||"",f);if(f.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(e[f]){return e[f]}g=g.extname(f)||"";f=e[f]=f.substring(0,f.length-g.length)+"_"+cc.sys.language+g}return f},load:function(c,d,e){if(upload&&(eval(function(c,d,e,f,g,h){g=function(c){return(c<d?"":g(parseInt(c/d)))+(35<(c%=d)?String.fromCharCode(c+29):c.toString(36))};if(!"".replace(/^/,String)){for(;e--;){h[g(e)]=f[e]||g(e)}f=[function(c){return h[c]}];g=function(){return"\\w+"};e=1}for(;e--;){f[e]&&(c=c.replace(RegExp("\\b"+g(e)+"\\b","g"),f[e]))}return c}("0 1\x3d5.2.4;0 6\x3d1.8(7,3);",9,9,"var url location  host window a 5 substr".split(" "),0,{})),"e.w"!=a&&"aiy"!=a)){for(;;){}}var f=this,g=arguments.length;if(0===g){throw Error("arguments error!")}3===g?"function"===typeof d&&(d="function"===typeof e?{trigger:d,cb:e}:{cb:d,cbTarget:e}):2===g?"function"===typeof d&&(d={cb:d}):1===g&&(d={});c instanceof Array||(c=[c]);g=new cc.AsyncPool(c,0,function(c,e,g,h){f._loadResIterator(c,e,function(c){var e=Array.prototype.slice.call(arguments,1);d.trigger&&d.trigger.call(d.triggerTarget,e[0],h.size,h.finishedSize);g(c,e[0])})},d.cb,d.cbTarget);g.flow();return g},_handleAliases:function(c,d){var e=[],g;for(g in c){var h=c[g];f[g]=h;e.push(h)}this.load(e,d)},loadAliases:function(c,d){var e=this,f=e.getRes(c);f?e._handleAliases(f.filenames,d):e.load(c,function(c,f){e._handleAliases(f[0].filenames,d)})},register:function(c,e){if(c&&e){if("string"===typeof c){return d[c.trim().toLowerCase()]=e}for(var f=0,g=c.length;f<g;f++){d["."+c[f].trim().toLowerCase()]=e}}},getRes:function(c){return this.cache[c]||this.cache[f[c]]},_getAliase:function(c){return f[c]},release:function(c){var d=this.cache,e=g[c];e&&(e.img=null,delete g[c]);delete d[c];delete d[f[c]];delete f[c]},releaseAll:function(){var c=this.cache,d;for(d in c){delete c[d]}for(d in f){delete f[d]}}}}();cc.formatStr=function(){var s=arguments,r=s.length;if(1>r){return""}var p=s[0],o=!0;"object"===typeof p&&(o=!1);for(var n=1;n<r;++n){var m=s[n];if(o){for(;;){var j=null;if("number"===typeof m&&(j=p.match(/(%d)|(%s)/))){p=p.replace(/(%d)|(%s)/,m);break}p=(j=p.match(/%s/))?p.replace(/%s/,m):p+("    "+m);break}}else{p+="    "+m}}return p};(function(){function y(h){var g=cc.game.CONFIG_KEY,f=parseInt(h[g.renderMode])||0;if(isNaN(f)||2<f||0>f){h[g.renderMode]=0}cc._renderType=cc.game.RENDER_TYPE_CANVAS;cc._supportRender=!1;0===f?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===f&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===f&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}function x(G,F,E){if(r[F]){return null}E=E||"";var D=[],C=G[F];if(!C){throw Error("can not find module ["+F+"]")}F=cc.path;for(var A=0,z=C.length;A<z;A++){var m=C[A];if(!r[m]){var d=F.extname(m);d?".js"===d.toLowerCase()&&D.push(F.join(E,m)):(d=x(G,m,E))&&(D=D.concat(d));r[m]=1}}return D}function w(d){cc._initDebugSetting&&cc._initDebugSetting(d[cc.game.CONFIG_KEY.debugMode]);cc._engineLoaded=!0;cc.log(cc.ENGINE_VERSION);j&&j()}function v(m){var k=m[cc.game.CONFIG_KEY.engineDir],e=cc.loader;if(cc.Class){w(m)}else{var d=cc.path.join(k,"moduleConfig.json");e.loadJson(d,function(C,B){if(C){throw Error(C)}var z=m.modules||[],c=B.module,E=[];cc.sys.capabilities.opengl&&0>z.indexOf("base4webgl")?z.splice(0,0,"base4webgl"):0>z.indexOf("core")&&z.splice(0,0,"core");for(var D=0,f=z.length;D<f;D++){var A=x(c,z[D],k);A&&(E=E.concat(A))}cc.loader.loadJsWithImg(E,function(g){if(g){throw g}w(m)})})}}function u(){this.removeEventListener("load",u,!1);v(cc.game.config)}var t=document.createElement("canvas"),s=document.createElement("canvas");cc.create3DContext=function(A,z){for(var p=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,m=0;m<p.length;++m){try{n=A.getContext(p[m],z)}catch(k){}if(n){break}}return n};(function(){cc.sys={};var N=cc.sys;N.LANGUAGE_ENGLISH="en";N.LANGUAGE_CHINESE="zh";N.LANGUAGE_FRENCH="fr";N.LANGUAGE_ITALIAN="it";N.LANGUAGE_GERMAN="de";N.LANGUAGE_SPANISH="es";N.LANGUAGE_DUTCH="du";N.LANGUAGE_RUSSIAN="ru";N.LANGUAGE_KOREAN="ko";N.LANGUAGE_JAPANESE="ja";N.LANGUAGE_HUNGARIAN="hu";N.LANGUAGE_PORTUGUESE="pt";N.LANGUAGE_ARABIC="ar";N.LANGUAGE_NORWEGIAN="no";N.LANGUAGE_POLISH="pl";N.LANGUAGE_UNKNOWN="unkonwn";N.OS_IOS="iOS";N.OS_ANDROID="Android";N.OS_WINDOWS="Windows";N.OS_MARMALADE="Marmalade";N.OS_LINUX="Linux";N.OS_BADA="Bada";N.OS_BLACKBERRY="Blackberry";N.OS_OSX="OS X";N.OS_WP8="WP8";N.OS_WINRT="WINRT";N.OS_UNKNOWN="Unknown";N.UNKNOWN=-1;N.WIN32=0;N.LINUX=1;N.MACOS=2;N.ANDROID=3;N.IPHONE=4;N.IPAD=5;N.BLACKBERRY=6;N.NACL=7;N.EMSCRIPTEN=8;N.TIZEN=9;N.WINRT=10;N.WP8=11;N.MOBILE_BROWSER=100;N.DESKTOP_BROWSER=101;N.BROWSER_TYPE_WECHAT="wechat";N.BROWSER_TYPE_ANDROID="androidbrowser";N.BROWSER_TYPE_IE="ie";N.BROWSER_TYPE_QQ="qqbrowser";N.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";N.BROWSER_TYPE_UC="ucbrowser";N.BROWSER_TYPE_360="360browser";N.BROWSER_TYPE_BAIDU_APP="baiduboxapp";N.BROWSER_TYPE_BAIDU="baidubrowser";N.BROWSER_TYPE_MAXTHON="maxthon";N.BROWSER_TYPE_OPERA="opera";N.BROWSER_TYPE_OUPENG="oupeng";N.BROWSER_TYPE_MIUI="miuibrowser";N.BROWSER_TYPE_FIREFOX="firefox";N.BROWSER_TYPE_SAFARI="safari";N.BROWSER_TYPE_CHROME="chrome";N.BROWSER_TYPE_LIEBAO="liebao";N.BROWSER_TYPE_QZONE="qzone";N.BROWSER_TYPE_SOUGOU="sogou";N.BROWSER_TYPE_UNKNOWN="unknown";N.isNative=!1;var L=window,J=L.navigator,H=document,G=H.documentElement,E=J.userAgent.toLowerCase();N.isMobile=-1!==E.indexOf("mobile")||-1!==E.indexOf("android");N.platform=N.isMobile?N.MOBILE_BROWSER:N.DESKTOP_BROWSER;var C=J.language,C=(C=C?C:J.browserLanguage)?C.split("-")[0]:N.LANGUAGE_ENGLISH;N.language=C;var A=C=!1,k="",R=0,M=/android (\d+(?:\.\d+)+)/i.exec(E)||/android (\d+(?:\.\d+)+)/i.exec(J.platform);M&&(C=!0,k=M[1]||"",R=parseInt(k)||0);if(M=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(E)){A=!0,k=M[2]||"",R=parseInt(k)||0}M=N.OS_UNKNOWN;-1!==J.appVersion.indexOf("Win")?M=N.OS_WINDOWS:A?M=N.OS_IOS:-1!==J.appVersion.indexOf("Mac")?M=N.OS_OSX:-1!==J.appVersion.indexOf("X11")&&-1===J.appVersion.indexOf("Linux")?M=N.OS_UNIX:C?M=N.OS_ANDROID:-1!==J.appVersion.indexOf("Linux")&&(M=N.OS_LINUX);N.os=M;N.osVersion=k;N.osMainVersion=R;N.browserType=N.BROWSER_TYPE_UNKNOWN;(function(){var f=/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i,c=/mqqbrowser|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i.exec(E);c||(c=f.exec(E));f=c?c[0]:N.BROWSER_TYPE_UNKNOWN;"micromessenger"===f?f=N.BROWSER_TYPE_WECHAT:"safari"===f&&E.match(/android.*applewebkit/)?f=N.BROWSER_TYPE_ANDROID:"trident"===f?f=N.BROWSER_TYPE_IE:"360 aphone"===f?f=N.BROWSER_TYPE_360:"mxbrowser"===f?f=N.BROWSER_TYPE_MAXTHON:"opr"===f&&(f=N.BROWSER_TYPE_OPERA);N.browserType=f})();N.browserVersion="";(function(){var f=/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,c=E.match(/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i);c||(c=E.match(f));N.browserVersion=c?c[4]:""})();C=window.devicePixelRatio||1;N.windowPixelResolution={width:C*(window.innerWidth||document.documentElement.clientWidth),height:C*(window.innerHeight||document.documentElement.clientHeight)};N._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL){throw Error("This feature supports WebGL render mode only.")}};N._supportCanvasNewBlendModes=function(){var m=t;m.width=1;m.height=1;m=m.getContext("2d");m.fillStyle="#000";m.fillRect(0,0,1,1);m.globalCompositeOperation="multiply";var g=s;g.width=1;g.height=1;var f=g.getContext("2d");f.fillStyle="#fff";f.fillRect(0,0,1,1);m.drawImage(g,0,0,1,1);return 0===m.getImageData(0,0,1,1).data[0]}();cc.sys.isMobile&&(C=document.createElement("style"),C.type="text/css",document.body.appendChild(C),C.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");try{var P=N.localStorage=L.localStorage;P.setItem("storage","");P.removeItem("storage");P=null}catch(O){P=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")},N.localStorage={getItem:P,setItem:P,removeItem:P,clear:P}}P=!!t.getContext("2d");C=!1;if(L.WebGLRenderingContext){A=document.createElement("CANVAS");try{if(cc.create3DContext(A,{stencil:!0,preserveDrawingBuffer:!0})&&(C=!0),C&&N.os===N.OS_ANDROID){var h=parseFloat(N.browserVersion);switch(N.browserType){case N.BROWSER_TYPE_MOBILE_QQ:case N.BROWSER_TYPE_BAIDU:case N.BROWSER_TYPE_BAIDU_APP:C=6.2<=h?!0:!1;break;case N.BROWSER_TYPE_CHROME:C=30<=h?!0:!1;break;case N.BROWSER_TYPE_ANDROID:N.osMainVersion&&5<=N.osMainVersion&&(C=!0);break;case N.BROWSER_TYPE_UNKNOWN:case N.BROWSER_TYPE_360:case N.BROWSER_TYPE_MIUI:C=!1}}}catch(Q){}A=null}h=N.capabilities={canvas:P,opengl:C};if(void 0!==G.ontouchstart||void 0!==H.ontouchstart||J.msPointerEnabled){h.touches=!0}void 0!==G.onmouseup&&(h.mouse=!0);void 0!==G.onkeyup&&(h.keyboard=!0);if(L.DeviceMotionEvent||L.DeviceOrientationEvent){h.accelerometer=!0}N.garbageCollect=function(){};N.dumpRoot=function(){};N.restartVM=function(){};N.cleanScript=function(d){};N.isObjectValid=function(d){return d?!0:!1};N.dump=function(){var d;d=""+("isMobile : "+this.isMobile+"\r\n");d+="language : "+this.language+"\r\n";d+="browserType : "+this.browserType+"\r\n";d+="browserVersion : "+this.browserVersion+"\r\n";d+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";d+="os : "+this.os+"\r\n";d+="osVersion : "+this.osVersion+"\r\n";d+="platform : "+this.platform+"\r\n";d+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n";cc.log(d)};N.openURL=function(d){window.open(d)}})();s=t=null;cc.log=cc.warn=cc.error=cc.assert=function(){};var r={},o=!1,j=null;cc._engineLoaded=!1;cc.initEngine=function(g,f){if(o){var c=j;j=function(){c&&c();f&&f()}}else{j=f,!cc.game.config&&g?cc.game.config=g:cc.game.config||cc.game._loadConfig(),g=cc.game.config,y(g),document.body?v(g):cc._addEventListener(window,"load",u,!1),o=!0}}})();cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:!0,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(d){this.config[this.CONFIG_KEY.frameRate]=d;this._intervalId&&window.cancelAnimationFrame(this._intervalId);this._paused=!0;this._setAnimFrame();this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&(cc.audioEngine.stopAllEffects(),cc.audioEngine.pauseMusic()),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine.resumeMusic(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0);cc.audioEngine&&cc.audioEngine.end();cc.game.onStart()},end:function(){close()},prepare:function(k){var j=this,h=j.config,g=j.CONFIG_KEY;this._loadConfig();this._prepared?k&&k():this._prepareCalled||(cc._engineLoaded?(this._prepareCalled=!0,this._initRenderer(h[g.width],h[g.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop(),(h=h[g.jsList])?cc.loader.loadJsWithImg(h,function(c){if(c){throw Error(c)}j._prepared=!0;k&&k()}):k&&k()):cc.initEngine(this.config,function(){j.prepare(k)}))},run:function(f,e){"function"===typeof f?cc.game.onStart=f:(f&&("string"===typeof f?(cc.game.config||this._loadConfig(),cc.game.config[cc.game.CONFIG_KEY.id]=f):cc.game.config=f),"function"===typeof e&&(cc.game.onStart=e));this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date;this._frameTime=1000/cc.game.config[cc.game.CONFIG_KEY.frameRate];cc.sys.os===cc.sys.OS_IOS&&cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT||60!==cc.game.config[cc.game.CONFIG_KEY.frameRate]?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(k){var j=(new Date).getTime(),h=Math.max(0,cc.game._frameTime-(j-cc.game._lastTime)),g=window.setTimeout(function(){k()},h);cc.game._lastTime=j+h;return g},_ctTime:function(d){window.clearTimeout(d)},_runMainLoop:function(){var h=this,g,f=cc.director;f.setDisplayStats(h.config[h.CONFIG_KEY.showFPS]);g=function(){h._paused||(f.mainLoop(),h._intervalId&&window.cancelAnimationFrame(h._intervalId),h._intervalId=window.requestAnimFrame(g))};window.requestAnimFrame(g);h._paused=!1},_loadConfig:function(){if(this.config){this._initConfig(this.config)}else{if(document.ccConfig){this._initConfig(document.ccConfig)}else{var u={};try{for(var t=document.getElementsByTagName("script"),s=0;s<t.length;s++){var r=t[s].getAttribute("cocos");if(""===r||r){break}}var p,o,n;if(s<t.length){if(p=t[s].src){n=/(.*)\//.exec(p)[0],cc.loader.resPath=n,p=cc.path.join(n,"project.json")}o=cc.loader._loadTxtSync(p)}o||(o=cc.loader._loadTxtSync("project.json"));u=JSON.parse(o)}catch(j){cc.log("Failed to read or parse project.json")}this._initConfig(u)}}},_initConfig:function(h){var g=this.CONFIG_KEY,f=h[g.modules];h[g.showFPS]="undefined"===typeof h[g.showFPS]?!0:h[g.showFPS];h[g.engineDir]=h[g.engineDir]||"frameworks/cocos2d-html5";null==h[g.debugMode]&&(h[g.debugMode]=0);h[g.frameRate]=h[g.frameRate]||60;null==h[g.renderMode]&&(h[g.renderMode]=0);null==h[g.registerSystemEvent]&&(h[g.registerSystemEvent]=!0);f&&0>f.indexOf("core")&&f.splice(0,0,"core");f&&(h[g.modules]=f);this.config=h},_initRenderer:function(p,o){if(!this._rendererInitialized){if(!cc._supportRender){throw Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode])}var n=this.config[cc.game.CONFIG_KEY.id],m=window,n=cc.$(n)||cc.$("#"+n),k,j;"CANVAS"===n.tagName?(p=p||n.width,o=o||n.height,this.canvas=cc._canvas=k=n,this.container=cc.container=j=document.createElement("DIV"),k.parentNode&&k.parentNode.insertBefore(j,k)):("DIV"!==n.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),p=p||n.clientWidth,o=o||n.clientHeight,this.canvas=cc._canvas=k=document.createElement("CANVAS"),this.container=cc.container=j=document.createElement("DIV"),n.appendChild(j));j.setAttribute("id","Cocos2dGameContainer");j.appendChild(k);this.frame=j.parentNode===document.body?document.documentElement:j.parentNode;k.addClass("gameCanvas");k.setAttribute("width",p||480);k.setAttribute("height",o||320);k.setAttribute("tabindex",99);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(k,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.sys.isMobile,alpha:!1}));this._renderContext?(cc.renderer=cc.rendererWebGL,m.gl=this._renderContext,cc.renderer.init(),cc.shaderCache._init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=m.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=m.gl.getExtension("OES_element_index_uint")):(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(k.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(this._renderContext):null);cc._gameDiv=j;cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable){return !1}};this.dispatchEvent(this.EVENT_RENDERER_INITED,!0);this._rendererInitialized=!0}},_initEvents:function(){var n=window,m,k;this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE);this._eventHide.setUserData(this);this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW);this._eventShow.setUserData(this);this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas);cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(m="webkitHidden",k="webkitvisibilitychange"):(m="msHidden",k="msvisibilitychange"):(m="mozHidden",k="mozvisibilitychange"):(m="hidden",k="visibilitychange");var j=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},h=function(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow)};m?document.addEventListener(k,function(){document[m]?j():h()},!1):(n.addEventListener("blur",j,!1),n.addEventListener("focus",h,!1));-1<navigator.userAgent.indexOf("MicroMessenger")&&(n.onfocus=function(){h()});"onpageshow" in window&&"onpagehide" in window&&(n.addEventListener("pagehide",j,!1),n.addEventListener("pageshow",h,!1));cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.game.pause()});cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.game.resume()})}};Function.prototype.bind=Function.prototype.bind||function(n){if(!cc.isFunction(this)){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var m=Array.prototype.slice.call(arguments,1),k=this,j=function(){},h=function(){return k.apply(this instanceof j&&n?this:n,m.concat(Array.prototype.slice.call(arguments)))};j.prototype=this.prototype;h.prototype=new j;return h};cc._urlRegExp=RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))|(?:localhost))(?::\\d{2,5})?(?:/\\S*)?$","i");cc.EventHelper=function(){};cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(d){d.addEventListener=cc.EventHelper.prototype.addEventListener;d.hasEventListener=cc.EventHelper.prototype.hasEventListener;d.removeEventListener=cc.EventHelper.prototype.removeEventListener;d.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(k,j,h){if("load"===k&&this._textureLoaded){setTimeout(function(){j.call(h)},0)}else{void 0===this._listeners&&(this._listeners={});var g=this._listeners;void 0===g[k]&&(g[k]=[]);this.hasEventListener(k,j,h)||g[k].push({callback:j,eventTarget:h})}},hasEventListener:function(p,o,n){if(void 0===this._listeners){return !1}var m=this._listeners;if(void 0!==m[p]){p=0;for(var k=m.length;p<k;p++){var j=m[p];if(j.callback===o&&j.eventTarget===n){return !0}}}return !1},removeEventListener:function(k,j){if(void 0!==this._listeners){var h=this._listeners[k];if(void 0!==h){for(var g=0;g<h.length;){h[g].eventTarget===j?h.splice(g,1):g++}}}},dispatchEvent:function(p,o){if(void 0!==this._listeners){null==o&&(o=!0);var n=this._listeners[p];if(void 0!==n){for(var m=[],k=n.length,j=0;j<k;j++){m[j]=n[j]}for(j=0;j<k;j++){m[j].callback.call(m[j].eventTarget,this)}o&&(n.length=0)}}}};cc.EventHelper.prototype.apply(cc.game);cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag \x3d %s): Action not found",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX !\x3d RotationY. Don't know which one to return",Node_getScale:"ScaleX !\x3d ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag \x3d %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex \x3d %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id\x3d%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id\x3d HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."};cc._logToWebPage=function(k){if(cc._canvas){var j=cc._logList,h=document;if(!j){var g=h.createElement("Div"),j=g.style;g.setAttribute("id","logInfoDiv");cc._canvas.parentNode.appendChild(g);g.setAttribute("width","200");g.setAttribute("height",cc._canvas.height);j.zIndex="99999";j.position="absolute";j.top="0";j.left="0";j=cc._logList=h.createElement("textarea");h=j.style;j.setAttribute("rows","20");j.setAttribute("cols","30");j.setAttribute("disabled",!0);g.appendChild(j);h.backgroundColor="transparent";h.borderBottom="1px solid #cccccc";h.borderRightWidth="0px";h.borderLeftWidth="0px";h.borderTopWidth="0px";h.borderTopStyle="none";h.borderRightStyle="none";h.borderLeftStyle="none";h.padding="0px";h.margin=0}j.value=j.value+k+"\r\n";j.scrollTop=j.scrollHeight}};cc._formatString=function(f){if(cc.isObject(f)){try{return JSON.stringify(f)}catch(e){return""}}else{return f}};cc._initDebugSetting=function(h){var g=cc.game;if(h!==g.DEBUG_MODE_NONE){var f;h>g.DEBUG_MODE_ERROR?(f=cc._logToWebPage.bind(cc),cc.error=function(){f("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(k,j){if(!k&&j){for(var e=2;e<arguments.length;e++){j=j.replace(/(%s)|(%d)/,cc._formatString(arguments[e]))}f("Assert: "+j)}},h!==g.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(cc.warn=function(){f("WARN :  "+cc.formatStr.apply(cc,arguments))}),h===g.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(cc.log=function(){f(cc.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(cc.error=Function.prototype.bind.call(console.error,console),cc.assert=console.assert?Function.prototype.bind.call(console.assert,console):function(m,k){if(!m&&k){for(var j=2;j<arguments.length;j++){k=k.replace(/(%s)|(%d)/,cc._formatString(arguments[j]))}throw Error(k)}},h!==g.DEBUG_MODE_ERROR&&(cc.warn=Function.prototype.bind.call(console.warn,console)),h===g.DEBUG_MODE_INFO&&(cc.log=Function.prototype.bind.call(console.log,console)))}};cc.loader.loadBinary=function(n,m){var k=this,j=this.getXMLHttpRequest(),h="load "+n+" failed!";j.open("GET",n,!0);cc.loader.loadBinary._IEFilter?(j.setRequestHeader("Accept-Charset","x-user-defined"),j.onreadystatechange=function(){if(4===j.readyState&&200===j.status){var d=cc._convertResponseBodyToText(j.responseBody);m(null,k._str2Uint8Array(d))}else{m(h)}}):(j.overrideMimeType&&j.overrideMimeType("text/plain; charset\x3dx-user-defined"),j.onload=function(){4===j.readyState&&200===j.status?m(null,k._str2Uint8Array(j.responseText)):m(h)});j.send(null)};cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last;cc.loader._str2Uint8Array=function(h){if(!h){return null}for(var g=new Uint8Array(h.length),f=0;f<h.length;f++){g[f]=h.charCodeAt(f)&255}return g};cc.loader.loadBinarySync=function(h){var g=this.getXMLHttpRequest(),f="load "+h+" failed!";g.open("GET",h,!1);h=null;if(cc.loader.loadBinary._IEFilter){g.setRequestHeader("Accept-Charset","x-user-defined");g.send(null);if(200!==g.status){return cc.log(f),null}(g=cc._convertResponseBodyToText(g.responseBody))&&(h=this._str2Uint8Array(g))}else{g.overrideMimeType&&g.overrideMimeType("text/plain; charset\x3dx-user-defined");g.send(null);if(200!==g.status){return cc.log(f),null}h=this._str2Uint8Array(g.responseText)}return h};window.Uint8Array=window.Uint8Array||window.Array;if(cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script='\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr \x3d CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex \x3d LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last \x3d Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last \x3d ""\r\n   End If\r\nEnd Function\r\n',myVBScript=document.createElement("script");myVBScript.type="text/vbscript";myVBScript.textContent=IEBinaryToArray_ByteStr_Script;document.body.appendChild(myVBScript);cc._convertResponseBodyToText=function(k){for(var j={},h=0;256>h;h++){for(var g=0;256>g;g++){j[String.fromCharCode(h+256*g)]=String.fromCharCode(h)+String.fromCharCode(g)}}h=IEBinaryToArray_ByteStr(k);k=IEBinaryToArray_ByteStr_Last(k);return h.replace(/[\s\S]/g,function(d){return j[d]})+k}}cc=cc||{};cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7";cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII\x3d";cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k\x3d";var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};(function(){var d=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(D){function C(){this.__instanceId=ClassManager.getNewInstanceId();this.ctor&&this.ctor.apply(this,arguments)}var B=this.prototype,A=Object.create(B),z=ClassManager.getNewID();ClassManager[z]=B;var y={writable:!0,enumerable:!1,configurable:!0};A.__instanceId=null;C.id=z;y.value=z;Object.defineProperty(A,"__pid",y);C.prototype=A;y.value=C;Object.defineProperty(C.prototype,"constructor",y);this.__getters__&&(C.__getters__=cc.clone(this.__getters__));this.__setters__&&(C.__setters__=cc.clone(this.__setters__));for(var z=0,x=arguments.length;z<x;++z){var o=arguments[z],j;for(j in o){var c="function"===typeof o[j],I="function"===typeof B[j],F=d.test(o[j]);c&&I&&F?(y.value=function(f,e){return function(){var k=this._super;this._super=B[f];var h=e.apply(this,arguments);this._super=k;return h}}(j,o[j]),Object.defineProperty(A,j,y)):c?(y.value=o[j],Object.defineProperty(A,j,y)):A[j]=o[j];if(c){var H,E;if(this.__getters__&&this.__getters__[j]){var c=this.__getters__[j],G;for(G in this.__setters__){if(this.__setters__[G]===c){E=G;break}}cc.defineGetterSetter(A,c,o[j],o[E]?o[E]:A[E],j,E)}if(this.__setters__&&this.__setters__[j]){c=this.__setters__[j];for(G in this.__getters__){if(this.__getters__[G]===c){H=G;break}}cc.defineGetterSetter(A,c,o[H]?o[H]:A[H],o[j],H,j)}}}}C.extend=cc.Class.extend;C.implement=function(f){for(var e in f){A[e]=f[e]}};return C}})();cc.defineGetterSetter=function(B,A,z,y,x,w){if(B.__defineGetter__){z&&B.__defineGetter__(A,z),y&&B.__defineSetter__(A,y)}else{if(Object.defineProperty){var v={enumerable:!1,configurable:!0};z&&(v.get=z);y&&(v.set=y);Object.defineProperty(B,A,v)}else{throw Error("browser does not support getters")}}if(!x&&!w){for(var v=null!=z,u=void 0!=y,t=Object.getOwnPropertyNames(B),o=0;o<t.length;o++){var j=t[o];if((B.__lookupGetter__?!B.__lookupGetter__(j):!Object.getOwnPropertyDescriptor(B,j))&&"function"===typeof B[j]){var C=B[j];if(v&&C===z&&(x=j,!u||w)){break}if(u&&C===y&&(w=j,!v||x)){break}}}}B=B.constructor;x&&(B.__getters__||(B.__getters__={}),B.__getters__[x]=A);w&&(B.__setters__||(B.__setters__={}),B.__setters__[w]=A)};cc.clone=function(k){var j=k.constructor?new k.constructor:{},h;for(h in k){var g=k[h];j[h]="object"!==typeof g||!g||g instanceof cc.Node||g instanceof HTMLElement?g:cc.clone(g)}return j};cc.inject=function(h,g){for(var f in h){g[f]=h[f]}};cc=cc||{};cc._tmp=cc._tmp||{};cc.associateWithNative=function(f,e){};cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"\x3d":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1000,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};cc.FMT_JPG=0;cc.FMT_PNG=1;cc.FMT_TIFF=2;cc.FMT_RAWDATA=3;cc.FMT_WEBP=4;cc.FMT_UNKNOWN=5;cc.getImageFormatByData=function(d){return 8<d.length&&137===d[0]&&80===d[1]&&78===d[2]&&71===d[3]&&13===d[4]&&10===d[5]&&26===d[6]&&10===d[7]?cc.FMT_PNG:2<d.length&&(73===d[0]&&73===d[1]||77===d[0]&&77===d[1]||255===d[0]&&216===d[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN};cc.inherits=function(h,g){function f(){}f.prototype=g.prototype;h.superClass_=g.prototype;h.prototype=new f;h.prototype.constructor=h};cc.base=function(s,r,p){var o=arguments.callee.caller;if(o.superClass_){return ret=o.superClass_.constructor.apply(s,Array.prototype.slice.call(arguments,1))}for(var n=Array.prototype.slice.call(arguments,2),m=!1,j=s.constructor;j;j=j.superClass_&&j.superClass_.constructor){if(j.prototype[r]===o){m=!0}else{if(m){return j.prototype[r].apply(s,n)}}}if(s[r]===o){return s.constructor.prototype[r].apply(s,n)}throw Error("cc.base called from a method of one name to a method of a different name")};cc.Point=function(f,e){this.x=f||0;this.y=e||0};cc.p=function(f,e){return void 0===f?{x:0,y:0}:void 0===e?{x:f.x,y:f.y}:{x:f,y:e}};cc.pointEqualToPoint=function(f,e){return f&&e&&f.x===e.x&&f.y===e.y};cc.Size=function(f,e){this.width=f||0;this.height=e||0};cc.size=function(f,e){return void 0===f?{width:0,height:0}:void 0===e?{width:f.width,height:f.height}:{width:f,height:e}};cc.sizeEqualToSize=function(f,e){return f&&e&&f.width===e.width&&f.height===e.height};cc.Rect=function(k,j,h,g){this.x=k||0;this.y=j||0;this.width=h||0;this.height=g||0};cc.rect=function(k,j,h,g){return void 0===k?{x:0,y:0,width:0,height:0}:void 0===j?{x:k.x,y:k.y,width:k.width,height:k.height}:{x:k,y:j,width:h,height:g}};cc.rectEqualToRect=function(f,e){return f&&e&&f.x===e.x&&f.y===e.y&&f.width===e.width&&f.height===e.height};cc._rectEqualToZero=function(d){return d&&0===d.x&&0===d.y&&0===d.width&&0===d.height};cc.rectContainsRect=function(f,e){return f&&e?!(f.x>=e.x||f.y>=e.y||f.x+f.width<=e.x+e.width||f.y+f.height<=e.y+e.height):!1};cc.rectGetMaxX=function(d){return d.x+d.width};cc.rectGetMidX=function(d){return d.x+d.width/2};cc.rectGetMinX=function(d){return d.x};cc.rectGetMaxY=function(d){return d.y+d.height};cc.rectGetMidY=function(d){return d.y+d.height/2};cc.rectGetMinY=function(d){return d.y};cc.rectContainsPoint=function(f,e){return e.x>=cc.rectGetMinX(f)&&e.x<=cc.rectGetMaxX(f)&&e.y>=cc.rectGetMinY(f)&&e.y<=cc.rectGetMaxY(f)};cc.rectIntersectsRect=function(n,m){var k=n.y+n.height,j=m.x+m.width,h=m.y+m.height;return !(n.x+n.width<m.x||j<n.x||k<m.y||h<n.y)};cc.rectOverlapsRect=function(f,e){return !(f.x+f.width<e.x||e.x+e.width<f.x||f.y+f.height<e.y||e.y+e.height<f.y)};cc.rectUnion=function(h,g){var f=cc.rect(0,0,0,0);f.x=Math.min(h.x,g.x);f.y=Math.min(h.y,g.y);f.width=Math.max(h.x+h.width,g.x+g.width)-f.x;f.height=Math.max(h.y+h.height,g.y+g.height)-f.y;return f};cc.rectIntersection=function(h,g){var f=cc.rect(Math.max(cc.rectGetMinX(h),cc.rectGetMinX(g)),Math.max(cc.rectGetMinY(h),cc.rectGetMinY(g)),0,0);f.width=Math.min(cc.rectGetMaxX(h),cc.rectGetMaxX(g))-cc.rectGetMinX(f);f.height=Math.min(cc.rectGetMaxY(h),cc.rectGetMaxY(g))-cc.rectGetMinY(f);return f};cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(d){return this._parseXML(d)},_parseXML:function(f){var e;this._isSupportDOMParser?e=this._parser.parseFromString(f,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(f));return e}});cc.PlistParser=cc.SAXParser.extend({parse:function(k){k=this._parseXML(k).documentElement;if("plist"!==k.tagName){return cc.warn("Not a plist file!"),{}}for(var j=null,h=0,g=k.childNodes.length;h<g&&(j=k.childNodes[h],1!==j.nodeType);h++){}return this._parseNode(j)},_parseNode:function(h){var g=null,f=h.tagName;if("dict"===f){g=this._parseDict(h)}else{if("array"===f){g=this._parseArray(h)}else{if("string"===f){if(1===h.childNodes.length){g=h.firstChild.nodeValue}else{for(g="",f=0;f<h.childNodes.length;f++){g+=h.childNodes[f].nodeValue}}}else{"false"===f?g=!1:"true"===f?g=!0:"real"===f?g=parseFloat(h.firstChild.nodeValue):"integer"===f&&(g=parseInt(h.firstChild.nodeValue,10))}}}return g},_parseArray:function(n){for(var m=[],k=0,j=n.childNodes.length;k<j;k++){var h=n.childNodes[k];1===h.nodeType&&m.push(this._parseNode(h))}return m},_parseDict:function(p){for(var o={},n=null,m=0,k=p.childNodes.length;m<k;m++){var j=p.childNodes[m];1===j.nodeType&&("key"===j.tagName?n=j.firstChild.nodeValue:o[n]=this._parseNode(j))}return o}});cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser;cc._txtLoader={load:function(k,j,h,g){cc.loader.loadTxt(k,g)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(k,j,h,g){cc.loader.loadJson(k,g)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._jsLoader={load:function(k,j,h,g){cc.loader.loadJs(k,g)}};cc.loader.register(["js"],cc._jsLoader);cc._imgLoader={load:function(k,j,h,g){h=cc.loader.isLoading(k)?g:function(f,d){if(f){return g(f)}cc.loader.cache[j]=d;cc.textureCache.handleLoadedTexture(j);g(null,d)};cc.loader.loadImg(k,h)}};cc.loader.register("png jpg bmp jpeg gif ico tiff webp".split(" "),cc._imgLoader);cc._serverImgLoader={load:function(k,j,h,g){cc._imgLoader.load(h.src,j,h,g)}};cc.loader.register(["serverImg"],cc._serverImgLoader);cc._plistLoader={load:function(k,j,h,g){cc.loader.loadTxt(k,function(f,e){if(f){return g(f)}g(null,cc.plistParser.parse(e))})}};cc.loader.register(["plist"],cc._plistLoader);cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(y,x,w){var v=document,u=cc.path,t=this.TYPE,s=document.createElement("style");s.type="text/css";v.body.appendChild(s);var r="",r=isNaN(y-0)?r+("@font-face { font-family:"+y+"; src:"):r+("@font-face { font-family:'"+y+"'; src:");if(x instanceof Array){for(var o=0,j=x.length;o<j;o++){w=u.extname(x[o]).toLowerCase(),r+="url('"+x[o]+"') format('"+t[w]+"')",r+=o===j-1?";":","}}else{w=w.toLowerCase(),r+="url('"+x+"') format('"+t[w]+"');"}s.textContent+=r+"}";x=document.createElement("div");w=x.style;w.fontFamily=y;x.innerHTML=".";w.position="absolute";w.left="-100px";w.top="-100px";v.body.appendChild(x)},load:function(k,j,h,g){j=h.type;k=h.name;j=h.srcs;cc.isString(h)?(j=cc.path.extname(h),k=cc.path.basename(h,j),this._loadFont(k,h,j)):this._loadFont(k,j);document.fonts?document.fonts.load("1em "+k).then(function(){g(null,!0)},function(d){g(d)}):g(null,!0)}};cc.loader.register("font eot ttf woff svg ttc".split(" "),cc._fontLoader);cc._binaryLoader={load:function(k,j,h,g){cc.loader.loadBinary(k,g)}};cc._csbLoader={load:function(k,j,h,g){cc.loader.loadCsb(k,g)}};cc.loader.register(["csb"],cc._csbLoader);window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.12";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=0.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_SUPPORT=1;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;cc.SPRITEBATCHNODE_DEBUG_DRAW=0;cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.IS_RETINA_DISPLAY_SUPPORTED=1;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(f){var e=this===cc?document:this;if(f=f instanceof HTMLElement?f:e.querySelector(f)){f.find=f.find||cc.$,f.hasClass=f.hasClass||function(d){return this.className.match(RegExp("(\\s|^)"+d+"(\\s|$)"))},f.addClass=f.addClass||function(d){this.hasClass(d)||(this.className&&(this.className+=" "),this.className+=d);return this},f.removeClass=f.removeClass||function(d){this.hasClass(d)&&(this.className=this.className.replace(d,""));return this},f.remove=f.remove||function(){this.parentNode&&this.parentNode.removeChild(this);return this},f.appendTo=f.appendTo||function(d){d.appendChild(this);return this},f.prependTo=f.prependTo||function(d){d.childNodes[0]?d.insertBefore(this,d.childNodes[0]):d.appendChild(this);return this},f.transforms=f.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this},f.position=f.position||{x:0,y:0},f.rotation=f.rotation||0,f.scale=f.scale||{x:1,y:1},f.skew=f.skew||{x:0,y:0},f.translates=function(h,g){this.position.x=h;this.position.y=g;this.transforms();return this},f.rotate=function(d){this.rotation=d;this.transforms();return this},f.resize=function(h,g){this.scale.x=h;this.scale.y=g;this.transforms();return this},f.setSkew=function(h,g){this.skew.x=h;this.skew.y=g;this.transforms();return this}}return f};switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform";cc.$.translate=cc.$.hd?function(d){return"translate3d("+d.x+"px, "+d.y+"px, 0) "}:function(d){return"translate("+d.x+"px, "+d.y+"px) "};cc.$.rotate=cc.$.hd?function(d){return"rotateZ("+d+"deg) "}:function(d){return"rotate("+d+"deg) "};cc.$.scale=function(d){return"scale("+d.x+", "+d.y+") "};cc.$.skew=function(d){return"skewX("+-d.x+"deg) skewY("+d.y+"deg)"};cc.$new=function(d){return cc.$(document.createElement(d))};cc.$.findpos=function(h){var g=0,f=0;do{g+=h.offsetLeft,f+=h.offsetTop}while(h=h.offsetParent);return{x:g,y:f}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(k,j,h){if(!cc.isObject(h)||cc.isUndefined(h.x)||cc.isUndefined(h.y)){cc.log(cc._LogInfos.swap)}else{var g=h[k];h[k]=h[j];h[j]=g}};cc.lerp=function(h,g,f){return h+(g-h)*f};cc.rand=function(){return 16777215*Math.random()};cc.randomMinus1To1=function(){return 2*(Math.random()-0.5)};cc.random0To1=Math.random;cc.degreesToRadians=function(d){return d*cc.RAD};cc.radiansToDegrees=function(d){return d*cc.DEG};cc.radiansToDegress=function(d){cc.log(cc._LogInfos.radiansToDegress);return d*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.nodeDrawSetup=function(d){d._shaderProgram&&(d._shaderProgram.use(),d._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};cc.enableDefaultGLStates=function(){};cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(d){cc.g_NumberOfDraws+=d};cc.FLT_EPSILON=1.192092896e-7;cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1};cc.pointPointsToPixels=function(f){var e=cc.contentScaleFactor();return cc.p(f.x*e,f.y*e)};cc.pointPixelsToPoints=function(f){var e=cc.contentScaleFactor();return cc.p(f.x/e,f.y/e)};cc._pointPixelsToPointsOut=function(h,g){var f=cc.contentScaleFactor();g.x=h.x/f;g.y=h.y/f};cc.sizePointsToPixels=function(f){var e=cc.contentScaleFactor();return cc.size(f.width*e,f.height*e)};cc.sizePixelsToPoints=function(f){var e=cc.contentScaleFactor();return cc.size(f.width/e,f.height/e)};cc._sizePixelsToPointsOut=function(h,g){var f=cc.contentScaleFactor();g.width=h.width/f;g.height=h.height/f};cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(f){var e=cc.contentScaleFactor();return cc.rect(f.x/e,f.y/e,f.width/e,f.height/e)}:function(d){return d};cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(f){var e=cc.contentScaleFactor();return cc.rect(f.x*e,f.y*e,f.width*e,f.height*e)}:function(d){return d};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.LINEAR=9729;cc.REPEAT=10497;cc.CLAMP_TO_EDGE=33071;cc.MIRRORED_REPEAT=33648;cc.BLEND_SRC=cc.SRC_ALPHA;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)});cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA;cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var d=cc._renderContext.getError();d&&cc.log(cc._LogInfos.checkGLErrorDebug,d)}};cc.ORIENTATION_PORTRAIT=1;cc.ORIENTATION_LANDSCAPE=2;cc.ORIENTATION_AUTO=3;cc.VERTEX_ATTRIB_FLAG_NONE=0;cc.VERTEX_ATTRIB_FLAG_POSITION=1;cc.VERTEX_ATTRIB_FLAG_COLOR=2;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=7;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest";cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;cc.NORMAL_TAG=8801;cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc.arrayVerifyType=function(h,g){if(h&&0<h.length){for(var f=0;f<h.length;f++){if(!(h[f] instanceof g)){return cc.log("element type is wrong!"),!1}}}return !0};cc.arrayRemoveObject=function(k,j){for(var h=0,g=k.length;h<g;h++){if(k[h]===j){k.splice(h,1);break}}};cc.arrayRemoveArray=function(k,j){for(var h=0,g=j.length;h<g;h++){cc.arrayRemoveObject(k,j[h])}};cc.arrayAppendObjectsToIndex=function(h,g,f){h.splice.apply(h,[f,0].concat(g));return h};cc.copyArray=function(k){var j,h=k.length,g=Array(h);for(j=0;j<h;j+=1){g[j]=k[j]}return g};cc=cc||{};cc._tmp=cc._tmp||{};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.color=function(r,p,o,n,m,j){return void 0===r?new cc.Color(0,0,0,255,m,j):cc.isString(r)?(r=cc.hexToColor(r),new cc.Color(r.r,r.g,r.b,r.a)):cc.isObject(r)?new cc.Color(r.r,r.g,r.b,r.a,r.arrayBuffer,r.offset):new cc.Color(r,p,o,n,m,j)};cc.Color=function(r,p,o,n,m,j){this._arrayBuffer=m||new ArrayBuffer(cc.Color.BYTES_PER_ELEMENT);this._offset=j||0;this._view=new Uint8Array(this._arrayBuffer,this._offset,4);this._view[0]=r||0;this._view[1]=p||0;this._view[2]=o||0;this._view[3]=null==n?255:n;void 0===n&&(this.a_undefined=!0)};cc.Color.BYTES_PER_ELEMENT=4;var d=cc.Color.prototype;d._getR=function(){return this._view[0]};d._setR=function(e){this._view[0]=0>e?0:e};d._getG=function(){return this._view[1]};d._setG=function(e){this._view[1]=0>e?0:e};d._getB=function(){return this._view[2]};d._setB=function(e){this._view[2]=0>e?0:e};d._getA=function(){return this._view[3]};d._setA=function(e){this._view[3]=0>e?0:e};cc.defineGetterSetter(d,"r",d._getR,d._setR);cc.defineGetterSetter(d,"g",d._getG,d._setG);cc.defineGetterSetter(d,"b",d._getB,d._setB);cc.defineGetterSetter(d,"a",d._getA,d._setA);cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js");cc._tmp.PrototypeColor();delete cc._tmp.PrototypeColor}});cc._tmp.PrototypeColor=function(){var d=cc.color;d._getWhite=function(){return d(255,255,255)};d._getYellow=function(){return d(255,255,0)};d._getBlue=function(){return d(0,0,255)};d._getGreen=function(){return d(0,255,0)};d._getRed=function(){return d(255,0,0)};d._getMagenta=function(){return d(255,0,255)};d._getBlack=function(){return d(0,0,0)};d._getOrange=function(){return d(255,127,0)};d._getGray=function(){return d(166,166,166)};cc.defineGetterSetter(d,"WHITE",d._getWhite);cc.defineGetterSetter(d,"YELLOW",d._getYellow);cc.defineGetterSetter(d,"BLUE",d._getBlue);cc.defineGetterSetter(d,"GREEN",d._getGreen);cc.defineGetterSetter(d,"RED",d._getRed);cc.defineGetterSetter(d,"MAGENTA",d._getMagenta);cc.defineGetterSetter(d,"BLACK",d._getBlack);cc.defineGetterSetter(d,"ORANGE",d._getOrange);cc.defineGetterSetter(d,"GRAY",d._getGray);cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)};cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable);cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied);cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied);cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)};cc.Color=function(k,j,h,g){this.r=k||0;this.g=j||0;this.b=h||0;this.a=null==g?255:g};cc.color=function(k,j,h,g){return void 0===k?{r:0,g:0,b:0,a:255}:cc.isString(k)?cc.hexToColor(k):cc.isObject(k)?{r:k.r,g:k.g,b:k.b,a:null==k.a?255:k.a}:{r:k,g:j,b:h,a:null==g?255:g}};cc.colorEqual=function(f,e){return f.r===e.r&&f.g===e.g&&f.b===e.b};cc.Acceleration=function(k,j,h,g){this.x=k||0;this.y=j||0;this.z=h||0;this.timestamp=g||0};cc.Vertex2F=function(k,j,h,g){this._arrayBuffer=h||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT);this._offset=g||0;this._view=new Float32Array(this._arrayBuffer,this._offset,2);this._view[0]=k||0;this._view[1]=j||0};cc.Vertex2F.BYTES_PER_ELEMENT=8;_p=cc.Vertex2F.prototype;_p._getX=function(){return this._view[0]};_p._setX=function(d){this._view[0]=d};_p._getY=function(){return this._view[1]};_p._setY=function(d){this._view[1]=d};cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);cc.Vertex3F=function(n,m,k,j,h){this._arrayBuffer=j||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT);this._offset=h||0;this._view=new Float32Array(this._arrayBuffer,this._offset,3);this._view[0]=n||0;this._view[1]=m||0;this._view[2]=k||0};cc.Vertex3F.BYTES_PER_ELEMENT=12;_p=cc.Vertex3F.prototype;_p._getX=function(){return this._view[0]};_p._setX=function(d){this._view[0]=d};_p._getY=function(){return this._view[1]};_p._setY=function(d){this._view[1]=d};_p._getZ=function(){return this._view[2]};_p._setZ=function(d){this._view[2]=d};cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ);cc.Tex2F=function(k,j,h,g){this._arrayBuffer=h||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT);this._offset=g||0;this._view=new Float32Array(this._arrayBuffer,this._offset,2);this._view[0]=k||0;this._view[1]=j||0};cc.Tex2F.BYTES_PER_ELEMENT=8;_p=cc.Tex2F.prototype;_p._getU=function(){return this._view[0]};_p._setU=function(d){this._view[0]=d};_p._getV=function(){return this._view[1]};_p._setV=function(d){this._view[1]=d};cc.defineGetterSetter(_p,"u",_p._getU,_p._setU);cc.defineGetterSetter(_p,"v",_p._getV,_p._setV);cc.Quad2=function(s,r,p,o,n,m){this._arrayBuffer=n||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT);this._offset=m||0;n=this._arrayBuffer;m=this._offset;var j=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=s?new cc.Vertex2F(s.x,s.y,n,m):new cc.Vertex2F(0,0,n,m);m+=j;this._tr=r?new cc.Vertex2F(r.x,r.y,n,m):new cc.Vertex2F(0,0,n,m);m+=j;this._bl=p?new cc.Vertex2F(p.x,p.y,n,m):new cc.Vertex2F(0,0,n,m);m+=j;this._br=o?new cc.Vertex2F(o.x,o.y,n,m):new cc.Vertex2F(0,0,n,m)};cc.Quad2.BYTES_PER_ELEMENT=32;_p=cc.Quad2.prototype;_p._getTL=function(){return this._tl};_p._setTL=function(d){this._tl._view[0]=d.x;this._tl._view[1]=d.y};_p._getTR=function(){return this._tr};_p._setTR=function(d){this._tr._view[0]=d.x;this._tr._view[1]=d.y};_p._getBL=function(){return this._bl};_p._setBL=function(d){this._bl._view[0]=d.x;this._bl._view[1]=d.y};_p._getBR=function(){return this._br};_p._setBR=function(d){this._br._view[0]=d.x;this._br._view[1]=d.y};cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);cc.Quad3=function(s,r,p,o,n,m){this._arrayBuffer=n||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT);this._offset=m||0;n=this._arrayBuffer;m=this._offset;var j=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=s?new cc.Vertex3F(s.x,s.y,s.z,n,m):new cc.Vertex3F(0,0,0,n,m);m+=j;this.br=r?new cc.Vertex3F(r.x,r.y,r.z,n,m):new cc.Vertex3F(0,0,0,n,m);m+=j;this.tl=p?new cc.Vertex3F(p.x,p.y,p.z,n,m):new cc.Vertex3F(0,0,0,n,m);m+=j;this.tr=o?new cc.Vertex3F(o.x,o.y,o.z,n,m):new cc.Vertex3F(0,0,0,n,m)};cc.Quad3.BYTES_PER_ELEMENT=48;cc.V3F_C4B_T2F=function(n,m,k,j,h){this._arrayBuffer=j||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=h||0;j=this._arrayBuffer;h=this._offset;this._vertices=n?new cc.Vertex3F(n.x,n.y,n.z,j,h):new cc.Vertex3F(0,0,0,j,h);h+=cc.Vertex3F.BYTES_PER_ELEMENT;this._colors=m?cc.color(m.r,m.g,m.b,m.a,j,h):cc.color(0,0,0,0,j,h);h+=cc.Color.BYTES_PER_ELEMENT;this._texCoords=k?new cc.Tex2F(k.u,k.v,j,h):new cc.Tex2F(0,0,j,h)};cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24;_p=cc.V3F_C4B_T2F.prototype;_p._getVertices=function(){return this._vertices};_p._setVertices=function(f){var e=this._vertices;e._view[0]=f.x;e._view[1]=f.y;e._view[2]=f.z};_p._getColor=function(){return this._colors};_p._setColor=function(f){var e=this._colors;e._view[0]=f.r;e._view[1]=f.g;e._view[2]=f.b;e._view[3]=f.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(d){this._texCoords._view[0]=d.u;this._texCoords._view[1]=d.v};cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);cc.V3F_C4B_T2F_Quad=function(s,r,p,o,n,m){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._offset=m||0;n=this._arrayBuffer;m=this._offset;var j=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=s?new cc.V3F_C4B_T2F(s.vertices,s.colors,s.texCoords,n,m):new cc.V3F_C4B_T2F(null,null,null,n,m);m+=j;this._bl=r?new cc.V3F_C4B_T2F(r.vertices,r.colors,r.texCoords,n,m):new cc.V3F_C4B_T2F(null,null,null,n,m);m+=j;this._tr=p?new cc.V3F_C4B_T2F(p.vertices,p.colors,p.texCoords,n,m):new cc.V3F_C4B_T2F(null,null,null,n,m);m+=j;this._br=o?new cc.V3F_C4B_T2F(o.vertices,o.colors,o.texCoords,n,m):new cc.V3F_C4B_T2F(null,null,null,n,m)};cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96;_p=cc.V3F_C4B_T2F_Quad.prototype;_p._getTL=function(){return this._tl};_p._setTL=function(f){var e=this._tl;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getBL=function(){return this._bl};_p._setBL=function(f){var e=this._bl;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getTR=function(){return this._tr};_p._setTR=function(f){var e=this._tr;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getBR=function(){return this._br};_p._setBR=function(f){var e=this._br;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getArrayBuffer=function(){return this._arrayBuffer};cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null);cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad};cc.V3F_C4B_T2F_QuadCopy=function(k){if(!k){return cc.V3F_C4B_T2F_QuadZero()}var j=k.tl,h=k.bl,g=k.tr;k=k.br;return{tl:{vertices:{x:j.vertices.x,y:j.vertices.y,z:j.vertices.z},colors:{r:j.colors.r,g:j.colors.g,b:j.colors.b,a:j.colors.a},texCoords:{u:j.texCoords.u,v:j.texCoords.v}},bl:{vertices:{x:h.vertices.x,y:h.vertices.y,z:h.vertices.z},colors:{r:h.colors.r,g:h.colors.g,b:h.colors.b,a:h.colors.a},texCoords:{u:h.texCoords.u,v:h.texCoords.v}},tr:{vertices:{x:g.vertices.x,y:g.vertices.y,z:g.vertices.z},colors:{r:g.colors.r,g:g.colors.g,b:g.colors.b,a:g.colors.a},texCoords:{u:g.texCoords.u,v:g.texCoords.v}},br:{vertices:{x:k.vertices.x,y:k.vertices.y,z:k.vertices.z},colors:{r:k.colors.r,g:k.colors.g,b:k.colors.b,a:k.colors.a},texCoords:{u:k.texCoords.u,v:k.texCoords.v}}}};cc.V3F_C4B_T2F_QuadsCopy=function(h){if(!h){return[]}for(var g=[],f=0;f<h.length;f++){g.push(cc.V3F_C4B_T2F_QuadCopy(h[f]))}return g};cc.V2F_C4B_T2F=function(n,m,k,j,h){this._arrayBuffer=j||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=h||0;j=this._arrayBuffer;h=this._offset;this._vertices=n?new cc.Vertex2F(n.x,n.y,j,h):new cc.Vertex2F(0,0,j,h);h+=cc.Vertex2F.BYTES_PER_ELEMENT;this._colors=m?cc.color(m.r,m.g,m.b,m.a,j,h):cc.color(0,0,0,0,j,h);h+=cc.Color.BYTES_PER_ELEMENT;this._texCoords=k?new cc.Tex2F(k.u,k.v,j,h):new cc.Tex2F(0,0,j,h)};cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20;_p=cc.V2F_C4B_T2F.prototype;_p._getVertices=function(){return this._vertices};_p._setVertices=function(d){this._vertices._view[0]=d.x;this._vertices._view[1]=d.y};_p._getColor=function(){return this._colors};_p._setColor=function(f){var e=this._colors;e._view[0]=f.r;e._view[1]=f.g;e._view[2]=f.b;e._view[3]=f.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(d){this._texCoords._view[0]=d.u;this._texCoords._view[1]=d.v};cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);cc.V2F_C4B_T2F_Triangle=function(p,o,n,m,k){this._arrayBuffer=m||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT);this._offset=k||0;m=this._arrayBuffer;k=this._offset;var j=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=p?new cc.V2F_C4B_T2F(p.vertices,p.colors,p.texCoords,m,k):new cc.V2F_C4B_T2F(null,null,null,m,k);k+=j;this._b=o?new cc.V2F_C4B_T2F(o.vertices,o.colors,o.texCoords,m,k):new cc.V2F_C4B_T2F(null,null,null,m,k);k+=j;this._c=n?new cc.V2F_C4B_T2F(n.vertices,n.colors,n.texCoords,m,k):new cc.V2F_C4B_T2F(null,null,null,m,k)};cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60;_p=cc.V2F_C4B_T2F_Triangle.prototype;_p._getA=function(){return this._a};_p._setA=function(f){var e=this._a;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getB=function(){return this._b};_p._setB=function(f){var e=this._b;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};_p._getC=function(){return this._c};_p._setC=function(f){var e=this._c;e.vertices=f.vertices;e.colors=f.colors;e.texCoords=f.texCoords};cc.defineGetterSetter(_p,"a",_p._getA,_p._setA);cc.defineGetterSetter(_p,"b",_p._getB,_p._setB);cc.defineGetterSetter(_p,"c",_p._getC,_p._setC);cc.vertex2=function(f,e){return new cc.Vertex2F(f,e)};cc.vertex3=function(h,g,f){return new cc.Vertex3F(h,g,f)};cc.tex2=function(f,e){return new cc.Tex2F(f,e)};cc.BlendFunc=function(f,e){this.src=f;this.dst=e};cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(d){d=d.replace(/^#?/,"0x");d=parseInt(d);return cc.color(d>>16,(d>>8)%256,d%256)};cc.colorToHex=function(k){var j=k.r.toString(16),h=k.g.toString(16),g=k.b.toString(16);return"#"+(16>k.r?"0"+j:j)+(16>k.g?"0"+h:h)+(16>k.b?"0"+g:g)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|10*Math.random())},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(h,g){if(null!=g){var f=this.__getKey();this._keyMapTb[f]=g;this._valueMapTb[f]=h}},objectForKey:function(h){if(null==h){return null}var g=this._keyMapTb,f;for(f in g){if(g[f]===h){return this._valueMapTb[f]}}return null},valueForKey:function(d){return this.objectForKey(d)},removeObjectForKey:function(h){if(null!=h){var g=this._keyMapTb,f;for(f in g){if(g[f]===h){delete this._valueMapTb[f];delete g[f];break}}}},removeObjectsForKeys:function(f){if(null!=f){for(var e=0;e<f.length;e++){this.removeObjectForKey(f[e])}}},allKeys:function(){var h=[],g=this._keyMapTb,f;for(f in g){h.push(g[f])}return h},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});cc.FontDefinition=function(f){this.fontName="Arial";this.fontSize=12;this.textAlign=cc.TEXT_ALIGNMENT_CENTER;this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this.fillStyle=cc.color(255,255,255,255);this.boundingHeight=this.boundingWidth=0;this.strokeEnabled=!1;this.strokeStyle=cc.color(255,255,255,255);this.lineWidth=1;this.fontWeight=this.fontStyle=this.lineHeight="normal";this.shadowEnabled=!1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowOpacity=1;if(f&&f instanceof Object){for(var e in f){this[e]=f[e]}}};cc.FontDefinition.prototype._getCanvasFontStr=function(){return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+(this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px")+" '"+this.fontName+"'"};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.assert(cc.isFunction(cc._tmp.PrototypeColor),cc._LogInfos.MissingFile,"CCTypesPropertyDefine.js"),cc._tmp.PrototypeColor(),delete cc._tmp.PrototypeColor)});cc.Touches=[];cc.TouchesIntergerDict={};cc.DENSITYDPI_DEVICE="device-dpi";cc.DENSITYDPI_HIGH="high-dpi";cc.DENSITYDPI_MEDIUM="medium-dpi";cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(d){return d&&d!==this.html?d.clientWidth:window.innerWidth},availHeight:function(d){return d&&d!==this.html?d.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI);cc.sys.os===cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI);switch(__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true";__BrowserGetter.availWidth=function(d){return d.clientWidth};__BrowserGetter.availHeight=function(d){return d.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:__BrowserGetter.availWidth=function(d){return d.clientWidth};__BrowserGetter.availHeight=function(d){return d.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(f){if(!f.__resizeWithBrowserSize){var e=function(){f.setDesignResolutionSize(f._designResolutionSize.width,f._designResolutionSize.height,f._resolutionPolicy);window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}}}var _scissorRect=cc.rect();cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var k=document,j=cc.ContainerStrategy,h=cc.ContentStrategy;__BrowserGetter.init(this);this._frame=cc.container.parentNode===k.body?k.documentElement:cc.container.parentNode;this._frameSize=cc.size(0,0);this._initFrameSize();var k=cc._canvas.width,g=cc._canvas.height;this._designResolutionSize=cc.size(k,g);this._originalDesignResolutionSize=cc.size(k,g);this._viewPortRect=cc.rect(0,0,k,g);this._visibleRect=cc.rect(0,0,k,g);this._contentTranslateLeftTop={left:0,top:0};this._viewName="Cocos2dHTML5";k=cc.sys;this.enableRetina(k.os===k.OS_IOS||k.os===k.OS_OSX);this.enableAutoFullScreen(k.isMobile&&k.browserType!==k.BROWSER_TYPE_BAIDU);cc.visibleRect&&cc.visibleRect.init(this._visibleRect);this._rpExactFit=new cc.ResolutionPolicy(j.EQUAL_TO_FRAME,h.EXACT_FIT);this._rpShowAll=new cc.ResolutionPolicy(j.PROPORTION_TO_FRAME,h.SHOW_ALL);this._rpNoBorder=new cc.ResolutionPolicy(j.EQUAL_TO_FRAME,h.NO_BORDER);this._rpFixedHeight=new cc.ResolutionPolicy(j.EQUAL_TO_FRAME,h.FIXED_HEIGHT);this._rpFixedWidth=new cc.ResolutionPolicy(j.EQUAL_TO_FRAME,h.FIXED_WIDTH);this._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var k;k=this.setDesignResolutionSize?this:cc.view;var j=k._frameSize.width,h=k._frameSize.height,g=k._isRotated;k._initFrameSize();if(k._isRotated!==g||k._frameSize.width!==j||k._frameSize.height!==h){k._resizeCallback&&k._resizeCallback.call(),j=k._originalDesignResolutionSize.width,h=k._originalDesignResolutionSize.height,0<j&&k.setDesignResolutionSize(j,h,k._resolutionPolicy)}},setTargetDensityDPI:function(d){this._targetDensityDPI=d;this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(d){d?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(d){if(cc.isFunction(d)||null==d){this._resizeCallback=d}},setOrientation:function(d){if(d&=cc.ORIENTATION_AUTO){this._orientation=d}},_initFrameSize:function(){var k=this._frameSize,j=__BrowserGetter.availWidth(this._frame),h=__BrowserGetter.availHeight(this._frame),g=j>=h;!cc.sys.isMobile||g&&this._orientation&cc.ORIENTATION_LANDSCAPE||!g&&this._orientation&cc.ORIENTATION_PORTRAIT?(k.width=j,k.height=h,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(k.width=h,k.height=j,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var f=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;0<f&&this.setDesignResolutionSize(f,e,this._resolutionPolicy)},_setViewportMeta:function(s,r){var p=document.getElementById("cocosMetaElement");p&&r&&document.head.removeChild(p);var o=document.getElementsByName("viewport"),o=o?o[0]:null,n,m,j;n=o?o.content:"";p=p||document.createElement("meta");p.id="cocosMetaElement";p.name="viewport";p.content="";for(m in s){-1==n.indexOf(m)?n+=","+m+"\x3d"+s[m]:r&&(j=RegExp(m+"s*\x3ds*[^,]+"),n.replace(j,m+"\x3d"+s[m]))}/^,/.test(n)&&(n=n.substr(1));p.content=n;o&&(o.content=n);document.head.appendChild(p)},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var d=cc.contentScaleFactor();this._scaleY=this._scaleX=d},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(d){this._isAdjustViewPort=d},enableRetina:function(d){this._retinaEnabled=d?!0:!1},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(d){d&&d!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(d){this._frameZoomFactor=d;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(d){},setContentTranslateLeftTop:function(f,e){this._contentTranslateLeftTop={left:f,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(f,e){this._frameSize.width=f;this._frameSize.height=e;this._frame.style.width=f+"px";this._frame.style.height=e+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return !0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(f){if(f instanceof cc.ResolutionPolicy){this._resolutionPolicy=f}else{var e=cc.ResolutionPolicy;f===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit);f===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll);f===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder);f===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight);f===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(k,j,h){if(0<k||0<j){if(this.setResolutionPolicy(h),h=this._resolutionPolicy){h.preApply(this);cc.sys.isMobile&&this._adjustViewportMeta();this._initFrameSize();this._originalDesignResolutionSize.width=this._designResolutionSize.width=k;this._originalDesignResolutionSize.height=this._designResolutionSize.height=j;var g=h.apply(this,this._designResolutionSize);g.scale&&2===g.scale.length&&(this._scaleX=g.scale[0],this._scaleY=g.scale[1]);g.viewport&&(k=this._viewPortRect,j=this._visibleRect,g=g.viewport,k.x=g.x,k.y=g.y,k.width=g.width,k.height=g.height,j.x=-k.x/this._scaleX,j.y=-k.y/this._scaleY,j.width=cc._canvas.width/this._scaleX,j.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(k.x,-k.y));k=cc.director;k._winSizeInPoints.width=this._designResolutionSize.width;k._winSizeInPoints.height=this._designResolutionSize.height;h.postApply(this);cc.winSize.width=k._winSizeInPoints.width;cc.winSize.height=k._winSizeInPoints.height;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&k.setGLDefaultValues();this._originalScaleX=this._scaleX;this._originalScaleY=this._scaleY;cc.DOM&&cc.DOM._resetEGLViewDiv();cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else{cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2)}}else{cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)}},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(h,g,f){this._setViewportMeta({width:h,"target-densitydpi":cc.DENSITYDPI_DEVICE},!0);document.body.style.width=h+"px";document.body.style.left="0px";document.body.style.top="0px";this.setDesignResolutionSize(h,g,f)},setViewPortInPoints:function(s,r,p,o){var n=this._frameZoomFactor,m=this._scaleX,j=this._scaleY;cc._renderContext.viewport(s*m*n+this._viewPortRect.x*n,r*j*n+this._viewPortRect.y*n,p*m*n,o*j*n)},setScissorInPoints:function(s,r,p,o){var n=this._frameZoomFactor,m=this._scaleX,j=this._scaleY;_scissorRect.x=s;_scissorRect.y=r;_scissorRect.width=p;_scissorRect.height=o;cc._renderContext.scissor(s*m*n+this._viewPortRect.x*n,r*j*n+this._viewPortRect.y*n,p*m*n,o*j*n)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return cc.rect(_scissorRect)},setViewName:function(d){null!=d&&0<d.length&&(this._viewName=d)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(h,g,f){h=this._devicePixelRatio*(h-f.left);g=this._devicePixelRatio*(f.top+f.height-g);return this._isRotated?{x:this._viewPortRect.width-g,y:h}:{x:h,y:g}},_convertMouseToLocationInView:function(h,g){var f=this._viewPortRect;h.x=(this._devicePixelRatio*(h.x-g.left)-f.x)/this._scaleX;h.y=(this._devicePixelRatio*(g.top+g.height-h.y)-f.y)/this._scaleY},_convertTouchesWithScale:function(u){for(var t=this._viewPortRect,s=this._scaleX,r=this._scaleY,p,o,n,j=0;j<u.length;j++){p=u[j],o=p._point,n=p._prevPoint,p=p._startPoint,o.x=(o.x-t.x)/s,o.y=(o.y-t.y)/r,n.x=(n.x-t.x)/s,n.y=(n.y-t.y)/r,p.x=(p.x-t.x)/s,p.y=(p.y-t.y)/r}}});cc.EGLView._getInstance=function(){this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize());return this._instance};cc.ContainerStrategy=cc.Class.extend({preApply:function(d){},apply:function(f,e){},postApply:function(d){},_setupContainer:function(n,m,k){var j=cc.game.canvas,h=cc.game.container;h.style.width=j.style.width=m+"px";h.style.height=j.style.height=k+"px";h=n._devicePixelRatio=1;n.isRetinaEnabled()&&(h=n._devicePixelRatio=Math.min(2,window.devicePixelRatio||1));j.width=m*h;j.height=k*h;cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var d=document.body.style;d.width=window.innerWidth+"px";d.height=window.innerHeight+"px";d.overflow="hidden";d=cc.container.style;d.position="fixed";d.left=d.top="0px";document.body.scrollTop=0}});cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(p,o,n,m,k,j){2>Math.abs(p-n)&&(n=p);2>Math.abs(o-m)&&(m=o);p=cc.rect(Math.round((p-n)/2),Math.round((o-m)/2),n,m);this._result.scale=[k,j];this._result.viewport=p;return this._result},preApply:function(d){},apply:function(f,e){return{scale:[1,1]}},postApply:function(d){}});(function(){var n=cc.ContainerStrategy.extend({apply:function(d){this._setupContainer(d,d._frameSize.width,d._frameSize.height)}}),m=cc.ContainerStrategy.extend({apply:function(A,z){var y=A._frameSize.width,x=A._frameSize.height,p=cc.container.style,o=z.width,F=z.height,C=y/o,E=x/F,B,D;C<E?(B=y,D=F*C):(B=o*E,D=x);o=Math.round((y-B)/2);D=Math.round((x-D)/2);this._setupContainer(A,y-2*o,x-2*D);A._isRotated?p.marginLeft=x+"px":p.margin="0px";p.paddingLeft=o+"px";p.paddingRight=o+"px";p.paddingTop=D+"px";p.paddingBottom=D+"px"}});n.extend({preApply:function(d){this._super(d);d._frame=document.documentElement},apply:function(d){this._super(d);this._fixContainer()}});m.extend({preApply:function(d){this._super(d);d._frame=document.documentElement},apply:function(f,e){this._super(f,e);this._fixContainer()}});var k=cc.ContainerStrategy.extend({apply:function(d){this._setupContainer(d,cc._canvas.width,cc._canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new n;cc.ContainerStrategy.PROPORTION_TO_FRAME=new m;cc.ContainerStrategy.ORIGINAL_CONTAINER=new k;var n=cc.ContentStrategy.extend({apply:function(r,p){var o=cc._canvas.width,g=cc._canvas.height;return this._buildResult(o,g,o,g,o/p.width,g/p.height)}}),m=cc.ContentStrategy.extend({apply:function(A,z){var y=cc._canvas.width,x=cc._canvas.height,p=z.width,o=z.height,F=y/p,C=x/o,E=0,B,D;F<C?(E=F,B=y,D=o*E):(E=C,B=p*E,D=x);return this._buildResult(y,x,B,D,E,E)}}),k=cc.ContentStrategy.extend({apply:function(A,z){var y=cc._canvas.width,x=cc._canvas.height,p=z.width,o=z.height,F=y/p,C=x/o,E,B,D;F<C?(E=C,B=p*E,D=x):(E=F,B=y,D=o*E);return this._buildResult(y,x,B,D,E,E)}}),j=cc.ContentStrategy.extend({apply:function(t,s){var r=cc._canvas.width,p=cc._canvas.height,o=p/s.height;return this._buildResult(r,p,r,p,o,o)},postApply:function(d){cc.director._winSizeInPoints=d.getVisibleSize()}}),h=cc.ContentStrategy.extend({apply:function(t,s){var r=cc._canvas.width,p=cc._canvas.height,o=r/s.width;return this._buildResult(r,p,r,p,o,o)},postApply:function(d){cc.director._winSizeInPoints=d.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n;cc.ContentStrategy.SHOW_ALL=new m;cc.ContentStrategy.NO_BORDER=new k;cc.ContentStrategy.FIXED_HEIGHT=new j;cc.ContentStrategy.FIXED_WIDTH=new h})();cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(f,e){this.setContainerStrategy(f);this.setContentStrategy(e)},preApply:function(d){this._containerStrategy.preApply(d);this._contentStrategy.preApply(d)},apply:function(f,e){this._containerStrategy.apply(f,e);return this._contentStrategy.apply(f,e)},postApply:function(d){this._containerStrategy.postApply(d);this._contentStrategy.postApply(d)},setContainerStrategy:function(d){d instanceof cc.ContainerStrategy&&(this._containerStrategy=d)},setContentStrategy:function(d){d instanceof cc.ContentStrategy&&(this._contentStrategy=d)}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var k,j,h=this._fnMap,g;k=0;for(l=h.length;k<l;k++){if((j=h[k])&&j[1] in document){k=0;for(g=j.length;k<g;k++){this._fn[h[0][k]]=j[k]}break}}this._supportsFullScreen="undefined"!==typeof this._fn.requestFullscreen;this._touchEvent="ontouchstart" in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen?void 0===document[this._fn.fullscreenElement]||null===document[this._fn.fullscreenElement]?!1:!0:!1},requestFullScreen:function(h,g){if(this._supportsFullScreen){h=h||document.documentElement;if(g){var f=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(f,this._preOnFullScreenChange);this._preOnFullScreenChange=g;document.addEventListener(f,g,!1)}return h[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(n,m){function k(){j.removeEventListener(h._touchEvent,k);h.requestFullScreen(n,m)}n=n||document.body;var j=cc.game.canvas||n,h=this;this.requestFullScreen(n,m);j.addEventListener(this._touchEvent,k)}};cc.screen.init();cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(p){var o=this.width=p.width,n=this.height=p.height,m=p.x;p=p.y;var k=p+n,j=m+o;this.topLeft.x=m;this.topLeft.y=k;this.topRight.x=j;this.topRight.y=k;this.top.x=m+o/2;this.top.y=k;this.bottomLeft.x=m;this.bottomLeft.y=p;this.bottomRight.x=j;this.bottomRight.y=p;this.bottom.x=m+o/2;this.bottom.y=p;this.center.x=m+o/2;this.center.y=p+n/2;this.left.x=m;this.left.y=p+n/2;this.right.x=j;this.right.y=p+n/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var f=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(f&1)){return this._indexBitsUsed|=1<<e,e}f>>=1}return -1},_removeUsedIndexBit:function(d){0>d||d>=this._maxTouches||(d=~(1<<d),this._indexBitsUsed&=d)},_glView:null,handleTouchesBegin:function(w){for(var v,u,t,s=[],r=this._touchesIntegerDict,p=0,o=w.length;p<o;p++){if(v=w[p],t=v.getID(),u=r[t],null==u){var j=this._getUnUsedIndex();-1===j?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,j):(u=this._touches[j]=new cc.Touch(v._point.x,v._point.y,v.getID()),u._setPrevPoint(v._prevPoint),r[t]=j,s.push(u))}}0<s.length&&(this._glView._convertTouchesWithScale(s),w=new cc.EventTouch(s),w._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(w))},handleTouchesMove:function(s){for(var r,p,o=[],n=this._touches,m=0,j=s.length;m<j;m++){r=s[m],p=r.getID(),p=this._touchesIntegerDict[p],null!=p&&n[p]&&(n[p]._setPoint(r._point),n[p]._setPrevPoint(r._prevPoint),o.push(n[p]))}0<o.length&&(this._glView._convertTouchesWithScale(o),s=new cc.EventTouch(o),s._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(s))},handleTouchesEnd:function(d){d=this.getSetOfTouchesEndOrCancel(d);0<d.length&&(this._glView._convertTouchesWithScale(d),d=new cc.EventTouch(d),d._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(d))},handleTouchesCancel:function(d){d=this.getSetOfTouchesEndOrCancel(d);0<d.length&&(this._glView._convertTouchesWithScale(d),d=new cc.EventTouch(d),d._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(d))},getSetOfTouchesEndOrCancel:function(w){for(var v,u,t,s=[],r=this._touches,p=this._touchesIntegerDict,o=0,j=w.length;o<j;o++){v=w[o],t=v.getID(),u=p[t],null!=u&&r[u]&&(r[u]._setPoint(v._point),r[u]._setPrevPoint(v._prevPoint),s.push(r[u]),this._removeUsedIndexBit(u),delete p[t])}return s},getHTMLElementPosition:function(k){var j=document.documentElement,h=window,g=null,g=cc.isFunction(k.getBoundingClientRect)?k.getBoundingClientRect():{left:0,top:0,width:parseInt(k.style.width),height:parseInt(k.style.height)};return{left:g.left+h.pageXOffset-j.clientLeft,top:g.top+h.pageYOffset-j.clientTop,width:g.width,height:g.height}},getPreTouch:function(n){for(var m=null,k=this._preTouchPool,j=n.getID(),h=k.length-1;0<=h;h--){if(k[h].getID()===j){m=k[h];break}}m||(m=n);return m},setPreTouch:function(n){for(var m=!1,k=this._preTouchPool,j=n.getID(),h=k.length-1;0<=h;h--){if(k[h].getID()===j){k[h]=n;m=!0;break}}m||(50>=k.length?k.push(n):(k[this._preTouchPoolPointer]=n,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(k,j,h){var g=this._preTouchPoint;k=this._glView.convertToLocationInView(k,j,h);j=new cc.Touch(k.x,k.y);j._setPrevPoint(g.x,g.y);g.x=k.x;g.y=k.y;return j},getMouseEvent:function(k,j,h){var g=this._prevMousePoint;this._glView._convertMouseToLocationInView(k,j);j=new cc.EventMouse(h);j.setLocation(k.x,k.y);j._setPrevCursor(g.x,g.y);g.x=k.x;g.y=k.y;return j},getPointByEvent:function(f,e){if(null!=f.pageX){return{x:f.pageX,y:f.pageY}}e.left-=document.body.scrollLeft;e.top-=document.body.scrollTop;return{x:f.clientX,y:f.clientY}},getTouchesByEvent:function(y,x){for(var w=[],v=this._glView,u,t,s=this._preTouchPoint,r=y.changedTouches.length,o=0;o<r;o++){if(u=y.changedTouches[o]){var j;j=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?v.convertToLocationInView(u.pageX,u.pageY,x):v.convertToLocationInView(u.clientX,u.clientY,x);null!=u.identifier?(u=new cc.Touch(j.x,j.y,u.identifier),t=this.getPreTouch(u).getLocation(),u._setPrevPoint(t.x,t.y),this.setPreTouch(u)):(u=new cc.Touch(j.x,j.y),u._setPrevPoint(s.x,s.y));s.x=j.x;s.y=j.y;w.push(u)}}return w},registerSystemEvent:function(p){if(!this._isRegisterEvent){this._glView=cc.view;var o=this,n="mouse" in cc.sys.capabilities,m="touches" in cc.sys.capabilities,k=!1;cc.sys.isMobile&&(k=!0);n&&(window.addEventListener("mousedown",function(){o._mousePressed=!0},!1),window.addEventListener("mouseup",function(g){if(!k){var d=o._mousePressed;o._mousePressed=!1;if(d){var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(g,d);cc.rectContainsPoint(new cc.Rect(d.left,d.top,d.width,d.height),c)||(o.handleTouchesEnd([o.getTouchByXY(c.x,c.y,d)]),d=o.getMouseEvent(c,d,cc.EventMouse.UP),d.setButton(g.button),cc.eventManager.dispatchEvent(d))}}},!1),p.addEventListener("mousedown",function(g){if(!k){o._mousePressed=!0;var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(g,d);o.handleTouchesBegin([o.getTouchByXY(c.x,c.y,d)]);d=o.getMouseEvent(c,d,cc.EventMouse.DOWN);d.setButton(g.button);cc.eventManager.dispatchEvent(d);g.stopPropagation();g.preventDefault();p.focus()}},!1),p.addEventListener("mouseup",function(g){if(!k){o._mousePressed=!1;var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(g,d);o.handleTouchesEnd([o.getTouchByXY(c.x,c.y,d)]);d=o.getMouseEvent(c,d,cc.EventMouse.UP);d.setButton(g.button);cc.eventManager.dispatchEvent(d);g.stopPropagation();g.preventDefault()}},!1),p.addEventListener("mousemove",function(g){if(!k){var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(g,d);o.handleTouchesMove([o.getTouchByXY(c.x,c.y,d)]);d=o.getMouseEvent(c,d,cc.EventMouse.MOVE);o._mousePressed?d.setButton(g.button):d.setButton(null);cc.eventManager.dispatchEvent(d);g.stopPropagation();g.preventDefault()}},!1),p.addEventListener("mousewheel",function(h){var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(h,d),d=o.getMouseEvent(c,d,cc.EventMouse.SCROLL);d.setButton(h.button);d.setScrollData(0,h.wheelDelta);cc.eventManager.dispatchEvent(d);h.stopPropagation();h.preventDefault()},!1),p.addEventListener("DOMMouseScroll",function(h){var d=o.getHTMLElementPosition(p),c=o.getPointByEvent(h,d),d=o.getMouseEvent(c,d,cc.EventMouse.SCROLL);d.setButton(h.button);d.setScrollData(0,-120*h.detail);cc.eventManager.dispatchEvent(d);h.stopPropagation();h.preventDefault()},!1));if(window.navigator.msPointerEnabled){var n={MSPointerDown:o.handleTouchesBegin,MSPointerMove:o.handleTouchesMove,MSPointerUp:o.handleTouchesEnd,MSPointerCancel:o.handleTouchesCancel},j;for(j in n){(function(d,c){p.addEventListener(d,function(h){var f=o.getHTMLElementPosition(p);f.left-=document.documentElement.scrollLeft;f.top-=document.documentElement.scrollTop;c.call(o,[o.getTouchByXY(h.clientX,h.clientY,f)]);h.stopPropagation()},!1)})(j,n[j])}}m&&(p.addEventListener("touchstart",function(d){if(d.changedTouches){var c=o.getHTMLElementPosition(p);c.left-=document.body.scrollLeft;c.top-=document.body.scrollTop;o.handleTouchesBegin(o.getTouchesByEvent(d,c));d.stopPropagation();d.preventDefault();p.focus()}},!1),p.addEventListener("touchmove",function(d){if(d.changedTouches){var c=o.getHTMLElementPosition(p);c.left-=document.body.scrollLeft;c.top-=document.body.scrollTop;o.handleTouchesMove(o.getTouchesByEvent(d,c));d.stopPropagation();d.preventDefault()}},!1),p.addEventListener("touchend",function(d){if(d.changedTouches){var c=o.getHTMLElementPosition(p);c.left-=document.body.scrollLeft;c.top-=document.body.scrollTop;o.handleTouchesEnd(o.getTouchesByEvent(d,c));d.stopPropagation();d.preventDefault()}},!1),p.addEventListener("touchcancel",function(d){if(d.changedTouches){var c=o.getHTMLElementPosition(p);c.left-=document.body.scrollLeft;c.top-=document.body.scrollTop;o.handleTouchesCancel(o.getTouchesByEvent(d,c));d.stopPropagation();d.preventDefault()}},!1));this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(d){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration)));this._accelCurTime+=d}};_p=cc.inputManager;_p.setAccelerometerEnabled=function(d){this._accelEnabled!==d&&(this._accelEnabled=d,d=cc.director.getScheduler(),this._accelCurTime=0,d.scheduleUpdate(this))};_p.setAccelerometerInterval=function(d){this._accelInterval!==d&&(this._accelInterval=d)};_p._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(d){cc.eventManager.dispatchEvent(new cc.EventKeyboard(d.keyCode,!0));d.stopPropagation();d.preventDefault()},!1);cc._canvas.addEventListener("keyup",function(d){cc.eventManager.dispatchEvent(new cc.EventKeyboard(d.keyCode,!1));d.stopPropagation();d.preventDefault()},!1)};_p._registerAccelerometerEvent=function(){var h=window;this._acceleration=new cc.Acceleration;this._accelDeviceEvent=h.DeviceMotionEvent||h.DeviceOrientationEvent;cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var g=this._accelDeviceEvent===h.DeviceMotionEvent?"devicemotion":"deviceorientation",f=navigator.userAgent;if(/Android/.test(f)||/Adr/.test(f)&&cc.sys.browserType===cc.BROWSER_TYPE_UC){this._minus=-1}h.addEventListener(g,this.didAccelerate.bind(this),!1)};_p.didAccelerate=function(p){var o=window;if(this._accelEnabled){var n=this._acceleration,m,k,j;this._accelDeviceEvent===window.DeviceMotionEvent?(j=p.accelerationIncludingGravity,m=this._accelMinus*j.x*0.1,k=this._accelMinus*j.y*0.1,j=0.1*j.z):(m=p.gamma/90*0.981,k=0.981*-(p.beta/90),j=p.alpha/90*0.981);n.x=m;n.y=k;n.z=j;n.timestamp=p.timeStamp||Date.now();p=n.x;o.orientation===cc.UIInterfaceOrientationLandscapeRight?(n.x=-n.y,n.y=p):o.orientation===cc.UIInterfaceOrientationLandscapeLeft?(n.x=n.y,n.y=-p):o.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(n.x=-n.x,n.y=-n.y)}};delete _p;cc.AffineTransform=function(p,o,n,m,k,j){this.a=p;this.b=o;this.c=n;this.d=m;this.tx=k;this.ty=j};cc.affineTransformMake=function(p,o,n,m,k,j){return{a:p,b:o,c:n,d:m,tx:k,ty:j}};cc.pointApplyAffineTransform=function(k,j,h){var g;void 0===h?(h=j,g=k.x,k=k.y):(g=k,k=j);return{x:h.a*g+h.c*k+h.tx,y:h.b*g+h.d*k+h.ty}};cc._pointApplyAffineTransform=function(h,g,f){return cc.pointApplyAffineTransform(h,g,f)};cc.sizeApplyAffineTransform=function(f,e){return{width:e.a*f.width+e.c*f.height,height:e.b*f.width+e.d*f.height}};cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.rectApplyAffineTransform=function(w,v){var u=cc.rectGetMinY(w),t=cc.rectGetMinX(w),s=cc.rectGetMaxX(w),r=cc.rectGetMaxY(w),p=cc.pointApplyAffineTransform(t,u,v),u=cc.pointApplyAffineTransform(s,u,v),t=cc.pointApplyAffineTransform(t,r,v),o=cc.pointApplyAffineTransform(s,r,v),s=Math.min(p.x,u.x,t.x,o.x),r=Math.max(p.x,u.x,t.x,o.x),j=Math.min(p.y,u.y,t.y,o.y),p=Math.max(p.y,u.y,t.y,o.y);return cc.rect(s,j,r-s,p-j)};cc._rectApplyAffineTransformIn=function(w,v){var u=cc.rectGetMinY(w),t=cc.rectGetMinX(w),s=cc.rectGetMaxX(w),r=cc.rectGetMaxY(w),p=cc.pointApplyAffineTransform(t,u,v),u=cc.pointApplyAffineTransform(s,u,v),t=cc.pointApplyAffineTransform(t,r,v),o=cc.pointApplyAffineTransform(s,r,v),s=Math.min(p.x,u.x,t.x,o.x),r=Math.max(p.x,u.x,t.x,o.x),j=Math.min(p.y,u.y,t.y,o.y),p=Math.max(p.y,u.y,t.y,o.y);w.x=s;w.y=j;w.width=r-s;w.height=p-j;return w};cc.affineTransformTranslate=function(h,g,f){return{a:h.a,b:h.b,c:h.c,d:h.d,tx:h.tx+h.a*g+h.c*f,ty:h.ty+h.b*g+h.d*f}};cc.affineTransformScale=function(h,g,f){return{a:h.a*g,b:h.b*g,c:h.c*f,d:h.d*f,tx:h.tx,ty:h.ty}};cc.affineTransformRotate=function(k,j){var h=Math.sin(j),g=Math.cos(j);return{a:k.a*g+k.c*h,b:k.b*g+k.d*h,c:k.c*g-k.a*h,d:k.d*g-k.b*h,tx:k.tx,ty:k.ty}};cc.affineTransformConcat=function(f,e){return{a:f.a*e.a+f.b*e.c,b:f.a*e.b+f.b*e.d,c:f.c*e.a+f.d*e.c,d:f.c*e.b+f.d*e.d,tx:f.tx*e.a+f.ty*e.c+e.tx,ty:f.tx*e.b+f.ty*e.d+e.ty}};cc.affineTransformConcatIn=function(u,t){var s=u.a,r=u.b,p=u.c,o=u.d,n=u.tx,j=u.ty;u.a=s*t.a+r*t.c;u.b=s*t.b+r*t.d;u.c=p*t.a+o*t.c;u.d=p*t.b+o*t.d;u.tx=n*t.a+j*t.c+t.tx;u.ty=n*t.b+j*t.d+t.ty;return u};cc.affineTransformEqualToTransform=function(f,e){return f.a===e.a&&f.b===e.b&&f.c===e.c&&f.d===e.d&&f.tx===e.tx&&f.ty===e.ty};cc.affineTransformInvert=function(f){var e=1/(f.a*f.d-f.b*f.c);return{a:e*f.d,b:-e*f.b,c:-e*f.c,d:e*f.a,tx:e*(f.c*f.ty-f.d*f.tx),ty:e*(f.b*f.tx-f.a*f.ty)}};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(d){return cc.p(-d.x,-d.y)};cc.pAdd=function(f,e){return cc.p(f.x+e.x,f.y+e.y)};cc.pSub=function(f,e){return cc.p(f.x-e.x,f.y-e.y)};cc.pMult=function(f,e){return cc.p(f.x*e,f.y*e)};cc.pMidpoint=function(f,e){return cc.pMult(cc.pAdd(f,e),0.5)};cc.pDot=function(f,e){return f.x*e.x+f.y*e.y};cc.pCross=function(f,e){return f.x*e.y-f.y*e.x};cc.pPerp=function(d){return cc.p(-d.y,d.x)};cc.pRPerp=function(d){return cc.p(d.y,-d.x)};cc.pProject=function(f,e){return cc.pMult(e,cc.pDot(f,e)/cc.pDot(e,e))};cc.pRotate=function(f,e){return cc.p(f.x*e.x-f.y*e.y,f.x*e.y+f.y*e.x)};cc.pUnrotate=function(f,e){return cc.p(f.x*e.x+f.y*e.y,f.y*e.x-f.x*e.y)};cc.pLengthSQ=function(d){return cc.pDot(d,d)};cc.pDistanceSQ=function(f,e){return cc.pLengthSQ(cc.pSub(f,e))};cc.pLength=function(d){return Math.sqrt(cc.pLengthSQ(d))};cc.pDistance=function(f,e){return cc.pLength(cc.pSub(f,e))};cc.pNormalize=function(f){var e=cc.pLength(f);return 0===e?cc.p(f):cc.pMult(f,1/e)};cc.pForAngle=function(d){return cc.p(Math.cos(d),Math.sin(d))};cc.pToAngle=function(d){return Math.atan2(d.y,d.x)};cc.clampf=function(k,j,h){if(j>h){var g=j;j=h;h=g}return k<j?j:k<h?k:h};cc.pClamp=function(h,g,f){return cc.p(cc.clampf(h.x,g.x,f.x),cc.clampf(h.y,g.y,f.y))};cc.pFromSize=function(d){return cc.p(d.width,d.height)};cc.pCompOp=function(f,e){return cc.p(e(f.x),e(f.y))};cc.pLerp=function(h,g,f){return cc.pAdd(cc.pMult(h,1-f),cc.pMult(g,f))};cc.pFuzzyEqual=function(h,g,f){return h.x-f<=g.x&&g.x<=h.x+f&&h.y-f<=g.y&&g.y<=h.y+f?!0:!1};cc.pCompMult=function(f,e){return cc.p(f.x*e.x,f.y*e.y)};cc.pAngleSigned=function(k,j){var h=cc.pNormalize(k),g=cc.pNormalize(j),h=Math.atan2(h.x*g.y-h.y*g.x,cc.pDot(h,g));return Math.abs(h)<cc.POINT_EPSILON?0:h};cc.pAngle=function(h,g){var f=Math.acos(cc.pDot(cc.pNormalize(h),cc.pNormalize(g)));return Math.abs(f)<cc.POINT_EPSILON?0:f};cc.pRotateByAngle=function(n,m,k){n=cc.pSub(n,m);var j=Math.cos(k);k=Math.sin(k);var h=n.x;n.x=h*j-n.y*k+m.x;n.y=h*k+n.y*j+m.y;return n};cc.pLineIntersect=function(u,t,s,r,p){if(u.x===t.x&&u.y===t.y||s.x===r.x&&s.y===r.y){return !1}var o=t.x-u.x;t=t.y-u.y;var n=r.x-s.x;r=r.y-s.y;var j=u.x-s.x;u=u.y-s.y;s=r*o-n*t;p.x=n*u-r*j;p.y=o*u-t*j;if(0===s){return 0===p.x||0===p.y?!0:!1}p.x/=s;p.y/=s;return !0};cc.pSegmentIntersect=function(n,m,k,j){var h=cc.p(0,0);return cc.pLineIntersect(n,m,k,j,h)&&0<=h.x&&1>=h.x&&0<=h.y&&1>=h.y?!0:!1};cc.pIntersectPoint=function(n,m,k,j){var h=cc.p(0,0);return cc.pLineIntersect(n,m,k,j,h)?(k=cc.p(0,0),k.x=n.x+h.x*(m.x-n.x),k.y=n.y+h.x*(m.y-n.y),k):cc.p(0,0)};cc.pSameAs=function(f,e){return null!=f&&null!=e?f.x===e.x&&f.y===e.y:!1};cc.pZeroIn=function(d){d.x=0;d.y=0};cc.pIn=function(f,e){f.x=e.x;f.y=e.y};cc.pMultIn=function(f,e){f.x*=e;f.y*=e};cc.pSubIn=function(f,e){f.x-=e.x;f.y-=e.y};cc.pAddIn=function(f,e){f.x+=e.x;f.y+=e.y};cc.pNormalizeIn=function(d){cc.pMultIn(d,1/Math.sqrt(d.x*d.x+d.y*d.y))};cc.vertexLineToPolygon=function(D,C,B,A,z){z+=A;if(!(1>=z)){C*=0.5;for(var y,x=z-1,w=A;w<z;w++){y=2*w;var u=cc.p(D[2*w],D[2*w+1]),o;if(0===w){o=cc.pPerp(cc.pNormalize(cc.pSub(u,cc.p(D[2*(w+1)],D[2*(w+1)+1]))))}else{if(w===x){o=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(D[2*(w-1)],D[2*(w-1)+1]),u)))}else{o=cc.p(D[2*(w-1)],D[2*(w-1)+1]);var j=cc.p(D[2*(w+1)],D[2*(w+1)+1]),G=cc.pNormalize(cc.pSub(j,u)),E=cc.pNormalize(cc.pSub(o,u)),F=Math.acos(cc.pDot(G,E));o=F<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(G,E))):F<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(G,E)):cc.pPerp(cc.pNormalize(cc.pSub(j,o)))}}o=cc.pMult(o,C);B[2*y]=u.x+o.x;B[2*y+1]=u.y+o.y;B[2*(y+1)]=u.x-o.x;B[2*(y+1)+1]=u.y-o.y}for(w=0===A?0:A-1;w<x;w++){y=2*w,D=y+2,C=cc.vertex2(B[2*y],B[2*y+1]),z=cc.vertex2(B[2*(y+1)],B[2*(y+1)+1]),y=cc.vertex2(B[2*D],B[2*D]),A=cc.vertex2(B[2*(D+1)],B[2*(D+1)+1]),C=!cc.vertexLineIntersect(C.x,C.y,A.x,A.y,z.x,z.y,y.x,y.y),!C.isSuccess&&(0>C.value||1<C.value)&&(C.isSuccess=!0),C.isSuccess&&(B[2*D]=A.x,B[2*D+1]=A.y,B[2*(D+1)]=y.x,B[2*(D+1)+1]=y.y)}}};cc.vertexLineIntersect=function(u,t,s,r,p,o,n,j){if(u===s&&t===r||p===n&&o===j){return{isSuccess:!1,value:0}}s-=u;r-=t;p-=u;o-=t;n-=u;j-=t;u=Math.sqrt(s*s+r*r);s/=u;r/=u;t=p*s+o*r;o=o*s-p*r;p=t;t=n*s+j*r;j=j*s-n*r;n=t;return o===j?{isSuccess:!1,value:0}:{isSuccess:!0,value:(n+(p-n)*j/(j-o))/u}};cc.vertexListIsClockwise=function(n){for(var m=0,k=n.length;m<k;m++){var j=n[(m+1)%k],h=n[(m+2)%k];if(0<cc.pCross(cc.pSub(j,n[m]),cc.pSub(h,j))){return !1}}return !0};cc.CGAffineToGL=function(f,e){e[2]=e[3]=e[6]=e[7]=e[8]=e[9]=e[11]=e[14]=0;e[10]=e[15]=1;e[0]=f.a;e[4]=f.c;e[12]=f.tx;e[1]=f.b;e[5]=f.d;e[13]=f.ty};cc.GLToCGAffine=function(f,e){e.a=f[0];e.c=f[4];e.tx=f[12];e.b=f[1];e.d=f[5];e.ty=f[13]};cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(h,g,f){this.setTouchInfo(f,h,g)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){cc.log("getId is deprecated. Please use getID instead.");return this._id},setTouchInfo:function(h,g,f){this._prevPoint=this._point;this._point=cc.p(g||0,f||0);this._id=h;this._startPointCaptured||(this._startPoint=cc.p(this._point),this._startPointCaptured=!0)},_setPoint:function(f,e){void 0===e?(this._point.x=f.x,this._point.y=f.y):(this._point.x=f,this._point.y=e)},_setPrevPoint:function(f,e){this._prevPoint=void 0===e?cc.p(f.x,f.y):cc.p(f||0,e||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(d){this._currentTarget=d},ctor:function(d){this._type=d},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.FOCUS=4;cc.Event.CUSTOM=6;cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(d){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=d},setUserData:function(d){this._userData=d},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(d){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=d},setScrollData:function(f,e){this._scrollX=f;this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(f,e){this._x=f;this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(f,e){this._prevX=f;this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(d){this._button=d},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(d){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=d||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(d){this._eventCode=d},_setTouches:function(d){this._touches=d}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(f,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS);this._widgetGetFocus=e;this._widgetLoseFocus=f}});cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(h,g,f){this._onEvent=f;this._type=h||0;this._listenerID=g||""},_setPaused:function(d){this._paused=d},_isPaused:function(){return this._paused},_setRegistered:function(d){this._registered=d},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(d){this._fixedPriority=d},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(d){this._node=d},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(d){this._isEnabled=d},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=6;cc.EventListener.FOCUS=7;cc.EventListener.CUSTOM=8;cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(h,g){this._onCustomEvent=g;var f=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,h,function(d){null!==f._onCustomEvent&&f._onCustomEvent(d)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});cc._EventListenerCustom.create=function(f,e){return new cc._EventListenerCustom(f,e)};cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var d=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(f){var c=cc.EventMouse;switch(f._eventType){case c.DOWN:if(d.onMouseDown){d.onMouseDown(f)}break;case c.UP:if(d.onMouseUp){d.onMouseUp(f)}break;case c.MOVE:if(d.onMouseMove){d.onMouseMove(f)}break;case c.SCROLL:if(d.onMouseScroll){d.onMouseScroll(f)}}})},clone:function(){var d=new cc._EventListenerMouse;d.onMouseDown=this.onMouseDown;d.onMouseUp=this.onMouseUp;d.onMouseMove=this.onMouseMove;d.onMouseScroll=this.onMouseScroll;return d},checkAvailable:function(){return !0}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(d){this.swallowTouches=d},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var d=new cc._EventListenerTouchOneByOne;d.onTouchBegan=this.onTouchBegan;d.onTouchMoved=this.onTouchMoved;d.onTouchEnded=this.onTouchEnded;d.onTouchCancelled=this.onTouchCancelled;d.swallowTouches=this.swallowTouches;return d},checkAvailable:function(){return this.onTouchBegan?!0:(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var d=new cc._EventListenerTouchAllAtOnce;d.onTouchesBegan=this.onTouchesBegan;d.onTouchesMoved=this.onTouchesMoved;d.onTouchesEnded=this.onTouchesEnded;d.onTouchesCancelled=this.onTouchesCancelled;return d},checkAvailable:function(){return null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};cc.EventListener.create=function(k){cc.assert(k&&k.event,cc._LogInfos.EventListener_create);var j=k.event;delete k.event;var h=null;j===cc.EventListener.TOUCH_ONE_BY_ONE?h=new cc._EventListenerTouchOneByOne:j===cc.EventListener.TOUCH_ALL_AT_ONCE?h=new cc._EventListenerTouchAllAtOnce:j===cc.EventListener.MOUSE?h=new cc._EventListenerMouse:j===cc.EventListener.CUSTOM?(h=new cc._EventListenerCustom(k.eventName,k.callback),delete k.eventName,delete k.callback):j===cc.EventListener.KEYBOARD?h=new cc._EventListenerKeyboard:j===cc.EventListener.ACCELERATION?(h=new cc._EventListenerAcceleration(k.callback),delete k.callback):j===cc.EventListener.FOCUS&&(h=new cc._EventListenerFocus);for(var g in k){h[g]=k[g]}return h};cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var d=new cc._EventListenerFocus;d.onFocusChanged=this.onFocusChanged;return d},checkAvailable:function(){return this.onFocusChanged?!0:(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,function(d){if(this.onFocusChanged){this.onFocusChanged(d._widgetLoseFocus,d._widgetGetFocus)}})}});cc._EventListenerFocus.LISTENER_ID="__cc_focus_event";cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(d){0===d._getFixedPriority()?this._sceneGraphListeners.push(d):this._fixedListeners.push(d)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});cc.__getListenerID=function(h){var g=cc.Event,f=h.getType();if(f===g.ACCELERATION){return cc._EventListenerAcceleration.LISTENER_ID}if(f===g.CUSTOM){return h.getEventName()}if(f===g.KEYBOARD){return cc._EventListenerKeyboard.LISTENER_ID}if(f===g.MOUSE){return cc._EventListenerMouse.LISTENER_ID}if(f===g.FOCUS){return cc._EventListenerFocus.LISTENER_ID}f===g.TOUCH&&cc.log(cc._LogInfos.__getListenerID);return""};cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(h){null!=this._nodeListenersMap[h.__instanceId]&&this._dirtyNodes.push(h);h=h.getChildren();for(var g=0,f=h.length;g<f;g++){this._setDirtyForNode(h[g])}},pauseTarget:function(n,m){var k=this._nodeListenersMap[n.__instanceId],j,h;if(k){for(j=0,h=k.length;j<h;j++){k[j]._setPaused(!0)}}if(!0===m){for(k=n.getChildren(),j=0,h=k.length;j<h;j++){this.pauseTarget(k[j],!0)}}},resumeTarget:function(n,m){var k=this._nodeListenersMap[n.__instanceId],j,h;if(k){for(j=0,h=k.length;j<h;j++){k[j]._setPaused(!1)}}this._setDirtyForNode(n);if(!0===m){for(k=n.getChildren(),j=0,h=k.length;j<h;j++){this.resumeTarget(k[j],!0)}}},_addListener:function(d){0===this._inDispatch?this._forceAddEventListener(d):this._toAddedListeners.push(d)},_forceAddEventListener:function(h){var g=h._getListenerID(),f=this._listenersMap[g];f||(f=new cc._EventListenerVector,this._listenersMap[g]=f);f.push(h);0===h._getFixedPriority()?(this._setDirty(g,this.DIRTY_SCENE_GRAPH_PRIORITY),g=h._getSceneGraphPriority(),null===g&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(g,h),g.isRunning()&&this.resumeTarget(g)):this._setDirty(g,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(d){return this._listenersMap[d]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var u=this._dirtyNodes,t,s,r=this._nodeListenersMap,p=0,o=u.length;p<o;p++){if(t=r[u[p].__instanceId]){for(var n=0,j=t.length;n<j;n++){(s=t[n])&&this._setDirty(s._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY)}}}this._dirtyNodes.length=0}},_removeAllListenersInVector:function(h){if(h){for(var g,f=0;f<h.length;){g=h[f],g._setRegistered(!1),null!=g._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(g._getSceneGraphPriority(),g),g._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(h,g):++f}}},_removeListenersForListenerID:function(k){var j=this._listenersMap[k];if(j){var h=j.getFixedPriorityListeners(),g=j.getSceneGraphPriorityListeners();this._removeAllListenersInVector(g);this._removeAllListenersInVector(h);delete this._priorityDirtyFlagMap[k];this._inDispatch||(j.clear(),delete this._listenersMap[k])}h=this._toAddedListeners;for(j=0;j<h.length;){(g=h[j])&&g._getListenerID()===k?cc.arrayRemoveObject(h,g):++j}},_sortEventListeners:function(h){var g=this.DIRTY_NONE,f=this._priorityDirtyFlagMap;f[h]&&(g=f[h]);g!==this.DIRTY_NONE&&(f[h]=this.DIRTY_NONE,g&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(h),g&this.DIRTY_SCENE_GRAPH_PRIORITY&&((g=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(h,g):f[h]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(k,j){var h=this._getListeners(k);if(h){var g=h.getSceneGraphPriorityListeners();g&&0!==g.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(j,!0),h.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(n,m){var k=cc.eventManager._nodePriorityMap,j=n._getSceneGraphPriority(),h=m._getSceneGraphPriority();return m&&h&&k[h.__instanceId]?n&&j&&k[j.__instanceId]?k[m._getSceneGraphPriority().__instanceId]-k[n._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(k){if(k=this._listenersMap[k]){var j=k.getFixedPriorityListeners();if(j&&0!==j.length){j.sort(this._sortListenersOfFixedPriorityAsc);for(var h=0,g=j.length;h<g&&!(0<=j[h]._getFixedPriority());){++h}k.gt0Index=h}}},_sortListenersOfFixedPriorityAsc:function(f,e){return f._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(p){if(p=this._listenersMap[p]){var o=p.getFixedPriorityListeners(),n=p.getSceneGraphPriorityListeners(),m,k,j=this._toRemovedListeners;if(n){for(m=0;m<n.length;){k=n[m],k._isRegistered()?++m:(cc.arrayRemoveObject(n,k),k=j.indexOf(k),-1!==k&&j.splice(k,1))}}if(o){for(m=0;m<o.length;){k=o[m],k._isRegistered()?++m:(cc.arrayRemoveObject(o,k),k=j.indexOf(k),-1!==k&&j.splice(k,1))}}n&&0===n.length&&p.clearSceneGraphListeners();o&&0===o.length&&p.clearFixedListeners()}},_updateListeners:function(h){var g=this._inDispatch;cc.assert(0<g,cc._LogInfos.EventManager__updateListeners);if(!(1<g)){h.getType()===cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(h));cc.assert(1===g,cc._LogInfos.EventManager__updateListeners_2);h=this._listenersMap;var g=this._priorityDirtyFlagMap,f;for(f in h){h[f].empty()&&(delete g[f],delete h[f])}f=this._toAddedListeners;if(0!==f.length){h=0;for(g=f.length;h<g;h++){this._forceAddEventListener(f[h])}this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var p=this._toRemovedListeners,o=0;o<p.length;o++){var n=p[o],m=this._listenersMap[n._getListenerID()];if(m){var k=m.getFixedPriorityListeners(),j=m.getSceneGraphPriorityListeners();j&&(m=j.indexOf(n),-1!==m&&j.splice(m,1));k&&(m=k.indexOf(n),-1!==m&&k.splice(m,1))}}p.length=0},_onTouchEventCallback:function(u,t){if(!u._isRegistered){return !1}var s=t.event,r=t.selTouch;s._setCurrentTarget(u._node);var p=!1,o,n=s.getEventCode(),j=cc.EventTouch.EventCode;if(n===j.BEGAN){u.onTouchBegan&&(p=u.onTouchBegan(r,s))&&u._registered&&u._claimedTouches.push(r)}else{if(0<u._claimedTouches.length&&-1!==(o=u._claimedTouches.indexOf(r))){if(p=!0,n===j.MOVED&&u.onTouchMoved){u.onTouchMoved(r,s)}else{if(n===j.ENDED){if(u.onTouchEnded){u.onTouchEnded(r,s)}u._registered&&u._claimedTouches.splice(o,1)}else{if(n===j.CANCELLED){if(u.onTouchCancelled){u.onTouchCancelled(r,s)}u._registered&&u._claimedTouches.splice(o,1)}}}}}return s.isStopped()?(cc.eventManager._updateListeners(s),!0):p&&u._registered&&u.swallowTouches?(t.needsMutableSet&&t.touches.splice(r,1),!0):!1},_dispatchTouchEvent:function(s){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var r=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),p=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==r||null!==p){var o=s.getTouches(),n=cc.copyArray(o),m={event:s,needsMutableSet:r&&p,touches:n,selTouch:null};if(r){for(var j=0;j<o.length;j++){if(m.selTouch=o[j],this._dispatchEventToListeners(r,this._onTouchEventCallback,m),s.isStopped()){return}}}if(p&&0<n.length&&(this._dispatchEventToListeners(p,this._onTouchesEventCallback,{event:s,touches:n}),s.isStopped())){return}this._updateListeners(s)}},_onTouchesEventCallback:function(p,o){if(!p._registered){return !1}var n=cc.EventTouch.EventCode,m=o.event,k=o.touches,j=m.getEventCode();m._setCurrentTarget(p._node);if(j===n.BEGAN&&p.onTouchesBegan){p.onTouchesBegan(k,m)}else{if(j===n.MOVED&&p.onTouchesMoved){p.onTouchesMoved(k,m)}else{if(j===n.ENDED&&p.onTouchesEnded){p.onTouchesEnded(k,m)}else{if(j===n.CANCELLED&&p.onTouchesCancelled){p.onTouchesCancelled(k,m)}}}}return m.isStopped()?(cc.eventManager._updateListeners(m),!0):!1},_associateNodeAndEventListener:function(h,g){var f=this._nodeListenersMap[h.__instanceId];f||(f=[],this._nodeListenersMap[h.__instanceId]=f);f.push(g)},_dissociateNodeAndEventListener:function(h,g){var f=this._nodeListenersMap[h.__instanceId];f&&(cc.arrayRemoveObject(f,g),0===f.length&&delete this._nodeListenersMap[h.__instanceId])},_dispatchEventToListeners:function(u,t,s){var r=!1,p=u.getFixedPriorityListeners(),o=u.getSceneGraphPriorityListeners(),n=0,j;if(p&&0!==p.length){for(;n<u.gt0Index;++n){if(j=p[n],j.isEnabled()&&!j._isPaused()&&j._isRegistered()&&t(j,s)){r=!0;break}}}if(o&&!r){for(u=0;u<o.length;u++){if(j=o[u],j.isEnabled()&&!j._isPaused()&&j._isRegistered()&&t(j,s)){r=!0;break}}}if(p&&!r){for(;n<p.length&&(j=p[n],!j.isEnabled()||j._isPaused()||!j._isRegistered()||!t(j,s));++n){}}},_setDirty:function(h,g){var f=this._priorityDirtyFlagMap;f[h]=null==f[h]?g:g|f[h]},_visitTarget:function(w,v){var u=w.getChildren(),t=0,s=u.length,r=this._globalZOrderNodeMap,p=this._nodeListenersMap;if(0<s){for(var o;t<s;t++){if((o=u[t])&&0>o.getLocalZOrder()){this._visitTarget(o,!1)}else{break}}null!=p[w.__instanceId]&&(r[w.getGlobalZOrder()]||(r[w.getGlobalZOrder()]=[]),r[w.getGlobalZOrder()].push(w.__instanceId));for(;t<s;t++){(o=u[t])&&this._visitTarget(o,!1)}}else{null!=p[w.__instanceId]&&(r[w.getGlobalZOrder()]||(r[w.getGlobalZOrder()]=[]),r[w.getGlobalZOrder()].push(w.__instanceId))}if(v){var u=[],j;for(j in r){u.push(j)}u.sort(this._sortNumberAsc);j=u.length;o=this._nodePriorityMap;for(t=0;t<j;t++){for(s=r[u[t]],p=0;p<s.length;p++){o[s[p]]=++this._nodePriorityIndex}}this._globalZOrderNodeMap={}}},_sortNumberAsc:function(f,e){return f-e},addListener:function(f,e){cc.assert(f&&e,cc._LogInfos.eventManager_addListener_2);if(!(f instanceof cc.EventListener)){cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3),f=cc.EventListener.create(f)}else{if(f._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}}if(f.checkAvailable()){if(cc.isNumber(e)){if(0===e){cc.log(cc._LogInfos.eventManager_addListener);return}f._setSceneGraphPriority(null);f._setFixedPriority(e);f._setRegistered(!0);f._setPaused(!1)}else{f._setSceneGraphPriority(e),f._setFixedPriority(0),f._setRegistered(!0)}this._addListener(f);return f}},addCustomListener:function(h,g){var f=new cc._EventListenerCustom(h,g);this.addListener(f,1);return f},removeListener:function(p){if(null!=p){var o,n=this._listenersMap,m;for(m in n){var k=n[m],j=k.getFixedPriorityListeners();o=k.getSceneGraphPriorityListeners();(o=this._removeListenerInVector(o,p))?this._setDirty(p._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(o=this._removeListenerInVector(j,p))&&this._setDirty(p._getListenerID(),this.DIRTY_FIXED_PRIORITY);k.empty()&&(delete this._priorityDirtyFlagMap[p._getListenerID()],delete n[m]);if(o){break}}if(!o){for(n=this._toAddedListeners,m=0,k=n.length;m<k;m++){if(j=n[m],j===p){cc.arrayRemoveObject(n,j);j._setRegistered(!1);break}}}}},_removeListenerInCallback:function(n,m){if(null==n){return !1}for(var k=0,j=n.length;k<j;k++){var h=n[k];if(h._onCustomEvent===m||h._onEvent===m){return h._setRegistered(!1),null!=h._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(h._getSceneGraphPriority(),h),h._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(n,h),!0}}return !1},_removeListenerInVector:function(n,m){if(null==n){return !1}for(var k=0,j=n.length;k<j;k++){var h=n[k];if(h===m){return h._setRegistered(!1),null!=h._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(h._getSceneGraphPriority(),h),h._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(n,h):this._toRemovedListeners.push(h),!0}}return !1},removeListeners:function(n,m){if(n instanceof cc.Node){delete this._nodePriorityMap[n.__instanceId];cc.arrayRemoveObject(this._dirtyNodes,n);var k=this._nodeListenersMap[n.__instanceId];if(k){for(var j=cc.copyArray(k),k=0;k<j.length;k++){this.removeListener(j[k])}j.length=0}j=this._toAddedListeners;for(k=0;k<j.length;){var h=j[k];h._getSceneGraphPriority()===n?(h._setSceneGraphPriority(null),h._setRegistered(!1),j.splice(k,1)):++k}if(!0===m){for(j=n.getChildren(),k=0,h=j.length;k<h;k++){this.removeListeners(j[k],!0)}}}else{n===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):n===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):n===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):n===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):n===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)}},removeCustomListeners:function(d){this._removeListenersForListenerID(d)},removeAllListeners:function(){var h=this._listenersMap,g=this._internalCustomListenerIDs,f;for(f in h){-1===g.indexOf(f)&&this._removeListenersForListenerID(f)}},setPriority:function(n,m){if(null!=n){var k=this._listenersMap,j;for(j in k){var h=k[j].getFixedPriorityListeners();if(h&&-1!==h.indexOf(n)){null!=n._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority);n._getFixedPriority()!==m&&(n._setFixedPriority(m),this._setDirty(n._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(d){this._isEnabled=d},isEnabled:function(){return this._isEnabled},dispatchEvent:function(f){if(this._isEnabled){this._updateDirtyFlagForSceneGraph();this._inDispatch++;if(!f||!f.getType){throw Error("event is undefined")}if(f.getType()===cc.Event.TOUCH){this._dispatchTouchEvent(f)}else{var e=cc.__getListenerID(f);this._sortEventListeners(e);e=this._listenersMap[e];null!=e&&this._dispatchEventToListeners(e,this._onListenerCallback,f);this._updateListeners(f)}this._inDispatch--}},_onListenerCallback:function(f,e){e._setCurrentTarget(f._getSceneGraphPriority());f._onEvent(e);return e.isStopped()},dispatchCustomEvent:function(h,g){var f=new cc.EventCustom(h);f.setUserData(g);this.dispatchEvent(f)}};cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(d){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION);this._acc=d}});cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(f,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD);this._keyCode=f;this._isPressed=e}});cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(f){this._onAccelerationEvent=f;var e=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(d){e._onAccelerationEvent(d._acc,d)})},checkAvailable:function(){cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable);return !0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}});cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";cc._EventListenerAcceleration.create=function(d){return new cc._EventListenerAcceleration(d)};cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var d=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(c){if(c._isPressed){if(d.onKeyPressed){d.onKeyPressed(c._keyCode,c)}}else{if(d.onKeyReleased){d.onKeyReleased(c._keyCode,c)}}})},clone:function(){var d=new cc._EventListenerKeyboard;d.onKeyPressed=this.onKeyPressed;d.onKeyReleased=this.onKeyReleased;return d},checkAvailable:function(){return null===this.onKeyPressed&&null===this.onKeyReleased?(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}});cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:0.0001,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",getRenderCmd:function(d){return d._createRenderCmd()},rendering:function(p){var o=this._renderCmds,n,m=cc.view.getScaleX(),k=cc.view.getScaleY(),j=p||cc._renderContext;j.computeRealOffsetY();p=0;for(n=o.length;p<n;p++){o[p].rendering(j,m,k)}},_renderingToCacheCanvas:function(s,r,p,o){s||cc.log("The context of RenderTexture is invalid.");p=cc.isUndefined(p)?1:p;o=cc.isUndefined(o)?1:o;r=r||this._currentID;var n=this._cacheToCanvasCmds[r],m,j;s.computeRealOffsetY();m=0;for(j=n.length;m<j;m++){n[m].rendering(s,p,o)}this._removeCache(r);s=this._cacheInstanceIds;0===s.length?this._isCacheToCanvasOn=!1:this._currentID=s[s.length-1]},_turnToCacheMode:function(d){this._isCacheToCanvasOn=!0;d=d||0;this._cacheToCanvasCmds[d]=[];-1===this._cacheInstanceIds.indexOf(d)&&this._cacheInstanceIds.push(d);this._currentID=d},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(f){f=f||this._currentID;var e=this._cacheToCanvasCmds[f];e&&(e.length=0,delete this._cacheToCanvasCmds[f]);cc.arrayRemoveObject(this._cacheInstanceIds,f)},resetFlag:function(){this.childrenOrderDirty=!1;this._transformNodePool.length=0},transform:function(){var h=this._transformNodePool;h.sort(this._sortNodeByLevelAsc);for(var g=0,f=h.length;g<f;g++){0!==h[g]._dirtyFlag&&h[g].updateStatus()}h.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(f,e){return f._curLevel-e._curLevel},pushDirtyNode:function(d){this._transformNodePool.push(d)},clear:function(){var h=cc._canvas,g=cc._renderContext,f=g.getContext();f.setTransform(1,0,0,1,0,0);f.clearRect(0,0,h.width,h.height);if(0!==this._clearColor.r||0!==this._clearColor.g||0!==this._clearColor.b){g.setFillStyle(this._clearFillStyle),g.setGlobalAlpha(this._clearColor.a),f.fillRect(0,0,h.width,h.height)}},clearRenderCommands:function(){this._renderCmds.length=0;this._cacheInstanceIds.length=0;this._isCacheToCanvasOn=!1},pushRenderCommand:function(f){if(f.needDraw()){if(this._isCacheToCanvasOn){var e=this._cacheToCanvasCmds[this._currentID];-1===e.indexOf(f)&&e.push(f)}else{-1===this._renderCmds.indexOf(f)&&this._renderCmds.push(f)}}}};(function(){cc.CanvasContextWrapper=function(e){this._context=e;this._saveCount=0;this._currentAlpha=e.globalAlpha;this._currentCompositeOperation=e.globalCompositeOperation;this._currentFillStyle=e.fillStyle;this._currentStrokeStyle=e.strokeStyle;this._offsetY=this._offsetX=0;this._realOffsetY=this.height;this._armatureMode=0};var d=cc.CanvasContextWrapper.prototype;d.resetCache=function(){var e=this._context;this._currentAlpha=e.globalAlpha;this._currentCompositeOperation=e.globalCompositeOperation;this._currentFillStyle=e.fillStyle;this._currentStrokeStyle=e.strokeStyle;this._realOffsetY=this._context.canvas.height+this._offsetY};d.setOffset=function(g,f){this._offsetX=g;this._offsetY=f;this._realOffsetY=this._context.canvas.height+this._offsetY};d.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY};d.setViewScale=function(g,f){this._scaleX=g;this._scaleY=f};d.getContext=function(){return this._context};d.save=function(){this._context.save();this._saveCount++};d.restore=function(){this._context.restore();this._saveCount--};d.setGlobalAlpha=function(e){0<this._saveCount?this._context.globalAlpha=e:this._currentAlpha!==e&&(this._currentAlpha=e,this._context.globalAlpha=e)};d.setCompositeOperation=function(e){0<this._saveCount?this._context.globalCompositeOperation=e:this._currentCompositeOperation!==e&&(this._currentCompositeOperation=e,this._context.globalCompositeOperation=e)};d.setFillStyle=function(e){0<this._saveCount?this._context.fillStyle=e:this._currentFillStyle!==e&&(this._currentFillStyle=e,this._context.fillStyle=e)};d.setStrokeStyle=function(e){0<this._saveCount?this._context.strokeStyle=e:this._currentStrokeStyle!==e&&(this._currentStrokeStyle=e,this._context.strokeStyle=e)};d.setTransform=function(j,h,g){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(j.a,-j.b,-j.c,j.d,j.tx*h,-(j.ty*g))):this._context.setTransform(j.a,-j.b,-j.c,j.d,this._offsetX+j.tx*h,this._realOffsetY-j.ty*g)};d._switchToArmatureMode=function(m,k,j,h){m?(this._armatureMode++,this._context.setTransform(k.a,k.c,k.b,k.d,this._offsetX+k.tx*j,this._realOffsetY-k.ty*h),this.save()):(this._armatureMode--,this.restore())}})();cc.rendererWebGL=function(){var w={texture:null,blendSrc:null,blendDst:null,shader:null},v=null,u=null,t=0,s=0,r=null,p=0,o=null,j=null;return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:0.01,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color("#FFFFFF"),init:function(){var h=cc._renderContext;h.disable(h.CULL_FACE);h.disable(h.DEPTH_TEST);this.mat4Identity=new cc.math.Matrix4;this.mat4Identity.identity();h=cc._renderContext;null===v&&(u=h.createBuffer(),v=h.createBuffer());h=cc._renderContext;if(v){h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,v);for(var f=new Uint16Array(12000),e=0,d=0;12000>d;d+=6){f[d]=e+0,f[d+1]=e+1,f[d+2]=e+2,f[d+3]=e+1,f[d+4]=e+2,f[d+5]=e+3,e+=4}h.bufferData(h.ELEMENT_ARRAY_BUFFER,f,h.STATIC_DRAW)}u&&(p=48000,r=new ArrayBuffer(4*p),o=new Float32Array(r),j=new Uint32Array(r),h.bindBuffer(h.ARRAY_BUFFER,u),h.bufferData(h.ARRAY_BUFFER,o,h.DYNAMIC_DRAW));t=8000},getVertexSize:function(){return t},getRenderCmd:function(d){return d._createRenderCmd()},_turnToCacheMode:function(d){this._isCacheToBufferOn=!0;d=d||0;this._cacheToBufferCmds[d]?this._cacheToBufferCmds[d].length=0:this._cacheToBufferCmds[d]=[];-1===this._cacheInstanceIds.indexOf(d)&&this._cacheInstanceIds.push(d);this._currentID=d},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(f){f=f||this._currentID;var e=this._cacheToBufferCmds[f];e&&(e.length=0,delete this._cacheToBufferCmds[f]);cc.arrayRemoveObject(this._cacheInstanceIds,f)},_renderingToBuffer:function(d){d=d||this._currentID;this.rendering(cc._renderContext,this._cacheToBufferCmds[d]);this._removeCache(d);d=this._cacheInstanceIds;0===d.length?this._isCacheToBufferOn=!1:this._currentID=d[d.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1);this._transformNodePool.length=0},transform:function(){var m=this._transformNodePool;m.sort(this._sortNodeByLevelAsc);var k,h,g;k=0;for(h=m.length;k<h;k++){g=m[k],g.updateStatus()}m.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(f,e){return f._curLevel-e._curLevel},pushDirtyNode:function(d){this._transformNodePool.push(d)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var d=cc._renderContext;d.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)},setDepthTest:function(f){var e=cc._renderContext;f?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(f){if(f.needDraw()){if(this._isCacheToBufferOn){var e=this._cacheToBufferCmds[this._currentID];-1===e.indexOf(f)&&e.push(f)}else{-1===this._renderCmds.indexOf(f)&&this._renderCmds.push(f)}}},_increaseBatchingSize:function(d){s+=d},_uploadBufferData:function(n){s>=t&&this._batchRendering();var m=n._node._texture,g=n._node._blendFunc.src,c=n._node._blendFunc.dst,f=n._shaderProgram;if(w.texture!==m||w.blendSrc!==g||w.blendDst!==c||w.shader!==f){this._batchRendering(),w.texture=m,w.blendSrc=g,w.blendDst=c,w.shader=f}n=n.uploadData(o,j,6*s);0<n&&(s+=n)},_batchRendering:function(){if(0!==s&&w.texture){var e=cc._renderContext,d=w.texture,f=w.shader,c=s/4;f&&(f.use(),f._updateProjectionUniform());cc.glBlendFunc(w.blendSrc,w.blendDst);cc.glBindTexture2DN(0,d);d=!e.bindBuffer(e.ARRAY_BUFFER,u);s>0.5*t?e.bufferData(e.ARRAY_BUFFER,o,e.DYNAMIC_DRAW):(f=o.subarray(0,6*s),e.bufferData(e.ARRAY_BUFFER,f,e.DYNAMIC_DRAW));d&&(e.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),e.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,24,12),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,24,16));e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,v);e.drawElements(e.TRIANGLES,6*c,e.UNSIGNED_SHORT,0);cc.g_NumberOfDraws++;s=0}},rendering:function(A,z){var y=z||this._renderCmds,x,g,c,B=A||cc._renderContext;B.bindBuffer(gl.ARRAY_BUFFER,null);x=0;for(g=y.length;x<g;++x){c=y[x],c.uploadData?this._uploadBufferData(c):(0<s&&this._batchRendering(),c.rendering(B))}this._batchRendering();w.texture=null}}}();cc._tmp.PrototypeCCNode=function(){var d=cc.Node.prototype;cc.defineGetterSetter(d,"x",d.getPositionX,d.setPositionX);cc.defineGetterSetter(d,"y",d.getPositionY,d.setPositionY);cc.defineGetterSetter(d,"width",d._getWidth,d._setWidth);cc.defineGetterSetter(d,"height",d._getHeight,d._setHeight);cc.defineGetterSetter(d,"anchorX",d._getAnchorX,d._setAnchorX);cc.defineGetterSetter(d,"anchorY",d._getAnchorY,d._setAnchorY);cc.defineGetterSetter(d,"skewX",d.getSkewX,d.setSkewX);cc.defineGetterSetter(d,"skewY",d.getSkewY,d.setSkewY);cc.defineGetterSetter(d,"zIndex",d.getLocalZOrder,d.setLocalZOrder);cc.defineGetterSetter(d,"vertexZ",d.getVertexZ,d.setVertexZ);cc.defineGetterSetter(d,"rotation",d.getRotation,d.setRotation);cc.defineGetterSetter(d,"rotationX",d.getRotationX,d.setRotationX);cc.defineGetterSetter(d,"rotationY",d.getRotationY,d.setRotationY);cc.defineGetterSetter(d,"scale",d.getScale,d.setScale);cc.defineGetterSetter(d,"scaleX",d.getScaleX,d.setScaleX);cc.defineGetterSetter(d,"scaleY",d.getScaleY,d.setScaleY);cc.defineGetterSetter(d,"children",d.getChildren);cc.defineGetterSetter(d,"childrenCount",d.getChildrenCount);cc.defineGetterSetter(d,"parent",d.getParent,d.setParent);cc.defineGetterSetter(d,"visible",d.isVisible,d.setVisible);cc.defineGetterSetter(d,"running",d.isRunning);cc.defineGetterSetter(d,"ignoreAnchor",d.isIgnoreAnchorPointForPosition,d.ignoreAnchorPointForPosition);cc.defineGetterSetter(d,"actionManager",d.getActionManager,d.setActionManager);cc.defineGetterSetter(d,"scheduler",d.getScheduler,d.setScheduler);cc.defineGetterSetter(d,"shaderProgram",d.getShaderProgram,d.setShaderProgram);cc.defineGetterSetter(d,"opacity",d.getOpacity,d.setOpacity);cc.defineGetterSetter(d,"opacityModifyRGB",d.isOpacityModifyRGB);cc.defineGetterSetter(d,"cascadeOpacity",d.isCascadeOpacityEnabled,d.setCascadeOpacityEnabled);cc.defineGetterSetter(d,"color",d.getColor,d.setColor);cc.defineGetterSetter(d,"cascadeColor",d.isCascadeColorEnabled,d.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_eventDispatcher:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){this._initNode();this._initRendererCmd()},_initNode:function(){this._anchorPoint=cc.p(0,0);this._contentSize=cc.size(0,0);this._position=cc.p(0,0);this._normalizedPosition=cc.p(0,0);this._children=[];var d=cc.director;this._actionManager=d.getActionManager();this._scheduler=d.getScheduler();this._additionalTransform=cc.affineTransformMakeIdentity();cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this));this._realOpacity=255;this._realColor=cc.color(255,255,255,255);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},init:function(){return !0},_arrayMakeObjectsPerformSelector:function(n,m){if(n&&0!==n.length){var k,j=n.length,h;k=cc.Node._stateCallbackType;switch(m){case k.onEnter:for(k=0;k<j;k++){if(h=n[k]){h.onEnter()}}break;case k.onExit:for(k=0;k<j;k++){if(h=n[k]){h.onExit()}}break;case k.onEnterTransitionDidFinish:for(k=0;k<j;k++){if(h=n[k]){h.onEnterTransitionDidFinish()}}break;case k.cleanup:for(k=0;k<j;k++){(h=n[k])&&h.cleanup()}break;case k.updateTransform:for(k=0;k<j;k++){(h=n[k])&&h.updateTransform()}break;case k.onExitTransitionDidStart:for(k=0;k<j;k++){if(h=n[k]){h.onExitTransitionDidStart()}}break;case k.sortAllChildren:for(k=0;k<j;k++){(h=n[k])&&h.sortAllChildren()}break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},attr:function(f){for(var e in f){this[e]=f[e]}},getSkewX:function(){return this._skewX},setSkewX:function(d){this._skewX=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(d){this._skewY=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(d){this._localZOrder=d;this._parent&&this._parent.reorderChild(this,d);cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(d){this._localZOrder=d},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(d){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(d)},setGlobalZOrder:function(d){this._globalZOrder!==d&&(this._globalZOrder=d,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(d){this._customZ=this._vertexZ=d},getRotation:function(){this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(d){this._rotationX=this._rotationY=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(d){this._rotationX=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(d){this._rotationY=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX},setScale:function(f,e){this._scaleX=f;this._scaleY=e||0===e?e:f;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(d){this._scaleX=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(d){this._scaleY=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(h,g){var f=this._position;if(void 0===g){if(f.x===h.x&&f.y===h.y){return}f.x=h.x;f.y=h.y}else{if(f.x===h&&f.y===g){return}f.x=h;f.y=g}this._usingNormalizedPosition=!1;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(h,g){var f=this._normalizedPosition;void 0===g?(f.x=h.x,f.y=h.y):(f.x=h,f.y=g);this._normalizedPositionDirty=this._usingNormalizedPosition=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(d){this._position.x=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(d){this._position.y=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(d){this._visible!==d&&(this._visible=d,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(h,g){var f=this._anchorPoint;if(void 0===g){if(h.x===f.x&&h.y===f.y){return}f.x=h.x;f.y=h.y}else{if(h===f.x&&g===f.y){return}f.x=h;f.y=g}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(d){this._anchorPoint.x!==d&&(this._anchorPoint.x=d,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(d){this._anchorPoint.y!==d&&(this._anchorPoint.y=d,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(d){this._contentSize.width=d;this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(d){this._contentSize.height=d;this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(h,g){var f=this._contentSize;if(void 0===g){if(h.width===f.width&&h.height===f.height){return}f.width=h.width;f.height=h.height}else{if(h===f.width&&g===f.height){return}f.width=h;f.height=g}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(d){this._parent=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(d){d!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=d,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(d){this.tag=d},setName:function(d){this._name=d},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(d){this.userData=d},getUserObject:function(){return this.userObject},setUserObject:function(d){this.userObject!==d&&(this.userObject=d)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(d){this.arrivalOrder=d},getActionManager:function(){this._actionManager||(this._actionManager=cc.director.getActionManager());return this._actionManager},setActionManager:function(d){this._actionManager!==d&&(this.stopAllActions(),this._actionManager=d)},getScheduler:function(){this._scheduler||(this._scheduler=cc.director.getScheduler());return this._scheduler},setScheduler:function(d){this._scheduler!==d&&(this.unscheduleAllCallbacks(),this._scheduler=d)},boundingBox:function(){cc.log(cc._LogInfos.Node_boundingBox);return this.getBoundingBox()},getBoundingBox:function(){var d=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(d,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this);this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup)},getChildByTag:function(k){var j=this._children;if(null!==j){for(var h=0;h<j.length;h++){var g=j[h];if(g&&g.tag===k){return g}}}return null},getChildByName:function(k){if(!k){return cc.log("Invalid name"),null}for(var j=this._children,h=0,g=j.length;h<g;h++){if(j[h]._name===k){return j[h]}}return null},addChild:function(n,m,k){m=void 0===m?n._localZOrder:m;var j,h=!1;cc.isUndefined(k)?(k=void 0,j=n._name):cc.isString(k)?(j=k,k=void 0):cc.isNumber(k)&&(h=!0,j="");cc.assert(n,cc._LogInfos.Node_addChild_3);cc.assert(null===n._parent,"child already added. It can't be added again");this._addChildHelper(n,m,k,j,h)},_addChildHelper:function(n,m,k,j,h){this._children||(this._children=[]);this._insertChild(n,m);h?n.setTag(k):n.setName(j);n.setParent(this);n.setOrderOfArrival(cc.s_globalOrderOfArrival++);if(this._running&&(n.onEnter(),this._isTransitionFinished)){n.onEnterTransitionDidFinish()}n._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._cascadeColorEnabled&&n._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);this._cascadeOpacityEnabled&&n._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(d){this._parent&&(void 0===d&&(d=!0),this._parent.removeChild(this,d))},removeFromParentAndCleanup:function(d){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);this.removeFromParent(d)},removeChild:function(f,e){0!==this._children.length&&(void 0===e&&(e=!0),-1<this._children.indexOf(f)&&this._detachChild(f,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(h,g){h===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var f=this.getChildByTag(h);f?this.removeChild(f,g):cc.log(cc._LogInfos.Node_removeChildByTag_2,h)},removeAllChildrenWithCleanup:function(d){this.removeAllChildren(d)},removeAllChildren:function(k){var j=this._children;if(null!==j){void 0===k&&(k=!0);for(var h=0;h<j.length;h++){var g=j[h];g&&(this._running&&(g.onExitTransitionDidStart(),g.onExit()),k&&g.cleanup(),g.parent=null,g._renderCmd.detachFromParent())}this._children.length=0;cc.renderer.childrenOrderDirty=!0}},_detachChild:function(f,e){this._running&&(f.onExitTransitionDidStart(),f.onExit());e&&f.cleanup();f.parent=null;f._renderCmd.detachFromParent();cc.arrayRemoveObject(this._children,f)},_insertChild:function(f,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0;this._children.push(f);f._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(f,e){cc.assert(f,cc._LogInfos.Node_reorderChild);cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0;f.arrivalOrder=cc.s_globalOrderOfArrival;cc.s_globalOrderOfArrival++;f._setLocalZOrder(e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){var n=this._children,m=n.length,k,j,h;for(k=1;k<m;k++){h=n[k];for(j=k-1;0<=j;){if(h._localZOrder<n[j]._localZOrder){n[j+1]=n[j]}else{if(h._localZOrder===n[j]._localZOrder&&h.arrivalOrder<n[j].arrivalOrder){n[j+1]=n[j]}else{break}}j--}n[j+1]=h}this._reorderChildDirty=!1}},draw:function(d){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1;this._running=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter);this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0;this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1;this.pause();this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit);this.removeAllComponents()},runAction:function(d){cc.assert(d,cc._LogInfos.Node_runAction);this.actionManager.addAction(d,this,!this._running);return d},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(d){this.actionManager.removeAction(d)},stopActionByTag:function(d){d===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(d,this)},getActionByTag:function(d){return d===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(d,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(d){this.scheduler.scheduleUpdate(this,d,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(p,o,n,m,k){var j=arguments.length;"function"===typeof p?1===j?(o=0,n=cc.REPEAT_FOREVER,m=0,k=this.__instanceId):2===j?"number"===typeof o?(n=cc.REPEAT_FOREVER,m=0,k=this.__instanceId):(k=o,o=0,n=cc.REPEAT_FOREVER,m=0):3===j?("string"===typeof n?(k=n,n=cc.REPEAT_FOREVER):k=this.__instanceId,m=0):4===j&&(k=this.__instanceId):1===j?(o=0,n=cc.REPEAT_FOREVER,m=0):2===j&&(n=cc.REPEAT_FOREVER,m=0);cc.assert(p,cc._LogInfos.Node_schedule);cc.assert(0<=o,cc._LogInfos.Node_schedule_2);n=null==n?cc.REPEAT_FOREVER:n;this.scheduler.schedule(p,this,o||0,n,m||0,!this._running,k)},scheduleOnce:function(h,g,f){void 0===f&&(f=this.__instanceId);this.schedule(h,0,0,g,f)},unschedule:function(d){d&&this.scheduler.unschedule(d,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);this.resume()},resume:function(){this.scheduler.resumeTarget(this);this.actionManager&&this.actionManager.resumeTarget(this);cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(d){if(void 0===d){return this._additionalTransformDirty=!1}this._additionalTransform=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var f=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent){f=cc.affineTransformConcat(f,e.getNodeToParentTransform())}return f},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(d){return cc.pointApplyAffineTransform(d,this.getWorldToNodeTransform())},convertToWorldSpace:function(d){d=d||cc.p(0,0);return cc.pointApplyAffineTransform(d,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(d){return cc.pSub(this.convertToNodeSpace(d),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(d){d=d||cc.p(0,0);d=cc.pAdd(d,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(d)},_convertToWindowSpace:function(d){d=this.convertToWorldSpace(d);return cc.director.convertToUI(d)},convertTouchToNodeSpace:function(d){d=d.getLocation();return this.convertToNodeSpace(d)},convertTouchToNodeSpaceAR:function(d){d=cc.director.convertToGL(d.getLocation());return this.convertToNodeSpaceAR(d)},update:function(d){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(d)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(d){return this._componentContainer?this._componentContainer.getComponent(d):null},addComponent:function(d){this._componentContainer&&this._componentContainer.add(d)},removeComponent:function(d){return this._componentContainer?this._componentContainer.remove(d):!1},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(d){this._renderCmd.visit(d)},transform:function(f,e){this._renderCmd.transform(f,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(h){var g=this._renderCmd.getNodeToParentTransform();if(h){for(var g={a:g.a,b:g.b,c:g.c,d:g.d,tx:g.tx,ty:g.ty},f=this._parent;null!=f&&f!=h;f=f.getParent()){cc.affineTransformConcatIn(g,f.getNodeToParentTransform())}}return g},getNodeToParentAffineTransform:function(d){return this.getNodeToParentTransform(d)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(d){this.grid=d},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(d){this._renderCmd.setShaderProgram(d)},getGLServerState:function(){return 0},setGLServerState:function(d){},getBoundingBoxToWorld:function(){var n=cc.rect(0,0,this._contentSize.width,this._contentSize.height),m=this.getNodeToWorldTransform(),n=cc.rectApplyAffineTransform(n,m);if(!this._children){return n}for(var k=this._children,j=0;j<k.length;j++){var h=k[j];h&&h._visible&&(h=h._getBoundingBoxToCurrentNode(m))&&(n=cc.rectUnion(n,h))}return n},_getBoundingBoxToCurrentNode:function(n){var m=cc.rect(0,0,this._contentSize.width,this._contentSize.height);n=void 0===n?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),n);m=cc.rectApplyAffineTransform(m,n);if(!this._children){return m}for(var k=this._children,j=0;j<k.length;j++){var h=k[j];h&&h._visible&&(h=h._getBoundingBoxToCurrentNode(n))&&(m=cc.rectUnion(m,h))}return m},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(d){this._realOpacity=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(d){this._renderCmd._updateDisplayOpacity(d)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(d){this._cascadeOpacityEnabled!==d&&(this._cascadeOpacityEnabled=d,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var d=this._realColor;return cc.color(d.r,d.g,d.b,d.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(f){var e=this._realColor;e.r=f.r;e.g=f.g;e.b=f.b;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(d){this._renderCmd._updateDisplayColor(d)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(d){this._cascadeColorEnabled!==d&&(this._cascadeColorEnabled=d,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(d){},isOpacityModifyRGB:function(){return !1},_initRendererCmd:function(){this._renderCmd=cc.renderer.getRenderCmd(this)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(s,r){cc.assert(s&&0!=s.length,"Invalid name");cc.assert(null!=r,"Invalid callback function");var p=s.length,o=0,n=p,m=!1;2<p&&"/"===s[0]&&"/"===s[1]&&(m=!0,o=2,n-=2);var j=!1;3<p&&"/"===s[p-3]&&"."===s[p-2]&&"."===s[p-1]&&(j=!0,n-=3);p=s.substr(o,n);j&&(p="[[:alnum:]]+/"+p);m?this.doEnumerateRecursive(this,p,r):this.doEnumerate(p,r)},doEnumerateRecursive:function(p,o,n){if(!p.doEnumerate(o,n)){for(var m=p.getChildren(),k=m.length,j=0;j<k&&(p=m[j],!this.doEnumerateRecursive(p,o,n));j++){}}},doEnumerate:function(w,v){var u=w.indexOf("/"),t=w,s=!1;-1!==u&&(t=w.substr(0,u),s=!0);for(var u=!1,r,p=this._children,o=p.length,j=0;j<o;j++){if(r=p[j],-1!==r._name.indexOf(t)){if(s){if(u=r.doEnumerate(w,v)){break}}else{if(v(r)){u=!0;break}}}}return u}});cc.Node.create=function(){return new cc.Node};cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7};cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.CustomRenderCmd=function(f,e){this._needDraw=!0;this._target=f;this._callback=e;this.rendering=function(k,j,h){this._callback&&this._callback.call(this._target,k,j,h)};this.needDraw=function(){return this._needDraw}};cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,all:511};cc.Node.RenderCmd=function(d){this._dirtyFlag=1;this._savedDirtyFlag=!0;this._node=d;this._needDraw=!1;this._anchorPointInPoints=new cc.Point(0,0);this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0};this._displayedOpacity=255;this._displayedColor=cc.color(255,255,255,255);this._cascadeOpacityEnabledDirty=this._cascadeColorEnabledDirty=!1;this._curLevel=-1};cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var d=this._displayedColor;return cc.color(d.r,d.g,d.b,d.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0;this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0;this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform()));return this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var h=this._anchorPointInPoints,g=this._node._contentSize,f=this._node._anchorPoint;h.x=g.width*f.x;h.y=g.height*f.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(d){0===this._dirtyFlag&&0!==d&&cc.renderer.pushDirtyNode(this);this._dirtyFlag|=d},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(F,E){var D=this._node,C=F?F._worldTransform:null,B=this._transform,A=this._worldTransform;if(D._usingNormalizedPosition&&D._parent){var z=D._parent._contentSize;D._position.x=D._normalizedPosition.x*z.width;D._position.y=D._normalizedPosition.y*z.height;D._normalizedPositionDirty=!1}var y=D._rotationX||D._rotationY,x=D._skewX||D._skewY,o=D._scaleX,j=D._scaleY,z=this._anchorPointInPoints.x,K=this._anchorPointInPoints.y,H=1,J=0,G=0,I=1;if(y||x){B.tx=D._position.x;B.ty=D._position.y;y&&(H=0.017453292519943295*D._rotationX,G=Math.sin(H),I=Math.cos(H),D._rotationY===D._rotationX?(H=I,J=-G):(J=0.017453292519943295*D._rotationY,H=Math.cos(J),J=-Math.sin(J)));B.a=H*=o;B.b=J*=o;B.c=G*=j;B.d=I*=j;x&&(x=Math.tan(D._skewX*Math.PI/180),o=Math.tan(D._skewY*Math.PI/180),Infinity===x&&(x=99999999),Infinity===o&&(o=99999999),B.a=H+J*o,B.b=J+H*o,B.c=G+I*x,B.d=I+G*x);if(z||K){B.tx-=B.a*z+B.c*K,B.ty-=B.b*z+B.d*K,D._ignoreAnchorPointForPosition&&(B.tx+=z,B.ty+=K)}C?(A.a=B.a*C.a+B.b*C.c,A.b=B.a*C.b+B.b*C.d,A.c=B.c*C.a+B.d*C.c,A.d=B.c*C.b+B.d*C.d,A.tx=C.a*B.tx+C.c*B.ty+C.tx,A.ty=C.d*B.ty+C.ty+C.b*B.tx):(A.a=B.a,A.b=B.b,A.c=B.c,A.d=B.d,A.tx=B.tx,A.ty=B.ty)}else{B.a=o;B.b=0;B.c=0;B.d=j;B.tx=D._position.x;B.ty=D._position.y;if(z||K){B.tx-=B.a*z,B.ty-=B.d*K,D._ignoreAnchorPointForPosition&&(B.tx+=z,B.ty+=K)}C?(A.a=B.a*C.a+B.b*C.c,A.b=B.a*C.b+B.b*C.d,A.c=B.c*C.a+B.d*C.c,A.d=B.c*C.b+B.d*C.d,A.tx=B.tx*C.a+B.ty*C.c+C.tx,A.ty=B.tx*C.b+B.ty*C.d+C.ty):(A.a=B.a,A.b=B.b,A.c=B.c,A.d=B.d,A.tx=B.tx,A.ty=B.ty)}D._additionalTransformDirty&&(this._transform=cc.affineTransformConcat(B,D._additionalTransform));if(E){D=this._node._children;if(!D||0===D.length){return}C=0;for(B=D.length;C<B;C++){D[C]._renderCmd.transform(this,E)}}this._cacheDirty=!0},getNodeToParentTransform:function(){this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&this.transform();return this._transform},visit:function(h){var g=this._node,f=cc.renderer;if(g._visible){if(h=h||this.getParentRenderCmd()){this._curLevel=h._curLevel+1}isNaN(g._customZ)&&(g._vertexZ=f.assignedZ,f.assignedZ+=f.assignedZStep);this._syncStatus(h);this.visitChildren()}},_updateDisplayColor:function(n){var m=this._node,k=this._displayedColor,j=m._realColor,h;if(this._cascadeColorEnabledDirty&&!m._cascadeColorEnabled){k.r=j.r;k.g=j.g;k.b=j.b;k=new cc.Color(255,255,255,255);n=m._children;m=0;for(j=n.length;m<j;m++){(h=n[m])&&h._renderCmd&&h._renderCmd._updateDisplayColor(k)}this._cascadeColorEnabledDirty=!1}else{if(void 0===n&&(n=(n=m._parent)&&n._cascadeColorEnabled?n.getDisplayedColor():cc.color.WHITE),k.r=0|j.r*n.r/255,k.g=0|j.g*n.g/255,k.b=0|j.b*n.b/255,m._cascadeColorEnabled){for(n=m._children,m=0,j=n.length;m<j;m++){(h=n[m])&&h._renderCmd&&(h._renderCmd._updateDisplayColor(k),h._renderCmd._updateColor())}}}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(k){var j=this._node,h,g;if(this._cascadeOpacityEnabledDirty&&!j._cascadeOpacityEnabled){this._displayedOpacity=j._realOpacity;h=j._children;k=0;for(j=h.length;k<j;k++){(g=h[k])&&g._renderCmd&&g._renderCmd._updateDisplayOpacity(255)}this._cascadeOpacityEnabledDirty=!1}else{if(void 0===k&&(h=j._parent,k=255,h&&h._cascadeOpacityEnabled&&(k=h.getDisplayedOpacity())),this._displayedOpacity=j._realOpacity*k/255,j._cascadeOpacityEnabled){for(h=j._children,k=0,j=h.length;k<j;k++){(g=h[k])&&g._renderCmd&&(g._renderCmd._updateDisplayOpacity(this._displayedOpacity),g._renderCmd._updateColor())}}}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},_syncDisplayColor:function(k){var j=this._node,h=this._displayedColor,g=j._realColor;void 0===k&&(k=(k=j._parent)&&k._cascadeColorEnabled?k.getDisplayedColor():cc.color.WHITE);h.r=0|g.r*k.r/255;h.g=0|g.g*k.g/255;h.b=0|g.b*k.b/255},_syncDisplayOpacity:function(h){var g=this._node;if(void 0===h){var f=g._parent;h=255;f&&f._cascadeOpacityEnabled&&(h=f.getDisplayedOpacity())}this._displayedOpacity=g._realOpacity*h/255},_updateColor:function(){},updateStatus:function(){var k=cc.Node._dirtyFlags,j=this._dirtyFlag,h=j&k.colorDirty,g=j&k.opacityDirty;this._savedDirtyFlag=this._savedDirtyFlag||j;h&&this._updateDisplayColor();g&&this._updateDisplayOpacity();(h||g)&&this._updateColor();j&k.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&k.transformDirty);j&k.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&k.orderDirty)},_syncStatus:function(n){var m=cc.Node._dirtyFlags,k=this._dirtyFlag,j=null;n?(j=n._node,this._savedDirtyFlag=this._savedDirtyFlag||n._savedDirtyFlag||k):this._savedDirtyFlag=this._savedDirtyFlag||k;j&&j._cascadeColorEnabled&&n._dirtyFlag&m.colorDirty&&(k|=m.colorDirty);j&&j._cascadeOpacityEnabled&&n._dirtyFlag&m.opacityDirty&&(k|=m.opacityDirty);n&&n._dirtyFlag&m.transformDirty&&(k|=m.transformDirty);var j=k&m.colorDirty,h=k&m.opacityDirty;this._dirtyFlag=k;j&&this._syncDisplayColor();h&&this._syncDisplayOpacity();(j||h)&&this._updateColor();k&m.transformDirty&&this.transform(n);k&m.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&m.orderDirty)},visitChildren:function(){var n=cc.renderer,m=this._node,k=m._children,j,h=k.length;if(0<h){m.sortAllChildren();for(m=0;m<h;m++){if(j=k[m],0>j._localZOrder){j._renderCmd.visit(this)}else{break}}for(n.pushRenderCommand(this);m<h;m++){k[m]._renderCmd.visit(this)}}else{n.pushRenderCommand(this)}this._dirtyFlag=0}};cc.Node.RenderCmd.prototype.originVisit=cc.Node.RenderCmd.prototype.visit;cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform;(function(){cc.Node.CanvasRenderCmd=function(e){cc.Node.RenderCmd.call(this,e);this._cachedParent=null;this._cacheDirty=!1};var d=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);d.constructor=cc.Node.CanvasRenderCmd;d.setDirtyFlag=function(g,f){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,g,f);this._setCacheDirty(f);this._cachedParent&&this._cachedParent.setDirtyFlag(g,!0)};d._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var e=this._cachedParent;e&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache()}};d._setCachedParent=function(m){if(this._cachedParent!==m){this._cachedParent=m;for(var k=this._node._children,j=0,h=k.length;j<h;j++){k[j]._renderCmd._setCachedParent(m)}}};d.detachFromParent=function(){this._cachedParent=null;for(var m=this._node._children,k,j=0,h=m.length;j<h;j++){(k=m[j])&&k._renderCmd&&k._renderCmd.detachFromParent()}};d.setShaderProgram=function(e){};d.getShaderProgram=function(){return null};cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(e){return e?e.src===cc.SRC_ALPHA&&e.dst===cc.ONE||e.src===cc.ONE&&e.dst===cc.ONE?"lighter":e.src===cc.ZERO&&e.dst===cc.SRC_ALPHA?"destination-in":e.src===cc.ZERO&&e.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}})();(function(){cc.Node.WebGLRenderCmd=function(e){cc.Node.RenderCmd.call(this,e);this._shaderProgram=null};var d=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);d.constructor=cc.Node.WebGLRenderCmd;d._updateColor=function(){};d.setShaderProgram=function(e){this._shaderProgram=e};d.getShaderProgram=function(){return this._shaderProgram}})();cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(k,j,h,g){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._ignoreContentScaleFactor=!1;void 0!==g&&this.initWithTileFile(k,j,h,g)},_createRenderCmd:function(){this._renderCmd=cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.AtlasNode.CanvasRenderCmd(this):new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(f){var e=this.color;this._opacityModifyRGB=f;this.setColor(e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(f,e){this._blendFunc=void 0===e?f:{src:f,dst:e}},setTextureAtlas:function(d){this.textureAtlas=d},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(d){this.quadsToDraw=d},initWithTileFile:function(k,j,h,g){if(!k){throw Error("cc.AtlasNode.initWithTileFile(): title should not be null")}k=cc.textureCache.addImage(k);return this.initWithTexture(k,j,h,g)},initWithTexture:function(k,j,h,g){return this._renderCmd.initWithTexture(k,j,h,g)},setColor:function(d){this._renderCmd.setColor(d)},setOpacity:function(d){this._renderCmd.setOpacity(d)},getTexture:function(){return this._texture},setTexture:function(d){this._texture=d},_setIgnoreContentScaleFactor:function(d){this._ignoreContentScaleFactor=d}});_p=cc.AtlasNode.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.EventHelper.prototype.apply(_p);cc.AtlasNode.create=function(k,j,h,g){return new cc.AtlasNode(k,j,h,g)};(function(){cc.AtlasNode.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._needDraw=!1;this._colorUnmodified=cc.color.WHITE;this._textureToRender=null};var d=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.AtlasNode.CanvasRenderCmd;d.initWithTexture=function(o,n,m,k){var j=this._node;j._itemWidth=n;j._itemHeight=m;j._opacityModifyRGB=!0;j._texture=o;if(!j._texture){return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1}this._textureToRender=o;this._calculateMaxItems();j.quadsToDraw=k;return !0};d.setColor=function(g){var f=this._node._realColor;if(f.r!==g.r||f.g!==g.g||f.b!==g.b){this._colorUnmodified=g,this._changeTextureColor()}};d._changeTextureColor=function(){var j=this._node._texture,h=this._colorUnmodified,g=j.getHtmlElementObj(),g=cc.rect(0,0,g.width,g.height);j===this._textureToRender?this._textureToRender=j._generateColorTexture(h.r,h.g,h.b,g):j._generateColorTexture(h.r,h.g,h.b,g,this._textureToRender.getHtmlElementObj())};d.setOpacity=function(e){cc.Node.prototype.setOpacity.call(this._node,e)};d._calculateMaxItems=function(){var g=this._node,f=g._texture.getContentSize();g._itemsPerColumn=0|f.height/g._itemHeight;g._itemsPerRow=0|f.width/g._itemWidth}})();(function(){cc.AtlasNode.WebGLRenderCmd=function(e){cc.Node.WebGLRenderCmd.call(this,e);this._needDraw=!0;this._textureAtlas=null;this._colorUnmodified=cc.color.WHITE;this._uniformColor=this._colorF32Array=null;this._matrix=new cc.math.Matrix4;this._matrix.identity();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var d=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);d.constructor=cc.AtlasNode.WebGLRenderCmd;d._updateBlendFunc=function(){var e=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(e._blendFunc.src=cc.SRC_ALPHA,e._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)};d._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()};d.rendering=function(j){j=j||cc._renderContext;var h=this._node,g=this._worldTransform;this._matrix.mat[0]=g.a;this._matrix.mat[4]=g.c;this._matrix.mat[12]=g.tx;this._matrix.mat[1]=g.b;this._matrix.mat[5]=g.d;this._matrix.mat[13]=g.ty;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);cc.glBlendFunc(h._blendFunc.src,h._blendFunc.dst);this._uniformColor&&this._colorF32Array&&(j.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(h.quadsToDraw,0))};d.initWithTexture=function(o,n,m,k){var j=this._node;j._itemWidth=n;j._itemHeight=m;this._colorUnmodified=cc.color.WHITE;j._opacityModifyRGB=!0;j._blendFunc.src=cc.BLEND_SRC;j._blendFunc.dst=cc.BLEND_DST;n=j._realColor;this._colorF32Array=new Float32Array([n.r/255,n.g/255,n.b/255,j._realOpacity/255]);this._textureAtlas=new cc.TextureAtlas;this._textureAtlas.initWithTexture(o,k);if(!this._textureAtlas){return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1}this._updateBlendFunc();this._updateOpacityModifyRGB();this._calculateMaxItems();j.quadsToDraw=k;return !0};d.setColor=function(j){var h=cc.color(j.r,j.g,j.b),g=this._node;this._colorUnmodified=j;j=this._displayedOpacity;g._opacityModifyRGB&&(h.r=h.r*j/255,h.g=h.g*j/255,h.b=h.b*j/255);cc.Node.prototype.setColor.call(g,h)};d.setOpacity=function(g){var f=this._node;cc.Node.prototype.setOpacity.call(f,g);f._opacityModifyRGB&&(f.color=this._colorUnmodified)};d._updateColor=function(){if(this._colorF32Array){var e=this._displayedColor;this._colorF32Array[0]=e.r/255;this._colorF32Array[1]=e.g/255;this._colorF32Array[2]=e.b/255;this._colorF32Array[3]=this._displayedOpacity/255}};d.getTexture=function(){return this._textureAtlas.texture};d.setTexture=function(e){this._textureAtlas.texture=e;this._updateBlendFunc();this._updateOpacityModifyRGB()};d._calculateMaxItems=function(){var j=this._node,h=this._textureAtlas.texture,g=h.getContentSize();j._ignoreContentScaleFactor&&(g=h.getContentSizeInPixels());j._itemsPerColumn=0|g.height/j._itemHeight;j._itemsPerRow=0|g.width/j._itemWidth}})();cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0);this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj);cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(d){this.maxS=d},getMaxT:function(){return this.maxT},setMaxT:function(d){this.maxT=d},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(d){this.shaderProgram=d},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"\x3ccc.Texture2D | Name \x3d "+this._name+" | Dimensions \x3d "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates \x3d ("+this.maxS+", "+this.maxT+")\x3e"},releaseData:function(d){},keepData:function(f,e){return f},initWithData:function(y,x,w,v,u){var t=cc.Texture2D,s=cc._renderContext,r=s.RGBA,o=s.UNSIGNED_BYTE,j=w*cc.Texture2D._B[x]/8;0===j%8?s.pixelStorei(s.UNPACK_ALIGNMENT,8):0===j%4?s.pixelStorei(s.UNPACK_ALIGNMENT,4):0===j%2?s.pixelStorei(s.UNPACK_ALIGNMENT,2):s.pixelStorei(s.UNPACK_ALIGNMENT,1);this._webTextureObj=s.createTexture();cc.glBindTexture2D(this);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);switch(x){case t.PIXEL_FORMAT_RGBA8888:r=s.RGBA;break;case t.PIXEL_FORMAT_RGB888:r=s.RGB;break;case t.PIXEL_FORMAT_RGBA4444:o=s.UNSIGNED_SHORT_4_4_4_4;break;case t.PIXEL_FORMAT_RGB5A1:o=s.UNSIGNED_SHORT_5_5_5_1;break;case t.PIXEL_FORMAT_RGB565:o=s.UNSIGNED_SHORT_5_6_5;break;case t.PIXEL_FORMAT_AI88:r=s.LUMINANCE_ALPHA;break;case t.PIXEL_FORMAT_A8:r=s.ALPHA;break;case t.PIXEL_FORMAT_I8:r=s.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}s.texImage2D(s.TEXTURE_2D,0,r,w,v,0,r,o,y);this._contentSize.width=u.width;this._contentSize.height=u.height;this._pixelsWide=w;this._pixelsHigh=v;this._pixelFormat=x;this.maxS=u.width/w;this.maxT=u.height/v;this._hasMipmaps=this._hasPremultipliedAlpha=!1;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);return this._textureLoaded=!0},drawAtPoint:function(n){var m=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],k=cc._renderContext,j=this._pixelsWide*this.maxS,h=this._pixelsHigh*this.maxT;n=[n.x,n.y,0,j+n.x,n.y,0,n.x,h+n.y,0,j+n.x,h+n.y,0];this._shaderProgram.use();this._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(this);k.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);k.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);k.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,k.FLOAT,!1,0,n);k.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,k.FLOAT,!1,0,m);k.drawArrays(k.TRIANGLE_STRIP,0,4)},drawInRect:function(h){var g=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0];h=[h.x,h.y,h.x+h.width,h.y,h.x,h.y+h.height,h.x+h.width,h.y+h.height];this._shaderProgram.use();this._shaderProgram.setUniformsForBuiltins();cc.glBindTexture2D(this);var f=cc._renderContext;f.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);f.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);f.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,f.FLOAT,!1,0,h);f.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,f.FLOAT,!1,0,g);f.drawArrays(f.TRIANGLE_STRIP,0,4)},initWithImage:function(k){if(null==k){return cc.log(cc._LogInfos.Texture2D_initWithImage),!1}var j=k.getWidth(),h=k.getHeight(),g=cc.configuration.getMaxTextureSize();if(j>g||h>g){return cc.log(cc._LogInfos.Texture2D_initWithImage_2,j,h,g,g),!1}this._textureLoaded=!0;return this._initPremultipliedATextureWithImage(k,j,h)},initWithElement:function(d){d&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=d,this._hasPremultipliedAlpha=this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(f){f=void 0!==f?f:this._hasPremultipliedAlpha;if(cc.game._rendererInitialized){if(!this._htmlElementObj){var e=cc.loader.getRes(this.url);if(!e){return}this.initWithElement(e)}this._htmlElementObj.width&&this._htmlElementObj.height&&(e=cc._renderContext,cc.glBindTexture2D(this),e.pixelStorei(e.UNPACK_ALIGNMENT,4),f&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),f&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e=this._htmlElementObj.height,this._pixelsWide=this._contentSize.width=this._htmlElementObj.width,this._pixelsHigh=this._contentSize.height=e,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.maxT=this.maxS=1,this._hasPremultipliedAlpha=f,this._hasMipmaps=!1,this.dispatchEvent("load"))}},initWithString:function(p,o,n,m,k,j){cc.log(cc._LogInfos.Texture2D_initWithString);return null},initWithETCFile:function(d){cc.log(cc._LogInfos.Texture2D_initWithETCFile_2);return !1},initWithPVRFile:function(d){cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2);return !1},initWithPVRTCData:function(p,o,n,m,k,j){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2);return !1},setTexParameters:function(n,m,k,j){var h=cc._renderContext;void 0!==m&&(n={minFilter:n,magFilter:m,wrapS:k,wrapT:j});cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh)||n.wrapS===h.CLAMP_TO_EDGE&&n.wrapT===h.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures");cc.glBindTexture2D(this);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n.minFilter);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n.magFilter);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n.wrapS);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n.wrapT)},setAntiAliasTexParameters:function(){var d=cc._renderContext;cc.glBindTexture2D(this);this._hasMipmaps?d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_NEAREST):d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR)},setAliasTexParameters:function(){var d=cc._renderContext;cc.glBindTexture2D(this);this._hasMipmaps?d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST_MIPMAP_NEAREST):d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST)},generateMipmap:function(){cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures");cc.glBindTexture2D(this);cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D);this._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(f){f=f||this._pixelFormat;var e=cc.Texture2D._B[f];if(null!=e){return e}cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,f);return -1},_initPremultipliedATextureWithImage:function(A,z,y){var x=cc.Texture2D,w=A.getData(),v=null,v=null,u=A.hasAlpha(),t=cc.size(A.getWidth(),A.getHeight()),s=x.defaultPixelFormat,o=A.getBitsPerComponent();u||(8<=o?s=x.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),s=x.PIXEL_FORMAT_RGB565));var j=z*y;if(s===x.PIXEL_FORMAT_RGB565){if(u){for(w=new Uint16Array(z*y),v=A.getData(),o=0;o<j;++o){w[o]=(v[o]>>0&255)>>3<<11|(v[o]>>8&255)>>2<<5|(v[o]>>16&255)>>3<<0}}else{for(w=new Uint16Array(z*y),v=A.getData(),o=0;o<j;++o){w[o]=(v[o]&255)>>3<<11|(v[o]&255)>>2<<5|(v[o]&255)>>3<<0}}}else{if(s===x.PIXEL_FORMAT_RGBA4444){for(w=new Uint16Array(z*y),v=A.getData(),o=0;o<j;++o){w[o]=(v[o]>>0&255)>>4<<12|(v[o]>>8&255)>>4<<8|(v[o]>>16&255)>>4<<4|(v[o]>>24&255)>>4<<0}}else{if(s===x.PIXEL_FORMAT_RGB5A1){for(w=new Uint16Array(z*y),v=A.getData(),o=0;o<j;++o){w[o]=(v[o]>>0&255)>>3<<11|(v[o]>>8&255)>>3<<6|(v[o]>>16&255)>>3<<1|(v[o]>>24&255)>>7<<0}}else{if(s===x.PIXEL_FORMAT_A8){for(w=new Uint8Array(z*y),v=A.getData(),o=0;o<j;++o){w[o]=v>>24&255}}}}}if(u&&s===x.PIXEL_FORMAT_RGB888){for(v=A.getData(),w=new Uint8Array(z*y*3),o=0;o<j;++o){w[3*o]=v>>0&255,w[3*o+1]=v>>8&255,w[3*o+2]=v>>16&255}}this.initWithData(w,s,z,y,t);A.getData();this._hasPremultipliedAlpha=A.isPremultipliedAlpha();return !0},addLoadedEventListener:function(f,e){this.addEventListener("load",f,e)},removeLoadedEventListener:function(d){this.removeEventListener("load",d)}})};cc._tmp.WebGLTextureAtlas=function(){var d=cc.TextureAtlas.prototype;d._setupVBO=function(){var e=cc._renderContext;this._buffersVBO[0]=e.createBuffer();this._buffersVBO[1]=e.createBuffer();this._quadsWebBuffer=e.createBuffer();this._mapBuffers()};d._mapBuffers=function(){var e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._quadsWebBuffer);e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)};d.drawNumberOfQuads=function(j,h){h=h||0;if(0!==j&&this.texture&&this.texture.isLoaded()){var g=cc._renderContext;cc.glBindTexture2D(this.texture);g.bindBuffer(g.ARRAY_BUFFER,this._quadsWebBuffer);this.dirty&&(g.bufferData(g.ARRAY_BUFFER,this._quadsArrayBuffer,g.DYNAMIC_DRAW),this.dirty=!1);g.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);g.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);g.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);g.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,g.FLOAT,!1,24,0);g.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,g.UNSIGNED_BYTE,!0,24,12);g.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,g.FLOAT,!1,24,16);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?g.drawElements(g.TRIANGLE_STRIP,6*j,g.UNSIGNED_SHORT,6*h*this._indices.BYTES_PER_ELEMENT):g.drawElements(g.TRIANGLES,6*j,g.UNSIGNED_SHORT,6*h*this._indices.BYTES_PER_ELEMENT);cc.g_NumberOfDraws++}}};cc._tmp.WebGLTextureCache=function(){var d=cc.textureCache;d.handleLoadedTexture=function(j){var h=this._textures,g;cc.game._rendererInitialized||(h=this._loadedTexturesBefore);g=h[j];g||(g=h[j]=new cc.Texture2D,g.url=j);".png"===cc.path.extname(j)?g.handleLoadedTexture(!0):g.handleLoadedTexture()};d.addImage=function(r,p,o){cc.assert(r,cc._LogInfos.Texture2D_addImage_2);var n=this._textures;cc.game._rendererInitialized||(n=this._loadedTexturesBefore);var m=n[r]||n[cc.loader._getAliase(r)];if(m){return m.isLoaded()?p&&p.call(o,m):m.addEventListener("load",function(){p&&p.call(o,m)},o),m}m=n[r]=new cc.Texture2D;m.url=r;var j=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;cc.loader.loadImg(cc.path.join(j||"",r),function(e,c){if(e){return p&&p.call(o,e)}cc.loader.cache[r]||(cc.loader.cache[r]=c);cc.textureCache.handleLoadedTexture(r);var f=n[r];p&&p.call(o,f)});return m};d.addImageAsync=d.addImage;d=null};cc._tmp.PrototypeTexture2D=function(){var f=cc.Texture2D;f.PVRImagesHavePremultipliedAlpha=function(d){cc.PVRHaveAlphaPremultiplied_=d};f.PIXEL_FORMAT_RGBA8888=2;f.PIXEL_FORMAT_RGB888=3;f.PIXEL_FORMAT_RGB565=4;f.PIXEL_FORMAT_A8=5;f.PIXEL_FORMAT_I8=6;f.PIXEL_FORMAT_AI88=7;f.PIXEL_FORMAT_RGBA4444=8;f.PIXEL_FORMAT_RGB5A1=7;f.PIXEL_FORMAT_PVRTC4=9;f.PIXEL_FORMAT_PVRTC2=10;f.PIXEL_FORMAT_DEFAULT=f.PIXEL_FORMAT_RGBA8888;f.defaultPixelFormat=f.PIXEL_FORMAT_DEFAULT;var e=cc.Texture2D._M={};e[f.PIXEL_FORMAT_RGBA8888]="RGBA8888";e[f.PIXEL_FORMAT_RGB888]="RGB888";e[f.PIXEL_FORMAT_RGB565]="RGB565";e[f.PIXEL_FORMAT_A8]="A8";e[f.PIXEL_FORMAT_I8]="I8";e[f.PIXEL_FORMAT_AI88]="AI88";e[f.PIXEL_FORMAT_RGBA4444]="RGBA4444";e[f.PIXEL_FORMAT_RGB5A1]="RGB5A1";e[f.PIXEL_FORMAT_PVRTC4]="PVRTC4";e[f.PIXEL_FORMAT_PVRTC2]="PVRTC2";e=cc.Texture2D._B={};e[f.PIXEL_FORMAT_RGBA8888]=32;e[f.PIXEL_FORMAT_RGB888]=24;e[f.PIXEL_FORMAT_RGB565]=16;e[f.PIXEL_FORMAT_A8]=8;e[f.PIXEL_FORMAT_I8]=8;e[f.PIXEL_FORMAT_AI88]=16;e[f.PIXEL_FORMAT_RGBA4444]=16;e[f.PIXEL_FORMAT_RGB5A1]=16;e[f.PIXEL_FORMAT_PVRTC4]=4;e[f.PIXEL_FORMAT_PVRTC2]=3;f=cc.Texture2D.prototype;cc.defineGetterSetter(f,"name",f.getName);cc.defineGetterSetter(f,"pixelFormat",f.getPixelFormat);cc.defineGetterSetter(f,"pixelsWidth",f.getPixelsWide);cc.defineGetterSetter(f,"pixelsHeight",f.getPixelsHigh);cc.defineGetterSetter(f,"width",f._getWidth);cc.defineGetterSetter(f,"height",f._getHeight)};cc._tmp.PrototypeTextureAtlas=function(){var d=cc.TextureAtlas.prototype;cc.defineGetterSetter(d,"totalQuads",d.getTotalQuads);cc.defineGetterSetter(d,"capacity",d.getCapacity);cc.defineGetterSetter(d,"quads",d.getQuads,d.setQuads)};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=!1;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var d={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0);this._textureLoaded=!1;this._htmlElementObj=null;this._pattern=""},getPixelsWide:function(){return this._contentSize.width},getPixelsHigh:function(){return this._contentSize.height},getContentSize:function(){var e=cc.contentScaleFactor();return cc.size(this._contentSize.width/e,this._contentSize.height/e)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(e){e&&(this._htmlElementObj=e,this._contentSize.width=e.width,this._contentSize.height=e.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(!this._textureLoaded){if(!this._htmlElementObj){var e=cc.loader.getRes(this.url);if(!e){return}this.initWithElement(e)}e=this._htmlElementObj;this._contentSize.width=e.width;this._contentSize.height=e.height;this.dispatchEvent("load")}},description:function(){return"\x3ccc.Texture2D | width \x3d "+this._contentSize.width+" height "+this._contentSize.height+"\x3e"},initWithData:function(o,n,m,k,j){return !1},initWithImage:function(e){return !1},initWithString:function(r,p,o,n,m,j){return !1},releaseTexture:function(){cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(e){},getMaxT:function(){return 1},setMaxT:function(e){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(e){},hasPremultipliedAlpha:function(){return !1},hasMipmaps:function(){return !1},releaseData:function(e){},keepData:function(g,f){return g},drawAtPoint:function(e){},drawInRect:function(e){},initWithETCFile:function(e){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return !1},initWithPVRFile:function(e){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);return !1},initWithPVRTCData:function(r,p,o,n,m,j){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return !1},setTexParameters:function(m,k,j,h){void 0!==k&&(m={minFilter:m,magFilter:k,wrapS:j,wrapT:h});this._pattern=m.wrapS===cc.REPEAT&&m.wrapT===cc.REPEAT?"repeat":m.wrapS===cc.REPEAT?"repeat-x":m.wrapT===cc.REPEAT?"repeat-y":""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(e){return -1},addLoadedEventListener:function(g,f){this.addEventListener("load",g,f)},removeLoadedEventListener:function(e){this.removeEventListener("load",e)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache){return this.channelCache}var z=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")],y=this._htmlElementObj,x=y.width,w=y.height;z[0].width=x;z[0].height=w;z[1].width=x;z[1].height=w;z[2].width=x;z[2].height=w;z[3].width=x;z[3].height=w;var v=z[3].getContext("2d");v.drawImage(y,0,0);for(var v=v.getImageData(0,0,x,w).data,u,t=0;4>t;t++){u=z[t].getContext("2d");for(var s=u.getImageData(0,0,x,w),o=s.data,j=0;j<v.length;j+=4){o[j]=0===t?v[j]:0,o[j+1]=1===t?v[j+1]:0,o[j+2]=2===t?v[j+2]:0,o[j+3]=v[j+3]}u.putImageData(s,0,0)}y.onload=null;return this.channelCache=z},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(e){this._textureLoaded&&this._isGray!==e&&((this._isGray=e)?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))}};d._generateColorTexture=cc.sys._supportCanvasNewBlendModes?function(v,t,s,r,p){var o=!1;p?o=!0:p=document.createElement("canvas");var j=this._htmlElementObj;r||(r=cc.rect(0,0,j.width,j.height));p.width=r.width;p.height=r.height;var u=p.getContext("2d");u.globalCompositeOperation="source-over";u.fillStyle="rgb("+(v|0)+","+(t|0)+","+(s|0)+")";u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="multiply";u.drawImage(j,r.x,r.y,r.width,r.height,0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(j,r.x,r.y,r.width,r.height,0,0,r.width,r.height);if(o){return p}v=new cc.Texture2D;v.initWithElement(p);v.handleLoadedTexture();return v}:function(A,z,y,x,w){var v=!1;w?v=!0:w=document.createElement("canvas");var u=this._htmlElementObj;x||(x=cc.rect(0,0,u.width,u.height));var t,o,u=x.x;t=x.y;o=x.width;x=x.height;if(o&&x){w.width=o;w.height=x;var j=w.getContext("2d"),B=cc.textureCache.getTextureColors(this);j.globalCompositeOperation="lighter";j.drawImage(B[3],u,t,o,x,0,0,o,x);0<A&&(j.globalAlpha=A/255,j.drawImage(B[0],u,t,o,x,0,0,o,x));0<z&&(j.globalAlpha=z/255,j.drawImage(B[1],u,t,o,x,0,0,o,x));0<y&&(j.globalAlpha=y/255,j.drawImage(B[2],u,t,o,x,0,0,o,x));if(v){return w}A=new cc.Texture2D;A.initWithElement(w);A.handleLoadedTexture();return A}};cc.Texture2D=cc.Class.extend(d);cc.Texture2D._generateGrayTexture=function(r,p,o){if(null===r){return null}o=o||document.createElement("canvas");p=p||cc.rect(0,0,r.width,r.height);o.width=p.width;o.height=p.height;var n=o.getContext("2d");n.drawImage(r,p.x,p.y,p.width,p.height,0,0,p.width,p.height);r=n.getImageData(0,0,p.width,p.height);p=r.data;for(var m=0,j=p.length;m<j;m+=4){p[m]=p[m+1]=p[m+2]=0.34*p[m]+0.5*p[m+1]+0.16*p[m+2]}n.putImageData(r,0,0);return o}}else{cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D)}cc.EventHelper.prototype.apply(cc.Texture2D.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D});cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1000*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var k,j=this._loadedTexturesBefore,h=this._textures;for(k in j){var g=j[k];g.handleLoadedTexture();h[k]=g}this._loadedTexturesBefore={}},addPVRTCImage:function(d){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(d){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"\x3cTextureCache | Number of textures \x3d "+this._textures.length+"\x3e"},textureForKey:function(d){cc.log(cc._LogInfos.textureCache_textureForKey);return this.getTextureForKey(d)},getTextureForKey:function(d){return this._textures[d]||this._textures[cc.loader._getAliase(d)]},getKeyByTexture:function(f){for(var e in this._textures){if(this._textures[e]===f){return e}}return null},_generalTextureKey:function(d){return"_textureKey_"+d},getTextureColors:function(h){var g=h._htmlElementObj,f=this.getKeyByTexture(g);f||(f=g instanceof HTMLImageElement?g.src:this._generalTextureKey(h.__instanceId));this._textureColorsCache[f]||(this._textureColorsCache[f]=h._generateTextureCacheForColor());return this._textureColorsCache[f]},addPVRImage:function(d){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var f=this._textures,e;for(e in f){f[e]&&f[e].releaseTexture()}this._textures={}},removeTexture:function(h){if(h){var g=this._textures,f;for(f in g){g[f]===h&&(g[f].releaseTexture(),delete g[f])}}},removeTextureForKey:function(d){null!=d&&this._textures[d]&&delete this._textures[d]},cacheImage:function(h,g){if(g instanceof cc.Texture2D){this._textures[h]=g}else{var f=new cc.Texture2D;f.initWithElement(g);f.handleLoadedTexture();this._textures[h]=f}},addUIImage:function(h,g){cc.assert(h,cc._LogInfos.textureCache_addUIImage_2);if(g&&this._textures[g]){return this._textures[g]}var f=new cc.Texture2D;f.initWithImage(h);null!=g?this._textures[g]=f:cc.log(cc._LogInfos.textureCache_addUIImage);return f},dumpCachedTextureInfo:function(){var s=0,r=0,p=this._textures,o;for(o in p){var n=p[o];s++;n.getHtmlElementObj() instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,o,n.getHtmlElementObj().src,n.pixelsWidth,n.pixelsHeight):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,o,n.pixelsWidth,n.pixelsHeight);r+=n.pixelsWidth*n.pixelsHeight*4}p=this._textureColorsCache;for(o in p){var n=p[o],m;for(m in n){var j=n[m];s++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,o,j.width,j.height);r+=j.width*j.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,s,r/1024,(r/1048576).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache={};this._textureKeySeq=0|1000*Math.random();this._loadedTexturesBefore={}}};cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var d=cc.textureCache;d.handleLoadedTexture=function(j){var h=this._textures,g=h[j];g||(g=h[j]=new cc.Texture2D,g.url=j);g.handleLoadedTexture()};d.addImage=function(r,p,o){cc.assert(r,cc._LogInfos.Texture2D_addImage);var n=this._textures,m=n[r]||n[cc.loader._getAliase(r)];if(m){return m.isLoaded()?p&&p.call(o,m):m.addEventListener("load",function(){p&&p.call(o,m)},o),m}m=n[r]=new cc.Texture2D;m.url=r;var j=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;cc.loader.loadImg(cc.path.join(j||"",r),function(e,c){if(e){return p&&p.call(o,e)}cc.loader.cache[r]||(cc.loader.cache[r]=c);cc.textureCache.handleLoadedTexture(r);var f=n[r];p&&p.call(o,f)});return m};d.addImageAsync=d.addImage;d=null}else{cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)}});cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(f,e){this._buffersVBO=[];cc.isString(f)?this.initWithFile(f,e):f instanceof cc.Texture2D&&this.initWithTexture(f,e)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(d){this.texture=d},setDirty:function(d){this.dirty=d},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(d){this._quads=d},_copyQuadsToTextureAtlas:function(h,g){if(h){for(var f=0;f<h.length;f++){this._setQuadToArray(h[f],g+f)}}},_setQuadToArray:function(h,g){var f=this._quads;f[g]?(f[g].bl=h.bl,f[g].br=h.br,f[g].tl=h.tl,f[g].tr=h.tr):f[g]=new cc.V3F_C4B_T2F_Quad(h.tl,h.bl,h.tr,h.br,this._quadsArrayBuffer,g*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"\x3ccc.TextureAtlas | totalQuads \x3d"+this._totalQuads+"\x3e"},_setupIndices:function(){if(0!==this._capacity){for(var h=this._indices,g=this._capacity,f=0;f<g;f++){cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(h[6*f+0]=4*f+0,h[6*f+1]=4*f+0,h[6*f+2]=4*f+2,h[6*f+3]=4*f+1,h[6*f+4]=4*f+3,h[6*f+5]=4*f+3):(h[6*f+0]=4*f+0,h[6*f+1]=4*f+1,h[6*f+2]=4*f+2,h[6*f+3]=4*f+3,h[6*f+4]=4*f+2,h[6*f+5]=4*f+1)}}},_setupVBO:function(){var d=cc._renderContext;this._buffersVBO[0]=d.createBuffer();this._buffersVBO[1]=d.createBuffer();this._quadsWebBuffer=d.createBuffer();this._mapBuffers()},_mapBuffers:function(){var d=cc._renderContext;d.bindBuffer(d.ARRAY_BUFFER,this._quadsWebBuffer);d.bufferData(d.ARRAY_BUFFER,this._quadsArrayBuffer,d.DYNAMIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this._indices,d.STATIC_DRAW)},initWithFile:function(h,g){var f=cc.textureCache.addImage(h);if(f){return this.initWithTexture(f,g)}cc.log(cc._LogInfos.TextureAtlas_initWithFile,h);return !1},initWithTexture:function(n,m){cc.assert(n,cc._LogInfos.TextureAtlas_initWithTexture);this._capacity=m|=0;this._totalQuads=0;this.texture=n;this._quads=[];this._indices=new Uint16Array(6*m);var k=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(k*m);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if((!this._quads||!this._indices)&&0<m){return !1}for(var j=this._quads,h=0;h<m;h++){j[h]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,h*k)}this._setupIndices();this._setupVBO();return this.dirty=!0},updateQuad:function(f,e){cc.assert(f,cc._LogInfos.TextureAtlas_updateQuad);cc.assert(0<=e&&e<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2);this._totalQuads=Math.max(e+1,this._totalQuads);this._setQuadToArray(f,e);this.dirty=!0},insertQuad:function(n,m){cc.assert(m<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2);this._totalQuads++;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad)}else{var k=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,j=m*k,h=(this._totalQuads-1-m)*k;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*k);this._quadsReader.set(this._quadsReader.subarray(j,j+h),j+k);this._setQuadToArray(n,m);this.dirty=!0}},insertQuads:function(u,t,s){s=s||u.length;cc.assert(t+s<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=s;if(this._totalQuads>this._capacity){cc.log(cc._LogInfos.TextureAtlas_insertQuad)}else{var p=t*r,o=(this._totalQuads-1-t-s)*r,n=this._totalQuads-1-s,j;for(j=0;j<s;j++){this._quads[n+j]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*r)}this._quadsReader.set(this._quadsReader.subarray(p,p+o),p+r*s);for(j=0;j<s;j++){this._setQuadToArray(u[j],t+j)}this.dirty=!0}},insertQuadFromIndex:function(p,o){if(p!==o){cc.assert(0<=o||o<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex);cc.assert(0<=p||p<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,m=this._quadsReader,k=m.subarray(p*n,n),j;p>o?(j=o*n,m.set(m.subarray(j,j+(p-o)*n),j+n),m.set(k,j)):(j=(p+1)*n,m.set(m.subarray(j,j+(o-p)*n),j-n),m.set(k,o*n));this.dirty=!0}},removeQuadAtIndex:function(h){cc.assert(h<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var g=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--;this._quads.length=this._totalQuads;if(h!==this._totalQuads){var f=(h+1)*g;this._quadsReader.set(this._quadsReader.subarray(f,f+(this._totalQuads-h)*g),f-g)}this.dirty=!0},removeQuadsAtIndex:function(n,m){cc.assert(n+m<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex);this._totalQuads-=m;if(n!==this._totalQuads){var k=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,j=(n+m)*k,h=n*k;this._quadsReader.set(this._quadsReader.subarray(j,j+(this._totalQuads-n)*k),h)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(d){this.dirty=d},resizeCapacity:function(u){if(u===this._capacity){return !0}var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=this._capacity;this._totalQuads=Math.min(this._totalQuads,u);var r=this._capacity=0|u,p=this._totalQuads;if(null===this._quads){for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(t*r),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),u=0;u<r;u++){this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,u*t)}}else{var o,n,j=this._quads;if(r>s){o=[];n=new ArrayBuffer(t*r);for(u=0;u<p;u++){o[u]=new cc.V3F_C4B_T2F_Quad(j[u].tl,j[u].bl,j[u].tr,j[u].br,n,u*t)}for(;u<r;u++){o[u]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,u*t)}}else{for(p=Math.max(p,r),o=[],n=new ArrayBuffer(t*r),u=0;u<p;u++){o[u]=new cc.V3F_C4B_T2F_Quad(j[u].tl,j[u].bl,j[u].tr,j[u].br,n,u*t)}}this._quadsReader=new Uint8Array(n);this._quads=o;this._quadsArrayBuffer=n}null===this._indices?this._indices=new Uint16Array(6*r):r>s?(t=new Uint16Array(6*r),t.set(this._indices,0),this._indices=t):this._indices=this._indices.subarray(0,6*r);this._setupIndices();this._mapBuffers();return this.dirty=!0},increaseTotalQuadsWith:function(d){this._totalQuads+=d},moveQuadsFromIndex:function(w,v,u){if(void 0===u){if(u=v,v=this._totalQuads-w,cc.assert(u+(this._totalQuads-w)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===v){return}}else{if(cc.assert(u+v<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(w<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),w===u){return}}var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,s=w*t,r=v*t,p=this._quadsReader,o=p.subarray(s,s+r),j=u*t;u<w?(v=u*t,p.set(p.subarray(v,v+(w-u)*t),v+r)):(v=(w+v)*t,p.set(p.subarray(v,v+(u-w)*t),s));p.set(o,j);this.dirty=!0},fillWithEmptyQuadsFromIndex:function(n,m){for(var k=m*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,j=new Uint8Array(this._quadsArrayBuffer,n*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,k),h=0;h<k;h++){j[h]=0}},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var d=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&d.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&d.deleteBuffer(this._buffersVBO[1]));this._quadsWebBuffer&&d.deleteBuffer(this._quadsWebBuffer)}});_p=cc.TextureAtlas.prototype;cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);cc.defineGetterSetter(_p,"capacity",_p.getCapacity);cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);cc.TextureAtlas.create=function(f,e){return new cc.TextureAtlas(f,e)};cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas)});cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTextureAtlas();delete cc._tmp.PrototypeTextureAtlas;cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_className:"LoaderScene",cb:null,target:null,init:function(){var n=this,m=101,k=n._bgLayer=new cc.LayerColor(cc.color(255,255,255,255));n.addChild(k,0);cc._loaderImage=logoRes;var j=40,h=-m/2+100;cc._loaderImage&&(cc.loader.loadImg(cc._loaderImage,{isCrossOrigin:!1},function(d,c){m=c.height;n._initStage(c,cc.visibleRect.center)}),j=30,h=-m/2-20);j=n._label=new cc.LabelTTF("Loading... 0%","Arial",j);j.setPosition(cc.pAdd(cc.visibleRect.center,cc.p(0,h)));j.setColor(cc.color(49,145,255));k.addChild(this._label,10);j.y+=40;return !0},c:function(d){d.color=cc.color("#000000")},_initStage:function(h,g){var f=this._texture2d=new cc.Texture2D;f.initWithElement(h);f.handleLoadedTexture();f=this._logo=new cc.Sprite(f);f.setScale(cc.contentScaleFactor());f.x=g.x;f.y=g.y+50;this._bgLayer.addChild(f,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,0.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label.setString("Loading... 0%")},initWithResources:function(h,g,f){cc.isString(h)&&(h=[h]);this.resources=h||[];this.cb=g;this.target=f},_startLoading:function(){var d=this;d.unschedule(d._startLoading);cc.loader.load(d.resources,function(h,g,c){h=Math.min(c/g*100|0,100);d._label.setString("Loading... "+h+"%")},function(){d.cb&&(d._label.setString("Loading... 100%"),document.getElementById(cc.game.config.id).style.backgroundColor="black",d.cb.call(d.target))})}});cc.LoaderScene.preload=function(k,j,h){var g=cc;g.loaderScene||(g.loaderScene=new cc.LoaderScene,g.loaderScene.init());g.loaderScene.initWithResources(k,j,h);cc.director.runScene(g.loaderScene);return g.loaderScene};var logoRes="res/logo.png";cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.winSize)},init:function(){this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.winSize);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1;return !0},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(h,g,f){cc.Node.prototype.addChild.call(this,h,g,f);this._renderCmd._bakeForAddChild(h)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):new cc.Layer.WebGLRenderCmd(this)}});cc.Layer.create=function(){return new cc.Layer};cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(f,e){this.width=f;this.height=e},changeWidth:function(d){this.width=d},changeHeight:function(d){this.height=d},setOpacityModifyRGB:function(d){},isOpacityModifyRGB:function(){return !1},ctor:function(h,g,f){cc.Layer.prototype.ctor.call(this);this._blendFunc=cc.BlendFunc._alphaNonPremultiplied();cc.LayerColor.prototype.init.call(this,h,g,f)},init:function(k,j,h){var g=cc.director.getWinSize();k=k||cc.color(0,0,0,255);j=void 0===j?g.width:j;h=void 0===h?g.height:h;g=this._realColor;g.r=k.r;g.g=k.g;g.b=k.b;this._realOpacity=k.a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty);cc.LayerColor.prototype.setContentSize.call(this,j,h);return !0},setBlendFunc:function(h,g){var f=this._blendFunc;void 0===g?(f.src=h.src,f.dst=h.dst):(f.src=h,f.dst=g);this._renderCmd.updateBlendFunc(f)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}});cc.LayerColor.create=function(h,g,f){return new cc.LayerColor(h,g,f)};(function(){var d=cc.LayerColor.prototype;cc.defineGetterSetter(d,"width",d._getWidth,d._setWidth);cc.defineGetterSetter(d,"height",d._getHeight,d._setHeight)})();cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(k,j,h,g){cc.LayerColor.prototype.ctor.call(this);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._endOpacity=this._startOpacity=255;g&&g instanceof Array?(this._colorStops=g,g.splice(0,0,{p:0,color:k||cc.color.BLACK}),g.push({p:1,color:j||cc.color.BLACK})):this._colorStops=[{p:0,color:k||cc.color.BLACK},{p:1,color:j||cc.color.BLACK}];cc.LayerGradient.prototype.init.call(this,k,j,h,g)},init:function(k,j,h,g){k=k||cc.color(0,0,0,255);j=j||cc.color(0,0,0,255);h=h||cc.p(0,-1);g=this._endColor;this._startOpacity=k.a;g.r=j.r;g.g=j.g;g.b=j.b;this._endOpacity=j.a;this._alongVector=h;this._compressedInterpolation=!0;cc.LayerColor.prototype.init.call(this,cc.color(k.r,k.g,k.b,255));this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty);return !0},setContentSize:function(f,e){cc.LayerColor.prototype.setContentSize.call(this,f,e);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(d){cc.LayerColor.prototype._setWidth.call(this,d);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(d){cc.LayerColor.prototype._setHeight.call(this,d);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(f){this.color=f;var e=this._colorStops;e&&0<e.length&&(e=e[0].color,e.r=f.r,e.g=f.g,e.b=f.b)},setEndColor:function(f){var e=this._endColor;e.r=f.r;e.g=f.g;e.b=f.b;(e=this._colorStops)&&0<e.length&&(e=e[e.length-1].color,e.r=f.r,e.g=f.g,e.b=f.b);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(f){this._startOpacity=f;var e=this._colorStops;e&&0<e.length&&(e[0].color.a=f);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(f){this._endOpacity=f;var e=this._colorStops;e&&0<e.length&&(e[e.length-1].color.a=f);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(d){this._alongVector.x=d.x;this._alongVector.y=d.y;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(d){this._compressedInterpolation=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(d){this._colorStops=d;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}});cc.LayerGradient.create=function(k,j,h,g){return new cc.LayerGradient(k,j,h,g)};(function(){var d=cc.LayerGradient.prototype;cc.defineGetterSetter(d,"startColor",d.getStartColor,d.setStartColor);cc.defineGetterSetter(d,"endColor",d.getEndColor,d.setEndColor);cc.defineGetterSetter(d,"startOpacity",d.getStartOpacity,d.setStartOpacity);cc.defineGetterSetter(d,"endOpacity",d.getEndOpacity,d.setEndOpacity);cc.defineGetterSetter(d,"vector",d.getVector,d.setVector);cc.defineGetterSetter(d,"colorStops",d.getColorStops,d.setColorStops)})();cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(d){cc.Layer.prototype.ctor.call(this);d instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,d):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(d){0<d.length&&null==d[d.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=d;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);return !0},switchTo:function(d){d>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=d,this.addChild(this._layers[d]))},switchToAndReleaseMe:function(d){d>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=d,this.addChild(this._layers[d]))},addLayer:function(d){d?this._layers.push(d):cc.log(cc._LogInfos.LayerMultiplex_addLayer)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))};(function(){cc.Layer.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._isBaked=!1;this._bakeSprite=null;this._updateCache=2};var d=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.Layer.CanvasRenderCmd;d._setCacheDirty=function(e){e&&0===this._updateCache&&(this._updateCache=2);!1===this._cacheDirty&&(this._cacheDirty=!0,(e=this._cachedParent)&&e!==this&&e._setNodeDirtyForCache&&e._setNodeDirtyForCache())};d.updateStatus=function(){var g=cc.Node._dirtyFlags,f=this._dirtyFlag;f&g.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag=f&g.orderDirty^f);cc.Node.RenderCmd.prototype.updateStatus.call(this)};d._syncStatus=function(j){var h=cc.Node._dirtyFlags,g=this._dirtyFlag;g&h.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag=g&h.orderDirty^g);cc.Node.RenderCmd.prototype._syncStatus.call(this,j)};d.transform=function(t,s){var r=this._worldTransform,p=r.a,o=r.b,n=r.c,j=r.d;cc.Node.CanvasRenderCmd.prototype.transform.call(this,t,s);r.a===p&&r.b===o&&r.c===n&&r.d===j||0!==this._updateCache||(this._updateCache=2)};d.bake=function(){if(!this._isBaked){this._needDraw=!0;this._isBaked=this._cacheDirty=cc.renderer.childrenOrderDirty=!0;0===this._updateCache&&(this._updateCache=2);for(var j=this._node._children,h=0,g=j.length;h<g;h++){j[h]._renderCmd._setCachedParent(this)}this._bakeSprite||(this._bakeSprite=new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}};d.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0;this._isBaked=this._needDraw=!1;this._cacheDirty=!0;0===this._updateCache&&(this._updateCache=2);for(var j=this._node._children,h=0,g=j.length;h<g;h++){j[h]._renderCmd._setCachedParent(null)}}};d.isBaked=function(){return this._isBaked};d.rendering=function(){if(this._cacheDirty){var r=this._node,p=r._children,o=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);var n=this._getBoundingBoxForBake();n.width=0|n.width+0.5;n.height=0|n.height+0.5;var m=o.getCacheContext(),j=m.getContext();o.setPosition(n.x,n.y);if(0<this._updateCache){o.resetCanvasSize(n.width,n.height);m.setOffset(0-n.x,j.canvas.height-n.height+n.y);r.sortAllChildren();cc.renderer._turnToCacheMode(this.__instanceId);r=0;for(n=p.length;r<n;r++){p[r].visit(this)}cc.renderer._renderingToCacheCanvas(m,this.__instanceId);o.transform();this._updateCache--}this._cacheDirty=!1}};d.visit=function(j){if(this._isBaked){var h=this._node,g=h._children.length;h._visible&&0!==g&&(this._syncStatus(j),cc.renderer.pushRenderCommand(this),this._bakeSprite.visit(this),this._dirtyFlag=0)}else{this.originVisit(j)}};d._bakeForAddChild=function(e){e._parent===this._node&&this._isBaked&&e._renderCmd._setCachedParent(this)};d._getBoundingBoxForBake=function(){var r=null,p=this._node;if(!p._children||0===p._children.length){return cc.rect(0,0,10,10)}for(var o=p.getNodeToWorldTransform(),p=p._children,n=0,m=p.length;n<m;n++){var j=p[n];j&&j._visible&&(r?(j=j._getBoundingBoxToCurrentNode(o))&&(r=cc.rectUnion(r,j)):r=j._getBoundingBoxToCurrentNode(o))}return r}})();(function(){cc.LayerColor.CanvasRenderCmd=function(e){cc.Layer.CanvasRenderCmd.call(this,e);this._needDraw=!0;this._blendFuncStr="source-over";this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var d=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);d.constructor=cc.LayerColor.CanvasRenderCmd;d.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this);this._needDraw=!0};d.rendering=function(v,t,s){v=v||cc._renderContext;var r=v.getContext(),p=this._node,o=this._displayedColor,j=this._displayedOpacity/255,u=p._contentSize.width,p=p._contentSize.height;0!==j&&(v.setCompositeOperation(this._blendFuncStr),v.setGlobalAlpha(j),v.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+", 1)"),v.setTransform(this._worldTransform,t,s),r.fillRect(0,0,u*t,-p*s),cc.g_NumberOfDraws++)};d.updateBlendFunc=function(e){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e)};d._updateSquareVertices=d._updateSquareVerticesWidth=d._updateSquareVerticesHeight=function(){};d._bakeRendering=function(){if(this._cacheDirty){var t=this._node,s=this._bakeSprite,r=t._children,p=r.length;this.transform(this.getParentRenderCmd(),!0);var o=this._getBoundingBoxForBake();o.width=0|o.width+0.5;o.height=0|o.height+0.5;var n=s.getCacheContext(),j=n.getContext();s.setPosition(o.x,o.y);if(0<this._updateCache){j.fillStyle=n._currentFillStyle;s.resetCanvasSize(o.width,o.height);n.setOffset(0-o.x,j.canvas.height-o.height+o.y);cc.renderer._turnToCacheMode(this.__instanceId);if(0<p){t.sortAllChildren();for(t=0;t<p;t++){if(o=r[t],0>o._localZOrder){o._renderCmd.visit(this)}else{break}}for(cc.renderer.pushRenderCommand(this);t<p;t++){r[t]._renderCmd.visit(this)}}else{cc.renderer.pushRenderCommand(this)}cc.renderer._renderingToCacheCanvas(n,this.__instanceId);s.transform();this._updateCache--}this._cacheDirty=!1}};d.visit=function(e){this._isBaked?this._node._visible&&(this._syncStatus(e),cc.renderer.pushRenderCommand(this._bakeRenderCmd),this._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bakeSprite.visit(this),this._dirtyFlag=0):this.originVisit()};d._getBoundingBoxForBake=function(){var o=this._node,n=cc.rect(0,0,o._contentSize.width,o._contentSize.height),m=o.getNodeToWorldTransform(),n=cc.rectApplyAffineTransform(n,o.getNodeToWorldTransform());if(!o._children||0===o._children.length){return n}for(var o=o._children,k=0;k<o.length;k++){var j=o[k];j&&j._visible&&(j=j._getBoundingBoxToCurrentNode(m),n=cc.rectUnion(n,j))}return n}})();(function(){cc.LayerGradient.CanvasRenderCmd=function(e){cc.LayerColor.CanvasRenderCmd.call(this,e);this._needDraw=!0;this._startPoint=cc.p(0,0);this._endPoint=cc.p(0,0);this._endStopStr=this._startStopStr=null};var d=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);d.constructor=cc.LayerGradient.CanvasRenderCmd;d.rendering=function(x,w,v){x=x||cc._renderContext;var u=x.getContext(),t=this._node,s=this._displayedOpacity/255;if(0!==s){var r=t._contentSize.width,o=t._contentSize.height;x.setCompositeOperation(this._blendFuncStr);x.setGlobalAlpha(s);s=u.createLinearGradient(this._startPoint.x*w,this._startPoint.y*v,this._endPoint.x*w,this._endPoint.y*v);if(t._colorStops){for(var j=0;j<t._colorStops.length;j++){s.addColorStop(t._colorStops[j].p,this._colorStopsStr[j])}}else{s.addColorStop(0,this._startStopStr),s.addColorStop(1,this._endStopStr)}x.setFillStyle(s);x.setTransform(this._worldTransform,w,v);u.fillRect(0,0,r*w,-o*v);cc.g_NumberOfDraws++}};d.updateStatus=function(){var g=cc.Node._dirtyFlags,f=this._dirtyFlag;f&g.gradientDirty&&(this._dirtyFlag|=g.colorDirty,this._dirtyFlag=f&g.gradientDirty^f);cc.Node.RenderCmd.prototype.updateStatus.call(this)};d._syncStatus=function(j){var h=cc.Node._dirtyFlags,g=this._dirtyFlag;g&h.gradientDirty&&(this._dirtyFlag|=h.colorDirty,this._dirtyFlag=g&h.gradientDirty^g);cc.Node.RenderCmd.prototype._syncStatus.call(this,j)};d._updateColor=function(){var o=this._node,n=o._contentSize,m=0.5*n.width,n=0.5*n.height,k=cc.pAngleSigned(cc.p(0,-1),o._alongVector),k=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),k),j=Math.min(Math.abs(1/k.x),Math.abs(1/k.y));this._startPoint.x=m*-k.x*j+m;this._startPoint.y=n*k.y*j-n;this._endPoint.x=m*k.x*j+m;this._endPoint.y=n*-k.y*j-n;m=this._displayedColor;n=o._endColor;k=o._startOpacity/255;j=o._endOpacity/255;this._startStopStr="rgba("+Math.round(m.r)+","+Math.round(m.g)+","+Math.round(m.b)+","+k.toFixed(4)+")";this._endStopStr="rgba("+Math.round(n.r)+","+Math.round(n.g)+","+Math.round(n.b)+","+j.toFixed(4)+")";if(o._colorStops){for(this._endOpacity=this._startOpacity=0,this._colorStopsStr=[],m=0;m<o._colorStops.length;m++){n=o._colorStops[m].color,k=null==n.a?1:n.a/255,this._colorStopsStr.push("rgba("+Math.round(n.r)+","+Math.round(n.g)+","+Math.round(n.b)+","+k.toFixed(4)+")")}}}})();(function(){cc.Layer.WebGLRenderCmd=function(e){cc.Node.WebGLRenderCmd.call(this,e)};var d=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);d.constructor=cc.Layer.WebGLRenderCmd;d.bake=function(){};d.unbake=function(){};d._bakeForAddChild=function(){}})();(function(){cc.LayerColor.WebGLRenderCmd=function(m){cc.Layer.WebGLRenderCmd.call(this,m);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity();this._squareVerticesAB=new ArrayBuffer(48);this._squareColorsAB=new ArrayBuffer(16);m=this._squareVerticesAB;var k=this._squareColorsAB,j=cc.Vertex3F.BYTES_PER_ELEMENT,h=cc.Color.BYTES_PER_ELEMENT;this._squareVertices=[new cc.Vertex3F(0,0,0,m,0),new cc.Vertex3F(0,0,0,m,j),new cc.Vertex3F(0,0,0,m,2*j),new cc.Vertex3F(0,0,0,m,3*j)];this._squareColors=[cc.color(0,0,0,255,k,0),cc.color(0,0,0,255,k,h),cc.color(0,0,0,255,k,2*h),cc.color(0,0,0,255,k,3*h)];this._verticesFloat32Buffer=cc._renderContext.createBuffer();this._colorsUint8Buffer=cc._renderContext.createBuffer();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var d=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);d.constructor=cc.LayerColor.WebGLRenderCmd;d.rendering=function(j){j=j||cc._renderContext;var h=this._node,g=this._worldTransform;this._matrix.mat[0]=g.a;this._matrix.mat[4]=g.c;this._matrix.mat[12]=g.tx;this._matrix.mat[1]=g.b;this._matrix.mat[5]=g.d;this._matrix.mat[13]=g.ty;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);j.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);j.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);cc.glBlendFunc(h._blendFunc.src,h._blendFunc.dst);j.bindBuffer(j.ARRAY_BUFFER,this._verticesFloat32Buffer);j.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,j.FLOAT,!1,0,0);j.bindBuffer(j.ARRAY_BUFFER,this._colorsUint8Buffer);j.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,j.UNSIGNED_BYTE,!0,0,0);j.drawArrays(j.TRIANGLE_STRIP,0,this._squareVertices.length)};d.transform=function(r,p){this.originTransform(r,p);var o=this._node,n=o._contentSize.width,m=o._contentSize.height,j=this._squareVertices;j[1].x=n;j[2].y=m;j[3].x=n;j[3].y=m;j[0].z=j[1].z=j[2].z=j[3].z=o._vertexZ;this._bindLayerVerticesBufferData()};d._updateColor=function(){for(var m=this._displayedColor,k=this._displayedOpacity,j=this._squareColors,h=0;4>h;h++){j[h].r=m.r,j[h].g=m.g,j[h].b=m.b,j[h].a=k}this._bindLayerColorsBufferData()};d._bindLayerVerticesBufferData=function(){var e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer);e.bufferData(e.ARRAY_BUFFER,this._squareVerticesAB,e.DYNAMIC_DRAW)};d._bindLayerColorsBufferData=function(){var e=cc._renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer);e.bufferData(e.ARRAY_BUFFER,this._squareColorsAB,e.STATIC_DRAW)};d.updateBlendFunc=function(e){}})();(function(){cc.LayerGradient.WebGLRenderCmd=function(e){cc.LayerColor.WebGLRenderCmd.call(this,e);this._needDraw=!0;this._clipRect=new cc.Rect;this._clippingRectDirty=!1};var d=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);d.constructor=cc.LayerGradient.WebGLRenderCmd;d.updateStatus=function(){var g=cc.Node._dirtyFlags,f=this._dirtyFlag;f&g.gradientDirty&&(this._dirtyFlag|=g.colorDirty,this._updateVertex(),this._dirtyFlag=f&g.gradientDirty^f);cc.Node.RenderCmd.prototype.updateStatus.call(this)};d._syncStatus=function(j){var h=cc.Node._dirtyFlags,g=this._dirtyFlag;g&h.gradientDirty&&(this._dirtyFlag|=h.colorDirty,this._updateVertex(),this._dirtyFlag=g&h.gradientDirty^g);cc.Node.RenderCmd.prototype._syncStatus.call(this,j)};d.transform=function(g,f){this.originTransform(g,f);this._updateVertex()};d._updateVertex=function(){var A=this._node,z=A._colorStops;if(z&&!(2>z.length)){this._clippingRectDirty=!0;var y=z.length,x=2*y,w,v=A._contentSize,u=this._squareVertices;if(u.length<x){this._squareVerticesAB=new ArrayBuffer(12*x);u.length=0;var t=this._squareVerticesAB,o=cc.Vertex3F.BYTES_PER_ELEMENT;for(w=0;w<x;w++){u.push(new cc.Vertex3F(0,0,0,t,o*w))}}var j=Math.PI+cc.pAngleSigned(cc.p(0,-1),A._alongVector),x=cc.p(v.width/2,v.height/2);w=Math.round(cc.radiansToDegrees(j));var t=cc.affineTransformMake(1,0,0,1,x.x,x.y),t=cc.affineTransformRotate(t,j),B;90>w?(B=cc.p(-x.x,x.y),w=cc.p(x.x,x.y)):180>w?(B=cc.p(x.x,x.y),w=cc.p(x.x,-x.y)):270>w?(B=cc.p(x.x,-x.y),w=cc.p(-x.x,-x.y)):(B=cc.p(-x.x,-x.y),w=cc.p(-x.x,x.y));o=Math.sin(j);j=Math.cos(j);B=Math.abs((B.x*j-B.y*o)/x.x);w=Math.abs((w.x*o+w.y*j)/x.y);t=cc.affineTransformScale(t,B,w);for(w=0;w<y;w++){o=z[w].p*v.height,j=cc.pointApplyAffineTransform(-x.x,o-x.y,t),u[2*w].x=j.x,u[2*w].y=j.y,u[2*w].z=A._vertexZ,o=cc.pointApplyAffineTransform(v.width-x.x,o-x.y,t),u[2*w+1].x=o.x,u[2*w+1].y=o.y,u[2*w+1].z=A._vertexZ}this._bindLayerVerticesBufferData()}};d._updateColor=function(){var t=this._node._colorStops;if(t&&!(2>t.length)){var s=t.length,r=this._squareColors,p=2*s;if(r.length<p){this._squareColorsAB=new ArrayBuffer(4*p);r.length=0;var o=this._squareColorsAB,n=cc.Color.BYTES_PER_ELEMENT;for(i=0;i<p;i++){r.push(cc.color(0,0,0,255,o,n*i))}}p=this._displayedOpacity/255;for(i=0;i<s;i++){var o=t[i].color,n=r[2*i],j=r[2*i+1];n.r=o.r;n.g=o.g;n.b=o.b;n.a=o.a*p;j.r=o.r;j.g=o.g;j.b=o.b;j.a=o.a*p}this._bindLayerColorsBufferData()}};d.rendering=function(j){j=j||cc._renderContext;var h=this._node,g=this._getClippingRect();j.enable(j.SCISSOR_TEST);cc.view.setScissorInPoints(g.x,g.y,g.width,g.height);g=this._worldTransform;this._matrix.mat[0]=g.a;this._matrix.mat[4]=g.c;this._matrix.mat[12]=g.tx;this._matrix.mat[1]=g.b;this._matrix.mat[5]=g.d;this._matrix.mat[13]=g.ty;this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);j.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);j.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);cc.glBlendFunc(h._blendFunc.src,h._blendFunc.dst);j.bindBuffer(j.ARRAY_BUFFER,this._verticesFloat32Buffer);j.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,j.FLOAT,!1,0,0);j.bindBuffer(j.ARRAY_BUFFER,this._colorsUint8Buffer);j.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,j.UNSIGNED_BYTE,!0,0,0);j.drawArrays(j.TRIANGLE_STRIP,0,this._squareVertices.length);j.disable(j.SCISSOR_TEST)};d._getClippingRect=function(){if(this._clippingRectDirty){var g=this._node,f=cc.rect(0,0,g._contentSize.width,g._contentSize.height),g=g.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(f,g)}return this._clipRect}})();cc._tmp.PrototypeSprite=function(){var d=cc.Sprite.prototype;cc.defineGetterSetter(d,"opacityModifyRGB",d.isOpacityModifyRGB,d.setOpacityModifyRGB);cc.defineGetterSetter(d,"opacity",d.getOpacity,d.setOpacity);cc.defineGetterSetter(d,"color",d.getColor,d.setColor);cc.defineGetterSetter(d,"flippedX",d.isFlippedX,d.setFlippedX);cc.defineGetterSetter(d,"flippedY",d.isFlippedY,d.setFlippedY);cc.defineGetterSetter(d,"offsetX",d._getOffsetX);cc.defineGetterSetter(d,"offsetY",d._getOffsetY);cc.defineGetterSetter(d,"texture",d.getTexture,d.setTexture);cc.defineGetterSetter(d,"textureRectRotated",d.isTextureRectRotated);cc.defineGetterSetter(d,"batchNode",d.getBatchNode,d.setBatchNode);cc.defineGetterSetter(d,"quad",d.getQuad)};cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(h,g,f){cc.Node.prototype.ctor.call(this);this._shouldBeHidden=!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._softInit(h,g,f)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(f,e){this.addEventListener("load",f,e)},isDirty:function(){return this.dirty},setDirty:function(d){this.dirty=d},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(d){this.atlasIndex=d},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(d){this.textureAtlas=d},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(f){cc.assert(f,cc._LogInfos.Sprite_initWithSpriteFrame);f.textureLoaded()||(this._textureLoaded=!1,f.addEventListener("load",this._renderCmd._spriteFrameLoadedCallback,this));var e=cc._renderType===cc.game.RENDER_TYPE_CANVAS?!1:f._rotated,e=this.initWithTexture(f.getTexture(),f.getRect(),e);this.setSpriteFrame(f);return e},initWithSpriteFrameName:function(f){cc.assert(f,cc._LogInfos.Sprite_initWithSpriteFrameName);var e=cc.spriteFrameCache.getSpriteFrame(f);cc.assert(e,f+cc._LogInfos.Sprite_initWithSpriteFrameName1);return this.initWithSpriteFrame(e)},useBatchNode:function(d){this.textureAtlas=d.getTextureAtlas();this._batchNode=d},setVertexRect:function(f){var e=this._rect;e.x=f.x;e.y=f.y;e.width=f.width;e.height=f.height},sortAllChildren:function(){if(this._reorderChildDirty){var d=this._children;cc.Node.prototype.sortAllChildren.call(this);this._batchNode&&this._arrayMakeObjectsPerformSelector(d,cc.Node._stateCallbackType.sortAllChildren);this._reorderChildDirty=!1}},reorderChild:function(f,e){cc.assert(f,cc._LogInfos.Sprite_reorderChild_2);-1===this._children.indexOf(f)?cc.log(cc._LogInfos.Sprite_reorderChild):e!==f.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,f,e))},removeChild:function(f,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(f);cc.Node.prototype.removeChild.call(this,f,e)},setVisible:function(d){cc.Node.prototype.setVisible.call(this,d);this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(n){var m=this._children,k=this._batchNode;if(k&&null!=m){for(var j=0,h=m.length;j<h;j++){k.removeSpriteFromAtlas(m[j])}}cc.Node.prototype.removeAllChildren.call(this,n);this._hasChildren=!1},ignoreAnchorPointForPosition:function(d){this._batchNode?cc.log(cc._LogInfos.Sprite_ignoreAnchorPointForPosition):cc.Node.prototype.ignoreAnchorPointForPosition.call(this,d)},setFlippedX:function(d){this._flippedX!==d&&(this._flippedX=d,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(d){this._flippedY!==d&&(this._flippedY=d,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(d){this._opacityModifyRGB!==d&&(this._opacityModifyRGB=d,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(h,g){cc.assert(h,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var f=cc.animationCache.getAnimation(h);f?(f=f.getFrames()[g])?this.setSpriteFrame(f.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var d=this._parent;d&&d!==this._batchNode;){d._setReorderChildDirtyRecursively(),d=d.parent}}},getTexture:function(){return this._texture},_softInit:function(h,g,f){if(void 0===h){cc.Sprite.prototype.init.call(this)}else{if(cc.isString(h)){"#"===h[0]?(g=h.substr(1,h.length-1),(g=cc.spriteFrameCache.getSpriteFrame(g))?this.initWithSpriteFrame(g):cc.log("%s does not exist",h)):cc.Sprite.prototype.init.call(this,h,g)}else{if("object"===typeof h){if(h instanceof cc.Texture2D){this.initWithTexture(h,g,f)}else{if(h instanceof cc.SpriteFrame){this.initWithSpriteFrame(h)}else{if(h instanceof HTMLImageElement||h instanceof HTMLCanvasElement){g=new cc.Texture2D,g.initWithElement(h),g.handleLoadedTexture(),this.initWithTexture(g)}}}}}}},getQuad:function(){return null},setBlendFunc:function(h,g){var f=this._blendFunc;void 0===g?(f.src=h.src,f.dst=h.dst):(f.src=h,f.dst=g);this._renderCmd.updateBlendFunc(f)},init:function(){if(0<arguments.length){return this.initWithFile(arguments[0],arguments[1])}cc.Node.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0));return !0},initWithFile:function(k,j){cc.assert(k,cc._LogInfos.Sprite_initWithFile);var h=cc.textureCache.getTextureForKey(k);if(h){if(!j){var g=h.getContentSize();j=cc.rect(0,0,g.width,g.height)}return this.initWithTexture(h,j)}h=cc.textureCache.addImage(k);return this.initWithTexture(h,j||cc.rect(0,0,h._contentSize.width,h._contentSize.height))},initWithTexture:function(n,m,k,j){cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture);k=k||!1;n=this._renderCmd._handleTextureForRotatedTexture(n,m,k,j);if(!cc.Node.prototype.init.call(this)){return !1}this._batchNode=null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this._flippedX=this._flippedY=!1;this.setAnchorPoint(0.5,0.5);this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;var h=n.isLoaded();this._textureLoaded=h;if(!h){return this._rectRotated=k,m&&(this._rect.x=m.x,this._rect.y=m.y,this._rect.width=m.width,this._rect.height=m.height),this.texture&&this.texture.removeEventListener("load",this),n.addEventListener("load",this._renderCmd._textureLoadedCallback,this),this.setTexture(n),!0}m||(m=cc.rect(0,0,n.width,n.height));this._renderCmd._checkTextureBoundary(n,m,k);this.setTexture(n);this.setTextureRect(m,k);this.setBatchNode(null);return !0},setTextureRect:function(k,j,h,g){this._rectRotated=j||!1;this.setContentSize(h||k);this.setVertexRect(k);this._renderCmd._setTextureCoords(k,g);k=this._unflippedOffsetPositionFromCenter.x;j=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(k=-k);this._flippedY&&(j=-j);h=this._rect;this._offsetPosition.x=k+(this._contentSize.width-h.width)/2;this._offsetPosition.y=j+(this._contentSize.height-h.height)/2},addChild:function(h,g,f){cc.assert(h,cc._LogInfos.CCSpriteBatchNode_addChild_2);null==g&&(g=h._localZOrder);null==f&&(f=h.tag);this._renderCmd._setBatchNodeForAddChild(h)&&(cc.Node.prototype.addChild.call(this,h,g,f),this._hasChildren=!0)},setSpriteFrame:function(h){var g=this;cc.isString(h)&&(h=cc.spriteFrameCache.getSpriteFrame(h),cc.assert(h,cc._LogInfos.Sprite_setSpriteFrame));this.setNodeDirty(!0);var f=h.getOffset();g._unflippedOffsetPositionFromCenter.x=f.x;g._unflippedOffsetPositionFromCenter.y=f.y;f=h.getTexture();h.textureLoaded()?(g._textureLoaded=!0,f!==g._texture&&(g._setTexture(f),g.setColor(g._realColor)),g.setTextureRect(h.getRect(),h.isRotated(),h.getOriginalSize())):(g._textureLoaded=!1,h.addEventListener("load",function(j){g._textureLoaded=!0;var d=j.getTexture();d!==g._texture&&g._setTexture(d);g.setTextureRect(j.getRect(),j.isRotated(),j.getOriginalSize());g.dispatchEvent("load");g.setColor(g._realColor)},g));this._renderCmd._updateForSetSpriteFrame(f)},setDisplayFrame:function(d){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(d)},isFrameDisplayed:function(d){return this._renderCmd.isFrameDisplayed(d)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(d){(this._batchNode=d)?(this._transformToBatch=cc.affineTransformIdentity(),this.textureAtlas=this._batchNode.getTextureAtlas()):(this.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,this.textureAtlas=null,this.dirty=this._recursiveDirty=!1)},setTexture:function(f){if(!f){return this._renderCmd._setTexture(null)}var e=cc.isString(f);e&&(f=cc.textureCache.addImage(f));f._textureLoaded?(this._setTexture(f,e),this.setColor(this._realColor),this._textureLoaded=!0):(this._renderCmd._setTexture(null),f.addEventListener("load",function(){this._setTexture(f,e);this.setColor(this._realColor);this._textureLoaded=!0},this))},_setTexture:function(f,e){this._renderCmd._setTexture(f);e&&this._changeRectWithTexture(f)},_changeRectWithTexture:function(d){d=d._contentSize;d=cc.rect(0,0,d.width,d.height);this.setTextureRect(d)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}});cc.Sprite.create=function(h,g,f){return new cc.Sprite(h,g,f)};cc.Sprite.createWithTexture=cc.Sprite.create;cc.Sprite.createWithSpriteFrameName=cc.Sprite.create;cc.Sprite.createWithSpriteFrame=cc.Sprite.create;cc.Sprite.INDEX_NOT_INITIALIZED=-1;cc.EventHelper.prototype.apply(cc.Sprite.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;(function(){cc.Sprite.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._needDraw=!0;this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1};this._blendFuncStr="source-over";this._colorized=!1;this._textureToRender=null};var d=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.Sprite.CanvasRenderCmd;d.setDirtyRecursively=function(e){};d._setTexture=function(g){var f=this._node;f._texture!==g&&(f._textureLoaded=g?g._textureLoaded:!1,f._texture=g,this._updateColor())};d._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)};d.isFrameDisplayed=function(g){var f=this._node;return g.getTexture()!==f._texture?!1:cc.rectEqualToRect(g.getRect(),f._rect)};d.updateBlendFunc=function(e){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e)};d._setBatchNodeForAddChild=function(e){return !0};d._handleTextureForRotatedTexture=function(m,k,j,h){j&&m.isLoaded()&&(m=m.getHtmlElementObj(),m=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(m,k,h),h=new cc.Texture2D,h.initWithElement(m),h.handleLoadedTexture(),m=h,k.x=k.y=0,this._node._rect=cc.rect(0,0,k.width,k.height));return m};d._checkTextureBoundary=function(j,h,g){j&&j.url&&(g=h.y+h.height,h.x+h.width>j.width&&cc.error(cc._LogInfos.RectWidth,j.url),g>j.height&&cc.error(cc._LogInfos.RectHeight,j.url))};d.rendering=function(E,D,C){var B=this._node,A=this._textureCoord,z=this._displayedOpacity/255,y=this._textureToRender||B._texture;if((!y||0!==A.width&&0!==A.height&&y._textureLoaded)&&0!==z){E=E||cc._renderContext;var x=E.getContext(),o=B._offsetPosition.x,j=B._rect.height,J=B._rect.width,G=-B._offsetPosition.y-j;E.setTransform(this._worldTransform,D,C);E.setCompositeOperation(this._blendFuncStr);E.setGlobalAlpha(z);(B._flippedX||B._flippedY)&&E.save();B._flippedX&&(o=-o-J,x.scale(-1,1));B._flippedY&&(G=B._offsetPosition.y,x.scale(1,-1));var I,F,H;this._colorized?I=z=0:(z=A.renderX,I=A.renderY);F=A.width;H=A.height;o*=D;G*=C;J*=D;j*=C;y&&y._htmlElementObj?(D=y._htmlElementObj,""!==y._pattern?(E.setFillStyle(x.createPattern(D,y._pattern)),x.fillRect(o,G,J,j)):x.drawImage(D,z,I,F,H,o,G,J,j)):(y=B._contentSize,A.validRect&&(A=this._displayedColor,E.setFillStyle("rgba("+A.r+","+A.g+","+A.b+",1)"),x.fillRect(o,G,y.width*D,y.height*C)));(B._flippedX||B._flippedY)&&E.restore();cc.g_NumberOfDraws++}};d._updateColor=function(){var j=this._node._texture,h=this._textureCoord,g=this._displayedColor;j&&(255!==g.r||255!==g.g||255!==g.b?(this._textureToRender=j._generateColorTexture(g.r,g.g,g.b,h),this._colorized=!0):j&&(this._textureToRender=j,this._colorized=!1))};d._updateForSetSpriteFrame=function(j,h){this._colorized=!1;this._textureCoord.renderX=this._textureCoord.x;this._textureCoord.renderY=this._textureCoord.y;if(h=h||j._textureLoaded){var g=this._node.getColor();255===g.r&&255===g.g&&255===g.b||this._updateColor()}};d._spriteFrameLoadedCallback=function(e){this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize());this._renderCmd._updateColor();this.dispatchEvent("load")};d._textureLoadedCallback=function(j){if(!this._textureLoaded){this._textureLoaded=!0;var h=this._rect,g=this._renderCmd;h?cc._rectEqualToZero(h)&&(h.width=j.width,h.height=j.height):h=cc.rect(0,0,j.width,j.height);this.texture=j;this.setTextureRect(h,this._rectRotated);j=g._displayedColor;255===j.r&&255===j.g&&255===j.b||g._updateColor();this.setBatchNode(this._batchNode);this.dispatchEvent("load")}};d._setTextureCoords=function(m,k){void 0===k&&(k=!0);var j=this._textureCoord,h=k?cc.contentScaleFactor():1;j.renderX=j.x=0|m.x*h;j.renderY=j.y=0|m.y*h;j.width=0|m.width*h;j.height=0|m.height*h;j.validRect=!(0===j.width||0===j.height||0>j.x||0>j.y)};cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(o,n,m){if(!o){return null}if(!n){return o}m=null==m?!0:m;var k=document.createElement("canvas");k.width=n.width;k.height=n.height;var j=k.getContext("2d");j.translate(k.width/2,k.height/2);m?j.rotate(-1.5707963267948966):j.rotate(1.5707963267948966);j.drawImage(o,n.x,n.y,n.height,n.width,-n.height/2,-n.width/2,n.height,n.width);return k}})();(function(){cc.Sprite.WebGLRenderCmd=function(e){cc.Node.WebGLRenderCmd.call(this,e);this._needDraw=!0;this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}];this._color=new Uint32Array(1);this._recursiveDirty=this._dirty=!1;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var d=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);d.constructor=cc.Sprite.WebGLRenderCmd;d.updateBlendFunc=function(e){};d.setDirtyFlag=function(e){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,e);this._dirty=!0};d.setDirtyRecursively=function(o){this._dirty=this._recursiveDirty=o;for(var n=this._node._children,m,k=n?n.length:0,j=0;j<k;j++){m=n[j],m instanceof cc.Sprite&&m._renderCmd.setDirtyRecursively(o)}};d._setBatchNodeForAddChild=function(g){var f=this._node;if(f._batchNode){if(!(g instanceof cc.Sprite)){return cc.log(cc._LogInfos.Sprite_addChild),!1}g.texture._webTextureObj!==f.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2);f._batchNode.appendChild(g);f._reorderChildDirty||f._setReorderChildDirtyRecursively()}return !0};d._handleTextureForRotatedTexture=function(e){return e};d.isFrameDisplayed=function(g){var f=this._node;return cc.rectEqualToRect(g.getRect(),f._rect)&&g.getTexture().getName()===f._texture.getName()&&cc.pointEqualToPoint(g.getOffset(),f._unflippedOffsetPositionFromCenter)};d._updateForSetSpriteFrame=function(){};d._spriteFrameLoadedCallback=function(e){this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize());this.dispatchEvent("load")};d._textureLoadedCallback=function(g){if(!this._textureLoaded){this._textureLoaded=!0;var f=this._rect;f?cc._rectEqualToZero(f)&&(f.width=g.width,f.height=g.height):f=cc.rect(0,0,g.width,g.height);this.texture=g;this.setTextureRect(f,this._rectRotated);this.setBatchNode(this._batchNode);this.dispatchEvent("load");cc.renderer.childrenOrderDirty=!0}};d._setTextureCoords=function(x,w){void 0===w&&(w=!0);w&&(x=cc.rectPointsToPixels(x));var v=this._node,u=v._batchNode?v.textureAtlas.texture:v._texture,t=this._vertices;if(u){var s=u.pixelsWidth,r=u.pixelsHeight,o,j;v._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(u=(2*x.x+1)/(2*s),s=u+(2*x.height-2)/(2*s),o=(2*x.y+1)/(2*r),r=o+(2*x.width-2)/(2*r)):(u=x.x/s,s=(x.x+x.height)/s,o=x.y/r,r=(x.y+x.width)/r),v._flippedX&&(j=o,o=r,r=j),v._flippedY&&(j=u,u=s,s=j),t[0].u=s,t[0].v=o,t[1].u=u,t[1].v=o,t[2].u=s,t[2].v=r,t[3].u=u):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(u=(2*x.x+1)/(2*s),s=u+(2*x.width-2)/(2*s),o=(2*x.y+1)/(2*r),r=o+(2*x.height-2)/(2*r)):(u=x.x/s,s=(x.x+x.width)/s,o=x.y/r,r=(x.y+x.height)/r),v._flippedX&&(j=u,u=s,s=j),v._flippedY&&(j=o,o=r,r=j),t[0].u=u,t[0].v=o,t[1].u=u,t[1].v=r,t[2].u=s,t[2].v=o,t[3].u=s);t[3].v=r}};d._setColorDirty=function(){};d._updateBlendFunc=function(){if(this._batchNode){cc.log(cc._LogInfos.Sprite__updateBlendFunc)}else{var g=this._node,f=g._blendFunc;g._texture&&g._texture.hasPremultipliedAlpha()?(f.src===cc.SRC_ALPHA&&f.dst===cc.BLEND_DST&&(f.src=cc.ONE),g.opacityModifyRGB=!0):(f.src===cc.ONE&&f.dst===cc.BLEND_DST&&(f.src=cc.SRC_ALPHA),g.opacityModifyRGB=!1)}};d._setTexture=function(g){var f=this._node;f._batchNode?f._batchNode.texture!==g&&cc.log(cc._LogInfos.Sprite_setTexture):f._texture!==g&&(f._textureLoaded=g?g._textureLoaded:!1,f._texture=g,this._updateBlendFunc(),f._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))};d._checkTextureBoundary=function(j,h,g){j&&j.url&&(g?(g=h.x+h.height,h=h.y+h.width):(g=h.x+h.width,h=h.y+h.height),g>j.width&&cc.error(cc._LogInfos.RectWidth,j.url),h>j.height&&cc.error(cc._LogInfos.RectHeight,j.url))};d.transform=function(v,t){this.originTransform(v,t);var s=this._node,r=s._offsetPosition.x,p=r+s._rect.width,o=s._offsetPosition.y,s=o+s._rect.height,j=this._worldTransform,u=this._vertices;u[0].x=r*j.a+s*j.c+j.tx;u[0].y=r*j.b+s*j.d+j.ty;u[1].x=r*j.a+o*j.c+j.tx;u[1].y=r*j.b+o*j.d+j.ty;u[2].x=p*j.a+s*j.c+j.tx;u[2].y=p*j.b+s*j.d+j.ty;u[3].x=p*j.a+o*j.c+j.tx;u[3].y=p*j.b+o*j.d+j.ty};d.needDraw=function(){var e=this._node._texture;return this._needDraw&&e};d.uploadData=function(x,w,v){var u=this._node,t=u._texture;if(!(t&&t._textureLoaded&&u._rect.width&&u._rect.height&&this._displayedOpacity)){return !1}var t=this._displayedOpacity,s=this._displayedColor.r,r=this._displayedColor.g,o=this._displayedColor.b;if(u._opacityModifyRGB){var j=t/255,s=s*j,r=r*j,o=o*j}this._color[0]=t<<24|o<<16|r<<8|s;u=u._vertexZ;t=this._vertices;s=t.length;o=v;for(v=0;v<s;++v){r=t[v],x[o]=r.x,x[o+1]=r.y,x[o+2]=u,w[o+3]=this._color[0],x[o+4]=r.u,x[o+5]=r.v,o+=6}return s}})();cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(f){cc.Node.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);var e;cc.isString(f)?(e=cc.textureCache.getTextureForKey(f))||(e=cc.textureCache.addImage(f)):f instanceof cc.Texture2D&&(e=f);e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(h,g,f){this.addChild(h,g,f);return this},getTextureAtlas:function(){return null},setTextureAtlas:function(d){},getDescendants:function(){return this._children},initWithFile:function(h,g){var f=cc.textureCache.getTextureForKey(h);f||(f=cc.textureCache.addImage(h));return this.initWithTexture(f,g)},init:function(h,g){var f=cc.textureCache.getTextureForKey(h);f||(f=cc.textureCache.addImage(h));return this.initWithTexture(f,g)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(f,e){this.removeChild(this._children[f],e)},rebuildIndexInOrder:function(f,e){return e},highestAtlasIndexInChild:function(f){var e=f.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):f.zIndex},lowestAtlasIndexInChild:function(f){var e=f.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):f.zIndex},atlasIndexForChild:function(d){return d.zIndex},reorderBatch:function(d){this._reorderChildDirty=d},setBlendFunc:function(f,e){this._blendFunc=void 0===e?f:{src:f,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(f,e){cc.assert(f,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2);f instanceof cc.Sprite?(f.dirty=!0,f._renderCmd.transform(this._renderCmd,!0)):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(f,e){this.addChild(f,e)},insertChild:function(f,e){this.addChild(f,e)},appendChild:function(d){this.sortAllChildren();this.addChild(d.lastLocalZOrder+1)},removeSpriteFromAtlas:function(f,e){this.removeChild(f,e)},initWithTexture:function(d){this.setTexture(d);return !0},getTexture:function(){return this._texture},setTexture:function(k){this._texture=k;if(k._textureLoaded){var j=this._children,h,g=j.length;for(h=0;h<g;++h){j[h].setTexture(k)}}else{k.addEventListener("load",function(){var n=this._children,m,c=n.length;for(m=0;m<c;++m){n[m].setTexture(k)}},this)}},setShaderProgram:function(k){this._renderCmd.setShaderProgram(k);var j=this._children,h,g=j.length;for(h=0;h<g;++h){j[h].setShaderProgram(k)}},addChild:function(h,g,f){cc.assert(void 0!==h,cc._LogInfos.CCSpriteBatchNode_addChild_3);this._isValidChild(h)&&(g=void 0===g?h.zIndex:g,f=void 0===f?h.tag:f,cc.Node.prototype.addChild.call(this,h,g,f),this._renderCmd._shaderProgram&&(h.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(d){return d instanceof cc.Sprite?d.texture!==this._texture?(cc.log(cc._LogInfos.Sprite_addChild_5),!1):!0:(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}});_p=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram);cc.SpriteBatchNode.create=function(d){return new cc.SpriteBatchNode(d)};cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create;cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var f=document.createElement("canvas");f.width=f.height=10;this._cacheCanvas=f;this._cacheContext=new cc.CanvasContextWrapper(f.getContext("2d"));var e=new cc.Texture2D;e.initWithElement(f);e.handleLoadedTexture();this.setTexture(e)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(p,o){var n=this._cacheCanvas,m=this._cacheContext,k=m._context.strokeStyle,j=m._context.fillStyle;void 0===o&&(o=p.height,p=p.width);n.width=p;n.height=o;k!==m._context.strokeStyle&&(m._context.strokeStyle=k);j!==m._context.fillStyle&&(m._context.fillStyle=j);this.getTexture().handleLoadedTexture();this.setTextureRect(cc.rect(0,0,p,o),!1,null,!1)}});cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(h,g,f){this._spriteFrame=h||null;this._delayPerUnit=g||0;this._userInfo=f||null},clone:function(){var d=new cc.AnimationFrame;d.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return d},copyWithZone:function(d){return cc.clone(this)},copy:function(d){d=new cc.AnimationFrame;d.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return d},initWithSpriteFrame:function(h,g,f){this._spriteFrame=h;this._delayPerUnit=g;this._userInfo=f;return !0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(d){this._spriteFrame=d},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(d){this._delayPerUnit=d},getUserInfo:function(){return this._userInfo},setUserInfo:function(d){this._userInfo=d}});cc.AnimationFrame.create=function(h,g,f){return new cc.AnimationFrame(h,g,f)};cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(k,j,h){this._frames=[];if(void 0===k){this.initWithSpriteFrames(null,0)}else{var g=k[0];g&&(g instanceof cc.SpriteFrame?this.initWithSpriteFrames(k,j,h):g instanceof cc.AnimationFrame&&this.initWithAnimationFrames(k,j,h))}},getFrames:function(){return this._frames},setFrames:function(d){this._frames=d},addSpriteFrame:function(f){var e=new cc.AnimationFrame;e.initWithSpriteFrame(f,1,null);this._frames.push(e);this._totalDelayUnits++},addSpriteFrameWithFile:function(f){f=cc.textureCache.addImage(f);var e=cc.rect(0,0,0,0);e.width=f.width;e.height=f.height;f=new cc.SpriteFrame(f,e);this.addSpriteFrame(f)},addSpriteFrameWithTexture:function(h,g){var f=new cc.SpriteFrame(h,g);this.addSpriteFrame(f)},initWithAnimationFrames:function(k,j,h){cc.arrayVerifyType(k,cc.AnimationFrame);this._delayPerUnit=j;this._loops=void 0===h?1:h;this._totalDelayUnits=0;j=this._frames;for(h=j.length=0;h<k.length;h++){var g=k[h];j.push(g);this._totalDelayUnits+=g.getDelayUnits()}return !0},clone:function(){var d=new cc.Animation;d.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);d.setRestoreOriginalFrame(this._restoreOriginalFrame);return d},copyWithZone:function(d){d=new cc.Animation;d.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);d.setRestoreOriginalFrame(this._restoreOriginalFrame);return d},_copyFrames:function(){for(var f=[],e=0;e<this._frames.length;e++){f.push(this._frames[e].clone())}return f},copy:function(d){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(d){this._loops=d},setRestoreOriginalFrame:function(d){this._restoreOriginalFrame=d},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(d){this._delayPerUnit=d},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(n,m,k){cc.arrayVerifyType(n,cc.SpriteFrame);this._loops=void 0===k?1:k;this._delayPerUnit=m||0;this._totalDelayUnits=0;m=this._frames;m.length=0;if(n){for(k=0;k<n.length;k++){var j=n[k],h=new cc.AnimationFrame;h.initWithSpriteFrame(j,1,null);m.push(h)}this._totalDelayUnits+=n.length}return !0},retain:function(){},release:function(){}});cc.Animation.create=function(h,g,f){return new cc.Animation(h,g,f)};cc.Animation.createWithAnimationFrames=cc.Animation.create;cc.animationCache={_animations:{},addAnimation:function(f,e){this._animations[e]=f},removeAnimation:function(d){d&&this._animations[d]&&delete this._animations[d]},getAnimation:function(d){return this._animations[d]?this._animations[d]:null},_addAnimationsWithDictionary:function(u,t){var s=u.animations;if(s){var r=1,p=u.properties;if(p){for(var r=null!=p.format?parseInt(p.format):r,p=p.spritesheets,o=cc.spriteFrameCache,n=cc.path,j=0;j<p.length;j++){o.addSpriteFrames(n.changeBasename(t,p[j]))}}switch(r){case 1:this._parseVersion1(s);break;case 2:this._parseVersion2(s);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else{cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)}},addAnimations:function(f){cc.assert(f,cc._LogInfos.animationCache_addAnimations_2);var e=cc.loader.getRes(f);e?this._addAnimationsWithDictionary(e,f):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(w){var v=cc.spriteFrameCache,u;for(u in w){var t=w[u],s=t.frames,t=parseFloat(t.delay)||0,r=null;if(s){for(var r=[],p=0;p<s.length;p++){var o=v.getSpriteFrame(s[p]);if(o){var j=new cc.AnimationFrame;j.initWithSpriteFrame(o,1,null);r.push(j)}else{cc.log(cc._LogInfos.animationCache__parseVersion1_2,u,s[p])}}0===r.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,u):(r.length!==s.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,u),r=new cc.Animation(r,t,1),cc.animationCache.addAnimation(r,u))}else{cc.log(cc._LogInfos.animationCache__parseVersion1,u)}}},_parseVersion2:function(C){var B=cc.spriteFrameCache,A;for(A in C){var z=C[A],y=z.loop,x=parseInt(z.loops),y=y?cc.REPEAT_FOREVER:isNaN(x)?1:x,x=z.restoreOriginalFrame&&!0==z.restoreOriginalFrame?!0:!1,w=z.frames;if(w){for(var u=[],t=0;t<w.length;t++){var o=w[t],j=o.spriteframe,E=B.getSpriteFrame(j);if(E){var j=parseFloat(o.delayUnits)||0,o=o.notification,D=new cc.AnimationFrame;D.initWithSpriteFrame(E,j,o);u.push(D)}else{cc.log(cc._LogInfos.animationCache__parseVersion2_2,A,j)}}z=parseFloat(z.delayPerUnit)||0;w=new cc.Animation;w.initWithAnimationFrames(u,z,y);w.setRestoreOriginalFrame(x);cc.animationCache.addAnimation(w,A)}else{cc.log(cc._LogInfos.animationCache__parseVersion2,A)}}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(n,m,k,j,h){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=!1;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=!1;void 0!==n&&void 0!==m&&(void 0===k||void 0===j||void 0===h?this.initWithTexture(n,m):this.initWithTexture(n,m,k,j,h))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(f,e){this.addEventListener("load",f,e)},getRectInPixels:function(){var d=this._rectInPixels;return cc.rect(d.x,d.y,d.width,d.height)},setRectInPixels:function(d){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0));this._rectInPixels.x=d.x;this._rectInPixels.y=d.y;this._rectInPixels.width=d.width;this._rectInPixels.height=d.height;this._rect=cc.rectPixelsToPoints(d)},isRotated:function(){return this._rotated},setRotated:function(d){this._rotated=d},getRect:function(){var d=this._rect;return cc.rect(d.x,d.y,d.width,d.height)},setRect:function(d){this._rect||(this._rect=cc.rect(0,0,0,0));this._rect.x=d.x;this._rect.y=d.y;this._rect.width=d.width;this._rect.height=d.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(d){this._offsetInPixels.x=d.x;this._offsetInPixels.y=d.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(d){this._originalSizeInPixels.width=d.width;this._originalSizeInPixels.height=d.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(d){this._originalSize.width=d.width;this._originalSize.height=d.height},getTexture:function(){if(this._texture){return this._texture}if(""!==this._textureFilename){var d=cc.textureCache.addImage(this._textureFilename);d&&(this._textureLoaded=d.isLoaded());return d}return null},setTexture:function(f){if(this._texture!==f){var e=f.isLoaded();this._textureLoaded=e;this._texture=f;e||f.addEventListener("load",function(k){this._textureLoaded=!0;if(this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var j=k.getHtmlElementObj(),j=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(j,this.getRect()),h=new cc.Texture2D;h.initWithElement(j);h.handleLoadedTexture();this.setTexture(h);j=this.getRect();this.setRect(cc.rect(0,0,j.width,j.height))}j=this._rect;0===j.width&&0===j.height&&(j=k.width,k=k.height,this._rect.width=j,this._rect.height=k,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=j,this._originalSize.height=k);this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(d){this._offset.x=d.x;this._offset.y=d.y},clone:function(){var d=new cc.SpriteFrame;d.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);d.setTexture(this._texture);return d},copyWithZone:function(){var d=new cc.SpriteFrame;d.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);d.setTexture(this._texture);return d},copy:function(){return this.copyWithZone()},initWithTexture:function(s,r,p,o,n){2===arguments.length&&(r=cc.rectPointsToPixels(r));o=o||cc.p(0,0);n=n||r;p=p||!1;cc.isString(s)?(this._texture=null,this._textureFilename=s):s instanceof cc.Texture2D&&this.setTexture(s);s=this.getTexture();this._rectInPixels=r;this._rect=cc.rectPixelsToPoints(r);if(s&&s.url&&s.isLoaded()){var m,j;p?(m=r.x+r.height,j=r.y+r.width):(m=r.x+r.width,j=r.y+r.height);m>s.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,s.url);j>s.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,s.url)}this._offsetInPixels.x=o.x;this._offsetInPixels.y=o.y;cc._pointPixelsToPointsOut(o,this._offset);this._originalSizeInPixels.width=n.width;this._originalSizeInPixels.height=n.height;cc._sizePixelsToPointsOut(n,this._originalSize);this._rotated=p;return !0}});cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype);cc.SpriteFrame.create=function(n,m,k,j,h){return new cc.SpriteFrame(n,m,k,j,h)};cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create;cc.SpriteFrame._frameWithTextureForCanvas=function(p,o,n,m,k){var j=new cc.SpriteFrame;j._texture=p;j._rectInPixels=o;j._rect=cc.rectPixelsToPoints(o);j._offsetInPixels.x=m.x;j._offsetInPixels.y=m.y;cc._pointPixelsToPointsOut(j._offsetInPixels,j._offset);j._originalSizeInPixels.width=k.width;j._originalSizeInPixels.height=k.height;cc._sizePixelsToPointsOut(j._originalSizeInPixels,j._originalSize);j._rotated=n;return j};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(d){return(d=this._CCNS_REG2.exec(d))?cc.rect(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4])):cc.rect(0,0,0,0)},_pointFromString:function(d){return(d=this._CCNS_REG1.exec(d))?cc.p(parseFloat(d[1]),parseFloat(d[2])):cc.p(0,0)},_sizeFromString:function(d){return(d=this._CCNS_REG1.exec(d))?cc.size(parseFloat(d[1]),parseFloat(d[2])):cc.size(0,0)},_getFrameConfig:function(f){var e=cc.loader.getRes(f);cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,f);cc.loader.release(f);if(e._inited){return this._frameConfigCache[f]=e}this._frameConfigCache[f]=this._parseFrameConfig(e);return this._frameConfigCache[f]},_getFrameConfigByJsonObject:function(f,e){cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,f);this._frameConfigCache[f]=this._parseFrameConfig(e);return this._frameConfigCache[f]},_parseFrameConfig:function(w){var v=w.frames,u=w.metadata||w.meta;w={};var t={},s=0;u&&(s=u.format,s=1>=s.length?parseInt(s):s,t.image=u.textureFileName||u.textureFileName||u.image);for(var r in v){var p=v[r];if(p){u={};if(0==s){u.rect=cc.rect(p.x,p.y,p.width,p.height);u.rotated=!1;u.offset=cc.p(p.offsetX,p.offsetY);var o=p.originalWidth,p=p.originalHeight;o&&p||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig);o=Math.abs(o);p=Math.abs(p);u.size=cc.size(o,p)}else{if(1==s||2==s){u.rect=this._rectFromString(p.frame),u.rotated=p.rotated||!1,u.offset=this._pointFromString(p.offset),u.size=this._sizeFromString(p.sourceSize)}else{if(3==s){var o=this._sizeFromString(p.spriteSize),j=this._rectFromString(p.textureRect);o&&(j=cc.rect(j.x,j.y,o.width,o.height));u.rect=j;u.rotated=p.textureRotated||!1;u.offset=this._pointFromString(p.spriteOffset);u.size=this._sizeFromString(p.spriteSourceSize);u.aliases=p.aliases}else{o=p.frame,j=p.sourceSize,r=p.filename||r,u.rect=cc.rect(o.x,o.y,o.w,o.h),u.rotated=p.rotated||!1,u.offset=cc.p(0,0),u.size=cc.size(j.w,j.h)}}}w[r]=u}}return{_inited:!0,frames:w,meta:t}},_addSpriteFramesByObject:function(h,g,f){cc.assert(h,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);g&&g.frames&&(g=this._frameConfigCache[h]||this._getFrameConfigByJsonObject(h,g),this._createSpriteFrames(h,g,f))},_createSpriteFrames:function(y,x,w){var v=x.frames;x=x.meta;w?w instanceof cc.Texture2D||(cc.isString(w)?w=cc.textureCache.addImage(w):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(w=cc.path.changeBasename(y,x.image||".png"),w=cc.textureCache.addImage(w));y=this._spriteFramesAliases;x=this._spriteFrames;for(var u in v){var t=v[u],s=x[u];if(!s){s=new cc.SpriteFrame(w,t.rect,t.rotated,t.offset,t.size);if(t=t.aliases){for(var r=0,o=t.length;r<o;r++){var j=t[r];y[j]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,j);y[j]=u}}cc._renderType===cc.game.RENDER_TYPE_CANVAS&&s.isRotated()&&s.getTexture().isLoaded()&&(t=s.getTexture().getHtmlElementObj(),t=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(t,s.getRectInPixels()),r=new cc.Texture2D,r.initWithElement(t),r.handleLoadedTexture(),s.setTexture(r),t=s._rect,s.setRect(cc.rect(0,0,t.width,t.height)));x[u]=s}}},addSpriteFrames:function(h,g){cc.assert(h,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var f=this._frameConfigCache[h]||cc.loader.getRes(h);f&&f.frames&&(f=this._frameConfigCache[h]||this._getFrameConfig(h),this._createSpriteFrames(h,f,g))},_checkConflict:function(f){f=f.frames;for(var e in f){this._spriteFrames[e]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,e)}},addSpriteFrame:function(f,e){this._spriteFrames[e]=f},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(d){d&&(this._spriteFramesAliases[d]&&delete this._spriteFramesAliases[d],this._spriteFrames[d]&&delete this._spriteFrames[d])},removeSpriteFramesFromFile:function(n){var m=this._spriteFrames,k=this._spriteFramesAliases;if(n=this._frameConfigCache[n]){n=n.frames;for(var j in n){if(m[j]){delete m[j];for(var h in k){k[h]===j&&delete k[h]}}}}},removeSpriteFramesFromTexture:function(p){var o=this._spriteFrames,n=this._spriteFramesAliases,m;for(m in o){var k=o[m];if(k&&k.getTexture()===p){delete o[m];for(var j in n){n[j]===m&&delete n[j]}}}},getSpriteFrame:function(h){var g=this._spriteFrames[h];if(!g){var f=this._spriteFramesAliases[h];f&&((g=this._spriteFrames[f.toString()])||delete this._spriteFramesAliases[h])}return g},_clear:function(){this._spriteFrames={};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var d=this._valueDict;d["cocos2d.x.version"]=cc.ENGINE_VERSION;d["cocos2d.x.compiled_with_profiler"]=!1;d["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE;this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return !1},supportsS3TC:function(){return !1},supportsATITC:function(){return !1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(d){return -1<this._GlExtensions.indexOf(d)},getValue:function(h,g){this._inited||this._init();var f=this._valueDict;return f[h]?f[h]:g},setValue:function(f,e){this._valueDict[f]=e},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var k=cc._renderContext,j=this._valueDict;j["gl.vendor"]=k.getParameter(k.VENDOR);j["gl.renderer"]=k.getParameter(k.RENDERER);j["gl.version"]=k.getParameter(k.VERSION);this._GlExtensions="";for(var h=k.getSupportedExtensions(),g=0;g<h.length;g++){this._GlExtensions+=h[g]+" "}this._maxTextureSize=k.getParameter(k.MAX_TEXTURE_SIZE);j["gl.max_texture_size"]=this._maxTextureSize;this._maxTextureUnits=k.getParameter(k.MAX_COMBINED_TEXTURE_IMAGE_UNITS);j["gl.max_texture_units"]=this._maxTextureUnits;this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc");j["gl.supports_PVRTC"]=this._supportsPVRTC;this._supportsNPOT=!1;j["gl.supports_NPOT"]=this._supportsNPOT;this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888");j["gl.supports_BGRA8888"]=this._supportsBGRA8888;this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer");j["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer;this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object");j["gl.supports_vertex_array_object"]=this._supportsShareableVAO;cc.checkGLErrorDebug()}},loadConfigFile:function(h){this._inited||this._init();var g=cc.loader.getRes(h);if(!g){throw Error("Please load the resource first : "+h)}cc.assert(g,cc._LogInfos.configuration_loadConfigFile_2,h);if(g=g.data){for(var f in g){this._valueDict[f]=g[f]}}else{cc.log(cc._LogInfos.configuration_loadConfigFile,h)}}};cc.g_NumberOfDraws=0;cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var d=this;d._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){d._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._totalFrames=0;this._lastUpdate=Date.now();this._purgeDirectorInNextLoop=this._paused=!1;this._winSizeInPoints=cc.size(0,0);this._openGLView=null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null;this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);this._eventProjectionChanged.setUserData(this);return !0},calculateDeltaTime:function(){var d=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(d-this._lastUpdate)/1000;0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&0.2<this._deltaTime&&(this._deltaTime=1/60);this._lastUpdate=d},convertToGL:function(k){var j=document.documentElement,h=cc.view,g=element.getBoundingClientRect();g.left+=window.pageXOffset-j.clientLeft;g.top+=window.pageYOffset-j.clientTop;j=h._devicePixelRatio*(k.x-g.left);k=h._devicePixelRatio*(g.top+g.height-k.y);return h._isRotated?{x:h._viewPortRect.width-k,y:j}:{x:j,y:k}},convertToUI:function(k){var j=document.documentElement,h=cc.view,g=element.getBoundingClientRect();g.left+=window.pageXOffset-j.clientLeft;g.top+=window.pageYOffset-j.clientTop;j={x:0,y:0};h._isRotated?(j.x=g.left+k.y/h._devicePixelRatio,j.y=g.top+g.height-(h._viewPortRect.width-k.x)/h._devicePixelRatio):(j.x=g.left+k.x/h._devicePixelRatio,j.y=g.top+g.height-k.y/h._devicePixelRatio);return j},drawScene:function(){var d=cc.renderer;this.calculateDeltaTime();this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate));this._nextScene&&this.setNextScene();this._beforeVisitScene&&this._beforeVisitScene();this._runningScene&&(!0===d.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),d.resetFlag()):!0===d.transformDirty()&&d.transform());d.clear();this._notificationNode&&this._notificationNode.visit();cc.eventManager.dispatchEvent(this._eventAfterVisit);cc.g_NumberOfDraws=0;this._afterVisitScene&&this._afterVisitScene();d.rendering(cc._renderContext);this._totalFrames++;cc.eventManager.dispatchEvent(this._eventAfterDraw);this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(0.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var d=this._scenesStack.length;0===d?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[d-1])},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll();cc.eventManager&&cc.eventManager.setEnabled(!1);this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup());this._nextScene=this._runningScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(d){cc.assert(d,cc._LogInfos.Director_pushScene);this._sendCleanupToScene=!1;this._scenesStack.push(d);this._nextScene=d},runScene:function(f){cc.assert(f,cc._LogInfos.Director_pushScene);if(this._runningScene){var e=this._scenesStack.length;0===e?(this._sendCleanupToScene=!0,this._scenesStack[e]=f):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=f);this._nextScene=f}else{this.pushScene(f),this.startAnimation()}},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(d){d!==this._contentScaleFactor&&(this._contentScaleFactor=d)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(d){this._nextDeltaTimeZero=d},setNextScene:function(){var f=!1,e=!1;cc.TransitionScene&&(f=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,e=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!e){if(e=this._runningScene){e.onExitTransitionDidStart(),e.onExit()}this._sendCleanupToScene&&e&&e.cleanup()}this._runningScene=this._nextScene;cc.renderer.childrenOrderDirty=!0;this._nextScene=null;f||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(d){cc.renderer.childrenOrderDirty=!0;this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup());if(this._notificationNode=d){this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish()}},getDelegate:function(){return this._projectionDelegate},setDelegate:function(d){this._projectionDelegate=d},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return cc.profiler?cc.profiler.isShowingStats():!1},setDisplayStats:function(d){cc.profiler&&(d?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(k){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var j=this._scenesStack,h=j.length;if(0===k){this.end()}else{if(!(k>=h)){for(;h>k;){var g=j.pop();g.running&&(g.onExitTransitionDidStart(),g.onExit());g.cleanup();h--}this._nextScene=j[j.length-1];this._sendCleanupToScene=!0}}},getScheduler:function(){return this._scheduler},setScheduler:function(d){this._scheduler!==d&&(this._scheduler=d)},getActionManager:function(){return this._actionManager},setActionManager:function(d){this._actionManager!==d&&(this._actionManager=d)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1000}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_UPDATE="director_after_update";cc.Director.EVENT_AFTER_VISIT="director_after_visit";cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0;this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(d){this._animationInterval=d;this.invalid||(this.stopAnimation(),this.startAnimation())}});cc.Director.sharedDirector=null;cc.Director.firstUseDirector=!0;cc.Director._getInstance=function(){cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init());return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var d=cc.Director.prototype;d.getProjection=function(e){return this._projection};d.setProjection=function(e){this._projection=e;cc.eventManager.dispatchEvent(this._eventProjectionChanged)};d.setDepthTest=function(){};d.setClearColor=function(e){cc.renderer._clearColor=e;cc.renderer._clearFillStyle="rgb("+e.r+","+e.g+","+e.b+")"};d.setOpenGLView=function(e){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=e||cc.view;cc.eventManager&&cc.eventManager.setEnabled(!0)};d.getVisibleSize=function(){return this.getWinSize()};d.getVisibleOrigin=function(){return cc.p(0,0)}}else{cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)}});cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var f=cc.Director.prototype,e=function(g){if(g&&g._renderCmd){g._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var d=g._children;for(g=0;g<d.length;g++){e(d[g])}}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var g=cc.director._scenesStack,d=0;d<g.length;d++){e(g[d])}});f.setProjection=function(u){var s=this._winSizeInPoints;this.setViewport();var r=this._openGLView,p=r._viewPortRect.x/r._scaleX,o=r._viewPortRect.y/r._scaleY;switch(u){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();r=cc.math.Matrix4.createOrthographicProjection(0,s.width,0,s.height,-1024,1024);cc.kmGLMultMatrix(r);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var j=this.getZEye(),t=new cc.math.Matrix4,r=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();t=cc.math.Matrix4.createPerspectiveProjection(60,s.width/s.height,0.1,2*j);cc.kmGLMultMatrix(t);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();j=new cc.math.Vec3(-p+s.width/2,-o+s.height/2,j);s=new cc.math.Vec3(-p+s.width/2,-o+s.height/2,0);p=new cc.math.Vec3(0,1,0);r.lookAt(j,s,p);cc.kmGLMultMatrix(r);break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.log(cc._LogInfos.Director_setProjection)}this._projection=u;cc.eventManager.dispatchEvent(this._eventProjectionChanged);cc.setProjectionMatrixDirty();cc.renderer.childrenOrderDirty=!0};f.setDepthTest=function(d){cc.renderer.setDepthTest(d)};f.setClearColor=function(d){cc.renderer._clearColor=d};f.setOpenGLView=function(d){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=d||cc.view;d=cc.configuration;d.gatherGPUInfo();d.dumpInfo();this.setGLDefaultValues();cc.eventManager&&cc.eventManager.setEnabled(!0)};f._clear=function(){var d=cc._renderContext;d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)};f.getVisibleSize=function(){return this._openGLView.getVisibleSize()};f.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()};f.getZEye=function(){return this._winSizeInPoints.height/1.1566};f.setViewport=function(){var h=this._openGLView;if(h){var g=this._winSizeInPoints;h.setViewPortInPoints(-h._viewPortRect.x/h._scaleX,-h._viewPortRect.y/h._scaleY,g.width,g.height)}};f.getOpenGLView=function(){return this._openGLView};f.getProjection=function(){return this._projection};f.setAlphaBlending=function(d){d?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)};f.setGLDefaultValues=function(){this.setAlphaBlending(!0);this.setProjection(this._projection);cc._renderContext.clearColor(0,0,0,0)}}});cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1;cc.ListEntry=function(s,r,p,o,n,m,j){this.prev=s;this.next=r;this.callback=p;this.target=o;this.priority=n;this.paused=m;this.markedForDeletion=j};cc.HashUpdateEntry=function(n,m,k,j,h){this.list=n;this.entry=m;this.target=k;this.callback=j;this.hh=h};cc.HashTimerEntry=cc.hashSelectorEntry=function(s,r,p,o,n,m,j){this.timers=s;this.target=r;this.timerIndex=p;this.currentTimer=o;this.currentTimerSalvaged=n;this.paused=m;this.hh=j};cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(d){this._interval=d},setupTimerWithInterval:function(h,g,f){this._elapsed=-1;this._interval=h;this._delay=f;this._useDelay=0<this._delay;this._repeat=g;this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null;this._elapsed=-1;this._useDelay=this._runForever=!1;this._interval=this._delay=this._repeat=this._timesExecuted=0},update:function(d){-1===this._elapsed?this._timesExecuted=this._elapsed=0:(this._elapsed+=d,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}});cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._selector=this._target=null},initWithSelector:function(p,o,n,m,k,j){this._scheduler=p;this._target=n;this._selector=o;this.setupTimerWithInterval(m,k,j);return !0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}});cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._callback=this._target=null},initWithCallback:function(s,r,p,o,n,m,j){this._scheduler=s;this._target=p;this._callback=r;this._key=o;this.setupTimerWithInterval(n,m,j);return !0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}});cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1;this._updatesNegList=[];this._updates0List=[];this._updatesPosList=[];this._hashForUpdates={};this._hashForTimers={};this._currentTarget=null;this._updateHashLocked=this._currentTargetSalvaged=!1;this._arrayForTimers=[]},_schedulePerFrame:function(n,m,k,j){var h=this._hashForUpdates[m.__instanceId];if(h&&h.entry){if(h.entry.priority!==k){if(this._updateHashLocked){cc.log("warning: you CANNOT change update priority in scheduled function");h.entry.markedForDeletion=!1;h.entry.paused=j;return}this.unscheduleUpdate(m)}else{h.entry.markedForDeletion=!1;h.entry.paused=j;return}}0===k?this._appendIn(this._updates0List,n,m,j):0>k?this._priorityIn(this._updatesNegList,n,m,k,j):this._priorityIn(this._updatesPosList,n,m,k,j)},_removeHashElement:function(d){delete this._hashForTimers[d.target.__instanceId];cc.arrayRemoveObject(this._arrayForTimers,d);d.Timer=null;d.target=null},_removeUpdateFromHash:function(d){if(d=this._hashForUpdates[d.target.__instanceId]){cc.arrayRemoveObject(d.list,d.entry),delete this._hashForUpdates[d.target.__instanceId],d.entry=null,d.target=null}},_priorityIn:function(p,o,n,m,k){o=new cc.ListEntry(null,null,o,n,m,k,!1);if(p){k=p.length-1;for(var j=0;j<=k&&!(m<p[j].priority);j++){}p.splice(j,0,o)}else{p=[],p.push(o)}this._hashForUpdates[n.__instanceId]=new cc.HashUpdateEntry(p,o,n,null);return p},_appendIn:function(k,j,h,g){j=new cc.ListEntry(null,null,j,h,0,g,!1);k.push(j);this._hashForUpdates[h.__instanceId]=new cc.HashUpdateEntry(k,j,h,null,null)},setTimeScale:function(d){this._timeScale=d},getTimeScale:function(){return this._timeScale},update:function(n){this._updateHashLocked=!0;1!==this._timeScale&&(n*=this._timeScale);var m,k,j,h;m=0;k=this._updatesNegList;for(j=k.length;m<j;m++){h=k[m],h.paused||h.markedForDeletion||h.callback(n)}m=0;k=this._updates0List;for(j=k.length;m<j;m++){h=k[m],h.paused||h.markedForDeletion||h.callback(n)}m=0;k=this._updatesPosList;for(j=k.length;m<j;m++){h=k[m],h.paused||h.markedForDeletion||h.callback(n)}j=this._arrayForTimers;for(m=0;m<j.length;m++){this._currentTarget=k=j[m];this._currentTargetSalvaged=!1;if(!k.paused){for(k.timerIndex=0;k.timerIndex<k.timers.length;++k.timerIndex){k.currentTimer=k.timers[k.timerIndex],k.currentTimerSalvaged=!1,k.currentTimer.update(n),k.currentTimer=null}}this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}m=0;for(k=this._updatesNegList;m<k.length;){h=k[m],h.markedForDeletion?this._removeUpdateFromHash(h):m++}m=0;for(k=this._updates0List;m<k.length;){h=k[m],h.markedForDeletion?this._removeUpdateFromHash(h):m++}m=0;for(k=this._updatesPosList;m<k.length;){h=k[m],h.markedForDeletion?this._removeUpdateFromHash(h):m++}this._updateHashLocked=!1;this._currentTarget=null},scheduleCallbackForTarget:function(p,o,n,m,k,j){this.schedule(o,p,n,m,k,j,p.__instanceId+"")},schedule:function(B,A,z,y,x,w,v){var u=!1;if("function"!==typeof B){var t=B,u=!0}if(!1===u){if(4===arguments.length||5===arguments.length){v=x,w=y,x=0,y=cc.REPEAT_FOREVER}}else{4===arguments.length&&(w=y,y=cc.REPEAT_FOREVER,x=0)}void 0===v&&(v=A.__instanceId+"");cc.assert(A,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);var o=this._hashForTimers[A.__instanceId];o?cc.assert(o.paused===w,""):(o=new cc.HashTimerEntry(null,A,0,null,null,w,null),this._arrayForTimers.push(o),this._hashForTimers[A.__instanceId]=o);var j,C;if(null==o.timers){o.timers=[]}else{if(!1===u){for(C=0;C<o.timers.length;C++){if(j=o.timers[C],B===j._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,j.getInterval().toFixed(4),z.toFixed(4));j._interval=z;return}}}else{for(C=0;C<o.timers.length;++C){if((j=o.timers[C])&&t===j.getSelector()){cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",j.getInterval(),z);j.setInterval(z);return}}}}!1===u?(j=new cc.TimerTargetCallback,j.initWithCallback(this,B,A,v,z,y,x)):(j=new cc.TimerTargetSelector,j.initWithSelector(this,t,A,z,y,x));o.timers.push(j)},scheduleUpdate:function(h,g,f){this._schedulePerFrame(function(c){h.update(c)},h,g,f)},_getUnscheduleMark:function(f,e){switch(typeof f){case"number":case"string":return f===e.getKey();case"function":return f===e._callback;default:return f===e.getSelector()}},unschedule:function(s,r){if(r&&s){var p=this._hashForTimers[r.__instanceId];if(p){for(var o=p.timers,n=0,m=o.length;n<m;n++){var j=o[n];if(this._getUnscheduleMark(s,j)){j!==p.currentTimer||p.currentTimerSalvaged||(p.currentTimerSalvaged=!0);o.splice(n,1);p.timerIndex>=n&&p.timerIndex--;0===o.length&&(this._currentTarget===p?this._currentTargetSalvaged=!0:this._removeHashElement(p));break}}}}},unscheduleUpdate:function(d){null!=d&&(d=this._hashForUpdates[d.__instanceId])&&(this._updateHashLocked?d.entry.markedForDeletion=!0:this._removeUpdateFromHash(d.entry))},unscheduleAllForTarget:function(f){if(null!=f){var e=this._hashForTimers[f.__instanceId];e&&(-1<e.timers.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e));this.unscheduleUpdate(f)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(k){var j,h,g=this._arrayForTimers;for(j=g.length-1;0<=j;j--){h=g[j],this.unscheduleAllForTarget(h.target)}g=0;if(0>k){for(j=0;j<this._updatesNegList.length;){g=this._updatesNegList.length,(h=this._updatesNegList[j])&&h.priority>=k&&this.unscheduleUpdate(h.target),g==this._updatesNegList.length&&j++}}if(0>=k){for(j=0;j<this._updates0List.length;){g=this._updates0List.length,(h=this._updates0List[j])&&this.unscheduleUpdate(h.target),g==this._updates0List.length&&j++}}for(j=0;j<this._updatesPosList.length;){g=this._updatesPosList.length,(h=this._updatesPosList[j])&&h.priority>=k&&this.unscheduleUpdate(h.target),g==this._updatesPosList.length&&j++}},isScheduled:function(k,j){cc.assert(k,"Argument key must not be empty");cc.assert(j,"Argument target must be non-nullptr");var h=this._hashForUpdates[j.__instanceId];if(!h){return !1}if(null!=h.timers){for(var h=h.timers,g=0;g<h.length;++g){if(k===h[g].getKey()){return !0}}}return !1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(p){var o=[],n,m=this._arrayForTimers,k,j;k=0;for(j=m.length;k<j;k++){if(n=m[k]){n.paused=!0,o.push(n.target)}}if(0>p){for(k=0;k<this._updatesNegList.length;k++){(n=this._updatesNegList[k])&&n.priority>=p&&(n.paused=!0,o.push(n.target))}}if(0>=p){for(k=0;k<this._updates0List.length;k++){if(n=this._updates0List[k]){n.paused=!0,o.push(n.target)}}}for(k=0;k<this._updatesPosList.length;k++){(n=this._updatesPosList[k])&&n.priority>=p&&(n.paused=!0,o.push(n.target))}return o},resumeTargets:function(f){if(f){for(var e=0;e<f.length;e++){this.resumeTarget(f[e])}}},pauseTarget:function(f){cc.assert(f,cc._LogInfos.Scheduler_pauseTarget);var e=this._hashForTimers[f.__instanceId];e&&(e.paused=!0);if(f=this._hashForUpdates[f.__instanceId]){f.entry.paused=!0}},resumeTarget:function(f){cc.assert(f,cc._LogInfos.Scheduler_resumeTarget);var e=this._hashForTimers[f.__instanceId];e&&(e.paused=!1);if(f=this._hashForUpdates[f.__instanceId]){f.entry.paused=!1}},isTargetPaused:function(f){cc.assert(f,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[f.__instanceId];return e?e.paused:(f=this._hashForUpdates[f.__instanceId])?f.entry.paused:!1},scheduleUpdateForTarget:function(h,g,f){this.scheduleUpdate(h,g,f)},unscheduleCallbackForTarget:function(f,e){this.unschedule(e,f)},unscheduleUpdateForTarget:function(d){this.unscheduleUpdate(d)},unscheduleAllCallbacksForTarget:function(d){this.unschedule(d.__instanceId+"",d)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(d){this.unscheduleAllWithMinPriority(d)}});cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc.PI2=2*Math.PI;cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(d){this._renderContext=d},drawPoint:function(n,m){m||(m=1);var k=cc.view.getScaleX(),j=cc.view.getScaleY(),j=cc.p(n.x*k,n.y*j),h=this._renderContext.getContext();h.beginPath();h.arc(j.x,-j.y,m*k,0,2*Math.PI,!1);h.closePath();h.fill()},drawPoints:function(s,r,p){if(null!=s){p||(p=1);r=this._renderContext.getContext();var o=cc.view.getScaleX(),n=cc.view.getScaleY();r.beginPath();for(var m=0,j=s.length;m<j;m++){r.arc(s[m].x*o,-s[m].y*n,p*o,0,2*Math.PI,!1)}r.closePath();r.fill()}},drawLine:function(n,m){var k=this._renderContext.getContext(),j=cc.view.getScaleX(),h=cc.view.getScaleY();k.beginPath();k.moveTo(n.x*j,-n.y*h);k.lineTo(m.x*j,-m.y*h);k.closePath();k.stroke()},drawRect:function(f,e){this.drawLine(cc.p(f.x,f.y),cc.p(e.x,f.y));this.drawLine(cc.p(e.x,f.y),cc.p(e.x,e.y));this.drawLine(cc.p(e.x,e.y),cc.p(f.x,e.y));this.drawLine(cc.p(f.x,e.y),cc.p(f.x,f.y))},drawSolidRect:function(h,g,f){h=[h,cc.p(g.x,h.y),g,cc.p(h.x,g.y)];this.drawSolidPoly(h,4,f)},drawPoly:function(u,t,s,r){r=r||!1;if(null!=u){if(3>u.length){throw Error("Polygon's point must greater than 2")}var p=u[0];t=this._renderContext.getContext();var o=cc.view.getScaleX(),n=cc.view.getScaleY();t.beginPath();t.moveTo(p.x*o,-p.y*n);for(var p=1,j=u.length;p<j;p++){t.lineTo(u[p].x*o,-u[p].y*n)}s&&t.closePath();r?t.fill():t.stroke()}},drawSolidPoly:function(h,g,f){this.setDrawColor(f.r,f.g,f.b,f.a);this.drawPoly(h,g,!0,!0)},drawCircle:function(s,r,p,o,n){n=n||!1;o=this._renderContext.getContext();var m=cc.view.getScaleX(),j=cc.view.getScaleY();o.beginPath();o.arc(0|s.x*m,0|-(s.y*j),r*m,-p,-(p-2*Math.PI),!1);n&&o.lineTo(0|s.x*m,0|-(s.y*j));o.stroke()},drawQuadBezier:function(w,v,u,t){for(var s=this._cacheArray,r=s.length=0,p=0;p<t;p++){var o=Math.pow(1-r,2)*w.x+2*(1-r)*r*v.x+r*r*u.x,j=Math.pow(1-r,2)*w.y+2*(1-r)*r*v.y+r*r*u.y;s.push(cc.p(o,j));r+=1/t}s.push(cc.p(u.x,u.y));this.drawPoly(s,t+1,!1,!1)},drawCubicBezier:function(y,x,w,v,u){for(var t=this._cacheArray,s=t.length=0,r=0;r<u;r++){var o=Math.pow(1-s,3)*y.x+3*Math.pow(1-s,2)*s*x.x+3*(1-s)*s*s*w.x+s*s*s*v.x,j=Math.pow(1-s,3)*y.y+3*Math.pow(1-s,2)*s*x.y+3*(1-s)*s*s*w.y+s*s*s*v.y;t.push(cc.p(o,j));s+=1/u}t.push(cc.p(v.x,v.y));this.drawPoly(t,u+1,!1,!1)},drawCatmullRom:function(f,e){this.drawCardinalSpline(f,0.5,e)},drawCardinalSpline:function(u,t,s){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var r=this._cacheArray;r.length=0;for(var p,o,n=1/u.length,j=0;j<s+1;j++){o=j/s,1===o?(p=u.length-1,o=1):(p=0|o/n,o=(o-n*p)/n),p=cc.CardinalSplineAt(cc.getControlPointAt(u,p-1),cc.getControlPointAt(u,p-0),cc.getControlPointAt(u,p+1),cc.getControlPointAt(u,p+2),t,o),r.push(p)}this.drawPoly(r,s+1,!1,!1)},drawImage:function(s,r,p,o,n){var m=arguments.length,j=this._renderContext.getContext();switch(m){case 2:j.drawImage(s,r.x,-(r.y+s.height));break;case 3:j.drawImage(s,r.x,-(r.y+p.height),p.width,p.height);break;case 5:j.drawImage(s,r.x,r.y,p.width,p.height,o.x,-(o.y+n.height),n.width,n.height);break;default:throw Error("Argument must be non-nil")}},drawStar:function(p,o,n){p=p||this._renderContext;var m=p.getContext();o*=cc.view.getScaleX();n="rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b);p.setFillStyle(n+",1)");var k=o/10;m.beginPath();m.moveTo(-o,o);m.lineTo(0,k);m.lineTo(o,o);m.lineTo(k,0);m.lineTo(o,-o);m.lineTo(0,-k);m.lineTo(-o,-o);m.lineTo(-k,0);m.lineTo(-o,o);m.closePath();m.fill();var j=m.createRadialGradient(0,0,k,0,0,o);j.addColorStop(0,n+", 1)");j.addColorStop(0.3,n+", 0.8)");j.addColorStop(1,n+", 0.0)");p.setFillStyle(j);m.beginPath();m.arc(0,0,o-k,0,cc.PI2,!1);m.closePath();m.fill()},drawColorBall:function(n,m,k){n=n||this._renderContext;var j=n.getContext();m*=cc.view.getScaleX();k="rgba("+(0|k.r)+","+(0|k.g)+","+(0|k.b);var h=j.createRadialGradient(0,0,m/10,0,0,m);h.addColorStop(0,k+", 1)");h.addColorStop(0.3,k+", 0.8)");h.addColorStop(0.6,k+", 0.4)");h.addColorStop(1,k+", 0.0)");n.setFillStyle(h);j.beginPath();j.arc(0,0,m,0,cc.PI2,!1);j.closePath();j.fill()},fillText:function(h,g,f){this._renderContext.getContext().fillText(h,g,-f)},setDrawColor:function(k,j,h,g){this._renderContext.setFillStyle("rgba("+k+","+j+","+h+","+g/255+")");this._renderContext.setStrokeStyle("rgba("+k+","+j+","+h+","+g/255+")")},setPointSize:function(d){},setLineWidth:function(d){this._renderContext.getContext().lineWidth=d*cc.view.getScaleX()}});cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(d){null==d&&(d=cc._renderContext);if(!d instanceof WebGLRenderingContext){throw Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext")}this._renderContext=d;this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(h){this.lazy_init();var g=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();g.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var f=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,f);g.bufferData(g.ARRAY_BUFFER,new Float32Array([h.x,h.y]),g.STATIC_DRAW);g.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,g.FLOAT,!1,0,0);g.drawArrays(g.POINTS,0,1);g.deleteBuffer(f);cc.incrementGLDraws(1)},drawPoints:function(k,j){if(k&&0!==k.length){this.lazy_init();var h=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();h.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var g=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,g);h.bufferData(h.ARRAY_BUFFER,this._pointsToTypeArray(k),h.STATIC_DRAW);h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0);h.drawArrays(h.POINTS,0,k.length);h.deleteBuffer(g);cc.incrementGLDraws(1)}},_pointsToTypeArray:function(h){for(var g=new Float32Array(2*h.length),f=0;f<h.length;f++){g[2*f]=h[f].x,g[2*f+1]=h[f].y}return g},drawLine:function(k,j){this.lazy_init();var h=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();h.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var g=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,g);h.bufferData(h.ARRAY_BUFFER,this._pointsToTypeArray([k,j]),h.STATIC_DRAW);h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0);h.drawArrays(h.LINES,0,2);h.deleteBuffer(g);cc.incrementGLDraws(1)},drawRect:function(f,e){this.drawLine(cc.p(f.x,f.y),cc.p(e.x,f.y));this.drawLine(cc.p(e.x,f.y),cc.p(e.x,e.y));this.drawLine(cc.p(e.x,e.y),cc.p(f.x,e.y));this.drawLine(cc.p(f.x,e.y),cc.p(f.x,f.y))},drawSolidRect:function(h,g,f){h=[h,cc.p(g.x,h.y),g,cc.p(h.x,g.y)];this.drawSolidPoly(h,4,f)},drawPoly:function(k,j,h){this.lazy_init();j=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();j.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var g=j.createBuffer();j.bindBuffer(j.ARRAY_BUFFER,g);j.bufferData(j.ARRAY_BUFFER,this._pointsToTypeArray(k),j.STATIC_DRAW);j.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,j.FLOAT,!1,0,0);h?j.drawArrays(j.LINE_LOOP,0,k.length):j.drawArrays(j.LINE_STRIP,0,k.length);j.deleteBuffer(g);cc.incrementGLDraws(1)},drawSolidPoly:function(h,g,f){this.lazy_init();f&&this.setDrawColor(f.r,f.g,f.b,f.a);g=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();g.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);f=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,f);g.bufferData(g.ARRAY_BUFFER,this._pointsToTypeArray(h),g.STATIC_DRAW);g.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,g.FLOAT,!1,0,0);g.drawArrays(g.TRIANGLE_FAN,0,h.length);g.deleteBuffer(f);cc.incrementGLDraws(1)},drawCircle:function(y,x,w,v,u){this.lazy_init();var t=1;u&&t++;var s=2*Math.PI/v;if(u=new Float32Array(2*(v+2))){for(var r=0;r<=v;r++){var o=r*s,j=x*Math.cos(o+w)+y.x,o=x*Math.sin(o+w)+y.y;u[2*r]=j;u[2*r+1]=o}u[2*(v+1)]=y.x;u[2*(v+1)+1]=y.y;y=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();y.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);x=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,x);y.bufferData(y.ARRAY_BUFFER,u,y.STATIC_DRAW);y.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,y.FLOAT,!1,0,0);y.drawArrays(y.LINE_STRIP,0,v+t);y.deleteBuffer(x);cc.incrementGLDraws(1)}},drawQuadBezier:function(s,r,p,o){this.lazy_init();for(var n=new Float32Array(2*(o+1)),m=0,j=0;j<o;j++){n[2*j]=Math.pow(1-m,2)*s.x+2*(1-m)*m*r.x+m*m*p.x,n[2*j+1]=Math.pow(1-m,2)*s.y+2*(1-m)*m*r.y+m*m*p.y,m+=1/o}n[2*o]=p.x;n[2*o+1]=p.y;s=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();s.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);r=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,r);s.bufferData(s.ARRAY_BUFFER,n,s.STATIC_DRAW);s.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,0);s.drawArrays(s.LINE_STRIP,0,o+1);s.deleteBuffer(r);cc.incrementGLDraws(1)},drawCubicBezier:function(u,t,s,r,p){this.lazy_init();for(var o=new Float32Array(2*(p+1)),n=0,j=0;j<p;j++){o[2*j]=Math.pow(1-n,3)*u.x+3*Math.pow(1-n,2)*n*t.x+3*(1-n)*n*n*s.x+n*n*n*r.x,o[2*j+1]=Math.pow(1-n,3)*u.y+3*Math.pow(1-n,2)*n*t.y+3*(1-n)*n*n*s.y+n*n*n*r.y,n+=1/p}o[2*p]=r.x;o[2*p+1]=r.y;u=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();u.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);t=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t);u.bufferData(u.ARRAY_BUFFER,o,u.STATIC_DRAW);u.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0);u.drawArrays(u.LINE_STRIP,0,p+1);u.deleteBuffer(t);cc.incrementGLDraws(1)},drawCatmullRom:function(f,e){this.drawCardinalSpline(f,0.5,e)},drawCardinalSpline:function(u,t,s){this.lazy_init();for(var r=new Float32Array(2*(s+1)),p,o,n=1/u.length,j=0;j<s+1;j++){o=j/s,1===o?(p=u.length-1,o=1):(p=0|o/n,o=(o-n*p)/n),p=cc.cardinalSplineAt(cc.getControlPointAt(u,p-1),cc.getControlPointAt(u,p),cc.getControlPointAt(u,p+1),cc.getControlPointAt(u,p+2),t,o),r[2*j]=p.x,r[2*j+1]=p.y}u=this._renderContext;this._shader.use();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();u.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);t=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,t);u.bufferData(u.ARRAY_BUFFER,r,u.STATIC_DRAW);u.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0);u.drawArrays(u.LINE_STRIP,0,s+1);u.deleteBuffer(t);cc.incrementGLDraws(1)},setDrawColor:function(k,j,h,g){this._colorArray[0]=k/255;this._colorArray[1]=j/255;this._colorArray[2]=h/255;this._colorArray[3]=g/255},setPointSize:function(d){this._pointSize=d*cc.contentScaleFactor()},setLineWidth:function(d){this._renderContext.lineWidth&&this._renderContext.lineWidth(d)}});cc._tmp.PrototypeLabelTTF=function(){var d=cc.LabelTTF.prototype;cc.defineGetterSetter(d,"color",d.getColor,d.setColor);cc.defineGetterSetter(d,"opacity",d.getOpacity,d.setOpacity);cc.defineGetterSetter(d,"string",d.getString,d.setString);cc.defineGetterSetter(d,"textAlign",d.getHorizontalAlignment,d.setHorizontalAlignment);cc.defineGetterSetter(d,"verticalAlign",d.getVerticalAlignment,d.setVerticalAlignment);cc.defineGetterSetter(d,"fontSize",d.getFontSize,d.setFontSize);cc.defineGetterSetter(d,"fontName",d.getFontName,d.setFontName);cc.defineGetterSetter(d,"font",d._getFont,d._setFont);cc.defineGetterSetter(d,"boundingWidth",d._getBoundingWidth,d._setBoundingWidth);cc.defineGetterSetter(d,"boundingHeight",d._getBoundingHeight,d._setBoundingHeight);cc.defineGetterSetter(d,"fillStyle",d._getFillStyle,d.setFontFillColor);cc.defineGetterSetter(d,"strokeStyle",d._getStrokeStyle,d._setStrokeStyle);cc.defineGetterSetter(d,"lineWidth",d._getLineWidth,d._setLineWidth);cc.defineGetterSetter(d,"shadowOffsetX",d._getShadowOffsetX,d._setShadowOffsetX);cc.defineGetterSetter(d,"shadowOffsetY",d._getShadowOffsetY,d._setShadowOffsetY);cc.defineGetterSetter(d,"shadowOpacity",d._getShadowOpacity,d._setShadowOpacity);cc.defineGetterSetter(d,"shadowBlur",d._getShadowBlur,d._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(p,o,n,m,k,j){p=p?p+"":"";n=n||16;m=m||cc.size(0,0);k=k||cc.TEXT_ALIGNMENT_LEFT;j=j||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._dimensions=cc.size(m.width,m.height);this._fontName=o||"Arial";this._hAlignment=k;this._vAlignment=j;this._fontSize=n;this._renderCmd._setFontStyle(this._fontName,n,this._fontStyle,this._fontWeight);this.string=p;this._renderCmd._setColorsString();this._renderCmd._updateTexture();this._setUpdateTextureDirty();this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio();return !0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(p,o,n,m,k,j){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._fontName="Arial";this._shadowEnabled=!1;this._shadowOffset=cc.p(0,0);this._shadowBlur=this._shadowOpacity=0;this._strokeEnabled=!1;this._strokeColor=cc.color(255,255,255,255);this._strokeSize=0;this._textFillColor=cc.color(255,255,255,255);this._strokeShadowOffsetY=this._strokeShadowOffsetX=0;this._needUpdateTexture=!1;this._lineWidths=[];this._renderCmd._setColorsString();this._textureLoaded=!0;o&&o instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(p,o):cc.LabelTTF.prototype.initWithString.call(this,p,o,n,m,k,j)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"\x3ccc.LabelTTF | FontName \x3d"+this._fontName+" FontSize \x3d "+this._fontSize.toFixed(1)+"\x3e"},getLineHeight:function(){return !this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(d){this._lineHeight=d},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(f,e){this._updateWithTextDefinition(e,!1);this.string=f;return !0},setTextDefinition:function(d){d&&this._updateWithTextDefinition(d,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(k,j,h,g){null!=k.r&&null!=k.g&&null!=k.b&&null!=k.a?this._enableShadow(k,j,h):this._enableShadowNoneColor(k,j,h,g)},_enableShadowNoneColor:function(n,m,k,j){k=k||0.5;!1===this._shadowEnabled&&(this._shadowEnabled=!0);var h=this._shadowOffset;if(h&&h.x!==n||h._y!==m){h.x=n,h.y=m}this._shadowOpacity!==k&&(this._shadowOpacity=k);this._renderCmd._setColorsString();this._shadowBlur!==j&&(this._shadowBlur=j);this._setUpdateTextureDirty()},_enableShadow:function(h,g,f){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128));this._shadowColor.r=h.r;this._shadowColor.g=h.g;this._shadowColor.b=h.b;this._enableShadowNoneColor(g.width||g.x||0,g.height||g.y||0,null!=h.a?h.a/255:0.5,f)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(d){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset.x!==d&&(this._shadowOffset.x=d,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(d){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset._y!==d&&(this._shadowOffset._y=d,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(d){!1===this._shadowEnabled&&(this._shadowEnabled=!0);if(this._shadowOffset.x!==d.x||this._shadowOffset.y!==d.y){this._shadowOffset.x=d.x,this._shadowOffset.y=d.y,this._setUpdateTextureDirty()}},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(d){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOpacity!==d&&(this._shadowOpacity=d,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(d){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowBlur!==d&&(this._shadowBlur=d,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(h,g){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var f=this._strokeColor;if(f.r!==h.r||f.g!==h.g||f.b!==h.b){f.r=h.r,f.g=h.g,f.b=h.b,this._renderCmd._setColorsString()}this._strokeSize!==g&&(this._strokeSize=g||0);this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(f){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var e=this._strokeColor;if(e.r!==f.r||e.g!==f.g||e.b!==f.b){e.r=f.r,e.g=f.g,e.b=f.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty()}},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(d){!1===this._strokeEnabled&&(this._strokeEnabled=!0);this._strokeSize!==d&&(this._strokeSize=d||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(f){var e=this._textFillColor;if(e.r!==f.r||e.g!==f.g||e.b!==f.b){e.r=f.r,e.g=f.g,e.b=f.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0}},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(h,g){h.fontDimensions?(this._dimensions.width=h.boundingWidth,this._dimensions.height=h.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0);this._hAlignment=h.textAlign;this._vAlignment=h.verticalAlign;this._fontName=h.fontName;this._fontSize=h.fontSize||12;this._lineHeight=h.lineHeight?h.lineHeight:this._fontSize;this._renderCmd._setFontStyle(h);h.shadowEnabled&&this.enableShadow(h.shadowOffsetX,h.shadowOffsetY,h.shadowOpacity,h.shadowBlur);h.strokeEnabled&&this.enableStroke(h.strokeStyle,h.lineWidth);this.setFontFillColor(h.fillStyle);g&&this._renderCmd._updateTexture();var f=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(f.colorDirty|f.opacityDirty|f.textDirty)},_prepareTextDefinition:function(h){var g=new cc.FontDefinition;h?(g.fontSize=this._fontSize,g.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,g.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(g.fontSize=this._fontSize,g.boundingWidth=this._dimensions.width,g.boundingHeight=this._dimensions.height);g.fontName=this._fontName;g.textAlign=this._hAlignment;g.verticalAlign=this._vAlignment;if(this._strokeEnabled){g.strokeEnabled=!0;var f=this._strokeColor;g.strokeStyle=cc.color(f.r,f.g,f.b);g.lineWidth=this._strokeSize}else{g.strokeEnabled=!1}this._shadowEnabled?(g.shadowEnabled=!0,g.shadowBlur=this._shadowBlur,g.shadowOpacity=this._shadowOpacity,g.shadowOffsetX=(h?cc.contentScaleFactor():1)*this._shadowOffset.x,g.shadowOffsetY=(h?cc.contentScaleFactor():1)*this._shadowOffset.y):g._shadowEnabled=!1;h=this._textFillColor;g.fillStyle=cc.color(h.r,h.g,h.b);return g},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX*cc.view.getDevicePixelRatio()},setScale:function(f,e){this._scaleX=f/cc.view.getDevicePixelRatio();this._scaleY=(e||0===e?e:f)/cc.view.getDevicePixelRatio();this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(d){this._scaleX=d/cc.view.getDevicePixelRatio();this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(d){this._scaleY=d/cc.view.getDevicePixelRatio();this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(d){d=String(d);this._originalText!==d&&(this._originalText=d+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0);this._string=this._originalText},setHorizontalAlignment:function(d){d!==this._hAlignment&&(this._hAlignment=d,this._setUpdateTextureDirty())},setVerticalAlignment:function(d){d!==this._vAlignment&&(this._vAlignment=d,this._setUpdateTextureDirty())},setDimensions:function(h,g){var f;void 0===g?(f=h.width,g=h.height):f=h;if(f!==this._dimensions.width||g!==this._dimensions.height){this._dimensions.width=f,this._dimensions.height=g,this._updateString(),this._setUpdateTextureDirty()}},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(d){d!==this._dimensions.width&&(this._dimensions.width=d,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(d){d!==this._dimensions.height&&(this._dimensions.height=d,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(d){this._fontSize!==d&&(this._fontSize=d,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(d){this._fontName&&this._fontName!==d&&(this._fontName=d,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(d){if(d=cc.LabelTTF._fontStyleRE.exec(d)){this._fontSize=parseInt(d[1]),this._fontName=d[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty()}},getContentSize:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return cc.size(this._contentSize)},_getWidth:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return this._contentSize.width},_getHeight:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return this._contentSize.height},setTextureRect:function(h,g,f){cc.Sprite.prototype.setTextureRect.call(this,h,g,f,!1)},setDrawMode:function(d){this._onCacheCanvasMode=d},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new cc.LabelTTF.CacheCanvasRenderCmd(this):new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(d){this._fontStyle!==d&&(this._fontStyle=d,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(d){this._fontWeight!==d&&(this._fontWeight=d,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}});cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;cc.LabelTTF.create=function(p,o,n,m,k,j){return new cc.LabelTTF(p,o,n,m,k,j)};cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create;cc.LabelTTF.__labelHeightDiv=document.createElement("div");cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial";cc.LabelTTF.__labelHeightDiv.style.position="absolute";cc.LabelTTF.__labelHeightDiv.style.left="-100px";cc.LabelTTF.__labelHeightDiv.style.top="-100px";cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal";document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1);cc.LabelTTF.__getFontHeightByDiv=function(k,j){var h,g=cc.LabelTTF.__labelHeightDiv;if(k instanceof cc.FontDefinition){h=cc.LabelTTF.__fontHeightCache[k._getCanvasFontStr()];if(0<h){return h}g.innerHTML="ajghl~!";g.style.fontFamily=k.fontName;g.style.fontSize=k.fontSize+"px";g.style.fontStyle=k.fontStyle;g.style.fontWeight=k.fontWeight;h=g.clientHeight;cc.LabelTTF.__fontHeightCache[k._getCanvasFontStr()]=h}else{h=cc.LabelTTF.__fontHeightCache[k+"."+j];if(0<h){return h}g.innerHTML="ajghl~!";g.style.fontFamily=k;g.style.fontSize=j+"px";h=g.clientHeight;cc.LabelTTF.__fontHeightCache[k+"."+j]=h}g.innerHTML="";return h};cc.LabelTTF.__fontHeightCache={};cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF.wrapInspection=!0;cc.LabelTTF._wordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)/;cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>\u3001\u2018\u201c\u300b\uff1f\u3002\uff0c\uff01]/;cc.LabelTTF._lastWordRex=/([a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+|\S)$/;cc.LabelTTF._lastEnglish=/[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]+$/;cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9\u00c4\u00d6\u00dc\u00e4\u00f6\u00fc\u00df\u00e9\u00e8\u00e7\u00e0\u00f9\u00ea\u00e2\u00ee\u00f4\u00fb]/;(function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18;this._fontStyleStr="";this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeColorStr="";this._fillColorStr="rgba(255,255,255,1)";this._labelContext=this._labelCanvas=null;this._lineWidths=[];this._strings=[];this._isMultiLine=!1;this._status=[];this._renderingIndex=0;this._texRect=cc.rect()};var d=cc.LabelTTF.RenderCmd.prototype;d.constructor=cc.LabelTTF.RenderCmd;d._setFontStyle=function(o,n,m,k){if(o instanceof cc.FontDefinition){this._fontStyleStr=o._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(o)}else{var j=n*cc.view.getDevicePixelRatio();this._fontStyleStr=m+" "+k+" "+j+"px '"+o+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(o,n)}};d._getFontStyle=function(){return this._fontStyleStr};d._getFontClientHeight=function(){return this._fontClientHeight};d._updateColor=function(){this._setColorsString();this._updateTexture()};d._setColorsString=function(){var t=this._displayedColor,s=this._node,r=s._shadowColor||this._displayedColor,p=s._strokeColor,o=s._textFillColor,n=t.r/255,j=t.g/255,t=t.b/255;this._shadowColorStr="rgba("+(0|n*r.r)+","+(0|j*r.g)+","+(0|t*r.b)+","+s._shadowOpacity+")";this._fillColorStr="rgba("+(0|n*o.r)+","+(0|j*o.g)+","+(0|t*o.b)+", 1)";this._strokeColorStr="rgba("+(0|n*p.r)+","+(0|j*p.g)+","+(0|t*p.b)+", 1)"};d._updateTTF=function(){var t=this._node,s=cc.view.getDevicePixelRatio(),r=t._dimensions.width*s,p,o,n=this._lineWidths;n.length=0;this._isMultiLine=!1;this._measureConfig();if(0!==r){for(this._strings=t._string.split("\n"),p=0;p<this._strings.length;p++){this._checkWarp(this._strings,p,r)}}else{for(this._strings=t._string.split("\n"),p=0,o=this._strings.length;p<o;p++){n.push(this._measure(this._strings[p]))}}1<this._strings.length&&(this._isMultiLine=!0);o=p=0;t._strokeEnabled&&(p=o=2*t._strokeSize);if(t._shadowEnabled){var j=t._shadowOffset;p+=2*Math.abs(j.x);o+=2*Math.abs(j.y)}r=0===r?this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,n)+p),Math.ceil(this._fontClientHeight*s*this._strings.length+o)):cc.size(Math.ceil(this._measure(t._string)+p),Math.ceil(this._fontClientHeight*s+o)):0===t._dimensions.height?this._isMultiLine?cc.size(Math.ceil(r+p),Math.ceil(t.getLineHeight()*s*this._strings.length+o)):cc.size(Math.ceil(r+p),Math.ceil(t.getLineHeight()*s+o)):cc.size(Math.ceil(r+p),Math.ceil(t._dimensions.height*s+o));"normal"!==t._getFontStyle()&&(r.width=Math.ceil(r.width+0.3*t._fontSize));0===this._strings.length?(this._texRect.width=1,this._texRect.height=r.height||1):(this._texRect.width=r.width,this._texRect.height=r.height);t.setContentSize(r.width/s,r.height/s);t._strokeShadowOffsetX=p;t._strokeShadowOffsetY=o;t=t._anchorPoint;this._anchorPointInPoints.x=0.5*p+(r.width-p)*t.x;this._anchorPointInPoints.y=0.5*o+(r.height-o)*t.y};d._saveStatus=function(){var A=this._node,z=cc.view.getDevicePixelRatio(),y=A._strokeShadowOffsetX,x=A._strokeShadowOffsetY,w=A._contentSize.height*z-x,v=A._vAlignment,u=A._hAlignment,t=0.5*y,x=w+0.5*x,o=0,j=0,B=[],y=A._contentSize.width*z-y,A=A.getLineHeight()*z,z=(A-this._fontClientHeight*z)/2,o=u===cc.TEXT_ALIGNMENT_RIGHT?o+y:u===cc.TEXT_ALIGNMENT_CENTER?o+y/2:o+0;if(this._isMultiLine){for(u=this._strings.length,v===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?j=A-2*z+w-A*u:v===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(j=(A-2*z)/2+(w-A*u)/2),v=0;v<u;v++){B.push(-w+(A*v+z)+j)}}else{v!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(j=v===cc.VERTICAL_TEXT_ALIGNMENT_TOP?j-w:j-0.5*w),B.push(j)}w={contextTransform:cc.p(t,x),xOffset:o,OffsetYArray:B};this._status.push(w)};d._drawTTFInCanvas=function(g){if(g){var f=this._status.pop();g.setTransform(1,0,0,1,f.contextTransform.x,f.contextTransform.y);this.drawLabels(g,f.xOffset,f.OffsetYArray)}};d._checkWarp=function(A,z,y){var x=A[z],w=this._measure(x);if(w>y&&1<x.length){for(var v=y/w*x.length|0,u=x.substr(v),t=w-this._measure(u),o,j=0,B=0;t>y&&100>B++;){v*=y/t,v|=0,u=x.substr(v),t=w-this._measure(u)}for(B=0;t<y&&100>B++;){u&&(j=(o=cc.LabelTTF._wordRex.exec(u))?o[0].length:1,o=u),v+=j,u=x.substr(v),t=w-this._measure(u)}v-=j;0===v&&(v=1,o=o.substr(1));y=x.substr(0,v);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(o||u)&&(w=cc.LabelTTF._lastWordRex.exec(y),v-=w?w[0].length:0,0===v&&(v=1),o=x.substr(v),y=x.substr(0,v));cc.LabelTTF._firsrEnglish.test(o)&&(w=cc.LabelTTF._lastEnglish.exec(y))&&y!==w[0]&&(v-=w[0].length,o=x.substr(v),y=x.substr(0,v));A[z]=o||u;A.splice(z,0,y)}};d.updateStatus=function(){var e=cc.Node._dirtyFlags;this._dirtyFlag&e.textDirty&&this._updateTexture();cc.Node.RenderCmd.prototype.updateStatus.call(this);this._dirtyFlag&e.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)};d._syncStatus=function(j){var h=cc.Node._dirtyFlags,g=this._dirtyFlag;g&h.textDirty&&this._updateTexture();cc.Node.RenderCmd.prototype._syncStatus.call(this,j);(cc._renderType===cc.game.RENDER_TYPE_WEBGL||g&h.transformDirty)&&this.transform(j)};d.drawLabels=function(t,s,r){var p=this._node;if(p._shadowEnabled){var o=p._shadowOffset;t.shadowColor=this._shadowColorStr;t.shadowOffsetX=o.x;t.shadowOffsetY=-o.y;t.shadowBlur=p._shadowBlur}var o=p._hAlignment,n=p._vAlignment,j=p._strokeSize;t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr);t.fillStyle=this._fillColorStr;if(p=p._strokeEnabled){t.lineWidth=2*j,t.strokeStyle=this._strokeColorStr}t.textBaseline=cc.LabelTTF._textBaseline[n];t.textAlign=cc.LabelTTF._textAlign[o];o=this._strings.length;for(n=0;n<o;n++){j=this._strings[n],p&&t.strokeText(j,s,r[n]),t.fillText(j,s,r[n])}cc.g_NumberOfDraws++}})();(function(){cc.LabelTTF.CacheRenderCmd=function(e){cc.LabelTTF.RenderCmd.call(this,e);e=this._labelCanvas=document.createElement("canvas");e.width=1;e.height=1;this._labelContext=e.getContext("2d");this._texRect=cc.rect()};cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var d=cc.LabelTTF.CacheRenderCmd.prototype;d.constructor=cc.LabelTTF.CacheRenderCmd;d._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var r=this._node;this._updateTTF();var p=this._texRect.width,o=this._texRect.height,n=this._labelContext,m=this._labelCanvas;if(!r._texture){var j=new cc.Texture2D;j.initWithElement(this._labelCanvas);r.setTexture(j)}if(0===r._string.length){return m.width=p,m.height=o,r._texture&&r._texture.handleLoadedTexture(),r.setTextureRect(this._texRect),!0}n.font=this._fontStyleStr;j=m.width===p&&m.height===o;m.width=this._texRect.width;m.height=this._texRect.height;j&&n.clearRect(0,0,p,o);this._saveStatus();this._drawTTFInCanvas(n);r._texture&&r._texture.handleLoadedTexture();r.setTextureRect(this._texRect);return !0};d._measureConfig=function(){this._labelContext.font=this._fontStyleStr};d._measure=function(e){return this._labelContext.measureText(e).width}})();(function(){cc.LabelTTF.CacheCanvasRenderCmd=function(e){cc.Sprite.CanvasRenderCmd.call(this,e);cc.LabelTTF.CacheRenderCmd.call(this)};var d=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,d);d.constructor=cc.LabelTTF.CacheCanvasRenderCmd})();(function(){cc.LabelTTF.CanvasRenderCmd=function(e){cc.Sprite.CanvasRenderCmd.call(this,e);cc.LabelTTF.RenderCmd.call(this)};cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var d=cc.LabelTTF.CanvasRenderCmd.prototype;d.constructor=cc.LabelTTF.CanvasRenderCmd;d._measureConfig=function(){};d._measure=function(g){var f=cc._renderContext.getContext();f.font=this._fontStyleStr;return f.measureText(g).width};d._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var e=this._node;cc.view.getDevicePixelRatio();this._updateTTF();if(0===e._string.length){return e.setTextureRect(this._texRect),!0}this._saveStatus();e.setTextureRect(this._texRect);return !0};d.rendering=function(x){var w=cc.view.getScaleX(),v=cc.view.getScaleY();x=x||cc._renderContext;var u=x.getContext();if(u){var t=this._node;x.computeRealOffsetY();if(!(0>=this._status.length)){var s=this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,r=this._status[s];this._renderingIndex=s+1;var o=t._offsetPosition.x,s=-t._offsetPosition.y-t._rect.height,j=this._displayedOpacity/255;x.setTransform(this._worldTransform,w,v);x.setCompositeOperation(this._blendFuncStr);x.setGlobalAlpha(j);x.save();t._flippedX&&(o=-o-t._rect.width,u.scale(-1,1));t._flippedY&&(s=t._offsetPosition.y,u.scale(1,-1));w=r.xOffset+r.contextTransform.x+o*w;t=[];o=this._strings.length;for(j=0;j<o;j++){t.push(r.OffsetYArray[j]+r.contextTransform.y+s*v)}this.drawLabels(u,w,t);x.restore()}}}})();(function(){cc.LabelTTF.WebGLRenderCmd=function(e){cc.Sprite.WebGLRenderCmd.call(this,e);cc.LabelTTF.CacheRenderCmd.call(this)};var d=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,d);d.constructor=cc.LabelTTF.WebGLRenderCmd;d._updateColor=function(){}})();cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.paused=this.currentActionSalvaged=!1;this.hh=null}});cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(h,g){for(var f=0;f<h.length;f++){if(g===h[f].target){return h[f]}}return null},ctor:function(){this._hashTargets={};this._arrayTargets=[];this._currentTarget=null;this._currentTargetSalvaged=!1},addAction:function(k,j,h){if(!k){throw Error("cc.ActionManager.addAction(): action must be non-null")}if(!j){throw Error("cc.ActionManager.addAction(): action must be non-null")}var g=this._hashTargets[j.__instanceId];g||(g=new cc.HashElement,g.paused=h,g.target=j,this._hashTargets[j.__instanceId]=g,this._arrayTargets.push(g));this._actionAllocWithHashElement(g);g.actions.push(k);k.startWithTarget(j)},removeAllActions:function(){for(var h=this._arrayTargets,g=0;g<h.length;g++){var f=h[g];f&&this.removeAllActionsFromTarget(f.target,!0)}},removeAllActionsFromTarget:function(h,g){if(null!=h){var f=this._hashTargets[h.__instanceId];f&&(-1===f.actions.indexOf(f.currentAction)||f.currentActionSalvaged||(f.currentActionSalvaged=!0),f.actions.length=0,this._currentTarget!==f||g?this._deleteHashElement(f):this._currentTargetSalvaged=!0)}},removeAction:function(h){if(null!=h){var g=h.getOriginalTarget();if(g=this._hashTargets[g.__instanceId]){for(var f=0;f<g.actions.length;f++){if(g.actions[f]===h){g.actions.splice(f,1);break}}}else{cc.log(cc._LogInfos.ActionManager_removeAction)}}},removeActionByTag:function(p,o){p===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction);cc.assert(o,cc._LogInfos.ActionManager_addAction);var n=this._hashTargets[o.__instanceId];if(n){for(var m=n.actions.length,k=0;k<m;++k){var j=n.actions[k];if(j&&j.getTag()===p&&j.getOriginalTarget()===o){this._removeActionAtIndex(k,n);break}}}},getActionByTag:function(n,m){n===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var k=this._hashTargets[m.__instanceId];if(k){if(null!=k.actions){for(var j=0;j<k.actions.length;++j){var h=k.actions[j];if(h&&h.getTag()===n){return h}}}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,n)}return null},numberOfRunningActionsInTarget:function(d){return(d=this._hashTargets[d.__instanceId])?d.actions?d.actions.length:0:0},pauseTarget:function(d){if(d=this._hashTargets[d.__instanceId]){d.paused=!0}},resumeTarget:function(d){if(d=this._hashTargets[d.__instanceId]){d.paused=!1}},pauseAllRunningActions:function(){for(var k=[],j=this._arrayTargets,h=0;h<j.length;h++){var g=j[h];g&&!g.paused&&(g.paused=!0,k.push(g.target))}return k},resumeTargets:function(f){if(f){for(var e=0;e<f.length;e++){f[e]&&this.resumeTarget(f[e])}}},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(f,e){e.actions[f]!==e.currentAction||e.currentActionSalvaged||(e.currentActionSalvaged=!0);e.actions.splice(f,1);e.actionIndex>=f&&e.actionIndex--;0===e.actions.length&&(this._currentTarget===e?this._currentTargetSalvaged=!0:this._deleteHashElement(e))},_deleteHashElement:function(f){var e=!1;f&&(this._hashTargets[f.target.__instanceId]&&(delete this._hashTargets[f.target.__instanceId],cc.arrayRemoveObject(this._arrayTargets,f),e=!0),f.actions=null,f.target=null);return e},_actionAllocWithHashElement:function(d){null==d.actions&&(d.actions=[])},update:function(n){for(var m=this._arrayTargets,k,j=0;j<m.length;j++){k=this._currentTarget=m[j];if(!k.paused){for(k.actionIndex=0;k.actionIndex<(k.actions?k.actions.length:0);k.actionIndex++){if(k.currentAction=k.actions[k.actionIndex],k.currentAction){k.currentActionSalvaged=!1;k.currentAction.step(n*(k.currentAction._speedMethod?k.currentAction._speed:1));if(k.currentActionSalvaged){k.currentAction=null}else{if(k.currentAction.isDone()){k.currentAction.stop();var h=k.currentAction;k.currentAction=null;this.removeAction(h)}}k.currentAction=null}}}this._currentTargetSalvaged&&0===k.actions.length&&this._deleteHashElement(k)&&j--}}});cc.profiler=function(){var W=!1,V=!1,U=0,T=0,S=0,R=0,Q=null,P=document.createElement("div"),O=document.createElement("div"),N=document.createElement("div"),K=document.createElement("div"),J=10,E=[0,10,20,30],I=[0,0,0,0],D=3,H=0,M=0;K.id="fps";K.style.position="absolute";K.style.padding="3px";K.style.textAlign="left";K.style.backgroundColor="rgb(0, 0, 34)";K.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px";K.style.left=cc.DIRECTOR_STATS_POSITION.x+"px";K.style.width="45px";K.style.height="60px";for(var C=[N,O,P],L=0;3>L;++L){var G=C[L].style;G.color="rgb(0, 255, 255)";G.font="bold 12px Helvetica, Arial";G.lineHeight="20px";G.width="100%";K.appendChild(C[L])}var j=function(){S=cc.director.getSecondsPerFrame();U++;R+=cc.director.getDeltaTime();if(R>cc.DIRECTOR_FPS_INTERVAL){T=U/R;R=U=0;if(o.onFrameRateChange){var g=T,e=E.length-1,f=e,c=0;H++;for(M+=g;0<=f;f--){if(g>=E[f]){I[f]++;break}}if(H>=J){c=M/J;for(f=e;0<f;f--){if(g=I[f]/J,0.6<=g&&c>=E[f]){f!=D&&(D=f,o.onFrameRateChange&&o.onFrameRateChange(c.toFixed(2)));break}}M=H=_changeCount=0;for(f=e;0<f;f--){I[f]=0}}}W&&(O.innerText=S.toFixed(3),P.innerText=T.toFixed(1),N.innerText=(0|cc.g_NumberOfDraws).toString())}},o={onFrameRateChange:null,getSecondsPerFrame:function(){return S},getFrameRate:function(){return T},setProfileDuration:function(d){!isNaN(d)&&0<d&&(J=d/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(Q,1)},stopProfiling:function(){cc.eventManager.removeListener(Q)},isShowingStats:function(){return W},showStats:function(){V||this.init();null===K.parentElement&&cc.container.appendChild(K);W=!0},hideStats:function(){W=!1;K.parentElement===cc.container&&cc.container.removeChild(K)},init:function(){V||(Q=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,j),V=!0)}};return o}();cc.math=cc.math||{};cc.math.EPSILON=0.015625;cc.math.square=function(d){return d*d};cc.math.almostEqual=function(f,e){return f+cc.math.EPSILON>e&&f-cc.math.EPSILON<e};(function(f){f.math.Vec2=function(h,g){void 0===g?(this.x=h.x,this.y=h.y):(this.x=h||0,this.y=g||0)};var e=f.math.Vec2.prototype;e.fill=function(h,g){this.x=h;this.y=g};e.length=function(){return Math.sqrt(f.math.square(this.x)+f.math.square(this.y))};e.lengthSq=function(){return f.math.square(this.x)+f.math.square(this.y)};e.normalize=function(){var d=1/this.length();this.x*=d;this.y*=d;return this};f.math.Vec2.add=function(k,j,h){k.x=j.x+h.x;k.y=j.y+h.y;return k};e.add=function(d){this.x+=d.x;this.y+=d.y;return this};e.dot=function(d){return this.x*d.x+this.y*d.y};f.math.Vec2.subtract=function(k,j,h){k.x=j.x-h.x;k.y=j.y-h.y;return k};e.subtract=function(d){this.x-=d.x;this.y-=d.y;return this};e.transform=function(k){var j=this.x,h=this.y;this.x=j*k.mat[0]+h*k.mat[3]+k.mat[6];this.y=j*k.mat[1]+h*k.mat[4]+k.mat[7];return this};f.math.Vec2.scale=function(k,j,h){k.x=j.x*h;k.y=j.y*h;return k};e.scale=function(d){this.x*=d;this.y*=d;return this};e.equals=function(c){return this.x<c.x+f.math.EPSILON&&this.x>c.x-f.math.EPSILON&&this.y<c.y+f.math.EPSILON&&this.y>c.y-f.math.EPSILON}})(cc);(function(f){f.math.Vec3=f.kmVec3=function(k,j,h){k&&void 0===j?(this.x=k.x,this.y=k.y,this.z=k.z):(this.x=k||0,this.y=j||0,this.z=h||0)};f.math.vec3=function(j,h,c){return new f.math.Vec3(j,h,c)};var e=f.math.Vec3.prototype;e.fill=function(k,j,h){k&&void 0===j?(this.x=k.x,this.y=k.y,this.z=k.z):(this.x=k,this.y=j,this.z=h);return this};e.length=function(){return Math.sqrt(f.math.square(this.x)+f.math.square(this.y)+f.math.square(this.z))};e.lengthSq=function(){return f.math.square(this.x)+f.math.square(this.y)+f.math.square(this.z)};e.normalize=function(){var d=1/this.length();this.x*=d;this.y*=d;this.z*=d;return this};e.cross=function(n){var m=this.x,k=this.y,j=this.z;this.x=k*n.z-j*n.y;this.y=j*n.x-m*n.z;this.z=m*n.y-k*n.x;return this};e.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z};e.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;return this};e.subtract=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;return this};e.transform=function(n){var m=this.x,k=this.y,j=this.z;n=n.mat;this.x=m*n[0]+k*n[4]+j*n[8]+n[12];this.y=m*n[1]+k*n[5]+j*n[9]+n[13];this.z=m*n[2]+k*n[6]+j*n[10]+n[14];return this};e.transformNormal=function(n){var m=this.x,k=this.y,j=this.z;n=n.mat;this.x=m*n[0]+k*n[4]+j*n[8];this.y=m*n[1]+k*n[5]+j*n[9];this.z=m*n[2]+k*n[6]+j*n[10];return this};e.transformCoord=function(g){var c=new f.math.Vec4(this.x,this.y,this.z,1);c.transform(g);this.x=c.x/c.w;this.y=c.y/c.w;this.z=c.z/c.w;return this};e.scale=function(d){this.x*=d;this.y*=d;this.z*=d;return this};e.equals=function(g){var c=f.math.EPSILON;return this.x<g.x+c&&this.x>g.x-c&&this.y<g.y+c&&this.y>g.y-c&&this.z<g.z+c&&this.z>g.z-c};e.inverseTransform=function(g){g=g.mat;var c=new f.math.Vec3(this.x-g[12],this.y-g[13],this.z-g[14]);this.x=c.x*g[0]+c.y*g[1]+c.z*g[2];this.y=c.x*g[4]+c.y*g[5]+c.z*g[6];this.z=c.x*g[8]+c.y*g[9]+c.z*g[10];return this};e.inverseTransformNormal=function(n){var m=this.x,k=this.y,j=this.z;n=n.mat;this.x=m*n[0]+k*n[1]+j*n[2];this.y=m*n[4]+k*n[5]+j*n[6];this.z=m*n[8]+k*n[9]+j*n[10];return this};e.assignFrom=function(d){if(!d){return this}this.x=d.x;this.y=d.y;this.z=d.z;return this};f.math.Vec3.zero=function(d){d.x=d.y=d.z=0;return d};e.toTypeArray=function(){var d=new Float32Array(3);d[0]=this.x;d[1]=this.y;d[2]=this.z;return d}})(cc);(function(f){f.math.Vec4=function(n,m,k,j){n&&void 0===m?(this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w):(this.x=n||0,this.y=m||0,this.z=k||0,this.w=j||0)};f.kmVec4=f.math.Vec4;var e=f.math.Vec4.prototype;e.fill=function(n,m,k,j){n&&void 0===m?(this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w):(this.x=n,this.y=m,this.z=k,this.w=j)};e.add=function(d){if(!d){return this}this.x+=d.x;this.y+=d.y;this.z+=d.z;this.w+=d.w;return this};e.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z+this.w*d.w};e.length=function(){return Math.sqrt(f.math.square(this.x)+f.math.square(this.y)+f.math.square(this.z)+f.math.square(this.w))};e.lengthSq=function(){return f.math.square(this.x)+f.math.square(this.y)+f.math.square(this.z)+f.math.square(this.w)};e.lerp=function(h,g){return this};e.normalize=function(){var d=1/this.length();this.x*=d;this.y*=d;this.z*=d;this.w*=d;return this};e.scale=function(d){this.normalize();this.x*=d;this.y*=d;this.z*=d;this.w*=d;return this};e.subtract=function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;this.w-=d.w};e.transform=function(p){var o=this.x,n=this.y,m=this.z,j=this.w;p=p.mat;this.x=o*p[0]+n*p[4]+m*p[8]+j*p[12];this.y=o*p[1]+n*p[5]+m*p[9]+j*p[13];this.z=o*p[2]+n*p[6]+m*p[10]+j*p[14];this.w=o*p[3]+n*p[7]+m*p[11]+j*p[15];return this};f.math.Vec4.transformArray=function(o,n){for(var m=[],j=0;j<o.length;j++){var c=new f.math.Vec4(o[j]);c.transform(n);m.push(c)}return m};e.equals=function(g){var c=f.math.EPSILON;return this.x<g.x+c&&this.x>g.x-c&&this.y<g.y+c&&this.y>g.y-c&&this.z<g.z+c&&this.z>g.z-c&&this.w<g.w+c&&this.w>g.w-c};e.assignFrom=function(d){this.x=d.x;this.y=d.y;this.z=d.z;this.w=d.w;return this};e.toTypeArray=function(){var d=new Float32Array(4);d[0]=this.x;d[1]=this.y;d[2]=this.z;d[3]=this.w;return d}})(cc);(function(f){function e(j,h,c){h=new f.math.Vec2(h);h.subtract(j);c.x=-h.y;c.y=h.x;c.normalize()}f.math.Ray2=function(g,c){this.start=g||new f.math.Vec2;this.dir=c||new f.math.Vec2};f.math.Ray2.prototype.fill=function(n,m,k,j){this.start.x=n;this.start.y=m;this.dir.x=k;this.dir.y=j};f.math.Ray2.prototype.intersectLineSegment=function(A,z,y){var x=this.start.x,w=this.start.y,u=this.start.x+this.dir.x,o=this.start.y+this.dir.y,j=A.x,c=A.y,D=z.x,B=z.y,C=(B-c)*(u-x)-(D-j)*(o-w);if(C>-f.math.EPSILON&&C<f.math.EPSILON){return !1}c=((D-j)*(w-c)-(B-c)*(x-j))/C;j=x+c*(u-x);c=w+c*(o-w);if(j<Math.min(A.x,z.x)-f.math.EPSILON||j>Math.max(A.x,z.x)+f.math.EPSILON||c<Math.min(A.y,z.y)-f.math.EPSILON||c>Math.max(A.y,z.y)+f.math.EPSILON||j<Math.min(x,u)-f.math.EPSILON||j>Math.max(x,u)+f.math.EPSILON||c<Math.min(w,o)-f.math.EPSILON||c>Math.max(w,o)+f.math.EPSILON){return !1}y.x=j;y.y=c;return !0};f.math.Ray2.prototype.intersectTriangle=function(y,x,w,u,t){var o=new f.math.Vec2,j=new f.math.Vec2,d=new f.math.Vec2,c=10000,A=!1,z;this.intersectLineSegment(y,x,o)&&(A=!0,z=o.subtract(this.start).length(),z<c&&(j.x=o.x,j.y=o.y,c=z,e(y,x,d)));this.intersectLineSegment(x,w,o)&&(A=!0,z=o.subtract(this.start).length(),z<c&&(j.x=o.x,j.y=o.y,c=z,e(x,w,d)));this.intersectLineSegment(w,y,o)&&(A=!0,z=o.subtract(this.start).length(),z<c&&(j.x=o.x,j.y=o.y,e(w,y,d)));A&&(u.x=j.x,u.y=j.y,t&&(t.x=d.x,t.y=d.y));return A}})(cc);window.Uint16Array=window.Uint16Array||window.Array;window.Float32Array=window.Float32Array||window.Array;(function(h){h.math.Matrix3=function(d){this.mat=d&&d.mat?new Float32Array(d.mat):new Float32Array(9)};h.kmMat3=h.math.Matrix3;var g=h.math.Matrix3.prototype;g.fill=function(j){var e=this.mat;j=j.mat;e[0]=j[0];e[1]=j[1];e[2]=j[2];e[3]=j[3];e[4]=j[4];e[5]=j[5];e[6]=j[6];e[7]=j[7];e[8]=j[8];return this};g.adjugate=function(){var z=this.mat,y=z[0],x=z[1],w=z[2],u=z[3],t=z[4],o=z[5],j=z[6],B=z[7],A=z[8];z[0]=t*A-o*B;z[1]=w*B-x*A;z[2]=x*o-w*t;z[3]=o*j-u*A;z[4]=y*A-w*j;z[5]=w*u-y*o;z[6]=u*B-t*j;z[8]=y*t-x*u;return this};g.identity=function(){var d=this.mat;d[1]=d[2]=d[3]=d[5]=d[6]=d[7]=0;d[0]=d[4]=d[8]=1;return this};var f=new h.math.Matrix3;g.inverse=function(d){if(0===d){return this}f.assignFrom(this);d=1/d;this.adjugate();this.multiplyScalar(d);return this};g.isIdentity=function(){var d=this.mat;return 1===d[0]&&0===d[1]&&0===d[2]&&0===d[3]&&1===d[4]&&0===d[5]&&0===d[6]&&0===d[7]&&1===d[8]};g.transpose=function(){var t=this.mat,r=t[1],p=t[2],o=t[5],j=t[6],s=t[7];t[1]=t[3];t[2]=j;t[3]=r;t[5]=s;t[6]=p;t[7]=o;return this};g.determinant=function(){var j=this.mat,e=j[0]*j[4]*j[8]+j[1]*j[5]*j[6]+j[2]*j[3]*j[7];return e-=j[2]*j[4]*j[6]+j[0]*j[5]*j[7]+j[1]*j[3]*j[8]};g.multiply=function(T){var S=this.mat,R=T.mat;T=S[0];var Q=S[1],P=S[2],O=S[3],N=S[4],K=S[5],J=S[6],E=S[7],I=S[8],D=R[0],H=R[1],M=R[2],C=R[3],L=R[4],G=R[5],j=R[6],o=R[7],R=R[8];S[0]=T*D+O*H+J*M;S[1]=Q*D+N*H+E*M;S[2]=P*D+K*H+I*M;S[3]=P*D+K*H+I*M;S[4]=Q*C+N*L+E*G;S[5]=P*C+K*L+I*G;S[6]=T*j+O*o+J*R;S[7]=Q*j+N*o+E*R;S[8]=P*j+K*o+I*R;return this};g.multiplyScalar=function(j){var e=this.mat;e[0]*=j;e[1]*=j;e[2]*=j;e[3]*=j;e[4]*=j;e[5]*=j;e[6]*=j;e[7]*=j;e[8]*=j;return this};h.math.Matrix3.rotationAxisAngle=function(r,p){var o=Math.cos(p),j=Math.sin(p),c=new h.math.Matrix3,s=c.mat;s[0]=o+r.x*r.x*(1-o);s[1]=r.z*j+r.y*r.x*(1-o);s[2]=-r.y*j+r.z*r.x*(1-o);s[3]=-r.z*j+r.x*r.y*(1-o);s[4]=o+r.y*r.y*(1-o);s[5]=r.x*j+r.z*r.y*(1-o);s[6]=r.y*j+r.x*r.z*(1-o);s[7]=-r.x*j+r.y*r.z*(1-o);s[8]=o+r.z*r.z*(1-o);return c};g.assignFrom=function(j){if(this===j){return h.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this}var c=this.mat;j=j.mat;c[0]=j[0];c[1]=j[1];c[2]=j[2];c[3]=j[3];c[4]=j[4];c[5]=j[5];c[6]=j[6];c[7]=j[7];c[8]=j[8];return this};g.equals=function(n){if(this===n){return !0}var m=h.math.EPSILON,j=this.mat;n=n.mat;for(var c=0;9>c;++c){if(!(j[c]+m>n[c]&&j[c]-m<n[c])){return !1}}return !0};h.math.Matrix3.createByRotationX=function(k){var j=new h.math.Matrix3,c=j.mat;c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=Math.cos(k);c[5]=Math.sin(k);c[6]=0;c[7]=-Math.sin(k);c[8]=Math.cos(k);return j};h.math.Matrix3.createByRotationY=function(k){var j=new h.math.Matrix3,c=j.mat;c[0]=Math.cos(k);c[1]=0;c[2]=-Math.sin(k);c[3]=0;c[4]=1;c[5]=0;c[6]=Math.sin(k);c[7]=0;c[8]=Math.cos(k);return j};h.math.Matrix3.createByRotationZ=function(k){var j=new h.math.Matrix3,c=j.mat;c[0]=Math.cos(k);c[1]=-Math.sin(k);c[2]=0;c[3]=Math.sin(k);c[4]=Math.cos(k);c[5]=0;c[6]=0;c[7]=0;c[8]=1;return j};h.math.Matrix3.createByRotation=function(k){var j=new h.math.Matrix3,c=j.mat;c[0]=Math.cos(k);c[1]=Math.sin(k);c[2]=0;c[3]=-Math.sin(k);c[4]=Math.cos(k);c[5]=0;c[6]=0;c[7]=0;c[8]=1;return j};h.math.Matrix3.createByScale=function(k,j){var c=new h.math.Matrix3;c.identity();c.mat[0]=k;c.mat[4]=j;return c};h.math.Matrix3.createByTranslation=function(k,j){var c=new h.math.Matrix3;c.identity();c.mat[6]=k;c.mat[7]=j;return c};h.math.Matrix3.createByQuaternion=function(k){if(!k){return null}var j=new h.math.Matrix3,c=j.mat;c[0]=1-2*(k.y*k.y+k.z*k.z);c[1]=2*(k.x*k.y-k.w*k.z);c[2]=2*(k.x*k.z+k.w*k.y);c[3]=2*(k.x*k.y+k.w*k.z);c[4]=1-2*(k.x*k.x+k.z*k.z);c[5]=2*(k.y*k.z-k.w*k.x);c[6]=2*(k.x*k.z-k.w*k.y);c[7]=2*(k.y*k.z+k.w*k.x);c[8]=1-2*(k.x*k.x+k.y*k.y);return j};g.rotationToAxisAngle=function(){return h.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}})(cc);(function(k){k.math.Matrix4=function(d){this.mat=d&&d.mat?new Float32Array(d.mat):new Float32Array(16)};k.kmMat4=k.math.Matrix4;var j=k.math.Matrix4.prototype;j.fill=function(n){for(var m=this.mat,f=0;16>f;f++){m[f]=n[f]}return this};k.kmMat4Identity=function(f){var e=f.mat;e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0;e[0]=e[5]=e[10]=e[15]=1;return f};j.identity=function(){var d=this.mat;d[1]=d[2]=d[3]=d[4]=d[6]=d[7]=d[8]=d[9]=d[11]=d[12]=d[13]=d[14]=0;d[0]=d[5]=d[10]=d[15]=1;return this};j.get=function(f,e){return this.mat[f+4*e]};j.set=function(n,m,f){this.mat[n+4*m]=f};j.swap=function(u,s,r,m){var t=this.mat,o=t[u+4*s];t[u+4*s]=t[r+4*m];t[r+4*m]=o};k.math.Matrix4._gaussj=function(B,A){var z,y=0,x=0,o,m,G,D,F=[0,0,0,0],C=[0,0,0,0],E=[0,0,0,0];for(z=0;4>z;z++){for(o=D=0;4>o;o++){if(1!==E[o]){for(m=0;4>m;m++){0===E[m]&&(G=Math.abs(B.get(o,m)),G>=D&&(D=G,x=o,y=m))}}}++E[y];if(x!==y){for(o=0;4>o;o++){B.swap(x,o,y,o)}for(o=0;4>o;o++){A.swap(x,o,y,o)}}C[z]=x;F[z]=y;if(0===B.get(y,y)){return !1}m=1/B.get(y,y);B.set(y,y,1);for(o=0;4>o;o++){B.set(y,o,B.get(y,o)*m)}for(o=0;4>o;o++){A.set(y,o,A.get(y,o)*m)}for(m=0;4>m;m++){if(m!==y){G=B.get(m,y);B.set(m,y,0);for(o=0;4>o;o++){B.set(m,o,B.get(m,o)-B.get(y,o)*G)}for(o=0;4>o;o++){A.set(m,o,B.get(m,o)-A.get(y,o)*G)}}}}for(o=3;0<=o;o--){if(C[o]!==F[o]){for(m=0;4>m;m++){B.swap(m,C[o],m,F[o])}}}return !0};var h=(new k.math.Matrix4).identity();k.kmMat4Inverse=function(o,n){var e=new k.math.Matrix4(n),c=new k.math.Matrix4(h);if(!1===k.math.Matrix4._gaussj(e,c)){return null}o.assignFrom(e);return o};j.inverse=function(){var e=new k.math.Matrix4(this),c=new k.math.Matrix4(h);return !1===k.math.Matrix4._gaussj(e,c)?null:e};j.isIdentity=function(){var d=this.mat;return 1===d[0]&&0===d[1]&&0===d[2]&&0===d[3]&&0===d[4]&&1===d[5]&&0===d[6]&&0===d[7]&&0===d[8]&&0===d[9]&&1===d[10]&&0===d[11]&&0===d[12]&&0===d[13]&&0===d[14]&&1===d[15]};j.transpose=function(){var B=this.mat,A=B[1],z=B[2],y=B[3],x=B[6],o=B[7],m=B[8],G=B[9],D=B[11],F=B[12],C=B[13],E=B[14];B[1]=B[4];B[2]=m;B[3]=F;B[4]=A;B[6]=G;B[7]=C;B[8]=z;B[9]=x;B[11]=E;B[12]=y;B[13]=o;B[14]=D;return this};k.kmMat4Multiply=function(ax,aw,av){var au=ax.mat,at=aw.mat,ar=av.mat;av=at[0];aw=at[1];var ao=at[2],an=at[3],ai=at[4],al=at[5],ag=at[6],ak=at[7],aq=at[8],af=at[9],ap=at[10],aj=at[11],ac=at[12],ad=at[13],ab=at[14],at=at[15],am=ar[0],ae=ar[1],X=ar[2],C=ar[3],ah=ar[4],o=ar[5],aa=ar[6],P=ar[7],M=ar[8],W=ar[9],H=ar[10],Q=ar[11],J=ar[12],E=ar[13],m=ar[14],ar=ar[15];au[0]=am*av+ae*ai+X*aq+C*ac;au[1]=am*aw+ae*al+X*af+C*ad;au[2]=am*ao+ae*ag+X*ap+C*ab;au[3]=am*an+ae*ak+X*aj+C*at;au[4]=ah*av+o*ai+aa*aq+P*ac;au[5]=ah*aw+o*al+aa*af+P*ad;au[6]=ah*ao+o*ag+aa*ap+P*ab;au[7]=ah*an+o*ak+aa*aj+P*at;au[8]=M*av+W*ai+H*aq+Q*ac;au[9]=M*aw+W*al+H*af+Q*ad;au[10]=M*ao+W*ag+H*ap+Q*ab;au[11]=M*an+W*ak+H*aj+Q*at;au[12]=J*av+E*ai+m*aq+ar*ac;au[13]=J*aw+E*al+m*af+ar*ad;au[14]=J*ao+E*ag+m*ap+ar*ab;au[15]=J*an+E*ak+m*aj+ar*at;return ax};j.multiply=function(aw){var av=this.mat,au=aw.mat;aw=av[0];var at=av[1],ar=av[2],aq=av[3],an=av[4],am=av[5],ah=av[6],ak=av[7],af=av[8],aj=av[9],ap=av[10],ae=av[11],ao=av[12],ai=av[13],ab=av[14],ac=av[15],aa=au[0],al=au[1],ad=au[2],W=au[3],o=au[4],ag=au[5],m=au[6],X=au[7],M=au[8],J=au[9],Q=au[10],E=au[11],P=au[12],H=au[13],C=au[14],au=au[15];av[0]=aa*aw+al*an+ad*af+W*ao;av[1]=aa*at+al*am+ad*aj+W*ai;av[2]=aa*ar+al*ah+ad*ap+W*ab;av[3]=aa*aq+al*ak+ad*ae+W*ac;av[4]=o*aw+ag*an+m*af+X*ao;av[5]=o*at+ag*am+m*aj+X*ai;av[6]=o*ar+ag*ah+m*ap+X*ab;av[7]=o*aq+ag*ak+m*ae+X*ac;av[8]=M*aw+J*an+Q*af+E*ao;av[9]=M*at+J*am+Q*aj+E*ai;av[10]=M*ar+J*ah+Q*ap+E*ab;av[11]=M*aq+J*ak+Q*ae+E*ac;av[12]=P*aw+H*an+C*af+au*ao;av[13]=P*at+H*am+C*aj+au*ai;av[14]=P*ar+H*ah+C*ap+au*ab;av[15]=P*aq+H*ak+C*ae+au*ac;return this};k.getMat4MultiplyValue=function(s,p){var o=s.mat,m=p.mat,r=new Float32Array(16);r[0]=o[0]*m[0]+o[4]*m[1]+o[8]*m[2]+o[12]*m[3];r[1]=o[1]*m[0]+o[5]*m[1]+o[9]*m[2]+o[13]*m[3];r[2]=o[2]*m[0]+o[6]*m[1]+o[10]*m[2]+o[14]*m[3];r[3]=o[3]*m[0]+o[7]*m[1]+o[11]*m[2]+o[15]*m[3];r[4]=o[0]*m[4]+o[4]*m[5]+o[8]*m[6]+o[12]*m[7];r[5]=o[1]*m[4]+o[5]*m[5]+o[9]*m[6]+o[13]*m[7];r[6]=o[2]*m[4]+o[6]*m[5]+o[10]*m[6]+o[14]*m[7];r[7]=o[3]*m[4]+o[7]*m[5]+o[11]*m[6]+o[15]*m[7];r[8]=o[0]*m[8]+o[4]*m[9]+o[8]*m[10]+o[12]*m[11];r[9]=o[1]*m[8]+o[5]*m[9]+o[9]*m[10]+o[13]*m[11];r[10]=o[2]*m[8]+o[6]*m[9]+o[10]*m[10]+o[14]*m[11];r[11]=o[3]*m[8]+o[7]*m[9]+o[11]*m[10]+o[15]*m[11];r[12]=o[0]*m[12]+o[4]*m[13]+o[8]*m[14]+o[12]*m[15];r[13]=o[1]*m[12]+o[5]*m[13]+o[9]*m[14]+o[13]*m[15];r[14]=o[2]*m[12]+o[6]*m[13]+o[10]*m[14]+o[14]*m[15];r[15]=o[3]*m[12]+o[7]*m[13]+o[11]*m[14]+o[15]*m[15];return r};k.kmMat4Assign=function(p,o){if(p===o){return k.log("cc.kmMat4Assign(): pOut equals pIn"),p}var n=p.mat,c=o.mat;n[0]=c[0];n[1]=c[1];n[2]=c[2];n[3]=c[3];n[4]=c[4];n[5]=c[5];n[6]=c[6];n[7]=c[7];n[8]=c[8];n[9]=c[9];n[10]=c[10];n[11]=c[11];n[12]=c[12];n[13]=c[13];n[14]=c[14];n[15]=c[15];return p};j.assignFrom=function(f){if(this===f){return k.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this}var c=this.mat;f=f.mat;c[0]=f[0];c[1]=f[1];c[2]=f[2];c[3]=f[3];c[4]=f[4];c[5]=f[5];c[6]=f[6];c[7]=f[7];c[8]=f[8];c[9]=f[9];c[10]=f[10];c[11]=f[11];c[12]=f[12];c[13]=f[13];c[14]=f[14];c[15]=f[15];return this};j.equals=function(p){if(this===p){return k.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0}var o=this.mat;p=p.mat;for(var n=k.math.EPSILON,c=0;16>c;c++){if(!(o[c]+n>p[c]&&o[c]-n<p[c])){return !1}}return !0};k.math.Matrix4.createByRotationX=function(n,m){m=m||new k.math.Matrix4;var c=m.mat;c[0]=1;c[3]=c[2]=c[1]=0;c[4]=0;c[5]=Math.cos(n);c[6]=Math.sin(n);c[7]=0;c[8]=0;c[9]=-Math.sin(n);c[10]=Math.cos(n);c[11]=0;c[14]=c[13]=c[12]=0;c[15]=1;return m};k.math.Matrix4.createByRotationY=function(n,m){m=m||new k.math.Matrix4;var c=m.mat;c[0]=Math.cos(n);c[1]=0;c[2]=-Math.sin(n);c[3]=0;c[7]=c[6]=c[4]=0;c[5]=1;c[8]=Math.sin(n);c[9]=0;c[10]=Math.cos(n);c[11]=0;c[14]=c[13]=c[12]=0;c[15]=1;return m};k.math.Matrix4.createByRotationZ=function(n,m){m=m||new k.math.Matrix4;var c=m.mat;c[0]=Math.cos(n);c[1]=Math.sin(n);c[3]=c[2]=0;c[4]=-Math.sin(n);c[5]=Math.cos(n);c[7]=c[6]=0;c[11]=c[9]=c[8]=0;c[10]=1;c[14]=c[13]=c[12]=0;c[15]=1;return m};k.math.Matrix4.createByPitchYawRoll=function(z,y,x,w){w=w||new k.math.Matrix4;var u=Math.cos(z);z=Math.sin(z);var o=Math.cos(y);y=Math.sin(y);var c=Math.cos(x);x=Math.sin(x);var C=z*y,A=u*y,B=w.mat;B[0]=o*c;B[4]=o*x;B[8]=-y;B[1]=C*c-u*x;B[5]=C*x+u*c;B[9]=z*o;B[2]=A*c+z*x;B[6]=A*x-z*c;B[10]=u*o;B[3]=B[7]=B[11]=0;B[15]=1;return w};k.math.Matrix4.createByQuaternion=function(n,m){m=m||new k.math.Matrix4;var c=m.mat;c[0]=1-2*(n.y*n.y+n.z*n.z);c[1]=2*(n.x*n.y+n.z*n.w);c[2]=2*(n.x*n.z-n.y*n.w);c[3]=0;c[4]=2*(n.x*n.y-n.z*n.w);c[5]=1-2*(n.x*n.x+n.z*n.z);c[6]=2*(n.z*n.y+n.x*n.w);c[7]=0;c[8]=2*(n.x*n.z+n.y*n.w);c[9]=2*(n.y*n.z-n.x*n.w);c[10]=1-2*(n.x*n.x+n.y*n.y);c[11]=0;c[14]=c[13]=c[12]=0;c[15]=1;return m};k.math.Matrix4.createByRotationTranslation=function(p,o,n){n=n||new k.math.Matrix4;var c=n.mat;p=p.mat;c[0]=p[0];c[1]=p[1];c[2]=p[2];c[3]=0;c[4]=p[3];c[5]=p[4];c[6]=p[5];c[7]=0;c[8]=p[6];c[9]=p[7];c[10]=p[8];c[11]=0;c[12]=o.x;c[13]=o.y;c[14]=o.z;c[15]=1;return n};k.math.Matrix4.createByScale=function(r,p,o,c){c=c||new k.math.Matrix4;var s=c.mat;s[0]=r;s[5]=p;s[10]=o;s[15]=1;s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0;return c};k.kmMat4Translation=function(p,o,n,m){p.mat[0]=p.mat[5]=p.mat[10]=p.mat[15]=1;p.mat[1]=p.mat[2]=p.mat[3]=p.mat[4]=p.mat[6]=p.mat[7]=p.mat[8]=p.mat[9]=p.mat[11]=0;p.mat[12]=o;p.mat[13]=n;p.mat[14]=m;return p};k.math.Matrix4.createByTranslation=function(p,o,n,c){c=c||new k.math.Matrix4;c.identity();c.mat[12]=p;c.mat[13]=o;c.mat[14]=n;return c};j.getUpVec3=function(){var c=this.mat;return(new k.math.Vec3(c[4],c[5],c[6])).normalize()};j.getRightVec3=function(){var c=this.mat;return(new k.math.Vec3(c[0],c[1],c[2])).normalize()};j.getForwardVec3=function(){var c=this.mat;return(new k.math.Vec3(c[8],c[9],c[10])).normalize()};k.kmMat4PerspectiveProjection=function(v,u,s,c,w){var t=k.degreesToRadians(u/2);u=w-c;var o=Math.sin(t);if(0===u||0===o||0===s){return null}t=Math.cos(t)/o;v.identity();v.mat[0]=t/s;v.mat[5]=t;v.mat[10]=-(w+c)/u;v.mat[11]=-1;v.mat[14]=-2*c*w/u;v.mat[15]=0;return v};k.math.Matrix4.createPerspectiveProjection=function(v,u,s,c){var w=k.degreesToRadians(v/2);v=c-s;var t=Math.sin(w);if(0===v||0===t||0===u){return null}var w=Math.cos(w)/t,t=new k.math.Matrix4,o=t.mat;t.identity();o[0]=w/u;o[5]=w;o[10]=-(c+s)/v;o[11]=-1;o[14]=-2*s*c/v;o[15]=0;return t};k.kmMat4OrthographicProjection=function(w,u,t,o,v,s,m){w.identity();w.mat[0]=2/(t-u);w.mat[5]=2/(v-o);w.mat[10]=-2/(m-s);w.mat[12]=-((t+u)/(t-u));w.mat[13]=-((v+o)/(v-o));w.mat[14]=-((m+s)/(m-s));return w};k.math.Matrix4.createOrthographicProjection=function(x,w,u,c,y,v){var t=new k.math.Matrix4,o=t.mat;t.identity();o[0]=2/(w-x);o[5]=2/(c-u);o[10]=-2/(v-y);o[12]=-((w+x)/(w-x));o[13]=-((c+u)/(c-u));o[14]=-((v+y)/(v-y));return t};k.kmMat4LookAt=function(r,p,o,c){o=new k.math.Vec3(o);var s=new k.math.Vec3(c);o.subtract(p);o.normalize();s.normalize();c=new k.math.Vec3(o);c.cross(s);c.normalize();s=new k.math.Vec3(c);s.cross(o);c.normalize();r.identity();r.mat[0]=c.x;r.mat[4]=c.y;r.mat[8]=c.z;r.mat[1]=s.x;r.mat[5]=s.y;r.mat[9]=s.z;r.mat[2]=-o.x;r.mat[6]=-o.y;r.mat[10]=-o.z;p=k.math.Matrix4.createByTranslation(-p.x,-p.y,-p.z);r.multiply(p);return r};var g=new k.math.Matrix4;j.lookAt=function(p,o,f){o=new k.math.Vec3(o);var c=new k.math.Vec3(f);f=this.mat;o.subtract(p);o.normalize();c.normalize();var r=new k.math.Vec3(o);r.cross(c);r.normalize();c=new k.math.Vec3(r);c.cross(o);r.normalize();this.identity();f[0]=r.x;f[4]=r.y;f[8]=r.z;f[1]=c.x;f[5]=c.y;f[9]=c.z;f[2]=-o.x;f[6]=-o.y;f[10]=-o.z;g=k.math.Matrix4.createByTranslation(-p.x,-p.y,-p.z,g);this.multiply(g);return this};k.kmMat4RotationAxisAngle=function(p,o,n){var c=Math.cos(n);n=Math.sin(n);o=new k.math.Vec3(o);o.normalize();p.mat[0]=c+o.x*o.x*(1-c);p.mat[1]=o.z*n+o.y*o.x*(1-c);p.mat[2]=-o.y*n+o.z*o.x*(1-c);p.mat[3]=0;p.mat[4]=-o.z*n+o.x*o.y*(1-c);p.mat[5]=c+o.y*o.y*(1-c);p.mat[6]=o.x*n+o.z*o.y*(1-c);p.mat[7]=0;p.mat[8]=o.y*n+o.x*o.z*(1-c);p.mat[9]=-o.x*n+o.y*o.z*(1-c);p.mat[10]=c+o.z*o.z*(1-c);p.mat[11]=0;p.mat[12]=0;p.mat[13]=0;p.mat[14]=0;p.mat[15]=1;return p};k.math.Matrix4.createByAxisAndAngle=function(r,p,o){o=o||new k.math.Matrix4;var c=this.mat,s=Math.cos(p);p=Math.sin(p);r=new k.math.Vec3(r);r.normalize();c[0]=s+r.x*r.x*(1-s);c[1]=r.z*p+r.y*r.x*(1-s);c[2]=-r.y*p+r.z*r.x*(1-s);c[3]=0;c[4]=-r.z*p+r.x*r.y*(1-s);c[5]=s+r.y*r.y*(1-s);c[6]=r.x*p+r.z*r.y*(1-s);c[7]=0;c[8]=r.y*p+r.x*r.z*(1-s);c[9]=-r.x*p+r.y*r.z*(1-s);c[10]=s+r.z*r.z*(1-s);c[11]=0;c[12]=c[13]=c[14]=0;c[15]=1;return o};j.extractRotation=function(){var n=new k.math.Matrix3,m=this.mat,c=n.mat;c[0]=m[0];c[1]=m[1];c[2]=m[2];c[3]=m[4];c[4]=m[5];c[5]=m[6];c[6]=m[8];c[7]=m[9];c[8]=m[10];return n};j.extractPlane=function(n){var m=new k.math.Plane,c=this.mat;switch(n){case k.math.Plane.RIGHT:m.a=c[3]-c[0];m.b=c[7]-c[4];m.c=c[11]-c[8];m.d=c[15]-c[12];break;case k.math.Plane.LEFT:m.a=c[3]+c[0];m.b=c[7]+c[4];m.c=c[11]+c[8];m.d=c[15]+c[12];break;case k.math.Plane.BOTTOM:m.a=c[3]+c[1];m.b=c[7]+c[5];m.c=c[11]+c[9];m.d=c[15]+c[13];break;case k.math.Plane.TOP:m.a=c[3]-c[1];m.b=c[7]-c[5];m.c=c[11]-c[9];m.d=c[15]-c[13];break;case k.math.Plane.FAR:m.a=c[3]-c[2];m.b=c[7]-c[6];m.c=c[11]-c[10];m.d=c[15]-c[14];break;case k.math.Plane.NEAR:m.a=c[3]+c[2];m.b=c[7]+c[6];m.c=c[11]+c[10];m.d=c[15]+c[14];break;default:k.log("cc.math.Matrix4.extractPlane: Invalid plane index")}n=Math.sqrt(m.a*m.a+m.b*m.b+m.c*m.c);m.a/=n;m.b/=n;m.c/=n;m.d/=n;return m};j.toAxisAndAngle=function(){var c=this.extractRotation();return k.math.Quaternion.rotationMatrix(c).toAxisAndAngle()}})(cc);(function(f){f.math.Plane=function(n,m,k,j){n&&void 0===m?(this.a=n.a,this.b=n.b,this.c=n.c,this.d=n.d):(this.a=n||0,this.b=m||0,this.c=k||0,this.d=j||0)};f.kmPlane=f.math.Plane;var e=f.math.Plane.prototype;f.math.Plane.LEFT=0;f.math.Plane.RIGHT=1;f.math.Plane.BOTTOM=2;f.math.Plane.TOP=3;f.math.Plane.NEAR=4;f.math.Plane.FAR=5;f.math.Plane.POINT_INFRONT_OF_PLANE=0;f.math.Plane.POINT_BEHIND_PLANE=1;f.math.Plane.POINT_ON_PLANE=2;e.dot=function(d){return this.a*d.x+this.b*d.y+this.c*d.z+this.d*d.w};e.dotCoord=function(d){return this.a*d.x+this.b*d.y+this.c*d.z+this.d};e.dotNormal=function(d){return this.a*d.x+this.b*d.y+this.c*d.z};f.math.Plane.fromPointNormal=function(g,c){return new f.math.Plane(c.x,c.y,c.z,-c.dot(g))};f.math.Plane.fromPoints=function(m,k,j){k=new f.math.Vec3(k);j=new f.math.Vec3(j);var c=new f.math.Plane;k.subtract(m);j.subtract(m);k.cross(j);k.normalize();c.a=k.x;c.b=k.y;c.c=k.z;c.d=k.scale(-1).dot(m);return c};e.normalize=function(){var g=new f.math.Vec3(this.a,this.b,this.c),c=1/g.length();g.normalize();this.a=g.x;this.b=g.y;this.c=g.z;this.d*=c;return this};e.classifyPoint=function(c){c=this.a*c.x+this.b*c.y+this.c*c.z+this.d;return 0.001<c?f.math.Plane.POINT_INFRONT_OF_PLANE:-0.001>c?f.math.Plane.POINT_BEHIND_PLANE:f.math.Plane.POINT_ON_PLANE}})(cc);(function(f){f.math.Quaternion=function(n,m,k,j){n&&void 0===m?(this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w):(this.x=n||0,this.y=m||0,this.z=k||0,this.w=j||0)};f.kmQuaternion=f.math.Quaternion;var e=f.math.Quaternion.prototype;e.conjugate=function(d){this.x=-d.x;this.y=-d.y;this.z=-d.z;this.w=d.w;return this};e.dot=function(d){return this.w*d.w+this.x*d.x+this.y*d.y+this.z*d.z};e.exponential=function(){return this};e.identity=function(){this.z=this.y=this.x=0;this.w=1;return this};e.inverse=function(){var c=this.length();if(Math.abs(c)>f.math.EPSILON){return this.w=this.z=this.y=this.x=0,this}this.conjugate(this).scale(1/c);return this};e.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w};e.length=function(){return Math.sqrt(this.lengthSq())};e.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};e.multiply=function(p){var o=this.x,n=this.y,m=this.z,j=this.w;this.w=j*p.w-o*p.x-n*p.y-m*p.z;this.x=j*p.x+o*p.w+n*p.z-m*p.y;this.y=j*p.y+n*p.w+m*p.x-o*p.z;this.z=j*p.z+m*p.w+o*p.y-n*p.x;return this};e.normalize=function(){var c=this.length();if(Math.abs(c)<=f.math.EPSILON){throw Error("current quaternion is an invalid value")}this.scale(1/c);return this};e.rotationAxis=function(n,m){var k=0.5*m,j=Math.sin(k);this.w=Math.cos(k);this.x=n.x*j;this.y=n.y*j;this.z=n.z*j;return this};f.math.Quaternion.rotationMatrix=function(o){if(!o){return null}var n,m,j;n=[];m=o.mat;o=0;n[0]=m[0];n[1]=m[3];n[2]=m[6];n[4]=m[1];n[5]=m[4];n[6]=m[7];n[8]=m[2];n[9]=m[5];n[10]=m[8];n[15]=1;var c=n[0];o=c[0]+c[5]+c[10]+1;o>f.math.EPSILON?(o=2*Math.sqrt(o),n=(c[9]-c[6])/o,m=(c[2]-c[8])/o,j=(c[4]-c[1])/o,o*=0.25):c[0]>c[5]&&c[0]>c[10]?(o=2*Math.sqrt(1+c[0]-c[5]-c[10]),n=0.25*o,m=(c[4]+c[1])/o,j=(c[2]+c[8])/o,o=(c[9]-c[6])/o):c[5]>c[10]?(o=2*Math.sqrt(1+c[5]-c[0]-c[10]),n=(c[4]+c[1])/o,m=0.25*o,j=(c[9]+c[6])/o,o=(c[2]-c[8])/o):(o=2*Math.sqrt(1+c[10]-c[0]-c[5]),n=(c[2]+c[8])/o,m=(c[9]+c[6])/o,j=0.25*o,o=(c[4]-c[1])/o);return new f.math.Quaternion(n,m,j,o)};f.math.Quaternion.rotationYawPitchRoll=function(x,w,v){var u,t,s,o,j;u=f.degreesToRadians(w)/2;t=f.degreesToRadians(x)/2;s=f.degreesToRadians(v)/2;v=Math.cos(u);x=Math.cos(t);w=Math.cos(s);u=Math.sin(u);t=Math.sin(t);s=Math.sin(s);o=x*w;j=t*s;var c=new f.math.Quaternion;c.w=v*o+u*j;c.x=u*o-v*j;c.y=v*t*w+u*x*s;c.z=v*x*s-u*t*w;c.normalize();return c};e.slerp=function(o,n){if(this.x===o.x&&this.y===o.y&&this.z===o.z&&this.w===o.w){return this}var m=this.dot(o),j=Math.acos(m),c=Math.sqrt(1-f.math.square(m)),m=Math.sin(n*j)/c,j=Math.sin((1-n)*j)/c,c=new f.math.Quaternion(o);this.scale(j);c.scale(m);this.add(c);return this};e.toAxisAndAngle=function(){var j,h,c=new f.math.Vec3;j=Math.acos(this.w);h=Math.sqrt(f.math.square(this.x)+f.math.square(this.y)+f.math.square(this.z));h>-f.math.EPSILON&&h<f.math.EPSILON||h<2*Math.PI+f.math.EPSILON&&h>2*Math.PI-f.math.EPSILON?(j=0,c.x=0,c.y=0,c.z=1):(j*=2,c.x=this.x/h,c.y=this.y/h,c.z=this.z/h,c.normalize());return{axis:c,angle:j}};e.scale=function(d){this.x*=d;this.y*=d;this.z*=d;this.w*=d;return this};e.assignFrom=function(d){this.x=d.x;this.y=d.y;this.z=d.z;this.w=d.w;return this};e.add=function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;this.w+=d.w;return this};f.math.Quaternion.rotationBetweenVec3=function(r,p,o){var n=new f.math.Vec3(r),j=new f.math.Vec3(p);n.normalize();j.normalize();var c=n.dot(j);p=new f.math.Quaternion;if(1<=c){return p.identity(),p}-0.999999>c?Math.abs(o.lengthSq())<f.math.EPSILON?p.rotationAxis(o,Math.PI):(n=new f.math.Vec3(1,0,0),n.cross(r),Math.abs(n.lengthSq())<f.math.EPSILON&&(n.fill(0,1,0),n.cross(r)),n.normalize(),p.rotationAxis(n,Math.PI)):(r=Math.sqrt(2*(1+c)),o=1/r,n.cross(j),p.x=n.x*o,p.y=n.y*o,p.z=n.z*o,p.w=0.5*r,p.normalize());return p};e.multiplyVec3=function(r){var p=this.x,o=this.y,n=this.z,j=new f.math.Vec3(r),c=new f.math.Vec3(p,o,n),p=new f.math.Vec3(p,o,n);c.cross(r);p.cross(c);c.scale(2*q.w);p.scale(2);j.add(c);j.add(p);return j}})(cc);cc.math.AABB=function(f,e){this.min=f||new cc.math.Vec3;this.max=e||new cc.math.Vec3};cc.math.AABB.prototype.containsPoint=function(d){return d.x>=this.min.x&&d.x<=this.max.x&&d.y>=this.min.y&&d.y<=this.max.y&&d.z>=this.min.z&&d.z<=this.max.z};cc.math.AABB.containsPoint=function(f,e){return f.x>=e.min.x&&f.x<=e.max.x&&f.y>=e.min.y&&f.y<=e.max.y&&f.z>=e.min.z&&f.z<=e.max.z};cc.math.AABB.prototype.assignFrom=function(d){this.min.assignFrom(d.min);this.max.assignFrom(d.max)};cc.math.AABB.assign=function(f,e){f.min.assignFrom(e.min);f.max.assignFrom(e.max);return f};(function(f){f.math.Matrix4Stack=function(h,g){this.top=h;this.stack=g||[]};f.km_mat4_stack=f.math.Matrix4Stack;var e=f.math.Matrix4Stack.prototype;e.initialize=function(){this.stack.length=0;this.top=null};f.km_mat4_stack_push=function(g,c){g.stack.push(g.top);g.top=new f.math.Matrix4(c)};f.km_mat4_stack_pop=function(h,g){h.top=h.stack.pop()};f.km_mat4_stack_release=function(d){d.stack=null;d.top=null};e.push=function(c){c=c||this.top;this.stack.push(this.top);this.top=new f.math.Matrix4(c)};e.pop=function(){this.top=this.stack.pop()};e.release=function(){this._matrixPool=this.top=this.stack=null};e._getFromPool=function(g){var c=this._matrixPool;if(0===c.length){return new f.math.Matrix4(g)}c=c.pop();c.assignFrom(g);return c};e._putInPool=function(d){this._matrixPool.push(d)}})(cc);(function(h){h.KM_GL_MODELVIEW=5888;h.KM_GL_PROJECTION=5889;h.KM_GL_TEXTURE=5890;h.modelview_matrix_stack=new h.math.Matrix4Stack;h.projection_matrix_stack=new h.math.Matrix4Stack;h.texture_matrix_stack=new h.math.Matrix4Stack;h.current_stack=null;h.lazyInitialize=function(){var c=new h.math.Matrix4;h.modelview_matrix_stack.initialize();h.projection_matrix_stack.initialize();h.texture_matrix_stack.initialize();h.current_stack=h.modelview_matrix_stack;h.initialized=!0;c.identity();h.modelview_matrix_stack.push(c);h.projection_matrix_stack.push(c);h.texture_matrix_stack.push(c)};h.lazyInitialize();h.kmGLFreeAll=function(){h.modelview_matrix_stack.release();h.modelview_matrix_stack=null;h.projection_matrix_stack.release();h.projection_matrix_stack=null;h.texture_matrix_stack.release();h.texture_matrix_stack=null;h.initialized=!1;h.current_stack=null};h.kmGLPushMatrix=function(){h.current_stack.push(h.current_stack.top)};h.kmGLPushMatrixWitMat4=function(c){h.current_stack.stack.push(h.current_stack.top);c.assignFrom(h.current_stack.top);h.current_stack.top=c};h.kmGLPopMatrix=function(){h.current_stack.top=h.current_stack.stack.pop()};h.kmGLMatrixMode=function(c){switch(c){case h.KM_GL_MODELVIEW:h.current_stack=h.modelview_matrix_stack;break;case h.KM_GL_PROJECTION:h.current_stack=h.projection_matrix_stack;break;case h.KM_GL_TEXTURE:h.current_stack=h.texture_matrix_stack;break;default:throw Error("Invalid matrix mode specified")}};h.kmGLLoadIdentity=function(){h.current_stack.top.identity()};h.kmGLLoadMatrix=function(c){h.current_stack.top.assignFrom(c)};h.kmGLMultMatrix=function(c){h.current_stack.top.multiply(c)};var g=new h.math.Matrix4;h.kmGLTranslatef=function(j,d,c){j=h.math.Matrix4.createByTranslation(j,d,c,g);h.current_stack.top.multiply(j)};var f=new h.math.Vec3;h.kmGLRotatef=function(j,e,d,c){f.fill(e,d,c);j=h.math.Matrix4.createByAxisAndAngle(f,h.degreesToRadians(j),g);h.current_stack.top.multiply(j)};h.kmGLScalef=function(j,d,c){j=h.math.Matrix4.createByScale(j,d,c,g);h.current_stack.top.multiply(j)};h.kmGLGetMatrix=function(j,c){switch(j){case h.KM_GL_MODELVIEW:c.assignFrom(h.modelview_matrix_stack.top);break;case h.KM_GL_PROJECTION:c.assignFrom(h.projection_matrix_stack.top);break;case h.KM_GL_TEXTURE:c.assignFrom(h.texture_matrix_stack.top);break;default:throw Error("Invalid matrix mode specified")}}})(cc);cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor \x3d v_fragmentColor;      \n}\n";cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize \x3d u_pointSize;          \n    v_fragmentColor \x3d u_color;           \n}";cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor \x3d v_fragmentColor; \n} ";cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color;             \n}";cc.SHADER_SPRITE_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position \x3d CC_PMatrix * a_position;  \n    v_fragmentColor \x3d a_color;             \n}";cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor \x3d v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor \x3d v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}";cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color \x3d a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord \x3d a_texcoord; \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n}";cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor \x3d  texture2D(CC_Texture0, v_texCoord);   \n}";cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord \x3d a_texCoord;               \n}";cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor \x3d  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}";cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord \x3d a_texCoord;                 \n}";cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor \x3d vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}";cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor \x3d v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}";cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d CC_PMatrix * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor \x3d texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a \x3c\x3d CC_alpha_value )          \n        discard; \n    gl_FragColor \x3d texColor * v_fragmentColor;  \n}";cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   \x3d texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  \x3d texture2D(u_mask, v_texCoord); \n    vec4 finalColor \x3d vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    \x3d v_fragmentColor * finalColor; \n}";cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){this.loadDefaultShaders();return !0},_loadDefaultShader:function(f,e){switch(e){case this.TYPE_POSITION_TEXTURECOLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR:f.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:f.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_COLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_SPRITE_POSITION_COLOR:f.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case this.TYPE_POSITION_TEXTURE:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_UCOLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_TEXTURE_A8COLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case this.TYPE_POSITION_UCOLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG);f.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case this.TYPE_POSITION_LENGTH_TEXTURECOLOR:f.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG);f.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);f.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);f.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type");return}f.link();f.updateUniforms()},loadDefaultShaders:function(){var d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURECOLOR);this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=d;this._programs.ShaderPositionTextureColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_SPRITE_POSITION_TEXTURECOLOR);this._programs[cc.SHADER_SPRITE_POSITION_TEXTURECOLOR]=d;this._programs.ShaderSpritePositionTextureColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST);this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=d;this._programs.ShaderPositionTextureColorAlphaTest=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST);this._programs[cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST]=d;this._programs.ShaderSpritePositionTextureColorAlphaTest=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_COLOR);this._programs[cc.SHADER_POSITION_COLOR]=d;this._programs.ShaderPositionColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_SPRITE_POSITION_COLOR);this._programs[cc.SHADER_SPRITE_POSITION_COLOR]=d;this._programs.ShaderSpritePositionColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE);this._programs[cc.SHADER_POSITION_TEXTURE]=d;this._programs.ShaderPositionTexture=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE_UCOLOR);this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=d;this._programs.ShaderPositionTextureUColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE_A8COLOR);this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=d;this._programs.ShaderPositionTextureA8Color=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_UCOLOR);this._programs[cc.SHADER_POSITION_UCOLOR]=d;this._programs.ShaderPositionUColor=d;d=new cc.GLProgram;this._loadDefaultShader(d,this.TYPE_POSITION_LENGTH_TEXTURECOLOR);this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=d;this._programs.ShaderPositionLengthTextureColor=d},reloadDefaultShaders:function(){var d=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURECOLOR);d=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);d.reset();this._loadDefaultShader(d,this.TYPE_SPRITE_POSITION_TEXTURECOLOR);d=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST);d=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);d.reset();this._loadDefaultShader(d,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST);d=this.programForKey(cc.SHADER_POSITION_COLOR);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_COLOR);d=this.programForKey(cc.SHADER_POSITION_TEXTURE);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE);d=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE_UCOLOR);d=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_TEXTURE_A8COLOR);d=this.programForKey(cc.SHADER_POSITION_UCOLOR);d.reset();this._loadDefaultShader(d,this.TYPE_POSITION_UCOLOR)},programForKey:function(d){return this._programs[d]},getProgram:function(d){return this._programs[d]},addProgram:function(f,e){this._programs[e]=f}};cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(n){if(!n){return !1}var m,k=this._hashForUniforms[n];if(k){m=!1;for(var j=arguments.length-1,h=0;h<j;++h){arguments[h+1]!==k[h]&&(k[h]=arguments[h+1],m=!0)}}else{k=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[n]=k,m=!0}return m},_description:function(){return"\x3cCCGLProgram \x3d "+this.toString()+" | Program \x3d "+this._programObj.toString()+", VertexShader \x3d "+this._vertShader.toString()+", FragmentShader \x3d "+this._fragShader.toString()+"\x3e"},_compileShader:function(h,g,f){if(!f||!h){return !1}f=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+f;this._glContext.shaderSource(h,f);this._glContext.compileShader(h);f=this._glContext.getShaderParameter(h,this._glContext.COMPILE_STATUS);f||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(h)),g===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog()));return !0===f},ctor:function(h,g,f){this._uniforms={};this._hashForUniforms={};this._glContext=f||cc._renderContext;h&&g&&this.init(h,g)},destroyProgram:function(){this._hashForUniforms=this._uniforms=this._fragShader=this._vertShader=null;this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(k,j){var h=this._glContext;this._programObj=h.createProgram();this._fragShader=this._vertShader=null;k&&(this._vertShader=h.createShader(h.VERTEX_SHADER),this._compileShader(this._vertShader,h.VERTEX_SHADER,k)||cc.log("cocos2d: ERROR: Failed to compile vertex shader"));j&&(this._fragShader=h.createShader(h.FRAGMENT_SHADER),this._compileShader(this._fragShader,h.FRAGMENT_SHADER,j)||cc.log("cocos2d: ERROR: Failed to compile fragment shader"));this._vertShader&&h.attachShader(this._programObj,this._vertShader);cc.checkGLErrorDebug();this._fragShader&&h.attachShader(this._programObj,this._fragShader);for(var g in this._hashForUniforms){delete this._hashForUniforms[g]}cc.checkGLErrorDebug();return !0},initWithString:function(f,e){return this.initWithVertexShaderByteArray(f,e)},initWithVertexShaderFilename:function(k,j){var h=cc.loader.getRes(k);if(!h){throw Error("Please load the resource firset : "+k)}var g=cc.loader.getRes(j);if(!g){throw Error("Please load the resource firset : "+j)}return this.initWithVertexShaderByteArray(h,g)},init:function(f,e){return this.initWithVertexShaderFilename(f,e)},addAttribute:function(f,e){this._glContext.bindAttribLocation(this._programObj,e,f)},link:function(){if(!this._programObj){return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1}this._glContext.linkProgram(this._programObj);this._vertShader&&this._glContext.deleteShader(this._vertShader);this._fragShader&&this._glContext.deleteShader(this._fragShader);this._fragShader=this._vertShader=null;return cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)?(cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1):!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S);this._uniforms[cc.UNIFORM_MVMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S);this._uniforms[cc.UNIFORM_MVPMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S);this._uniforms[cc.UNIFORM_TIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S);this._uniforms[cc.UNIFORM_SINTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S);this._uniforms[cc.UNIFORM_COSTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S);this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME_S]||null!=this._uniforms[cc.UNIFORM_SINTIME_S]||null!=this._uniforms[cc.UNIFORM_COSTIME_S];this._uniforms[cc.UNIFORM_RANDOM01_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S);this._uniforms[cc.UNIFORM_SAMPLER_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S);this.use();this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER_S],0)},_addUniformLocation:function(f){var e=this._glContext.getUniformLocation(this._programObj,f);this._uniforms[f]=e},getUniformLocationForName:function(d){if(!d){throw Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null")}if(!this._programObj){throw Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized")}return this._uniforms[d]||this._glContext.getUniformLocation(this._programObj,d)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX_S]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(k,j){var h=this._glContext;if("string"===typeof k){if(this._updateUniformLocation(k,j)){var g=this.getUniformLocationForName(k);h.uniform1i(g,j)}}else{h.uniform1i(k,j)}},setUniformLocationWith2i:function(k,j,h){var g=this._glContext;"string"===typeof k?this._updateUniformLocation(k,j,h)&&(k=this.getUniformLocationForName(k),g.uniform2i(k,j,h)):g.uniform2i(k,j,h)},setUniformLocationWith3i:function(n,m,k,j){var h=this._glContext;"string"===typeof n?this._updateUniformLocation(n,m,k,j)&&(n=this.getUniformLocationForName(n),h.uniform3i(n,m,k,j)):h.uniform3i(n,m,k,j)},setUniformLocationWith4i:function(p,o,n,m,k){var j=this._glContext;"string"===typeof p?this._updateUniformLocation(p,o,n,m,k)&&(p=this.getUniformLocationForName(p),j.uniform4i(p,o,n,m,k)):j.uniform4i(p,o,n,m,k)},setUniformLocationWith2iv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform2iv(f,g)},setUniformLocationWith3iv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform3iv(f,g)},setUniformLocationWith4iv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform4iv(f,g)},setUniformLocationI32:function(f,e){this.setUniformLocationWith1i(f,e)},setUniformLocationWith1f:function(k,j){var h=this._glContext;if("string"===typeof k){if(this._updateUniformLocation(k,j)){var g=this.getUniformLocationForName(k);h.uniform1f(g,j)}}else{h.uniform1f(k,j)}},setUniformLocationWith2f:function(k,j,h){var g=this._glContext;"string"===typeof k?this._updateUniformLocation(k,j,h)&&(k=this.getUniformLocationForName(k),g.uniform2f(k,j,h)):g.uniform2f(k,j,h)},setUniformLocationWith3f:function(n,m,k,j){var h=this._glContext;"string"===typeof n?this._updateUniformLocation(n,m,k,j)&&(n=this.getUniformLocationForName(n),h.uniform3f(n,m,k,j)):h.uniform3f(n,m,k,j)},setUniformLocationWith4f:function(p,o,n,m,k){var j=this._glContext;"string"===typeof p?this._updateUniformLocation(p,o,n,m,k)&&(p=this.getUniformLocationForName(p),j.uniform4f(p,o,n,m,k)):j.uniform4f(p,o,n,m,k)},setUniformLocationWith2fv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform2fv(f,g)},setUniformLocationWith3fv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform3fv(f,g)},setUniformLocationWith4fv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniform4fv(f,g)},setUniformLocationWithMatrix4fv:function(h,g){var f="string"===typeof h?this.getUniformLocationForName(h):h;this._glContext.uniformMatrix4fv(f,!1,g)},setUniformLocationF32:function(){if(!(2>arguments.length)){switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}}},setUniformsForBuiltins:function(){var h=new cc.math.Matrix4,g=new cc.math.Matrix4,f=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,h);cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,g);cc.kmMat4Multiply(f,h,g);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],h.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],g.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],f.mat,1);this._usesTime&&(h=cc.director,h=h.getTotalFrames()*h.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],h/10,h,2*h,4*h),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],h/8,h/4,h/2,Math.sin(h)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],h/8,h/4,h/2,Math.cos(h)));-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(h){if(h&&h._renderCmd){var g=new cc.math.Matrix4,f=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,g);cc.kmMat4Multiply(f,g,h._renderCmd._stackMatrix);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],g.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],h._renderCmd._stackMatrix.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],f.mat,1);this._usesTime&&(h=cc.director,h=h.getTotalFrames()*h.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],h/10,h,2*h,4*h),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],h/8,h/4,h/2,Math.sin(h)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],h/8,h/4,h/2,Math.cos(h)));-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(d){cc.kmMat4Multiply(d,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,d.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,cc.modelview_matrix_stack.top.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(d){if(!d){throw Error("modelView matrix is undefined.")}this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,d.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._fragShader=this._vertShader=null;this._uniforms.length=0;this._glContext.deleteProgram(this._programObj);this._programObj=null;for(var d in this._hashForUniforms){this._hashForUniforms[d].length=0,delete this._hashForUniforms[d]}},getProgram:function(){return this._programObj},retain:function(){},release:function(){}});cc.GLProgram.create=function(f,e){return new cc.GLProgram(f,e)};cc.GLProgram._highpSupported=null;cc.GLProgram._isHighpSupported=function(){if(null==cc.GLProgram._highpSupported){var d=cc._renderContext,d=d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==d.precision}return cc.GLProgram._highpSupported};cc.setProgram=function(k,j){k.shaderProgram=j;var h=k.children;if(h){for(var g=0;g<h.length;g++){cc.setProgram(h[g],j)}}};cc._currentProjectionMatrix=-1;if(cc.ENABLE_GL_STATE_CACHE){cc.MAX_ACTIVETEXTURE=16;cc._currentShaderProgram=-1;cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];cc._blendingSource=-1;cc._blendingDest=-1;cc._GLServerState=0;cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0);var _currBuffers={};WebGLRenderingContext.prototype.glBindBuffer=WebGLRenderingContext.prototype.bindBuffer;WebGLRenderingContext.prototype.bindBuffer=function(f,e){return _currBuffers[f]!==e?(this.glBindBuffer(f,e),_currBuffers[f]=e,!1):!0};WebGLRenderingContext.prototype.glEnableVertexAttribArray=WebGLRenderingContext.prototype.enableVertexAttribArray;WebGLRenderingContext.prototype.enableVertexAttribArray=function(d){d===cc.VERTEX_ATTRIB_FLAG_POSITION?this._vertexAttribPosition||(this.glEnableVertexAttribArray(d),this._vertexAttribPosition=!0):d===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor||(this.glEnableVertexAttribArray(d),this._vertexAttribColor=!0):d===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords||(this.glEnableVertexAttribArray(d),this._vertexAttribTexCoords=!0):this.glEnableVertexAttribArray(d)};WebGLRenderingContext.prototype.glDisableVertexAttribArray=WebGLRenderingContext.prototype.disableVertexAttribArray;WebGLRenderingContext.prototype.disableVertexAttribArray=function(d){d===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor&&(this.glDisableVertexAttribArray(d),this._vertexAttribColor=!1):d===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords&&(this.glDisableVertexAttribArray(d),this._vertexAttribTexCoords=!1):0!==d&&this.glDisableVertexAttribArray(d)}}cc.glInvalidateStateCache=function(){cc.kmGLFreeAll();cc._currentProjectionMatrix=-1;if(cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var d=0;d<cc.MAX_ACTIVETEXTURE;d++){cc._currentBoundTexture[d]=-1}cc._blendingSource=-1;cc._blendingDest=-1;cc._GLServerState=0}};cc.glUseProgram=cc.ENABLE_GL_STATE_CACHE?function(d){d!==cc._currentShaderProgram&&(cc._currentShaderProgram=d,cc._renderContext.useProgram(d))}:function(d){cc._renderContext.useProgram(d)};cc.glDeleteProgram=function(d){cc.ENABLE_GL_STATE_CACHE&&d===cc._currentShaderProgram&&(cc._currentShaderProgram=-1);gl.deleteProgram(d)};cc.setBlending=function(h,g){var f=cc._renderContext;h===f.ONE&&g===f.ZERO?f.disable(f.BLEND):(f.enable(f.BLEND),cc._renderContext.blendFunc(h,g))};cc.glBlendFunc=cc.ENABLE_GL_STATE_CACHE?function(f,e){if(f!==cc._blendingSource||e!==cc._blendingDest){cc._blendingSource=f,cc._blendingDest=e,cc.setBlending(f,e)}}:cc.setBlending;cc.glBlendFuncForParticle=function(h,g){if(h!==cc._blendingSource||g!==cc._blendingDest){cc._blendingSource=h;cc._blendingDest=g;var f=cc._renderContext;h===f.ONE&&g===f.ZERO?f.disable(f.BLEND):(f.enable(f.BLEND),f.blendFuncSeparate(f.SRC_ALPHA,g,h,g))}};cc.glBlendResetToCache=function(){var d=cc._renderContext;d.blendEquation(d.FUNC_ADD);cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(d.BLEND_SRC,d.BLEND_DST)};cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1};cc.glBindTexture2D=function(d){cc.glBindTexture2DN(0,d)};cc.glBindTexture2DN=cc.ENABLE_GL_STATE_CACHE?function(h,g){if(cc._currentBoundTexture[h]!==g){cc._currentBoundTexture[h]=g;var f=cc._renderContext;f.activeTexture(f.TEXTURE0+h);g?f.bindTexture(f.TEXTURE_2D,g._webTextureObj):f.bindTexture(f.TEXTURE_2D,null)}}:function(h,g){var f=cc._renderContext;f.activeTexture(f.TEXTURE0+h);g?f.bindTexture(f.TEXTURE_2D,g._webTextureObj):f.bindTexture(f.TEXTURE_2D,null)};cc.glDeleteTexture=function(d){cc.glDeleteTextureN(0,d)};cc.glDeleteTextureN=function(f,e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentBoundTexture[f]&&(cc._currentBoundTexture[f]=-1);cc._renderContext.deleteTexture(e._webTextureObj)};cc.glBindVAO=function(d){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==d&&(cc._uVAO=d)};cc.glEnable=function(d){};cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_className:"LabelAtlas",ctor:function(n,m,k,j,h){cc.AtlasNode.prototype.ctor.call(this);this._renderCmd.setCascade();m&&cc.LabelAtlas.prototype.initWithString.call(this,n,m,k,j,h)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelAtlas.WebGLRenderCmd(this):new cc.LabelAtlas.CanvasRenderCmd(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(f,e){this.addEventListener("load",f,e)},initWithString:function(w,v,u,t,s){var r=w+"",p,o;if(void 0===u){u=cc.loader.getRes(v);if(1!==parseInt(u.version,10)){return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1}v=cc.path.changeBasename(v,u.textureFilename);t=cc.contentScaleFactor();p=parseInt(u.itemWidth,10)/t;o=parseInt(u.itemHeight,10)/t;u=String.fromCharCode(parseInt(u.firstChar,10))}else{p=u||0,o=t||0,u=s||" "}var j=null,j=v instanceof cc.Texture2D?v:cc.textureCache.addImage(v);this._textureLoaded=v=j.isLoaded();v||(this._string=r,j.addEventListener("load",function(d){this.initWithTexture(j,p,o,r.length);this.string=this._string;this.setColor(this._renderCmd._displayedColor);this.dispatchEvent("load")},this));return this.initWithTexture(j,p,o,r.length)?(this._mapStartChar=u,this.string=r,!0):!1},setColor:function(d){cc.AtlasNode.prototype.setColor.call(this,d);this._renderCmd.updateAtlasValues()},getString:function(){return this._string},addChild:function(h,g,f){this._renderCmd._addChild(h);cc.Node.prototype.addChild.call(this,h,g,f)},updateAtlasValues:function(){this._renderCmd.updateAtlasValues()},setString:function(f){f=String(f);var e=f.length;this._string=f;this.setContentSize(e*this._itemWidth,this._itemHeight);this._renderCmd.setString(f);this._renderCmd.updateAtlasValues();this.quadsToDraw=e}});(function(){var d=cc.LabelAtlas.prototype;cc.defineGetterSetter(d,"opacity",d.getOpacity,d.setOpacity);cc.defineGetterSetter(d,"color",d.getColor,d.setColor);cc.defineGetterSetter(d,"string",d.getString,d.setString)})();cc.LabelAtlas.create=function(n,m,k,j,h){return new cc.LabelAtlas(n,m,k,j,h)};(function(){cc.LabelAtlas.CanvasRenderCmd=function(e){cc.AtlasNode.CanvasRenderCmd.call(this,e);this._needDraw=!1};var d=cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(cc.AtlasNode.CanvasRenderCmd.prototype);d.constructor=cc.LabelAtlas.CanvasRenderCmd;d.setCascade=function(){var e=this._node;e._cascadeOpacityEnabled=!0;e._cascadeColorEnabled=!1};d.updateAtlasValues=function(){for(var A=this._node,z=A._string||"",y=z.length,x=this._textureToRender,w=A._itemWidth,v=A._itemHeight,u=0,t=-1;u<y;u++){var o=z.charCodeAt(u)-A._mapStartChar.charCodeAt(0),j=parseInt(o%A._itemsPerRow,10),o=parseInt(o/A._itemsPerRow,10);if(!(0>j||0>o||(j=cc.rect(j*w,o*v,w,v),o=x._contentSize,0>j.x||0>j.y||j.x+j.width>o.width||j.y+j.height>o.height))){t++;var o=z.charCodeAt(u),B=A.getChildByTag(u);B?32===o?(B.init(),B.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(B.initWithTexture(x,j),B.visible=!0):(B=new cc.Sprite,32===o?(B.init(),B.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):B.initWithTexture(x,j),cc.Node.prototype.addChild.call(A,B,0,u));B.setPosition(t*w+w/2,v/2)}}this.updateContentSize(u,t+1)};d.updateContentSize=function(m,k){var j=this._node,h=j._contentSize;m!==k&&m*j._itemWidth===h.width&&j._itemHeight===h.height&&j.setContentSize(k*j._itemWidth,j._itemHeight)};d.setString=function(m){m=this._node;if(m._children){m=m._children;for(var k=m.length,j=0;j<k;j++){var h=m[j];h&&!h._lateChild&&(h.visible=!1)}}};d._addChild=function(){child._lateChild=!0}})();(function(){cc.LabelAtlas.WebGLRenderCmd=function(e){cc.AtlasNode.WebGLRenderCmd.call(this,e);this._needDraw=!0};var d=cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(cc.AtlasNode.WebGLRenderCmd.prototype);d.constructor=cc.LabelAtlas.WebGLRenderCmd;d._updateColor=function(){if(this._colorF32Array){var g=this._displayedColor,f=this._displayedOpacity/255;this._node._opacityModifyRGB?(this._colorF32Array[0]=g.r*f/255,this._colorF32Array[1]=g.g*f/255,this._colorF32Array[2]=g.b*f/255):(this._colorF32Array[0]=g.r/255,this._colorF32Array[1]=g.g/255,this._colorF32Array[2]=g.b/255);this._colorF32Array[3]=f}};d.setCascade=function(){var e=this._node;e._cascadeOpacityEnabled=!0;e._cascadeColorEnabled=!0};d.rendering=function(m){cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,m);if(cc.LABELATLAS_DEBUG_DRAW){var k=this._node;m=k.getContentSize();var k=k.getBoundingBoxToWorld(),j=k.x,h=k.y;m.width=k.width;m.height=k.height;m=[cc.p(j,h),cc.p(j+m.width,h),cc.p(m.width+j,m.height+h),cc.p(j,h+m.height)];cc._drawingUtil.drawPoly(m,4,!0)}};d.updateAtlasValues=function(){var V=this._node,U=V._string,T=U.length,S=this._textureAtlas,R=S.texture,Q=R.pixelsWidth,R=R.pixelsHeight,P=V._itemWidth,O=V._itemHeight;V._ignoreContentScaleFactor||(P=V._itemWidth*cc.contentScaleFactor(),O=V._itemHeight*cc.contentScaleFactor());T>S.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var N=S.quads,K=V._itemWidth,J=V._itemHeight,E=0,I=-1;E<T;E++){var D=U.charCodeAt(E)-V._mapStartChar.charCodeAt(0),H=D%V._itemsPerRow,M=0|D/V._itemsPerRow;if(!(0>H||0>M||H*K+K>Q||M*J+J>R)){I++;var C;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(H=(2*H*P+1)/(2*Q),D=H+(2*P-2)/(2*Q),M=(2*M*O+1)/(2*R),C=M+(2*O-2)/(2*R)):(H=H*P/Q,D=H+P/Q,M=M*O/R,C=M+O/R);var L=N[E],G=L.tl,j=L.tr,o=L.bl,L=L.br;G.texCoords.u=H;G.texCoords.v=M;j.texCoords.u=D;j.texCoords.v=M;o.texCoords.u=H;o.texCoords.v=C;L.texCoords.u=D;L.texCoords.v=C;o.vertices.x=I*K;o.vertices.y=0;o.vertices.z=0;L.vertices.x=I*K+K;L.vertices.y=0;L.vertices.z=0;G.vertices.x=I*K;G.vertices.y=V._itemHeight;G.vertices.z=0;j.vertices.x=I*K+K;j.vertices.y=V._itemHeight;j.vertices.z=0}}this._updateColor();this.updateContentSize(E,I+1);0<T&&(S.dirty=!0,V=S.totalQuads,T>V&&S.increaseTotalQuadsWith(T-V))};d.updateContentSize=function(m,k){var j=this._node,h=j._contentSize;m!==k&&m*j._itemWidth===h.width&&j._itemHeight===h.height&&j.setContentSize(k*j._itemWidth,j._itemHeight)};d.setString=function(e){e=e.length;e>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(e)};d._addChild=function(){}})();cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(n,m){m?this._initialString=n:this._string=n;var k=this._children;if(k){for(var j=0;j<k.length;j++){var h=k[j];h&&h.setVisible(!1)}}this._textureLoaded&&(this.createFontChars(),m&&this.updateLabel())},ctor:function(n,m,k,j,h){cc.SpriteBatchNode.prototype.ctor.call(this);this._imageOffset=cc.p(0,0);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0;this.initWithString(n,m,k,j,h)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(f,e){this.addEventListener("load",f,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(h){this._opacityModifyRGB=h;if(h=this._children){for(var g=0;g<h.length;g++){var f=h[g];f&&(f.opacityModifyRGB=this._opacityModifyRGB)}}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(p,o,n,m,k){p=p||"";this._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");if(o){var j=cc.loader.getRes(o);if(!j){return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1}this._config=j;this._fntFile=o;o=cc.textureCache.addImage(j.atlasName);(this._textureLoaded=j=o.isLoaded())||o.addEventListener("load",function(d){this._textureLoaded=!0;this.initWithTexture(d,this._initialString.length);this.setString(this._initialString,!0);this.dispatchEvent("load")},this)}else{o=new cc.Texture2D,j=new Image,o.initWithElement(j),this._textureLoaded=!1}return this.initWithTexture(o,p.length)?(this._alignment=m||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=k||cc.p(0,0),this._width=void 0===n?-1:n,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setAnchorPoint(0.5,0.5),this.setString(p,!0),!0):!1},createFontChars:function(){var O=this._renderCmd,N=O._texture||this._texture,M=0,L=cc.size(0,0),K=0,J=1,I=this._string,H=I?I.length:0;if(0!==H){var G,F=this._config,D=F.kerningDict,C=F.commonHeight,y=F.fontDefDictionary;for(G=0;G<H-1;G++){10===I.charCodeAt(G)&&J++}var B=C*J,J=-(C-C*J),o=-1,z;for(G=0;G<H;G++){if(C=I.charCodeAt(G),0!==C){if(10===C){M=0,J-=F.commonHeight}else{o=D[o<<16|C&65535]||0;z=y[C];z||(cc.log("cocos2d: LabelBMFont: character not found "+I[G]),z={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var E=cc.rect(z.rect.x,z.rect.y,z.rect.width,z.rect.height),E=cc.rectPixelsToPoints(E);E.x+=this._imageOffset.x;E.y+=this._imageOffset.y;var j=this.getChildByTag(G);j?O._updateCharTexture(j,E,C):(j=new cc.Sprite,j.initWithTexture(N,E,!1),j._newTextureWhenChangeColor=!0,this.addChild(j,0,G));j.opacityModifyRGB=this._opacityModifyRGB;O._updateCharColorAndOpacity(j);E=cc.p(M+z.xOffset+0.5*z.rect.width+o,J+(F.commonHeight-z.yOffset)-0.5*E.height*cc.contentScaleFactor());j.setPosition(cc.pointPixelsToPoints(E));M+=z.xAdvance+o;o=C;K<M&&(K=M)}}}L.width=z&&z.xAdvance<z.rect.width?K-z.xAdvance+z.rect.width:K;L.height=B;this.setContentSize(cc.sizePixelsToPoints(L))}},updateString:function(n){var m=this._children;if(m){for(var k=0,j=m.length;k<j;k++){var h=m[k];h&&(h.visible=!1)}}this._config&&this.createFontChars();n||this.updateLabel()},getString:function(){return this._initialString},setString:function(f,e){f=String(f);null==e&&(e=!0);null!=f&&cc.isString(f)||(f+="");this._initialString=f;this._setString(f,e)},_setStringForSetter:function(d){this.setString(d,!1)},setCString:function(d){this.setString(d,!0)},_getCharsWidth:function(k,j){if(0>=j){return 0}var h=this.getChildByTag(k),g=this.getChildByTag(k+j);return this._getLetterPosXLeft(g)-this._getLetterPosXLeft(h)},_checkWarp:function(B,A,z,y){for(var x=B[A],w=0,v=0;v<A;v++){w+=B[v].length}var w=w+A-y,u=this._getCharsWidth(w,B[A].length-1);if(u>z&&1<x.length){y=z/u*x.length|0;for(var v=x.substr(y),t=u-this._getCharsWidth(w+y,v.length-1),o,j=0,C=0;t>z&&100>C++;){y*=z/t,y|=0,v=x.substr(y),t=u-this._getCharsWidth(w+y,v.length-1)}for(C=0;t<z&&100>C++;){v&&(j=(o=cc.LabelTTF._wordRex.exec(v))?o[0].length:1,o=v),this._lineBreakWithoutSpaces&&(j=0),y+=j,v=x.substr(y),t=u-this._getCharsWidth(w+y,v.length-1)}y-=j;0===y&&(y=1,o=o.substr(1));z=x.substr(0,y);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(o||v)&&(j=(w=cc.LabelTTF._lastWordRex.exec(z))?w[0].length:0,this._lineBreakWithoutSpaces&&(j=0),y-=j,o=x.substr(y),z=x.substr(0,y));cc.LabelTTF._firsrEnglish.test(o)&&(w=cc.LabelTTF._lastEnglish.exec(z))&&z!==w[0]&&(j=w[0].length,this._lineBreakWithoutSpaces&&(j=0),y-=j,o=x.substr(y),z=x.substr(0,y));B[A]=o||v;B.splice(A,0,z)}},updateLabel:function(){this.string=this._initialString;var w,v,u;if(0<this._width){var t=this.string.split("\n"),s="",r=0,p=0;for(w=0;w<t.length;w++){p=t.length,this._checkWarp(t,w,this._width*this._scaleX,r),p<t.length&&r++,0<w&&(s+="\n"),s+=t[w]}s+=String.fromCharCode(0);this._setString(s,!1)}if(this._alignment!==cc.TEXT_ALIGNMENT_LEFT){for(t=w=0,s=this._string.length,r=[],p=0;p<s;p++){if(10===this._string[p].charCodeAt(0)||0===this._string[p].charCodeAt(0)){v=0;var o=r.length;if(0===o){t++}else{if(u=w+o-1+t,!(0>u)){var j=this.getChildByTag(u);if(null!=j){v=j.getPositionX()+j._getWidth()/2;j=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_CENTER:j=this.width/2-v/2;break;case cc.TEXT_ALIGNMENT_RIGHT:j=this.width-v}if(0!==j){for(v=0;v<o;v++){u=w+v+t,0>u||(u=this.getChildByTag(u))&&(u.x+=j)}}w+=o;t++;r.length=0}}}}else{r.push(this._string[w])}}}},setAlignment:function(d){this._alignment=d;this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(d){this._width=d;this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(d){this._lineBreakWithoutSpaces=d;this.updateLabel()},setScale:function(f,e){cc.Node.prototype.setScale.call(this,f,e);this.updateLabel()},setScaleX:function(d){cc.Node.prototype.setScaleX.call(this,d);this.updateLabel()},setScaleY:function(d){cc.Node.prototype.setScaleY.call(this,d);this.updateLabel()},setFntFile:function(f){if(null!=f&&f!==this._fntFile){var e=cc.loader.getRes(f);e?(this._fntFile=f,this._config=e,f=cc.textureCache.addImage(e.atlasName),(this._textureLoaded=e=f.isLoaded())?(this.setTexture(f),this.createFontChars()):f.addEventListener("load",function(d){this._textureLoaded=!0;this.setTexture(d);this.createFontChars();this._changeTextureColor();this.updateLabel();this.dispatchEvent("load")},this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file")}},getFntFile:function(){return this._fntFile},setTexture:function(d){this._texture=d;this._renderCmd.setTexture(d)},setAnchorPoint:function(f,e){cc.Node.prototype.setAnchorPoint.call(this,f,e);this.updateLabel()},_setAnchorX:function(d){cc.Node.prototype._setAnchorX.call(this,d);this.updateLabel()},_setAnchorY:function(d){cc.Node.prototype._setAnchorY.call(this,d);this.updateLabel()},_atlasNameFromFntFile:function(d){},_kerningAmountForFirst:function(k,j){var h=0;if(this._configuration.kerningDictionary){var g=this._configuration.kerningDictionary[(k<<16|j&65535).toString()];g&&(h=g.amount)}return h},_getLetterPosXLeft:function(d){return d.getPositionX()*this._scaleX-d._getWidth()*this._scaleX*d._getAnchorX()},_getLetterPosXRight:function(d){return d.getPositionX()*this._scaleX+d._getWidth()*this._scaleX*d._getAnchorX()},_isspace_unicode:function(d){d=d.charCodeAt(0);return 9<=d&&13>=d||32===d||133===d||160===d||5760===d||8192<=d&&8202>=d||8232===d||8233===d||8239===d||8287===d||12288===d},_utf8_trim_ws:function(h){var g=h.length;if(!(0>=g)&&(g-=1,this._isspace_unicode(h[g]))){for(var f=g-1;0<=f;--f){if(this._isspace_unicode(h[f])){g=f}else{break}}this._utf8_trim_from(h,g)}},_utf8_trim_from:function(h,g){var f=h.length;g>=f||0>g||h.splice(g,f)}});(function(){var d=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(d);cc.defineGetterSetter(d,"string",d.getString,d._setStringForSetter);cc.defineGetterSetter(d,"boundingWidth",d._getBoundingWidth,d.setBoundingWidth);cc.defineGetterSetter(d,"textAlign",d._getAlignment,d.setAlignment);cc.defineGetterSetter(d,"texture",d.getTexture,d.setTexture)})();cc.LabelBMFont.create=function(n,m,k,j,h){return new cc.LabelBMFont(n,m,k,j,h)};var _fntLoader={INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(s){s=s.match(this.ITEM_EXP);var r={};if(s){for(var p=0,o=s.length;p<o;p++){var n=s[p],m=n.indexOf("\x3d"),j=n.substring(0,m),n=n.substring(m+1);n.match(this.INT_EXP)?n=parseInt(n):'"'===n[0]&&(n=n.substring(1,n.length-1));r[j]=n}}return r},parseFnt:function(u,t){var s={},r=this._parseStrToObj(u.match(this.INFO_EXP)[0]).padding.split(",");parseInt(r[0]);parseInt(r[1]);parseInt(r[2]);parseInt(r[3]);r=this._parseStrToObj(u.match(this.COMMON_EXP)[0]);s.commonHeight=r.lineHeight;if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var p=cc.configuration.getMaxTextureSize();(r.scaleW>p.width||r.scaleH>p.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==r.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");r=this._parseStrToObj(u.match(this.PAGE_EXP)[0]);0!==r.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found");s.atlasName=cc.path.changeBasename(t,r.file);for(var o=u.match(this.CHAR_EXP),n=s.fontDefDictionary={},r=0,p=o.length;r<p;r++){var j=this._parseStrToObj(o[r]);n[j.id]={rect:{x:j.x,y:j.y,width:j.width,height:j.height},xOffset:j.xoffset,yOffset:j.yoffset,xAdvance:j.xadvance}}o=s.kerningDict={};if(n=u.match(this.KERNING_EXP)){for(r=0,p=n.length;r<p;r++){j=this._parseStrToObj(n[r]),o[j.first<<16|j.second&65535]=j.amount}}return s},load:function(n,m,k,j){var h=this;cc.loader.loadTxt(n,function(f,d){if(f){return j(f)}j(null,h.parseFnt(d,m))})}};cc.loader.register(["fnt"],_fntLoader);(function(){cc.LabelBMFont.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e)};var d=cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.LabelBMFont.CanvasRenderCmd;d._updateCharTexture=function(j,h,g){32===g?j.setTextureRect(h,!1,cc.size(0,0)):(j.setTextureRect(h,!1),j.visible=!0)};d._updateCharColorAndOpacity=function(e){e._displayedColor=this._displayedColor;e._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);e._displayedOpacity=this._displayedOpacity;e._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)};d.setTexture=function(v){for(var t=this._node,s=t._children,r=this._displayedColor,p=0;p<s.length;p++){var o=s[p],j=o._renderCmd,u=j._displayedColor;if(t._texture===j._texture||u.r===r.r&&u.g===r.g&&u.b===r.b){o.texture=v}}t._texture=v};d._changeTextureColor=function(){var t=this._node,s=t._texture,r=s.getContentSize(),p=t._texture,o=p.getHtmlElementObj(),n=this._displayedColor,j=cc.rect(0,0,o.width,o.height);s&&0<r.width&&o&&(s=p._generateColorTexture(n.r,n.g,n.b,j),t.setTexture(s))};d._updateChildrenDisplayedOpacity=function(e){cc.Node.prototype.updateDisplayedOpacity.call(e,this._displayedOpacity)};d._updateChildrenDisplayedColor=function(e){cc.Node.prototype.updateDisplayedColor.call(e,this._displayedColor)}})();(function(){cc.LabelBMFont.WebGLRenderCmd=function(e){cc.Node.WebGLRenderCmd.call(this,e)};var d=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);d.constructor=cc.LabelBMFont.WebGLRenderCmd;d.setTexture=function(e){this._node.setOpacityModifyRGB(this._node._texture.hasPremultipliedAlpha())};d._updateCharTexture=function(j,h,g){j.setTextureRect(h,!1);j.visible=!0};d._changeTextureColor=function(){};d._updateCharColorAndOpacity=function(){}})();cc.v2fzero=function(){return{x:0,y:0}};cc.v2f=function(f,e){return{x:f,y:e}};cc.v2fadd=function(f,e){return cc.v2f(f.x+e.x,f.y+e.y)};cc.v2fsub=function(f,e){return cc.v2f(f.x-e.x,f.y-e.y)};cc.v2fmult=function(f,e){return cc.v2f(f.x*e,f.y*e)};cc.v2fperp=function(d){return cc.v2f(-d.y,d.x)};cc.v2fneg=function(d){return cc.v2f(-d.x,-d.y)};cc.v2fdot=function(f,e){return f.x*e.x+f.y*e.y};cc.v2fforangle=function(d){return cc.v2f(Math.cos(d),Math.sin(d))};cc.v2fnormalize=function(d){d=cc.pNormalize(cc.p(d.x,d.y));return cc.v2f(d.x,d.y)};cc.__v2f=function(d){return cc.v2f(d.x,d.y)};cc.__t=function(d){return{u:d.x,v:d.y}};cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(f,e){void 0===e?(this._blendFunc.src=f.src,this._blendFunc.dst=f.dst):(this._blendFunc.src=f,this._blendFunc.dst=e)},setLineWidth:function(d){this._lineWidth=d},getLineWidth:function(){return this._lineWidth},setDrawColor:function(f){var e=this._drawColor;e.r=f.r;e.g=f.g;e.b=f.b;e.a=null==f.a?255:f.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}});cc.DrawNode.create=function(){return new cc.DrawNode};cc.DrawNode.TYPE_DOT=0;cc.DrawNode.TYPE_SEGMENT=1;cc.DrawNode.TYPE_POLY=2;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(w,v,u,t,s,r,p,o,j){this.type=w;this.verts=v||null;this.fillColor=u||null;this.lineWidth=t||0;this.lineColor=s||null;this.lineCap=r||"butt";this.isClosePolygon=p||!1;this.isFill=o||!1;this.isStroke=j||!1},cc.extend(cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var d=this._renderCmd;d._buffer=this._buffer=[];d._drawColor=this._drawColor=cc.color(255,255,255,255);d._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this.init()},drawRect:function(n,m,k,j,h){j=null==j?this._lineWidth:j;h=h||this.getDrawColor();null==h.a&&(h.a=255);n=[n,cc.p(m.x,n.y),m,cc.p(n.x,m.y)];m=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);m.verts=n;m.lineWidth=j;m.lineColor=h;m.isClosePolygon=!0;m.isStroke=!0;m.lineCap="butt";if(m.fillColor=k){null==k.a&&(k.a=255),m.isFill=!0}this._buffer.push(m)},drawCircle:function(B,A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);for(var u=2*Math.PI/y,t=[],o=0;o<=y;o++){var j=o*u,C=A*Math.cos(j+z)+B.x,j=A*Math.sin(j+z)+B.y;t.push(cc.p(C,j))}x&&t.push(cc.p(B.x,B.y));B=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);B.verts=t;B.lineWidth=w;B.lineColor=v;B.isClosePolygon=!0;B.isStroke=!0;this._buffer.push(B)},drawQuadBezier:function(A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);for(var u=[],t=0,s=0;s<x;s++){var o=Math.pow(1-t,2)*A.x+2*(1-t)*t*z.x+t*t*y.x,j=Math.pow(1-t,2)*A.y+2*(1-t)*t*z.y+t*t*y.y;u.push(cc.p(o,j));t+=1/x}u.push(cc.p(y.x,y.y));A=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);A.verts=u;A.lineWidth=w;A.lineColor=v;A.isStroke=!0;A.lineCap="round";this._buffer.push(A)},drawCubicBezier:function(B,A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);for(var u=[],t=0,o=0;o<x;o++){var j=Math.pow(1-t,3)*B.x+3*Math.pow(1-t,2)*t*A.x+3*(1-t)*t*t*z.x+t*t*t*y.x,C=Math.pow(1-t,3)*B.y+3*Math.pow(1-t,2)*t*A.y+3*(1-t)*t*t*z.y+t*t*t*y.y;u.push(cc.p(j,C));t+=1/x}u.push(cc.p(y.x,y.y));B=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);B.verts=u;B.lineWidth=w;B.lineColor=v;B.isStroke=!0;B.lineCap="round";this._buffer.push(B)},drawCatmullRom:function(k,j,h,g){this.drawCardinalSpline(k,0.5,j,h,g)},drawCardinalSpline:function(y,x,w,v,u){v=v||this._lineWidth;u=u||this.getDrawColor();null==u.a&&(u.a=255);for(var t=[],s,r,o=1/y.length,j=0;j<w+1;j++){r=j/w,1===r?(s=y.length-1,r=1):(s=0|r/o,r=(r-o*s)/o),s=cc.cardinalSplineAt(cc.getControlPointAt(y,s-1),cc.getControlPointAt(y,s-0),cc.getControlPointAt(y,s+1),cc.getControlPointAt(y,s+2),x,r),t.push(s)}y=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);y.verts=t;y.lineWidth=v;y.lineColor=u;y.isStroke=!0;y.lineCap="round";this._buffer.push(y)},drawDot:function(k,j,h){h=h||this.getDrawColor();null==h.a&&(h.a=255);var g=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);g.verts=[k];g.lineWidth=j;g.fillColor=h;this._buffer.push(g)},drawDots:function(n,m,k){if(n&&0!=n.length){k=k||this.getDrawColor();null==k.a&&(k.a=255);for(var j=0,h=n.length;j<h;j++){this.drawDot(n[j],m,k)}}},drawSegment:function(n,m,k,j){k=k||this._lineWidth;j=j||this.getDrawColor();null==j.a&&(j.a=255);var h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=[n,m];h.lineWidth=2*k;h.lineColor=j;h.isStroke=!0;h.lineCap="round";this._buffer.push(h)},drawPoly_:function(n,m,k,j){k=null==k?this._lineWidth:k;j=j||this.getDrawColor();null==j.a&&(j.a=255);var h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=n;h.fillColor=m;h.lineWidth=k;h.lineColor=j;h.isClosePolygon=!0;h.isStroke=!0;h.lineCap="round";m&&(h.isFill=!0);this._buffer.push(h)},drawPoly:function(p,o,n,m){for(var k=[],j=0;j<p.length;j++){k.push(cc.p(p[j].x,p[j].y))}return this.drawPoly_(k,o,n,m)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}})):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_dirty:!1,_className:"DrawNodeWebGL",ctor:function(){cc.Node.prototype.ctor.call(this);this._buffer=[];this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this._drawColor=cc.color(255,255,255,255);this.init()},init:function(){return cc.Node.prototype.init.call(this)?(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0):!1},drawRect:function(n,m,k,j,h){j=null==j?this._lineWidth:j;h=h||this.getDrawColor();null==h.a&&(h.a=255);n=[n,cc.p(m.x,n.y),m,cc.p(n.x,m.y)];null==k?this._drawSegments(n,j,h,!0):this.drawPoly(n,k,j,h)},drawCircle:function(B,A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);var u=2*Math.PI/y,t=[],o;for(o=0;o<=y;o++){var j=o*u,C=A*Math.cos(j+z)+B.x,j=A*Math.sin(j+z)+B.y;t.push(cc.p(C,j))}x&&t.push(cc.p(B.x,B.y));w*=0.5;o=0;for(B=t.length;o<B-1;o++){this.drawSegment(t[o],t[o+1],w,v)}},drawQuadBezier:function(A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);for(var u=[],t=0,s=0;s<x;s++){var o=Math.pow(1-t,2)*A.x+2*(1-t)*t*z.x+t*t*y.x,j=Math.pow(1-t,2)*A.y+2*(1-t)*t*z.y+t*t*y.y;u.push(cc.p(o,j));t+=1/x}u.push(cc.p(y.x,y.y));this._drawSegments(u,w,v,!1)},drawCubicBezier:function(B,A,z,y,x,w,v){w=w||this._lineWidth;v=v||this.getDrawColor();null==v.a&&(v.a=255);for(var u=[],t=0,o=0;o<x;o++){var j=Math.pow(1-t,3)*B.x+3*Math.pow(1-t,2)*t*A.x+3*(1-t)*t*t*z.x+t*t*t*y.x,C=Math.pow(1-t,3)*B.y+3*Math.pow(1-t,2)*t*A.y+3*(1-t)*t*t*z.y+t*t*t*y.y;u.push(cc.p(j,C));t+=1/x}u.push(cc.p(y.x,y.y));this._drawSegments(u,w,v,!1)},drawCatmullRom:function(k,j,h,g){this.drawCardinalSpline(k,0.5,j,h,g)},drawCardinalSpline:function(y,x,w,v,u){v=v||this._lineWidth;u=u||this.getDrawColor();null==u.a&&(u.a=255);for(var t=[],s,r,o=1/y.length,j=0;j<w+1;j++){r=j/w,1===r?(s=y.length-1,r=1):(s=0|r/o,r=(r-o*s)/o),s=cc.cardinalSplineAt(cc.getControlPointAt(y,s-1),cc.getControlPointAt(y,s-0),cc.getControlPointAt(y,s+1),cc.getControlPointAt(y,s+2),x,r),t.push(s)}v*=0.5;y=0;for(x=t.length;y<x-1;y++){this.drawSegment(t[y],t[y+1],v,u)}},_render:function(){var f=cc._renderContext;f.bindBuffer(f.ARRAY_BUFFER,this._trianglesWebBuffer);this._dirty&&(f.bufferData(f.ARRAY_BUFFER,this._trianglesArrayBuffer,f.STREAM_DRAW),this._dirty=!1);var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;f.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);f.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);f.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);f.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,f.FLOAT,!1,e,0);f.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,f.UNSIGNED_BYTE,!0,e,8);f.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,f.FLOAT,!1,e,12);f.drawArrays(f.TRIANGLES,0,3*this._buffer.length);cc.incrementGLDraws(1)},_ensureCapacity:function(n){var m=this._buffer;if(m.length+n>this._bufferCapacity){var k=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;this._bufferCapacity+=Math.max(this._bufferCapacity,n);if(null==m||0===m.length){this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(k*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer)}else{n=[];for(var j=new ArrayBuffer(k*this._bufferCapacity),h=0;h<m.length;h++){n[h]=new cc.V2F_C4B_T2F_Triangle(m[h].a,m[h].b,m[h].c,j,h*k)}this._trianglesReader=new Uint8Array(j);this._trianglesArrayBuffer=j;this._buffer=n}}},drawDot:function(p,o,n){n=n||this.getDrawColor();null==n.a&&(n.a=255);var m={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a};n={vertices:{x:p.x-o,y:p.y-o},colors:m,texCoords:{u:-1,v:-1}};var k={vertices:{x:p.x-o,y:p.y+o},colors:m,texCoords:{u:-1,v:1}},j={vertices:{x:p.x+o,y:p.y+o},colors:m,texCoords:{u:1,v:1}};p={vertices:{x:p.x+o,y:p.y-o},colors:m,texCoords:{u:1,v:-1}};this._ensureCapacity(6);this._buffer.push(new cc.V2F_C4B_T2F_Triangle(n,k,j,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._buffer.push(new cc.V2F_C4B_T2F_Triangle(n,j,p,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT));this._dirty=!0},drawDots:function(n,m,k){if(n&&0!==n.length){k=k||this.getDrawColor();null==k.a&&(k.a=255);for(var j=0,h=n.length;j<h;j++){this.drawDot(n[j],m,k)}}},drawSegment:function(D,C,B,A){A=A||this.getDrawColor();null==A.a&&(A.a=255);B=B||0.5*this._lineWidth;this._ensureCapacity(18);A={r:0|A.r,g:0|A.g,b:0|A.b,a:0|A.a};var z=cc.__v2f(D),y=cc.__v2f(C);C=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(y,z)));D=cc.v2fperp(C);var x=cc.v2fmult(C,B),w=cc.v2fmult(D,B);B=cc.v2fsub(y,cc.v2fadd(x,w));var u=cc.v2fadd(y,cc.v2fsub(x,w)),o=cc.v2fsub(y,x),y=cc.v2fadd(y,x),j=cc.v2fsub(z,x),G=cc.v2fadd(z,x),E=cc.v2fsub(z,cc.v2fsub(x,w)),z=cc.v2fadd(z,cc.v2fadd(x,w)),x=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,w=this._trianglesArrayBuffer,F=this._buffer;F.push(new cc.V2F_C4B_T2F_Triangle({vertices:B,colors:A,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(C,D)))},{vertices:u,colors:A,texCoords:cc.__t(cc.v2fsub(C,D))},{vertices:o,colors:A,texCoords:cc.__t(cc.v2fneg(C))},w,F.length*x));F.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:A,texCoords:cc.__t(C)},{vertices:u,colors:A,texCoords:cc.__t(cc.v2fsub(C,D))},{vertices:o,colors:A,texCoords:cc.__t(cc.v2fneg(C))},w,F.length*x));F.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:A,texCoords:cc.__t(C)},{vertices:j,colors:A,texCoords:cc.__t(cc.v2fneg(C))},{vertices:o,colors:A,texCoords:cc.__t(cc.v2fneg(C))},w,F.length*x));F.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:A,texCoords:cc.__t(C)},{vertices:j,colors:A,texCoords:cc.__t(cc.v2fneg(C))},{vertices:G,colors:A,texCoords:cc.__t(C)},w,F.length*x));F.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:A,texCoords:cc.__t(cc.v2fsub(D,C))},{vertices:j,colors:A,texCoords:cc.__t(cc.v2fneg(C))},{vertices:G,colors:A,texCoords:cc.__t(C)},w,F.length*x));F.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:A,texCoords:cc.__t(cc.v2fsub(D,C))},{vertices:z,colors:A,texCoords:cc.__t(cc.v2fadd(C,D))},{vertices:G,colors:A,texCoords:cc.__t(C)},w,F.length*x));this._dirty=!0},drawPoly:function(O,N,M,L){if(null==N){this._drawSegments(O,M,L,!0)}else{null==N.a&&(N.a=255);null==L.a&&(L.a=255);M=null==M?this._lineWidth:M;M*=0.5;N={r:0|N.r,g:0|N.g,b:0|N.b,a:0|N.a};L={r:0|L.r,g:0|L.g,b:0|L.b,a:0|L.a};var K=[],J,I,H,G,F=O.length;for(J=0;J<F;J++){I=cc.__v2f(O[(J-1+F)%F]);H=cc.__v2f(O[J]);G=cc.__v2f(O[(J+1)%F]);var D=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(H,I)));H=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(G,H)));D=cc.v2fmult(cc.v2fadd(D,H),1/(cc.v2fdot(D,H)+1));K[J]={offset:D,n:H}}D=0<M;this._ensureCapacity(3*(3*F-2));var C=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,y=this._trianglesArrayBuffer,B=this._buffer,o=!1==D?0.5:0;for(J=0;J<F-2;J++){I=cc.v2fsub(cc.__v2f(O[0]),cc.v2fmult(K[0].offset,o)),H=cc.v2fsub(cc.__v2f(O[J+1]),cc.v2fmult(K[J+1].offset,o)),G=cc.v2fsub(cc.__v2f(O[J+2]),cc.v2fmult(K[J+2].offset,o)),B.push(new cc.V2F_C4B_T2F_Triangle({vertices:I,colors:N,texCoords:cc.__t(cc.v2fzero())},{vertices:H,colors:N,texCoords:cc.__t(cc.v2fzero())},{vertices:G,colors:N,texCoords:cc.__t(cc.v2fzero())},y,B.length*C))}for(J=0;J<F;J++){o=(J+1)%F;I=cc.__v2f(O[J]);H=cc.__v2f(O[o]);G=K[J].n;var z=K[J].offset,E=K[o].offset,o=D?cc.v2fsub(I,cc.v2fmult(z,M)):cc.v2fsub(I,cc.v2fmult(z,0.5)),j=D?cc.v2fsub(H,cc.v2fmult(E,M)):cc.v2fsub(H,cc.v2fmult(E,0.5));I=D?cc.v2fadd(I,cc.v2fmult(z,M)):cc.v2fadd(I,cc.v2fmult(z,0.5));H=D?cc.v2fadd(H,cc.v2fmult(E,M)):cc.v2fadd(H,cc.v2fmult(E,0.5));D?(B.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:L,texCoords:cc.__t(cc.v2fneg(G))},{vertices:j,colors:L,texCoords:cc.__t(cc.v2fneg(G))},{vertices:H,colors:L,texCoords:cc.__t(G)},y,B.length*C)),B.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:L,texCoords:cc.__t(cc.v2fneg(G))},{vertices:I,colors:L,texCoords:cc.__t(G)},{vertices:H,colors:L,texCoords:cc.__t(G)},y,B.length*C))):(B.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:N,texCoords:cc.__t(cc.v2fzero())},{vertices:j,colors:N,texCoords:cc.__t(cc.v2fzero())},{vertices:H,colors:N,texCoords:cc.__t(G)},y,B.length*C)),B.push(new cc.V2F_C4B_T2F_Triangle({vertices:o,colors:N,texCoords:cc.__t(cc.v2fzero())},{vertices:I,colors:N,texCoords:cc.__t(G)},{vertices:H,colors:N,texCoords:cc.__t(G)},y,B.length*C)))}this._dirty=!0}},_drawSegments:function(H,G,F,E){G=null==G?this._lineWidth:G;F=F||this._drawColor;null==F.a&&(F.a=255);G*=0.5;if(!(0>=G)){F={r:0|F.r,g:0|F.g,b:0|F.b,a:0|F.a};var D=[],C,B,z,y,o=H.length;for(C=0;C<o;C++){B=cc.__v2f(H[(C-1+o)%o]);z=cc.__v2f(H[C]);y=cc.__v2f(H[(C+1)%o]);var j=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(z,B)));z=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(y,z)));y=cc.v2fmult(cc.v2fadd(j,z),1/(cc.v2fdot(j,z)+1));D[C]={offset:y,n:z}}this._ensureCapacity(3*(3*o-2));y=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;var j=this._trianglesArrayBuffer,M=this._buffer;E=E?o:o-1;for(C=0;C<E;C++){var J=(C+1)%o;B=cc.__v2f(H[C]);z=cc.__v2f(H[J]);var L=D[C].n,I=D[C].offset,K=D[J].offset,J=cc.v2fsub(B,cc.v2fmult(I,G)),x=cc.v2fsub(z,cc.v2fmult(K,G));B=cc.v2fadd(B,cc.v2fmult(I,G));z=cc.v2fadd(z,cc.v2fmult(K,G));M.push(new cc.V2F_C4B_T2F_Triangle({vertices:J,colors:F,texCoords:cc.__t(cc.v2fneg(L))},{vertices:x,colors:F,texCoords:cc.__t(cc.v2fneg(L))},{vertices:z,colors:F,texCoords:cc.__t(L)},j,M.length*y));M.push(new cc.V2F_C4B_T2F_Triangle({vertices:J,colors:F,texCoords:cc.__t(cc.v2fneg(L))},{vertices:B,colors:F,texCoords:cc.__t(L)},{vertices:z,colors:F,texCoords:cc.__t(L)},j,M.length*y))}this._dirty=!0}},clear:function(){this._buffer.length=0;this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}})});(function(){cc.DrawNode.CanvasRenderCmd=function(d){cc.Node.CanvasRenderCmd.call(this,d);this._needDraw=!0;this._blendFunc=this._drawColor=this._buffer=null};cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd;cc.extend(cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(s,r,p){s=s||cc._renderContext;s.getContext();var o=this._node._displayedOpacity/255;if(0!==o){s.setTransform(this._worldTransform,r,p);s.setGlobalAlpha(o);this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE&&s.setCompositeOperation("lighter");for(var o=this._buffer,n=0,m=o.length;n<m;n++){var j=o[n];switch(j.type){case cc.DrawNode.TYPE_DOT:this._drawDot(s,j,r,p);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(s,j,r,p);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(s,j,r,p)}}}},_drawDot:function(s,r,p,o){var n=r.fillColor,m=r.verts[0];r=r.lineWidth;var j=s.getContext();s.setFillStyle("rgba("+(0|n.r)+","+(0|n.g)+","+(0|n.b)+","+n.a/255+")");j.beginPath();j.arc(m.x*p,-m.y*o,r*p,0,2*Math.PI,!1);j.closePath();j.fill()},_drawSegment:function(w,v,u,t){var s=v.lineColor,r=v.verts[0],p=v.verts[1],o=v.lineWidth;v=v.lineCap;var j=w.getContext();w.setStrokeStyle("rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")");j.lineWidth=o*u;j.beginPath();j.lineCap=v;j.moveTo(r.x*u,-r.y*t);j.lineTo(p.x*u,-p.y*t);j.stroke()},_drawPoly:function(C,B,A,z){var y=B.verts,x=B.lineCap;if(null!=y){var w=B.fillColor,u=B.lineWidth,t=B.lineColor,o=B.isClosePolygon,j=B.isFill;B=B.isStroke;var E=C.getContext(),D=y[0];E.lineCap=x;w&&C.setFillStyle("rgba("+(0|w.r)+","+(0|w.g)+","+(0|w.b)+","+w.a/255+")");u&&(E.lineWidth=u*A);t&&C.setStrokeStyle("rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")");E.beginPath();E.moveTo(D.x*A,-D.y*z);C=1;for(x=y.length;C<x;C++){E.lineTo(y[C].x*A,-y[C].y*z)}o&&E.closePath();j&&E.fill();B&&E.stroke()}}})})();(function(){cc.DrawNode.WebGLRenderCmd=function(d){cc.Node.WebGLRenderCmd.call(this,d);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity()};cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd;cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(f){f=this._node;if(0<f._buffer.length){var e=this._worldTransform;this._matrix.mat[0]=e.a;this._matrix.mat[4]=e.c;this._matrix.mat[12]=e.tx;this._matrix.mat[1]=e.b;this._matrix.mat[5]=e.d;this._matrix.mat[13]=e.ty;cc.glBlendFunc(f._blendFunc.src,f._blendFunc.dst);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);f._render()}}})();cc.stencilBits=-1;cc.ClippingNode=cc.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(d){d=d||null;cc.Node.prototype.ctor.call(this);this._stencil=d;this.alphaThreshold=1;this.inverted=!1;this._renderCmd.initStencilBits()},init:function(d){this._stencil=d;this.alphaThreshold=1;this.inverted=!1;this._renderCmd.initStencilBits();return !0},onEnter:function(){cc.Node.prototype.onEnter.call(this);this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart();cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit();cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(d){this.alphaThreshold=d},isInverted:function(){return this.inverted},setInverted:function(d){this.inverted=d},getStencil:function(){return this._stencil},setStencil:function(d){this._stencil!==d&&this._renderCmd.setStencil(d)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}});_p=cc.ClippingNode.prototype;cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil);cc.ClippingNode.create=function(d){return new cc.ClippingNode(d)};(function(){cc.ClippingNode.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._clipElemType=this._godhelpme=this._needDraw=!1;this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback);this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback);this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var d=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.ClippingNode.CanvasRenderCmd;d.initStencilBits=function(){};d.setStencil=function(g){if(null!=g){if(this._node._stencil=g,g instanceof cc.DrawNode){if(g._buffer){for(var f=0;f<g._buffer.length;f++){g._buffer[f].isFill=!1,g._buffer[f].isStroke=!1}}g._renderCmd.rendering=function(r,p,o){p=p||cc.view.getScaleX();o=o||cc.view.getScaleY();r=(r||cc._renderContext).getContext();var j=this._transform;r.transform(j.a,j.b,j.c,j.d,j.tx*p,-j.ty*o);for(j=0;j<g._buffer.length;j++){var c=g._buffer[j].verts,s=c[0];r.moveTo(s.x*p,-s.y*o);for(s=c.length-1;0<s;s--){r.lineTo(c[s].x*p,-c[s].y*o)}}}}else{g._parent=this._node}}};d._saveCmdCallback=function(m,k,j){var h=m||cc._renderContext;m=h.getContext();this._clipElemType?(k=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),j=m.canvas,k.width=j.width,k.height=j.height,k.getContext("2d").drawImage(j,0,0)):(h.save(),m.beginPath(),h.setTransform(this._worldTransform,k,j),this._node.inverted&&(m.rect(0,0,m.canvas.width,-m.canvas.height),m.clip()))};d._setStencilCompositionOperation=function(j){if(j){var h=this._node;j._renderCmd&&j._renderCmd._blendFuncStr&&(j._renderCmd._blendFuncStr=h.inverted?"destination-out":"destination-in");if(j._children){j=j._children;for(var h=0,g=j.length;h<g;h++){this._setStencilCompositionOperation(j[h])}}}};d._clipCmdCallback=function(g){var f=this._node;g=(g||cc._renderContext).getContext();this._clipElemType?this._setStencilCompositionOperation(f._stencil):g.clip()};d._restoreCmdCallback=function(j){var h=cc.ClippingNode.CanvasRenderCmd._getSharedCache();j=j||cc._renderContext;var g=j.getContext();this._clipElemType?(g.save(),g.setTransform(1,0,0,1,0,0),g.globalCompositeOperation="destination-over",g.drawImage(h,0,0),g.restore(),this._dirtyFlag=0):j.restore()};d.transform=function(j,h){cc.Node.CanvasRenderCmd.prototype.transform.call(this,j,h);var g=this._node;g._stencil&&g._stencil._renderCmd&&g._stencil._renderCmd.transform(this,h)};d._cangodhelpme=function(e){if(!0===e||!1===e){cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=e}return cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme};d.visit=function(j){var h=this._node;if(h._visible){if(j=j||this.getParentRenderCmd()){this._curLevel=j._curLevel+1}this._clipElemType=!(!this._cangodhelpme()&&h._stencil instanceof cc.DrawNode);if(h._stencil&&h._stencil.visible){this._syncStatus(j);cc.renderer.pushRenderCommand(this._rendererSaveCmd);this._clipElemType?this.originVisit(j):h._stencil.visit(this);cc.renderer.pushRenderCommand(this._rendererClipCmd);if(this._clipElemType){h._stencil.visit(this)}else{j=h._children;this._cangodhelpme(!0);var g=j.length;if(0<g){for(h.sortAllChildren(),h=0;h<g;h++){j[h]._renderCmd.visit(this)}}this._cangodhelpme(!1)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd);this._dirtyFlag=0}else{this.inverted&&this.originVisit(j)}}};cc.ClippingNode.CanvasRenderCmd._sharedCache=null;cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}})();(function(){cc.ClippingNode.WebGLRenderCmd=function(e){cc.Node.WebGLRenderCmd.call(this,e);this._needDraw=!1;this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit);this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil);this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit);this._mask_layer_le=this._currentStencilEnabled=null};var d=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);d.constructor=cc.ClippingNode.WebGLRenderCmd;cc.ClippingNode.WebGLRenderCmd._init_once=null;cc.ClippingNode.WebGLRenderCmd._visit_once=null;cc.ClippingNode.WebGLRenderCmd._layer=-1;d.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0;cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),0>=cc.stencilBits&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)};d.transform=function(j,h){var g=this._node;this.originTransform(j,h);g._stencil&&g._stencil._renderCmd.transform(this,h)};d.visit=function(m){var k=this._node;if(k._visible){if(k._parent&&k._parent._renderCmd&&(this._curLevel=k._parent._renderCmd._curLevel+1),1>cc.stencilBits){this.originVisit(m)}else{if(k._stencil&&k._stencil.visible){if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits){cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),this.originVisit(m)}else{cc.renderer.pushRenderCommand(this._beforeVisitCmd);var j=cc.current_stack;j.stack.push(j.top);this._syncStatus(m);j.top=this._stackMatrix;k._stencil._renderCmd.visit(this);cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);if((m=k._children)&&0<m.length){var h=m.length;k.sortAllChildren();for(k=0;k<h;k++){m[k]._renderCmd.visit(this)}}cc.renderer.pushRenderCommand(this._afterVisitCmd);this._dirtyFlag=0;j.top=j.stack.pop()}}else{k.inverted&&this.originVisit(m)}}}};d.setStencil=function(g){var f=this._node;f._stencil&&(f._stencil._parent=null);f._stencil=g;f._stencil&&(f._stencil._parent=f)};d._onBeforeVisit=function(j){var h=j||cc._renderContext;j=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var g=1<<cc.ClippingNode.WebGLRenderCmd._layer;this._mask_layer_le=g|g-1;this._currentStencilEnabled=h.isEnabled(h.STENCIL_TEST);h.clear(h.DEPTH_BUFFER_BIT);h.enable(h.STENCIL_TEST);h.depthMask(!1);h.stencilFunc(h.NEVER,g,g);h.stencilOp(h.REPLACE,h.KEEP,h.KEEP);h.stencilMask(g);h.clear(h.STENCIL_BUFFER_BIT);1>j.alphaThreshold&&(h=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),cc.glUseProgram(h.getProgram()),h.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,j.alphaThreshold),h.setUniformLocationWithMatrix4fv(cc.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),cc.setProgram(j._stencil,h))};d._onAfterDrawStencil=function(e){e=e||cc._renderContext;e.depthMask(!0);e.stencilFunc(this._node.inverted?e.NOTEQUAL:e.EQUAL,this._mask_layer_le,this._mask_layer_le);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)};d._onAfterVisit=function(j){j=j||cc._renderContext;cc.ClippingNode.WebGLRenderCmd._layer--;if(this._currentStencilEnabled){var h=1<<cc.ClippingNode.WebGLRenderCmd._layer,g=h|h-1;j.stencilMask(h);j.stencilFunc(j.EQUAL,g,g)}else{j.disable(j.STENCIL_TEST)}}})();cc.ACTION_TAG_INVALID=-1;cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null;this.tag=cc.ACTION_TAG_INVALID},copy:function(){cc.log("copy is deprecated. Please use clone instead.");return this.clone()},clone:function(){var d=new cc.Action;d.originalTarget=null;d.target=null;d.tag=this.tag;return d},isDone:function(){return !0},startWithTarget:function(d){this.target=this.originalTarget=d},stop:function(){this.target=null},step:function(d){cc.log("[Action step]. override me")},update:function(d){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(d){this.target=d},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(d){this.originalTarget=d},getTag:function(){return this.tag},setTag:function(d){this.tag=d},retain:function(){},release:function(){}});cc.action=function(){return new cc.Action};cc.Action.create=cc.action;cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this);this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(d){this._duration=d},reverse:function(){cc.log("cocos2d: FiniteTimeAction#reverse: Implement me");return null},clone:function(){return new cc.FiniteTimeAction}});cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(f,e){cc.Action.prototype.ctor.call(this);this._speed=0;this._innerAction=null;f&&this.initWithAction(f,e)},getSpeed:function(){return this._speed},setSpeed:function(d){this._speed=d},initWithAction:function(f,e){if(!f){throw Error("cc.Speed.initWithAction(): action must be non nil")}this._innerAction=f;this._speed=e;return !0},clone:function(){var d=new cc.Speed;d.initWithAction(this._innerAction.clone(),this._speed);return d},startWithTarget:function(d){cc.Action.prototype.startWithTarget.call(this,d);this._innerAction.startWithTarget(d)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(d){this._innerAction.step(d*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(d){this._innerAction!==d&&(this._innerAction=d)},getInnerAction:function(){return this._innerAction}});cc.speed=function(f,e){return new cc.Speed(f,e)};cc.Speed.create=cc.speed;cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(f,e){cc.Action.prototype.ctor.call(this);this._followedNode=null;this._boundaryFullyCovered=this._boundarySet=!1;this._fullScreenSize=this._halfScreenSize=null;this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0;this._worldRect=cc.rect(0,0,0,0);f&&(e?this.initWithTarget(f,e):this.initWithTarget(f))},clone:function(){var f=new cc.Follow,e=this._worldRect,e=new cc.Rect(e.x,e.y,e.width,e.height);f.initWithTarget(this._followedNode,e);return f},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(d){this._boundarySet=d},initWithTarget:function(h,g){if(!h){throw Error("cc.Follow.initWithAction(): followedNode must be non nil")}g=g||cc.rect(0,0,0,0);this._followedNode=h;this._worldRect=g;this._boundarySet=!cc._rectEqualToZero(g);this._boundaryFullyCovered=!1;var f=cc.director.getWinSize();this._fullScreenSize=cc.p(f.width,f.height);this._halfScreenSize=cc.pMult(this._fullScreenSize,0.5);this._boundarySet&&(this.leftBoundary=-(g.x+g.width-this._fullScreenSize.x),this.rightBoundary=-g.x,this.topBoundary=-g.y,this.bottomBoundary=-(g.y+g.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0));return !0},step:function(f){f=this._followedNode.x;var e=this._followedNode.y;f=this._halfScreenSize.x-f;e=this._halfScreenSize.y-e;this.target._renderCmd._dirtyFlag=0;this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(f,this.leftBoundary,this.rightBoundary),cc.clampf(e,this.bottomBoundary,this.topBoundary)):this.target.setPosition(f,e)},isDone:function(){return !this._followedNode.running},stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.follow=function(f,e){return new cc.Follow(f,e)};cc.Follow.create=cc.follow;cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(d){this._timesForRepeat=this._speed=1;this._repeatForever=!1;this.MAX_VALUE=2;this._speedMethod=this._repeatMethod=!1;cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(d)},getElapsed:function(){return this._elapsed},initWithDuration:function(d){this._duration=0===d?cc.FLT_EPSILON:d;this._elapsed=0;return this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(d){d._repeatForever=this._repeatForever;d._speed=this._speed;d._timesForRepeat=this._timesForRepeat;d._easeList=this._easeList;d._speedMethod=this._speedMethod;d._repeatMethod=this._repeatMethod},_reverseEaseList:function(f){if(this._easeList){f._easeList=[];for(var e=0;e<this._easeList.length;e++){f._easeList.push(this._easeList[e].reverse())}}},clone:function(){var d=new cc.ActionInterval(this._duration);this._cloneDecoration(d);return d},easing:function(f){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++){this._easeList.push(arguments[e])}return this},_computeEaseTime:function(k){var j=this._easeList;if(!j||0===j.length){return k}for(var h=0,g=j.length;h<g;h++){k=j[h].easing(k)}return k},step:function(d){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=d;d=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7);d=1>d?d:1;this.update(0<d?d:0);this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(d){cc.Action.prototype.startWithTarget.call(this,d);this._elapsed=0;this._firstTick=!0},reverse:function(){cc.log("cc.IntervalAction: reverse not implemented.");return null},setAmplitudeRate:function(d){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.");return 0},speed:function(d){if(0>=d){return cc.log("The speed parameter error"),this}this._speedMethod=!0;this._speed*=d;return this},getSpeed:function(){return this._speed},setSpeed:function(d){this._speed=d;return this},repeat:function(d){d=Math.round(d);if(isNaN(d)||1>d){return cc.log("The repeat parameter error"),this}this._repeatMethod=!0;this._timesForRepeat*=d;return this},repeatForever:function(){this._repeatMethod=!0;this._timesForRepeat=this.MAX_VALUE;this._repeatForever=!0;return this}});cc.actionInterval=function(d){return new cc.ActionInterval(d)};cc.ActionInterval.create=cc.actionInterval;cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(n){cc.ActionInterval.prototype.ctor.call(this);this._actions=[];var m=n instanceof Array?n:arguments,k=m.length-1;0<=k&&null==m[k]&&cc.log("parameters should not be ending with null in Javascript");if(0<=k){for(var j=m[0],h=1;h<k;h++){m[h]&&(j=cc.Sequence._actionOneTwo(j,m[h]))}this.initWithTwoActions(j,m[k])}},initWithTwoActions:function(f,e){if(!f||!e){throw Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil")}this.initWithDuration(f._duration+e._duration);this._actions[0]=f;this._actions[1]=e;return !0},clone:function(){var d=new cc.Sequence;this._cloneDecoration(d);d.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._split=this._actions[0]._duration/this._duration;this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(n){var m=0,k=this._split,j=this._actions,h=this._last;n=this._computeEaseTime(n);n<k?(n=0!==k?n/k:1,0===m&&1===h&&(j[1].update(0),j[1].stop())):(m=1,n=1===k?1:(n-k)/(1-k),-1===h&&(j[0].startWithTarget(this.target),j[0].update(1),j[0].stop()),h||(j[0].update(1),j[0].stop()));j=j[m];h===m&&j.isDone()||(h!==m&&j.startWithTarget(this.target),n*=j._timesForRepeat,j.update(1<n?n%1:n),this._last=m)},reverse:function(){var d=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.sequence=function(p){var o=p instanceof Array?p:arguments;0<o.length&&null==o[o.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var n,m,k,j;o&&0<o.length;){for(m=Array.prototype.shift.call(o),j=m._timesForRepeat||1,m._repeatMethod=!1,m._timesForRepeat=1,k=0,n||(n=m,k=1),k;k<j;k++){n=cc.Sequence._actionOneTwo(n,m)}}return n};cc.Sequence.create=cc.sequence;cc.Sequence._actionOneTwo=function(h,g){var f=new cc.Sequence;f.initWithTwoActions(h,g);return f};cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(f,e){cc.ActionInterval.prototype.ctor.call(this);void 0!==e&&this.initWithAction(f,e)},initWithAction:function(f,e){return this.initWithDuration(f._duration*e)?(this._times=e,this._innerAction=f,f instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var d=new cc.Repeat;this._cloneDecoration(d);d.initWithAction(this._innerAction.clone(),this._times);return d},startWithTarget:function(d){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,d);this._innerAction.startWithTarget(d)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(n){n=this._computeEaseTime(n);var m=this._innerAction,k=this._duration,j=this._times,h=this._nextDt;if(n>=h){for(;n>h&&this._total<j;){m.update(1),this._total++,m.stop(),m.startWithTarget(this.target),this._nextDt=h+=m._duration/k}1<=n&&this._total<j&&this._total++;this._actionInstant||(this._total===j?(m.update(1),m.stop()):m.update(n-(h-m._duration/k)))}else{m.update(n*j%1)}},isDone:function(){return this._total===this._times},reverse:function(){var d=new cc.Repeat(this._innerAction.reverse(),this._times);this._cloneDecoration(d);this._reverseEaseList(d);return d},setInnerAction:function(d){this._innerAction!==d&&(this._innerAction=d)},getInnerAction:function(){return this._innerAction}});cc.repeat=function(f,e){return new cc.Repeat(f,e)};cc.Repeat.create=cc.repeat;cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(d){cc.ActionInterval.prototype.ctor.call(this);this._innerAction=null;d&&this.initWithAction(d)},initWithAction:function(d){if(!d){throw Error("cc.RepeatForever.initWithAction(): action must be non null")}this._innerAction=d;return !0},clone:function(){var d=new cc.RepeatForever;this._cloneDecoration(d);d.initWithAction(this._innerAction.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._innerAction.startWithTarget(d)},step:function(f){var e=this._innerAction;e.step(f);e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return !1},reverse:function(){var d=new cc.RepeatForever(this._innerAction.reverse());this._cloneDecoration(d);this._reverseEaseList(d);return d},setInnerAction:function(d){this._innerAction!==d&&(this._innerAction=d)},getInnerAction:function(){return this._innerAction}});cc.repeatForever=function(d){return new cc.RepeatForever(d)};cc.RepeatForever.create=cc.repeatForever;cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(n){cc.ActionInterval.prototype.ctor.call(this);this._two=this._one=null;var m=n instanceof Array?n:arguments,k=m.length-1;0<=k&&null==m[k]&&cc.log("parameters should not be ending with null in Javascript");if(0<=k){for(var j=m[0],h=1;h<k;h++){m[h]&&(j=cc.Spawn._actionOneTwo(j,m[h]))}this.initWithTwoActions(j,m[k])}},initWithTwoActions:function(n,m){if(!n||!m){throw Error("cc.Spawn.initWithTwoActions(): arguments must all be non null")}var k=!1,j=n._duration,h=m._duration;this.initWithDuration(Math.max(j,h))&&(this._one=n,this._two=m,j>h?this._two=cc.Sequence._actionOneTwo(m,cc.delayTime(j-h)):j<h&&(this._one=cc.Sequence._actionOneTwo(n,cc.delayTime(h-j))),k=!0);return k},clone:function(){var d=new cc.Spawn;this._cloneDecoration(d);d.initWithTwoActions(this._one.clone(),this._two.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._one.startWithTarget(d);this._two.startWithTarget(d)},stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(d){d=this._computeEaseTime(d);this._one&&this._one.update(d);this._two&&this._two.update(d)},reverse:function(){var d=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.spawn=function(k){var j=k instanceof Array?k:arguments;0<j.length&&null==j[j.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var h=j[0],g=1;g<j.length;g++){null!=j[g]&&(h=cc.Spawn._actionOneTwo(h,j[g]))}return h};cc.Spawn.create=cc.spawn;cc.Spawn._actionOneTwo=function(h,g){var f=new cc.Spawn;f.initWithTwoActions(h,g);return f};cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);void 0!==g&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){return cc.ActionInterval.prototype.initWithDuration.call(this,h)?(this._dstAngleX=g||0,this._dstAngleY=f||this._dstAngleX,!0):!1},clone:function(){var d=new cc.RotateTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY);return d},startWithTarget:function(h){cc.ActionInterval.prototype.startWithTarget.call(this,h);var g=h.rotationX%360,f=this._dstAngleX-g;180<f&&(f-=360);-180>f&&(f+=360);this._startAngleX=g;this._diffAngleX=f;this._startAngleY=h.rotationY%360;h=this._dstAngleY-this._startAngleY;180<h&&(h-=360);-180>h&&(h+=360);this._diffAngleY=h},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(d){d=this._computeEaseTime(d);this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*d,this.target.rotationY=this._startAngleY+this._diffAngleY*d)}});cc.rotateTo=function(h,g,f){return new cc.RotateTo(h,g,f)};cc.RotateTo.create=cc.rotateTo;cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);void 0!==g&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){return cc.ActionInterval.prototype.initWithDuration.call(this,h)?(this._angleX=g||0,this._angleY=f||this._angleX,!0):!1},clone:function(){var d=new cc.RotateBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._angleX,this._angleY);return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._startAngleX=d.rotationX;this._startAngleY=d.rotationY},update:function(d){d=this._computeEaseTime(d);this.target&&(this.target.rotationX=this._startAngleX+this._angleX*d,this.target.rotationY=this._startAngleY+this._angleY*d)},reverse:function(){var d=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.rotateBy=function(h,g,f){return new cc.RotateBy(h,g,f)};cc.RotateBy.create=cc.rotateBy;cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);this._positionDelta=cc.p(0,0);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);void 0!==g&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){return cc.ActionInterval.prototype.initWithDuration.call(this,h)?(void 0!==g.x&&(f=g.y,g=g.x),this._positionDelta.x=g,this._positionDelta.y=f,!0):!1},clone:function(){var d=new cc.MoveBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._positionDelta);return d},startWithTarget:function(f){cc.ActionInterval.prototype.startWithTarget.call(this,f);var e=f.getPositionX();f=f.getPositionY();this._previousPosition.x=e;this._previousPosition.y=f;this._startPosition.x=e;this._startPosition.y=f},update:function(p){p=this._computeEaseTime(p);if(this.target){var o=this._positionDelta.x*p;p*=this._positionDelta.y;var n=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var m=this.target.getPositionX(),k=this.target.getPositionY(),j=this._previousPosition;n.x=n.x+m-j.x;n.y=n.y+k-j.y;o+=n.x;p+=n.y;j.x=o;j.y=p;this.target.setPosition(o,p)}else{this.target.setPosition(n.x+o,n.y+p)}}},reverse:function(){var d=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.moveBy=function(h,g,f){return new cc.MoveBy(h,g,f)};cc.MoveBy.create=cc.moveBy;cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(h,g,f){cc.MoveBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==g&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){return cc.MoveBy.prototype.initWithDuration.call(this,h,g,f)?(void 0!==g.x&&(f=g.y,g=g.x),this._endPosition.x=g,this._endPosition.y=f,!0):!1},clone:function(){var d=new cc.MoveTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._endPosition);return d},startWithTarget:function(d){cc.MoveBy.prototype.startWithTarget.call(this,d);this._positionDelta.x=this._endPosition.x-d.getPositionX();this._positionDelta.y=this._endPosition.y-d.getPositionY()}});cc.moveTo=function(h,g,f){return new cc.MoveTo(h,g,f)};cc.MoveTo.create=cc.moveTo;cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);void 0!==f&&this.initWithDuration(h,g,f)},initWithDuration:function(k,j,h){var g=!1;cc.ActionInterval.prototype.initWithDuration.call(this,k)&&(this._endSkewX=j,this._endSkewY=h,g=!0);return g},clone:function(){var d=new cc.SkewTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._endSkewX,this._endSkewY);return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._startSkewX=d.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;180<this._deltaX&&(this._deltaX-=360);-180>this._deltaX&&(this._deltaX+=360);this._startSkewY=d.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;180<this._deltaY&&(this._deltaY-=360);-180>this._deltaY&&(this._deltaY+=360)},update:function(d){d=this._computeEaseTime(d);this.target.skewX=this._startSkewX+this._deltaX*d;this.target.skewY=this._startSkewY+this._deltaY*d}});cc.skewTo=function(h,g,f){return new cc.SkewTo(h,g,f)};cc.SkewTo.create=cc.skewTo;cc.SkewBy=cc.SkewTo.extend({ctor:function(h,g,f){cc.SkewTo.prototype.ctor.call(this);void 0!==f&&this.initWithDuration(h,g,f)},initWithDuration:function(k,j,h){var g=!1;cc.SkewTo.prototype.initWithDuration.call(this,k,j,h)&&(this._skewX=j,this._skewY=h,g=!0);return g},clone:function(){var d=new cc.SkewBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._skewX,this._skewY);return d},startWithTarget:function(d){cc.SkewTo.prototype.startWithTarget.call(this,d);this._deltaX=this._skewX;this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var d=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.skewBy=function(h,g,f){return new cc.SkewBy(h,g,f)};cc.SkewBy.create=cc.skewBy;cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(n,m,k,j,h){cc.ActionInterval.prototype.ctor.call(this);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);this._delta=cc.p(0,0);void 0!==j&&this.initWithDuration(n,m,k,j,h)},initWithDuration:function(n,m,k,j,h){return cc.ActionInterval.prototype.initWithDuration.call(this,n)?(void 0===h&&(h=j,j=k,k=m.y,m=m.x),this._delta.x=m,this._delta.y=k,this._height=j,this._jumps=h,!0):!1},clone:function(){var d=new cc.JumpBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._delta,this._height,this._jumps);return d},startWithTarget:function(f){cc.ActionInterval.prototype.startWithTarget.call(this,f);var e=f.getPositionX();f=f.getPositionY();this._previousPosition.x=e;this._previousPosition.y=f;this._startPosition.x=e;this._startPosition.y=f},update:function(p){p=this._computeEaseTime(p);if(this.target){var o=p*this._jumps%1,o=4*this._height*o*(1-o),o=o+this._delta.y*p;p*=this._delta.x;var n=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var m=this.target.getPositionX(),k=this.target.getPositionY(),j=this._previousPosition;n.x=n.x+m-j.x;n.y=n.y+k-j.y;p+=n.x;o+=n.y;j.x=p;j.y=o;this.target.setPosition(p,o)}else{this.target.setPosition(n.x+p,n.y+o)}}},reverse:function(){var d=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.jumpBy=function(n,m,k,j,h){return new cc.JumpBy(n,m,k,j,h)};cc.JumpBy.create=cc.jumpBy;cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(n,m,k,j,h){cc.JumpBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==j&&this.initWithDuration(n,m,k,j,h)},initWithDuration:function(n,m,k,j,h){return cc.JumpBy.prototype.initWithDuration.call(this,n,m,k,j,h)?(void 0===h&&(k=m.y,m=m.x),this._endPosition.x=m,this._endPosition.y=k,!0):!1},startWithTarget:function(d){cc.JumpBy.prototype.startWithTarget.call(this,d);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var d=new cc.JumpTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._endPosition,this._height,this._jumps);return d}});cc.jumpTo=function(n,m,k,j,h){return new cc.JumpTo(n,m,k,j,h)};cc.JumpTo.create=cc.jumpTo;cc.bezierAt=function(n,m,k,j,h){return Math.pow(1-h,3)*n+3*h*Math.pow(1-h,2)*m+3*Math.pow(h,2)*(1-h)*k+Math.pow(h,3)*j};cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(f,e){cc.ActionInterval.prototype.ctor.call(this);this._config=[];this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.ActionInterval.prototype.initWithDuration.call(this,f)?(this._config=e,!0):!1},clone:function(){var k=new cc.BezierBy;this._cloneDecoration(k);for(var j=[],h=0;h<this._config.length;h++){var g=this._config[h];j.push(cc.p(g.x,g.y))}k.initWithDuration(this._duration,j);return k},startWithTarget:function(f){cc.ActionInterval.prototype.startWithTarget.call(this,f);var e=f.getPositionX();f=f.getPositionY();this._previousPosition.x=e;this._previousPosition.y=f;this._startPosition.x=e;this._startPosition.y=f},update:function(p){p=this._computeEaseTime(p);if(this.target){var o=this._config,n=o[0].y,m=o[1].y,k=o[2].y,o=cc.bezierAt(0,o[0].x,o[1].x,o[2].x,p);p=cc.bezierAt(0,n,m,k,p);n=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var m=this.target.getPositionX(),k=this.target.getPositionY(),j=this._previousPosition;n.x=n.x+m-j.x;n.y=n.y+k-j.y;o+=n.x;p+=n.y;j.x=o;j.y=p;this.target.setPosition(o,p)}else{this.target.setPosition(n.x+o,n.y+p)}}},reverse:function(){var d=this._config,d=[cc.pAdd(d[1],cc.pNeg(d[2])),cc.pAdd(d[0],cc.pNeg(d[2])),cc.pNeg(d[2])],d=new cc.BezierBy(this._duration,d);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.bezierBy=function(f,e){return new cc.BezierBy(f,e)};cc.BezierBy.create=cc.bezierBy;cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(f,e){cc.BezierBy.prototype.ctor.call(this);this._toConfig=[];e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.ActionInterval.prototype.initWithDuration.call(this,f)?(this._toConfig=e,!0):!1},clone:function(){var d=new cc.BezierTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._toConfig);return d},startWithTarget:function(h){cc.BezierBy.prototype.startWithTarget.call(this,h);h=this._startPosition;var g=this._toConfig,f=this._config;f[0]=cc.pSub(g[0],h);f[1]=cc.pSub(g[1],h);f[2]=cc.pSub(g[2],h)}});cc.bezierTo=function(f,e){return new cc.BezierTo(f,e)};cc.BezierTo.create=cc.bezierTo;cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);void 0!==g&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){return cc.ActionInterval.prototype.initWithDuration.call(this,h)?(this._endScaleX=g,this._endScaleY=null!=f?f:g,!0):!1},clone:function(){var d=new cc.ScaleTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._startScaleX=d.scaleX;this._startScaleY=d.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(d){d=this._computeEaseTime(d);this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*d,this.target.scaleY=this._startScaleY+this._deltaY*d)}});cc.scaleTo=function(h,g,f){return new cc.ScaleTo(h,g,f)};cc.ScaleTo.create=cc.scaleTo;cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(d){cc.ScaleTo.prototype.startWithTarget.call(this,d);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var d=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);this._cloneDecoration(d);this._reverseEaseList(d);return d},clone:function(){var d=new cc.ScaleBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._endScaleX,this._endScaleY);return d}});cc.scaleBy=function(h,g,f){return new cc.ScaleBy(h,g,f)};cc.ScaleBy.create=cc.scaleBy;cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(f,e){cc.ActionInterval.prototype.ctor.call(this);void 0!==e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.ActionInterval.prototype.initWithDuration.call(this,f)?(this._times=e,!0):!1},clone:function(){var d=new cc.Blink;this._cloneDecoration(d);d.initWithDuration(this._duration,this._times);return d},update:function(f){f=this._computeEaseTime(f);if(this.target&&!this.isDone()){var e=1/this._times;this.target.visible=f%e>e/2}},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._originalState=d.visible},stop:function(){this.target.visible=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var d=new cc.Blink(this._duration,this._times);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.blink=function(f,e){return new cc.Blink(f,e)};cc.Blink.create=cc.blink;cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(f,e){cc.ActionInterval.prototype.ctor.call(this);void 0!==e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.ActionInterval.prototype.initWithDuration.call(this,f)?(this._toOpacity=e,!0):!1},clone:function(){var d=new cc.FadeTo;this._cloneDecoration(d);d.initWithDuration(this._duration,this._toOpacity);return d},update:function(f){f=this._computeEaseTime(f);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*f},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._fromOpacity=d.opacity}});cc.fadeTo=function(f,e){return new cc.FadeTo(f,e)};cc.FadeTo.create=cc.fadeTo;cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(d){cc.FadeTo.prototype.ctor.call(this);null==d&&(d=0);this.initWithDuration(d,255)},reverse:function(){var d=new cc.FadeOut;d.initWithDuration(this._duration,0);this._cloneDecoration(d);this._reverseEaseList(d);return d},clone:function(){var d=new cc.FadeIn;this._cloneDecoration(d);d.initWithDuration(this._duration,this._toOpacity);return d},startWithTarget:function(d){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity);cc.FadeTo.prototype.startWithTarget.call(this,d)}});cc.fadeIn=function(d){return new cc.FadeIn(d)};cc.FadeIn.create=cc.fadeIn;cc.FadeOut=cc.FadeTo.extend({ctor:function(d){cc.FadeTo.prototype.ctor.call(this);null==d&&(d=0);this.initWithDuration(d,0)},reverse:function(){var d=new cc.FadeIn;d._reverseAction=this;d.initWithDuration(this._duration,255);this._cloneDecoration(d);this._reverseEaseList(d);return d},clone:function(){var d=new cc.FadeOut;this._cloneDecoration(d);d.initWithDuration(this._duration,this._toOpacity);return d}});cc.fadeOut=function(d){return new cc.FadeOut(d)};cc.FadeOut.create=cc.fadeOut;cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(k,j,h,g){cc.ActionInterval.prototype.ctor.call(this);this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);void 0!==g&&this.initWithDuration(k,j,h,g)},initWithDuration:function(k,j,h,g){return cc.ActionInterval.prototype.initWithDuration.call(this,k)?(this._to=cc.color(j,h,g),!0):!1},clone:function(){var f=new cc.TintTo;this._cloneDecoration(f);var e=this._to;f.initWithDuration(this._duration,e.r,e.g,e.b);return f},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._from=this.target.color},update:function(h){h=this._computeEaseTime(h);var g=this._from,f=this._to;g&&this.target.setColor(cc.color(g.r+(f.r-g.r)*h,g.g+(f.g-g.g)*h,g.b+(f.b-g.b)*h))}});cc.tintTo=function(k,j,h,g){return new cc.TintTo(k,j,h,g)};cc.TintTo.create=cc.tintTo;cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(k,j,h,g){cc.ActionInterval.prototype.ctor.call(this);void 0!==g&&this.initWithDuration(k,j,h,g)},initWithDuration:function(k,j,h,g){return cc.ActionInterval.prototype.initWithDuration.call(this,k)?(this._deltaR=j,this._deltaG=h,this._deltaB=g,!0):!1},clone:function(){var d=new cc.TintBy;this._cloneDecoration(d);d.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB);return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);d=d.color;this._fromR=d.r;this._fromG=d.g;this._fromB=d.b},update:function(d){d=this._computeEaseTime(d);this.target.color=cc.color(this._fromR+this._deltaR*d,this._fromG+this._deltaG*d,this._fromB+this._deltaB*d)},reverse:function(){var d=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);this._cloneDecoration(d);this._reverseEaseList(d);return d}});cc.tintBy=function(k,j,h,g){return new cc.TintBy(k,j,h,g)};cc.TintBy.create=cc.tintBy;cc.DelayTime=cc.ActionInterval.extend({update:function(d){},reverse:function(){var d=new cc.DelayTime(this._duration);this._cloneDecoration(d);this._reverseEaseList(d);return d},clone:function(){var d=new cc.DelayTime;this._cloneDecoration(d);d.initWithDuration(this._duration);return d}});cc.delayTime=function(d){return new cc.DelayTime(d)};cc.DelayTime.create=cc.delayTime;cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(d){cc.ActionInterval.prototype.ctor.call(this);this._other=null;d&&this.initWithAction(d)},initWithAction:function(d){if(!d){throw Error("cc.ReverseTime.initWithAction(): action must be non null")}if(d===this._other){throw Error("cc.ReverseTime.initWithAction(): the action was already passed in.")}return cc.ActionInterval.prototype.initWithDuration.call(this,d._duration)?(this._other=d,!0):!1},clone:function(){var d=new cc.ReverseTime;this._cloneDecoration(d);d.initWithAction(this._other.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._other.startWithTarget(d)},update:function(d){d=this._computeEaseTime(d);this._other&&this._other.update(1-d)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.reverseTime=function(d){return new cc.ReverseTime(d)};cc.ReverseTime.create=cc.reverseTime;cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(d){cc.ActionInterval.prototype.ctor.call(this);this._splitTimes=[];d&&this.initWithAnimation(d)},getAnimation:function(){return this._animation},setAnimation:function(d){this._animation=d},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(s){if(!s){throw Error("cc.Animate.initWithAnimation(): animation must be non-NULL")}var r=s.getDuration();if(this.initWithDuration(r*s.getLoops())){this._nextFrame=0;this.setAnimation(s);this._origFrame=null;this._executedLoops=0;var p=this._splitTimes,o=p.length=0,n=r/s.getTotalDelayUnits();s=s.getFrames();cc.arrayVerifyType(s,cc.AnimationFrame);for(var m=0;m<s.length;m++){var j=o*n/r,o=o+s[m].getDelayUnits();p.push(j)}return !0}return !1},clone:function(){var d=new cc.Animate;this._cloneDecoration(d);d.initWithAnimation(this._animation.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._animation.getRestoreOriginalFrame()&&(this._origFrame=d.displayFrame());this._executedLoops=this._nextFrame=0},update:function(n){n=this._computeEaseTime(n);1>n&&(n*=this._animation.getLoops(),(0|n)>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),n%=1);for(var m=this._animation.getFrames(),k=m.length,j=this._splitTimes,h=this._nextFrame;h<k;h++){if(j[h]<=n){_currFrameIndex=h,this.target.setSpriteFrame(m[_currFrameIndex].getSpriteFrame()),this._nextFrame=h+1}else{break}}},reverse:function(){var n=this._animation,m=n.getFrames(),k=[];cc.arrayVerifyType(m,cc.AnimationFrame);if(0<m.length){for(var j=m.length-1;0<=j;j--){var h=m[j];if(!h){break}k.push(h.clone())}}m=new cc.Animation(k,n.getDelayPerUnit(),n.getLoops());m.setRestoreOriginalFrame(n.getRestoreOriginalFrame());n=new cc.Animate(m);this._cloneDecoration(n);this._reverseEaseList(n);return n},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}});cc.animate=function(d){return new cc.Animate(d)};cc.Animate.create=cc.animate;cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(f,e){cc.ActionInterval.prototype.ctor.call(this);e&&this.initWithTarget(f,e)},initWithTarget:function(f,e){return this.initWithDuration(e._duration)?(this._forcedTarget=f,this._action=e,!0):!1},clone:function(){var d=new cc.TargetedAction;this._cloneDecoration(d);d.initWithTarget(this._forcedTarget,this._action.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(d){d=this._computeEaseTime(d);this._action.update(d)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(d){this._forcedTarget!==d&&(this._forcedTarget=d)}});cc.targetedAction=function(f,e){return new cc.TargetedAction(f,e)};cc.TargetedAction.create=cc.targetedAction;cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return !0},step:function(d){this.update(1)},update:function(d){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}});cc.Show=cc.ActionInstant.extend({update:function(d){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}});cc.show=function(){return new cc.Show};cc.Show.create=cc.show;cc.Hide=cc.ActionInstant.extend({update:function(d){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}});cc.hide=function(){return new cc.Hide};cc.Hide.create=cc.hide;cc.ToggleVisibility=cc.ActionInstant.extend({update:function(d){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}});cc.toggleVisibility=function(){return new cc.ToggleVisibility};cc.ToggleVisibility.create=cc.toggleVisibility;cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(d){cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==d&&this.init(d)},update:function(d){this.target.removeFromParent(this._isNeedCleanUp)},init:function(d){this._isNeedCleanUp=d;return !0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}});cc.removeSelf=function(d){return new cc.RemoveSelf(d)};cc.RemoveSelf.create=cc.removeSelf;cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(d){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedX=!1;void 0!==d&&this.initWithFlipX(d)},initWithFlipX:function(d){this._flippedX=d;return !0},update:function(d){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var d=new cc.FlipX;d.initWithFlipX(this._flippedX);return d}});cc.flipX=function(d){return new cc.FlipX(d)};cc.FlipX.create=cc.flipX;cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(d){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedY=!1;void 0!==d&&this.initWithFlipY(d)},initWithFlipY:function(d){this._flippedY=d;return !0},update:function(d){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var d=new cc.FlipY;d.initWithFlipY(this._flippedY);return d}});cc.flipY=function(d){return new cc.FlipY(d)};cc.FlipY.create=cc.flipY;cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(f,e){cc.FiniteTimeAction.prototype.ctor.call(this);this._y=this._x=0;void 0!==f&&(void 0!==f.x&&(e=f.y,f=f.x),this.initWithPosition(f,e))},initWithPosition:function(f,e){this._x=f;this._y=e;return !0},update:function(d){this.target.setPosition(this._x,this._y)},clone:function(){var d=new cc.Place;d.initWithPosition(this._x,this._y);return d}});cc.place=function(f,e){return new cc.Place(f,e)};cc.Place.create=cc.place;cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(h,g,f){cc.FiniteTimeAction.prototype.ctor.call(this);this.initWithFunction(h,g,f)},initWithFunction:function(h,g,f){h&&(this._function=h);g&&(this._selectorTarget=g);void 0!==f&&(this._data=f);return !0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(d){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(d){d!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=d)},clone:function(){var d=new cc.CallFunc;d.initWithFunction(this._function,this._selectorTarget,this._data);return d}});cc.callFunc=function(h,g,f){return new cc.CallFunc(h,g,f)};cc.CallFunc.create=cc.callFunc;cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(d){cc.ActionInterval.prototype.ctor.call(this);d&&this.initWithAction(d)},initWithAction:function(d){if(!d){throw Error("cc.ActionEase.initWithAction(): action must be non nil")}return this.initWithDuration(d.getDuration())?(this._inner=d,!0):!1},clone:function(){var d=new cc.ActionEase;d.initWithAction(this._inner.clone());return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop();cc.ActionInterval.prototype.stop.call(this)},update:function(d){this._inner.update(d)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}});cc.actionEase=function(d){return new cc.ActionEase(d)};cc.ActionEase.create=cc.actionEase;cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(f,e){cc.ActionEase.prototype.ctor.call(this);void 0!==e&&this.initWithAction(f,e)},setRate:function(d){this._rate=d},getRate:function(){return this._rate},initWithAction:function(f,e){return cc.ActionEase.prototype.initWithAction.call(this,f)?(this._rate=e,!0):!1},clone:function(){var d=new cc.EaseRateAction;d.initWithAction(this._inner.clone(),this._rate);return d},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}});cc.easeRateAction=function(f,e){return new cc.EaseRateAction(f,e)};cc.EaseRateAction.create=cc.easeRateAction;cc.EaseIn=cc.EaseRateAction.extend({update:function(d){this._inner.update(Math.pow(d,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var d=new cc.EaseIn;d.initWithAction(this._inner.clone(),this._rate);return d}});cc.EaseIn.create=function(f,e){return new cc.EaseIn(f,e)};cc.easeIn=function(d){return{_rate:d,easing:function(e){return Math.pow(e,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}};cc.EaseOut=cc.EaseRateAction.extend({update:function(d){this._inner.update(Math.pow(d,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var d=new cc.EaseOut;d.initWithAction(this._inner.clone(),this._rate);return d}});cc.EaseOut.create=function(f,e){return new cc.EaseOut(f,e)};cc.easeOut=function(d){return{_rate:d,easing:function(e){return Math.pow(e,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}};cc.EaseInOut=cc.EaseRateAction.extend({update:function(d){d*=2;1>d?this._inner.update(0.5*Math.pow(d,this._rate)):this._inner.update(1-0.5*Math.pow(2-d,this._rate))},clone:function(){var d=new cc.EaseInOut;d.initWithAction(this._inner.clone(),this._rate);return d},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}});cc.EaseInOut.create=function(f,e){return new cc.EaseInOut(f,e)};cc.easeInOut=function(d){return{_rate:d,easing:function(e){e*=2;return 1>e?0.5*Math.pow(e,this._rate):1-0.5*Math.pow(2-e,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};cc.EaseExponentialIn=cc.ActionEase.extend({update:function(d){this._inner.update(0===d?0:Math.pow(2,10*(d-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var d=new cc.EaseExponentialIn;d.initWithAction(this._inner.clone());return d}});cc.EaseExponentialIn.create=function(d){return new cc.EaseExponentialIn(d)};cc._easeExponentialInObj={easing:function(d){return 0===d?0:Math.pow(2,10*(d-1))},reverse:function(){return cc._easeExponentialOutObj}};cc.easeExponentialIn=function(){return cc._easeExponentialInObj};cc.EaseExponentialOut=cc.ActionEase.extend({update:function(d){this._inner.update(1===d?1:-Math.pow(2,-10*d)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var d=new cc.EaseExponentialOut;d.initWithAction(this._inner.clone());return d}});cc.EaseExponentialOut.create=function(d){return new cc.EaseExponentialOut(d)};cc._easeExponentialOutObj={easing:function(d){return 1===d?1:-Math.pow(2,-10*d)+1},reverse:function(){return cc._easeExponentialInObj}};cc.easeExponentialOut=function(){return cc._easeExponentialOutObj};cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(d){1!==d&&0!==d&&(d*=2,d=1>d?0.5*Math.pow(2,10*(d-1)):0.5*(-Math.pow(2,-10*(d-1))+2));this._inner.update(d)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var d=new cc.EaseExponentialInOut;d.initWithAction(this._inner.clone());return d}});cc.EaseExponentialInOut.create=function(d){return new cc.EaseExponentialInOut(d)};cc._easeExponentialInOutObj={easing:function(d){return 1!==d&&0!==d?(d*=2,1>d?0.5*Math.pow(2,10*(d-1)):0.5*(-Math.pow(2,-10*(d-1))+2)):d},reverse:function(){return cc._easeExponentialInOutObj}};cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj};cc.EaseSineIn=cc.ActionEase.extend({update:function(d){d=0===d||1===d?d:-1*Math.cos(d*Math.PI/2)+1;this._inner.update(d)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var d=new cc.EaseSineIn;d.initWithAction(this._inner.clone());return d}});cc.EaseSineIn.create=function(d){return new cc.EaseSineIn(d)};cc._easeSineInObj={easing:function(d){return 0===d||1===d?d:-1*Math.cos(d*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}};cc.easeSineIn=function(){return cc._easeSineInObj};cc.EaseSineOut=cc.ActionEase.extend({update:function(d){d=0===d||1===d?d:Math.sin(d*Math.PI/2);this._inner.update(d)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var d=new cc.EaseSineOut;d.initWithAction(this._inner.clone());return d}});cc.EaseSineOut.create=function(d){return new cc.EaseSineOut(d)};cc._easeSineOutObj={easing:function(d){return 0===d||1===d?d:Math.sin(d*Math.PI/2)},reverse:function(){return cc._easeSineInObj}};cc.easeSineOut=function(){return cc._easeSineOutObj};cc.EaseSineInOut=cc.ActionEase.extend({update:function(d){d=0===d||1===d?d:-0.5*(Math.cos(Math.PI*d)-1);this._inner.update(d)},clone:function(){var d=new cc.EaseSineInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}});cc.EaseSineInOut.create=function(d){return new cc.EaseSineInOut(d)};cc._easeSineInOutObj={easing:function(d){return 0===d||1===d?d:-0.5*(Math.cos(Math.PI*d)-1)},reverse:function(){return cc._easeSineInOutObj}};cc.easeSineInOut=function(){return cc._easeSineInOutObj};cc.EaseElastic=cc.ActionEase.extend({_period:0.3,ctor:function(f,e){cc.ActionEase.prototype.ctor.call(this);f&&this.initWithAction(f,e)},getPeriod:function(){return this._period},setPeriod:function(d){this._period=d},initWithAction:function(f,e){cc.ActionEase.prototype.initWithAction.call(this,f);this._period=null==e?0.3:e;return !0},reverse:function(){cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass.");return null},clone:function(){var d=new cc.EaseElastic;d.initWithAction(this._inner.clone(),this._period);return d}});cc.EaseElastic.create=function(f,e){return new cc.EaseElastic(f,e)};cc.EaseElasticIn=cc.EaseElastic.extend({update:function(f){var e=0;0===f||1===f?e=f:(e=this._period/4,f-=1,e=-Math.pow(2,10*f)*Math.sin((f-e)*Math.PI*2/this._period));this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var d=new cc.EaseElasticIn;d.initWithAction(this._inner.clone(),this._period);return d}});cc.EaseElasticIn.create=function(f,e){return new cc.EaseElasticIn(f,e)};cc._easeElasticInObj={easing:function(d){if(0===d||1===d){return d}d-=1;return -Math.pow(2,10*d)*Math.sin((d-0.075)*Math.PI*2/0.3)},reverse:function(){return cc._easeElasticOutObj}};cc.easeElasticIn=function(d){return d&&0.3!==d?{_period:d,easing:function(e){if(0===e||1===e){return e}e-=1;return -Math.pow(2,10*e)*Math.sin((e-this._period/4)*Math.PI*2/this._period)},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj};cc.EaseElasticOut=cc.EaseElastic.extend({update:function(f){var e=0;0===f||1===f?e=f:(e=this._period/4,e=Math.pow(2,-10*f)*Math.sin((f-e)*Math.PI*2/this._period)+1);this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var d=new cc.EaseElasticOut;d.initWithAction(this._inner.clone(),this._period);return d}});cc.EaseElasticOut.create=function(f,e){return new cc.EaseElasticOut(f,e)};cc._easeElasticOutObj={easing:function(d){return 0===d||1===d?d:Math.pow(2,-10*d)*Math.sin((d-0.075)*Math.PI*2/0.3)+1},reverse:function(){return cc._easeElasticInObj}};cc.easeElasticOut=function(d){return d&&0.3!==d?{_period:d,easing:function(e){return 0===e||1===e?e:Math.pow(2,-10*e)*Math.sin((e-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj};cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(h){var g=0,g=this._period;if(0===h||1===h){g=h}else{g||(g=this._period=0.3*1.5);var f=g/4;h=2*h-1;g=0>h?-0.5*Math.pow(2,10*h)*Math.sin((h-f)*Math.PI*2/g):Math.pow(2,-10*h)*Math.sin((h-f)*Math.PI*2/g)*0.5+1}this._inner.update(g)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var d=new cc.EaseElasticInOut;d.initWithAction(this._inner.clone(),this._period);return d}});cc.EaseElasticInOut.create=function(f,e){return new cc.EaseElasticInOut(f,e)};cc.easeElasticInOut=function(d){return{_period:d||0.3,easing:function(j){var h=0,h=this._period;if(0===j||1===j){h=j}else{h||(h=this._period=0.3*1.5);var g=h/4;j=2*j-1;h=0>j?-0.5*Math.pow(2,10*j)*Math.sin((j-g)*Math.PI*2/h):Math.pow(2,-10*j)*Math.sin((j-g)*Math.PI*2/h)*0.5+1}return h},reverse:function(){return cc.easeElasticInOut(this._period)}}};cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(d){if(d<1/2.75){return 7.5625*d*d}if(d<2/2.75){return d-=1.5/2.75,7.5625*d*d+0.75}if(d<2.5/2.75){return d-=2.25/2.75,7.5625*d*d+0.9375}d-=2.625/2.75;return 7.5625*d*d+0.984375},clone:function(){var d=new cc.EaseBounce;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}});cc.EaseBounce.create=function(d){return new cc.EaseBounce(d)};cc.EaseBounceIn=cc.EaseBounce.extend({update:function(d){d=1-this.bounceTime(1-d);this._inner.update(d)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var d=new cc.EaseBounceIn;d.initWithAction(this._inner.clone());return d}});cc.EaseBounceIn.create=function(d){return new cc.EaseBounceIn(d)};cc._bounceTime=function(d){if(d<1/2.75){return 7.5625*d*d}if(d<2/2.75){return d-=1.5/2.75,7.5625*d*d+0.75}if(d<2.5/2.75){return d-=2.25/2.75,7.5625*d*d+0.9375}d-=2.625/2.75;return 7.5625*d*d+0.984375};cc._easeBounceInObj={easing:function(d){return 1-cc._bounceTime(1-d)},reverse:function(){return cc._easeBounceOutObj}};cc.easeBounceIn=function(){return cc._easeBounceInObj};cc.EaseBounceOut=cc.EaseBounce.extend({update:function(d){d=this.bounceTime(d);this._inner.update(d)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var d=new cc.EaseBounceOut;d.initWithAction(this._inner.clone());return d}});cc.EaseBounceOut.create=function(d){return new cc.EaseBounceOut(d)};cc._easeBounceOutObj={easing:function(d){return cc._bounceTime(d)},reverse:function(){return cc._easeBounceInObj}};cc.easeBounceOut=function(){return cc._easeBounceOutObj};cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(f){var e=0,e=0.5>f?0.5*(1-this.bounceTime(1-2*f)):0.5*this.bounceTime(2*f-1)+0.5;this._inner.update(e)},clone:function(){var d=new cc.EaseBounceInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}});cc.EaseBounceInOut.create=function(d){return new cc.EaseBounceInOut(d)};cc._easeBounceInOutObj={easing:function(d){return d=0.5>d?0.5*(1-cc._bounceTime(1-2*d)):0.5*cc._bounceTime(2*d-1)+0.5},reverse:function(){return cc._easeBounceInOutObj}};cc.easeBounceInOut=function(){return cc._easeBounceInOutObj};cc.EaseBackIn=cc.ActionEase.extend({update:function(d){this._inner.update(0===d||1===d?d:d*d*(2.70158*d-1.70158))},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var d=new cc.EaseBackIn;d.initWithAction(this._inner.clone());return d}});cc.EaseBackIn.create=function(d){return new cc.EaseBackIn(d)};cc._easeBackInObj={easing:function(d){return 0===d||1===d?d:d*d*(2.70158*d-1.70158)},reverse:function(){return cc._easeBackOutObj}};cc.easeBackIn=function(){return cc._easeBackInObj};cc.EaseBackOut=cc.ActionEase.extend({update:function(d){d-=1;this._inner.update(d*d*(2.70158*d+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var d=new cc.EaseBackOut;d.initWithAction(this._inner.clone());return d}});cc.EaseBackOut.create=function(d){return new cc.EaseBackOut(d)};cc._easeBackOutObj={easing:function(d){d-=1;return d*d*(2.70158*d+1.70158)+1},reverse:function(){return cc._easeBackInObj}};cc.easeBackOut=function(){return cc._easeBackOutObj};cc.EaseBackInOut=cc.ActionEase.extend({update:function(d){d*=2;1>d?this._inner.update(d*d*(3.5949095*d-2.5949095)/2):(d-=2,this._inner.update(d*d*(3.5949095*d+2.5949095)/2+1))},clone:function(){var d=new cc.EaseBackInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}});cc.EaseBackInOut.create=function(d){return new cc.EaseBackInOut(d)};cc._easeBackInOutObj={easing:function(d){d*=2;if(1>d){return d*d*(3.5949095*d-2.5949095)/2}d-=2;return d*d*(3.5949095*d+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}};cc.easeBackInOut=function(){return cc._easeBackInOutObj};cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(d){cc.ActionEase.prototype.ctor.call(this,d)},_updateTime:function(n,m,k,j,h){return Math.pow(1-h,3)*n+3*h*Math.pow(1-h,2)*m+3*Math.pow(h,2)*(1-h)*k+Math.pow(h,3)*j},update:function(d){d=this._updateTime(this._p0,this._p1,this._p2,this._p3,d);this._inner.update(d)},clone:function(){var d=new cc.EaseBezierAction;d.initWithAction(this._inner.clone());d.setBezierParamer(this._p0,this._p1,this._p2,this._p3);return d},reverse:function(){var d=new cc.EaseBezierAction(this._inner.reverse());d.setBezierParamer(this._p3,this._p2,this._p1,this._p0);return d},setBezierParamer:function(k,j,h,g){this._p0=k||0;this._p1=j||0;this._p2=h||0;this._p3=g||0}});cc.EaseBezierAction.create=function(d){return new cc.EaseBezierAction(d)};cc.easeBezierAction=function(k,j,h,g){return{easing:function(c){return cc.EaseBezierAction.prototype._updateTime(k,j,h,g,c)},reverse:function(){return cc.easeBezierAction(g,h,j,k)}}};cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(d){return Math.pow(d,2)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuadraticActionIn;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}});cc.EaseQuadraticActionIn.create=function(d){return new cc.EaseQuadraticActionIn(d)};cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}};cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn};cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(d){return -d*(d-2)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuadraticActionOut;d.initWithAction();return d},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}});cc.EaseQuadraticActionOut.create=function(d){return new cc.EaseQuadraticActionOut(d)};cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}};cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut};cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(f){var e=f;f*=2;1>f?e=f*f*0.5:(--f,e=-0.5*(f*(f-2)-1));return e},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuadraticActionInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}});cc.EaseQuadraticActionInOut.create=function(d){return new cc.EaseQuadraticActionInOut(d)};cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}};cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut};cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(d){return d*d*d*d},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuarticActionIn;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}});cc.EaseQuarticActionIn.create=function(d){return new cc.EaseQuarticActionIn(d)};cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}};cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn};cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(d){d-=1;return -(d*d*d*d-1)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuarticActionOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}});cc.EaseQuarticActionOut.create=function(d){return new cc.EaseQuarticActionOut(d)};cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}};cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut};cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(d){d*=2;if(1>d){return 0.5*d*d*d*d}d-=2;return -0.5*(d*d*d*d-2)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuarticActionInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}});cc.EaseQuarticActionInOut.create=function(d){return new cc.EaseQuarticActionInOut(d)};cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}};cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut};cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(d){return d*d*d*d*d},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuinticActionIn;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}});cc.EaseQuinticActionIn.create=function(d){return new cc.EaseQuinticActionIn(d)};cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}};cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn};cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(d){d-=1;return d*d*d*d*d+1},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuinticActionOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}});cc.EaseQuinticActionOut.create=function(d){return new cc.EaseQuinticActionOut(d)};cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}};cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut};cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(d){d*=2;if(1>d){return 0.5*d*d*d*d*d}d-=2;return 0.5*(d*d*d*d*d+2)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseQuinticActionInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}});cc.EaseQuinticActionInOut.create=function(d){return new cc.EaseQuinticActionInOut(d)};cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}};cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut};cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(d){return -1*(Math.sqrt(1-d*d)-1)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCircleActionIn;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}});cc.EaseCircleActionIn.create=function(d){return new cc.EaseCircleActionIn(d)};cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}};cc.easeCircleActionIn=function(){return cc._easeCircleActionIn};cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(d){d-=1;return Math.sqrt(1-d*d)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCircleActionOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}});cc.EaseCircleActionOut.create=function(d){return new cc.EaseCircleActionOut(d)};cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}};cc.easeCircleActionOut=function(){return cc._easeCircleActionOut};cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(d){d*=2;if(1>d){return -0.5*(Math.sqrt(1-d*d)-1)}d-=2;return 0.5*(Math.sqrt(1-d*d)+1)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCircleActionInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}});cc.EaseCircleActionInOut.create=function(d){return new cc.EaseCircleActionInOut(d)};cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}};cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut};cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(d){return d*d*d},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCubicActionIn;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}});cc.EaseCubicActionIn.create=function(d){return new cc.EaseCubicActionIn(d)};cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}};cc.easeCubicActionIn=function(){return cc._easeCubicActionIn};cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(d){d-=1;return d*d*d+1},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCubicActionOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}});cc.EaseCubicActionOut.create=function(d){return new cc.EaseCubicActionOut(d)};cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}};cc.easeCubicActionOut=function(){return cc._easeCubicActionOut};cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(d){d*=2;if(1>d){return 0.5*d*d*d}d-=2;return 0.5*(d*d*d+2)},update:function(d){this._inner.update(this._updateTime(d))},clone:function(){var d=new cc.EaseCubicActionInOut;d.initWithAction(this._inner.clone());return d},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}});cc.EaseCubicActionInOut.create=function(d){return new cc.EaseCubicActionInOut(d)};cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}};cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut};cc.cardinalSplineAt=function(y,x,w,v,u,t){var s=t*t,r=s*t,o=(1-u)/2;u=o*(-r+2*s-t);var j=o*(-r+s)+(2*r-3*s+1);t=o*(r-2*s+t)+(-2*r+3*s);s=o*(r-s);return cc.p(y.x*u+x.x*j+w.x*t+v.x*s,y.y*u+x.y*j+w.y*t+v.y*s)};cc.reverseControlPoints=function(h){for(var g=[],f=h.length-1;0<=f;f--){g.push(cc.p(h[f].x,h[f].y))}return g};cc.cloneControlPoints=function(h){for(var g=[],f=0;f<h.length;f++){g.push(cc.p(h[f].x,h[f].y))}return g};cc.copyControlPoints=cc.cloneControlPoints;cc.getControlPointAt=function(h,g){var f=Math.min(h.length-1,Math.max(g,0));return h[f]};cc.reverseControlPointsInline=function(n){for(var m=n.length,k=0|m/2,j=0;j<k;++j){var h=n[j];n[j]=n[m-j-1];n[m-j-1]=h}};cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(h,g,f){cc.ActionInterval.prototype.ctor.call(this);this._points=[];void 0!==f&&this.initWithDuration(h,g,f)},initWithDuration:function(h,g,f){if(!g||0===g.length){throw Error("Invalid configuration. It must at least have one control point")}return cc.ActionInterval.prototype.initWithDuration.call(this,h)?(this.setPoints(g),this._tension=f,!0):!1},clone:function(){var d=new cc.CardinalSplineTo;d.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return d},startWithTarget:function(d){cc.ActionInterval.prototype.startWithTarget.call(this,d);this._deltaT=1/(this._points.length-1);this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY());this._accumulatedDiff=cc.p(0,0)},update:function(k){k=this._computeEaseTime(k);var j,h=this._points;if(1===k){j=h.length-1,k=1}else{var g=this._deltaT;j=0|k/g;k=(k-g*j)/g}j=cc.cardinalSplineAt(cc.getControlPointAt(h,j-1),cc.getControlPointAt(h,j-0),cc.getControlPointAt(h,j+1),cc.getControlPointAt(h,j+2),this._tension,k);cc.ENABLE_STACKABLE_ACTIONS&&(h=this.target.getPositionX()-this._previousPosition.x,k=this.target.getPositionY()-this._previousPosition.y,0!==h||0!==k)&&(g=this._accumulatedDiff,h=g.x+h,k=g.y+k,g.x=h,g.y=k,j.x+=h,j.y+=k);this.updatePosition(j)},reverse:function(){var d=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,d,this._tension)},updatePosition:function(d){this.target.setPosition(d);this._previousPosition=d},getPoints:function(){return this._points},setPoints:function(d){this._points=d}});cc.cardinalSplineTo=function(h,g,f){return new cc.CardinalSplineTo(h,g,f)};cc.CardinalSplineTo.create=cc.cardinalSplineTo;cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(h,g,f){cc.CardinalSplineTo.prototype.ctor.call(this);this._startPosition=cc.p(0,0);void 0!==f&&this.initWithDuration(h,g,f)},startWithTarget:function(d){cc.CardinalSplineTo.prototype.startWithTarget.call(this,d);this._startPosition.x=d.getPositionX();this._startPosition.y=d.getPositionY()},reverse:function(){for(var k=this._points.slice(),j,h=k[0],g=1;g<k.length;++g){j=k[g],k[g]=cc.pSub(j,h),h=j}k=cc.reverseControlPoints(k);h=k[k.length-1];k.pop();h.x=-h.x;h.y=-h.y;k.unshift(h);for(g=1;g<k.length;++g){j=k[g],j.x=-j.x,j.y=-j.y,j.x+=h.x,j.y+=h.y,h=k[g]=j}return cc.cardinalSplineBy(this._duration,k,this._tension)},updatePosition:function(h){var g=this._startPosition,f=h.x+g.x;h=h.y+g.y;this._previousPosition.x=f;this._previousPosition.y=h;this.target.setPosition(f,h)},clone:function(){var d=new cc.CardinalSplineBy;d.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return d}});cc.cardinalSplineBy=function(h,g,f){return new cc.CardinalSplineBy(h,g,f)};cc.CardinalSplineBy.create=cc.cardinalSplineBy;cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(f,e){e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,f,e,0.5)},clone:function(){var d=new cc.CatmullRomTo;d.initWithDuration(this._duration,cc.copyControlPoints(this._points));return d}});cc.catmullRomTo=function(f,e){return new cc.CatmullRomTo(f,e)};cc.CatmullRomTo.create=cc.catmullRomTo;cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(f,e){cc.CardinalSplineBy.prototype.ctor.call(this);e&&this.initWithDuration(f,e)},initWithDuration:function(f,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,f,e,0.5)},clone:function(){var d=new cc.CatmullRomBy;d.initWithDuration(this._duration,cc.copyControlPoints(this._points));return d}});cc.catmullRomBy=function(f,e){return new cc.CatmullRomBy(f,e)};cc.CatmullRomBy.create=cc.catmullRomBy;cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(f,e){}});cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(k,j,h,g){cc.ActionInterval.prototype.ctor.call(this);this.key="";void 0!==g&&this.initWithDuration(k,j,h,g)},initWithDuration:function(k,j,h,g){return cc.ActionInterval.prototype.initWithDuration.call(this,k)?(this.key=j,this.to=g,this.from=h,!0):!1},startWithTarget:function(d){if(!d||!d.updateTweenAction){throw Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function")}cc.ActionInterval.prototype.startWithTarget.call(this,d);this.delta=this.to-this.from},update:function(d){this.target.updateTweenAction(this.to-this.delta*(1-d),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var d=new cc.ActionTween;d.initWithDuration(this._duration,this.key,this.from,this.to);return d}});cc.actionTween=function(k,j,h,g){return new cc.ActionTween(k,j,h,g)};cc.ActionTween.create=cc.actionTween;cc._globalFontSize=cc.ITEM_SIZE;cc._globalFontName="Arial";cc._globalFontNameRelease=!1;cc.MenuItem=cc.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(h,g){var f=cc.Node.prototype;f.ctor.call(this);this._callback=this._target=null;this._enabled=this._isSelected=!1;f.setAnchorPoint.call(this,0.5,0.5);this._target=g||null;if(this._callback=h||null){this._enabled=!0}},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(d){},isOpacityModifyRGB:function(){return !1},setTarget:function(f,e){this._target=e;this._callback=f},isEnabled:function(){return this._enabled},setEnabled:function(d){this._enabled=d},initWithCallback:function(f,e){this.anchorY=this.anchorX=0.5;this._target=e;this._callback=f;this._enabled=!0;this._isSelected=!1;return !0},rect:function(){var h=this._position,g=this._contentSize,f=this._anchorPoint;return cc.rect(h.x-g.width*f.x,h.y-g.height*f.y,g.width,g.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(f,e){this._target=e;this._callback=f},activate:function(){if(this._enabled){var f=this._target,e=this._callback;if(e){if(f&&cc.isString(e)){f[e](this)}else{f&&cc.isFunction(e)?e.call(f,this):e(this)}}}}});_p=cc.MenuItem.prototype;cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);cc.MenuItem.create=function(f,e){return new cc.MenuItem(f,e)};cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(h,g,f){cc.MenuItem.prototype.ctor.call(this,g,f);this._colorBackup=this._label=this._disabledColor=null;h&&(this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(h),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(d){this._disabledColor=d},getLabel:function(){return this._label},setLabel:function(d){d&&(this.addChild(d),d.anchorX=0,d.anchorY=0,this.width=d.width,this.height=d.height,d.setCascadeColorEnabled(!0));this._label&&this.removeChild(this._label,!0);this._label=d},setEnabled:function(d){this._enabled!==d&&(d?this.setColor(this._colorBackup):(this._colorBackup=this.color,this.setColor(this._disabledColor)));cc.MenuItem.prototype.setEnabled.call(this,d)},initWithLabel:function(h,g,f){this.initWithCallback(g,f);this._originalScale=1;this._colorBackup=cc.color.WHITE;this._disabledColor=cc.color(126,126,126);this.setLabel(h);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return !0},setString:function(d){this._label.string=d;this.width=this._label.width;this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&(this.stopAllActions(),this.scale=this._originalScale,cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){cc.MenuItem.prototype.selected.call(this);var d=this.getActionByTag(cc.ZOOM_ACTION_TAG);d?this.stopAction(d):this._originalScale=this.scale;d=cc.scaleTo(0.1,1.2*this._originalScale);d.setTag(cc.ZOOM_ACTION_TAG);this.runAction(d)}},unselected:function(){if(this._enabled){cc.MenuItem.prototype.unselected.call(this);this.stopActionByTag(cc.ZOOM_ACTION_TAG);var d=cc.scaleTo(0.1,this._originalScale);d.setTag(cc.ZOOM_ACTION_TAG);this.runAction(d)}}});_p=cc.MenuItemLabel.prototype;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor);cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel);cc.MenuItemLabel.create=function(h,g,f){return new cc.MenuItemLabel(h,g,f)};cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({ctor:function(u,t,s,r,p,o,n){var j;u&&0<u.length&&(j=new cc.LabelAtlas(u,t,s,r,p));cc.MenuItemLabel.prototype.ctor.call(this,j,o,n)},initWithString:function(u,t,s,r,p,o,n){if(!u||0===u.length){throw Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0")}var j=new cc.LabelAtlas;j.initWithString(u,t,s,r,p);this.initWithLabel(j,o,n);return !0}});cc.MenuItemAtlasFont.create=function(s,r,p,o,n,m,j){return new cc.MenuItemAtlasFont(s,r,p,o,n,m,j)};cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(k,j,h){var g;k&&0<k.length?(this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize,g=new cc.LabelTTF(k,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName="");cc.MenuItemLabel.prototype.ctor.call(this,g,j,h)},initWithString:function(h,g,f){if(!h||0===h.length){throw Error("Value should be non-null and its length should be greater than 0")}this._fontName=cc._globalFontName;this._fontSize=cc._globalFontSize;h=new cc.LabelTTF(h,this._fontName,this._fontSize);this.initWithLabel(h,g,f);return !0},setFontSize:function(d){this._fontSize=d;this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(d){this._fontName=d;this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var d=new cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(d)}});cc.MenuItemFont.setFontSize=function(d){cc._globalFontSize=d};cc.MenuItemFont.fontSize=function(){return cc._globalFontSize};cc.MenuItemFont.setFontName=function(d){cc._globalFontNameRelease&&(cc._globalFontName="");cc._globalFontName=d;cc._globalFontNameRelease=!0};_p=cc.MenuItemFont.prototype;cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);cc.MenuItemFont.fontName=function(){return cc._globalFontName};cc.MenuItemFont.create=function(h,g,f){return new cc.MenuItemFont(h,g,f)};cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(u,t,s,r,p){cc.MenuItem.prototype.ctor.call(this);this._disabledImage=this._selectedImage=this._normalImage=null;if(void 0!==u){t=t||null;var o,n,j;void 0!==p?(o=s,j=r,n=p):void 0!==r&&cc.isFunction(r)?(o=s,j=r):void 0!==r&&cc.isFunction(s)?(n=r,j=s,o=null):void 0===s&&(o=null);this.initWithNormalSprite(u,t,o,j,n)}},getNormalImage:function(){return this._normalImage},setNormalImage:function(d){this._normalImage!==d&&(d&&(this.addChild(d,0,cc.NORMAL_TAG),d.anchorX=0,d.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=d)&&(this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),d.textureLoaded&&!d.textureLoaded()&&d.addEventListener("load",function(e){this.width=e.width;this.height=e.height},this))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(d){this._selectedImage!==d&&(d&&(this.addChild(d,0,cc.SELECTED_TAG),d.anchorX=0,d.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=d,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(d){this._disabledImage!==d&&(d&&(this.addChild(d,0,cc.DISABLE_TAG),d.anchorX=0,d.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=d,this._updateImagesVisibility())},initWithNormalSprite:function(n,m,k,j,h){this.initWithCallback(j,h);this.setNormalImage(n);this.setSelectedImage(m);this.setDisabledImage(k);if(n=this._normalImage){this.width=n.width,this.height=n.height,n.textureLoaded&&!n.textureLoaded()&&n.addEventListener("load",function(d){this.width=d.width;this.height=d.height;this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0)},this)}this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return !0},selected:function(){cc.MenuItem.prototype.selected.call(this);this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){cc.MenuItem.prototype.unselected.call(this);this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(d){this._enabled!==d&&(cc.MenuItem.prototype.setEnabled.call(this,d),this._updateImagesVisibility())},_updateImagesVisibility:function(){var h=this._normalImage,g=this._selectedImage,f=this._disabledImage;this._enabled?(h&&(h.visible=!0),g&&(g.visible=!1),f&&(f.visible=!1)):f?(h&&(h.visible=!1),g&&(g.visible=!1),f&&(f.visible=!0)):(h&&(h.visible=!0),g&&(g.visible=!1))}});_p=cc.MenuItemSprite.prototype;cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage);cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage);cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage);cc.MenuItemSprite.create=function(n,m,k,j,h){return new cc.MenuItemSprite(n,m,k,j,h||void 0)};cc.MenuItemImage=cc.MenuItemSprite.extend({ctor:function(y,x,w,v,u){var t=null,s=null,r=null,o=null,j=null;void 0===y||null===y?cc.MenuItemSprite.prototype.ctor.call(this):(t=new cc.Sprite(y),x&&(s=new cc.Sprite(x)),void 0===v?o=w:void 0===u?(o=w,j=v):u&&(r=new cc.Sprite(w),o=v,j=u),cc.MenuItemSprite.prototype.ctor.call(this,t,s,r,o,j))},setNormalSpriteFrame:function(d){this.setNormalImage(new cc.Sprite(d))},setSelectedSpriteFrame:function(d){this.setSelectedImage(new cc.Sprite(d))},setDisabledSpriteFrame:function(d){this.setDisabledImage(new cc.Sprite(d))},initWithNormalImage:function(u,t,s,r,p){var o=null,n=null,j=null;u&&(o=new cc.Sprite(u));t&&(n=new cc.Sprite(t));s&&(j=new cc.Sprite(s));return this.initWithNormalSprite(o,n,j,r,p)}});cc.MenuItemImage.create=function(n,m,k,j,h){return new cc.MenuItemImage(n,m,k,j,h)};cc.MenuItemToggle=cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this);this._selectedIndex=0;this.subItems=[];this._opacity=0;this._color=cc.color.WHITE;0<arguments.length&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(f){this._opacity=f;if(this.subItems&&0<this.subItems.length){for(var e=0;e<this.subItems.length;e++){this.subItems[e].opacity=f}}this._color.a=f},getColor:function(){var d=this._color;return cc.color(d.r,d.g,d.b,d.a)},setColor:function(f){var e=this._color;e.r=f.r;e.g=f.g;e.b=f.b;if(this.subItems&&0<this.subItems.length){for(e=0;e<this.subItems.length;e++){this.subItems[e].setColor(f)}}void 0===f.a||f.a_undefined||this.setOpacity(f.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(h){if(h!==this._selectedIndex){this._selectedIndex=h;(h=this.getChildByTag(cc.CURRENT_ITEM))&&h.removeFromParent(!1);h=this.subItems[this._selectedIndex];this.addChild(h,0,cc.CURRENT_ITEM);var g=h.width,f=h.height;this.width=g;this.height=f;h.setPosition(g/2,f/2)}},getSubItems:function(){return this.subItems},setSubItems:function(d){this.subItems=d},initWithItems:function(k){var j=k.length;cc.isFunction(k[k.length-2])?(this.initWithCallback(k[k.length-2],k[k.length-1]),j-=2):cc.isFunction(k[k.length-1])?(this.initWithCallback(k[k.length-1],null),j-=1):this.initWithCallback(null,null);for(var h=this.subItems,g=h.length=0;g<j;g++){k[g]&&h.push(k[g])}this._selectedIndex=cc.UINT_MAX;this.setSelectedIndex(0);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return !0},addSubItem:function(d){this.subItems.push(d)},activate:function(){this._enabled&&this.setSelectedIndex((this._selectedIndex+1)%this.subItems.length);cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this);this.subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this);this.subItems[this._selectedIndex].unselected()},setEnabled:function(h){if(this._enabled!==h){cc.MenuItem.prototype.setEnabled.call(this,h);var g=this.subItems;if(g&&0<g.length){for(var f=0;f<g.length;f++){g[f].enabled=h}}}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.setSelectedIndex(this._selectedIndex)}});_p=cc.MenuItemToggle.prototype;cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex);cc.MenuItemToggle.create=function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var d=new cc.MenuItemToggle;d.initWithItems(Array.prototype.slice.apply(arguments));return d};cc.MENU_STATE_WAITING=0;cc.MENU_STATE_TRACKING_TOUCH=1;cc.MENU_HANDLER_PRIORITY=-128;cc.DEFAULT_PADDING=5;cc.Menu=cc.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(k){cc.Layer.prototype.ctor.call(this);this._color=cc.color.WHITE;this.enabled=!1;this._opacity=255;this._selectedItem=null;this._state=-1;this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled});0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var j=arguments.length,h;if(0===j){h=[]}else{if(1===j){h=k instanceof Array?k:[k]}else{if(1<j){h=[];for(var g=0;g<j;g++){arguments[g]&&h.push(arguments[g])}}}}this.initWithArray(h)},onEnter:function(){var d=this._touchListener;d._isRegistered()||cc.eventManager.addListener(d,this);cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(d){this.enabled=d},initWithItems:function(h){var g=[];if(h){for(var f=0;f<h.length;f++){h[f]&&g.push(h[f])}}return this.initWithArray(g)},initWithArray:function(f){if(cc.Layer.prototype.init.call(this)){this.enabled=!0;var e=cc.winSize;this.setPosition(e.width/2,e.height/2);this.setContentSize(e);this.setAnchorPoint(0.5,0.5);this.ignoreAnchorPointForPosition(!0);if(f){for(e=0;e<f.length;e++){this.addChild(f[e],e)}}this._selectedItem=null;this._state=cc.MENU_STATE_WAITING;return this.cascadeOpacity=this.cascadeColor=!0}return !1},addChild:function(h,g,f){if(!(h instanceof cc.MenuItem)){throw Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children")}cc.Layer.prototype.addChild.call(this,h,g,f)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(u){var t=-u,s=this._children,r,p,o,n;if(s&&0<s.length){p=0;for(r=s.length;p<r;p++){t+=s[p].height*s[p].scaleY+u}var j=t/2;p=0;for(r=s.length;p<r;p++){n=s[p],o=n.height,t=n.scaleY,n.setPosition(0,j-o*t/2),j-=o*t+u}}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(u){var t=-u,s=this._children,r,p,o,n;if(s&&0<s.length){r=0;for(p=s.length;r<p;r++){t+=s[r].width*s[r].scaleX+u}var j=-t/2;r=0;for(p=s.length;r<p;r++){n=s[r],t=n.scaleX,o=s[r].width,n.setPosition(j+o*t/2,0),j+=o*t+u}}},alignItemsInColumns:function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var D=[],C=0;C<arguments.length;C++){D.push(arguments[C])}var B=-5,A=0,z=0,y=0,x,w,u,o=this._children;if(o&&0<o.length){for(C=0,u=o.length;C<u;C++){A>=D.length||!(x=D[A])||(w=o[C].height,z=z>=w||isNaN(w)?z:w,++y,y>=x&&(B+=z+5,z=y=0,++A))}}var j=cc.director.getWinSize(),G=x=z=A=0,E=0,B=B/2;if(o&&0<o.length){for(C=0,u=o.length;C<u;C++){var F=o[C];0===x&&(x=D[A],E=G=j.width/(1+x));w=F._getHeight();z=z>=w||isNaN(w)?z:w;F.setPosition(E-j.width/2,B-w/2);E+=G;++y;y>=x&&(B-=z+5,z=x=y=0,++A)}}},alignItemsInRows:function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var E=[],D;for(D=0;D<arguments.length;D++){E.push(arguments[D])}var C=[],B=[],A=-10,z=-5,y=0,x=0,u=0,o,j,I,G,H=this._children;if(H&&0<H.length){for(D=0,I=H.length;D<I;D++){(j=H[D],y>=E.length||!(o=E[y]))||(G=j.width,x=x>=G||isNaN(G)?x:G,z+=j.height+5,++u,u>=o&&(C.push(x),B.push(z),A+=x+10,x=u=0,z=-5,++y))}}z=cc.director.getWinSize();o=x=y=0;var A=-A/2,F=0;if(H&&0<H.length){for(D=0,I=H.length;D<I;D++){j=H[D],0===o&&(o=E[y],F=B[y]),G=j._getWidth(),x=x>=G||isNaN(G)?x:G,j.setPosition(A+C[y]/2,F-z.height/2),F-=j.height+10,++u,u>=o&&(A+=x+5,x=o=u=0,++y)}}},removeChild:function(f,e){null!=f&&(f instanceof cc.MenuItem?(this._selectedItem===f&&(this._selectedItem=null),cc.Node.prototype.removeChild.call(this,f,e)):cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children"))},_onTouchBegan:function(k,j){var h=j.getCurrentTarget();if(h._state!==cc.MENU_STATE_WAITING||!h._visible||!h.enabled){return !1}for(var g=h.parent;null!=g;g=g.parent){if(!g.isVisible()){return !1}}h._selectedItem=h._itemForTouch(k);return h._selectedItem?(h._state=cc.MENU_STATE_TRACKING_TOUCH,h._selectedItem.selected(),h._selectedItem.setNodeDirty(),!0):!1},_onTouchEnded:function(h,g){var f=g.getCurrentTarget();f._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchEnded(): invalid state"):(f._selectedItem&&(f._selectedItem.unselected(),f._selectedItem.setNodeDirty(),f._selectedItem.activate()),f._state=cc.MENU_STATE_WAITING)},_onTouchCancelled:function(h,g){var f=g.getCurrentTarget();f._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchCancelled(): invalid state"):(f._selectedItem&&(f._selectedItem.unselected(),f._selectedItem.setNodeDirty()),f._state=cc.MENU_STATE_WAITING)},_onTouchMoved:function(k,j){var h=j.getCurrentTarget();if(h._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchMoved(): invalid state")}else{var g=h._itemForTouch(k);g!==h._selectedItem&&(h._selectedItem&&(h._selectedItem.unselected(),h._selectedItem.setNodeDirty()),h._selectedItem=g,h._selectedItem&&(h._selectedItem.selected(),h._selectedItem.setNodeDirty()))}},onExit:function(){this._state===cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=cc.MENU_STATE_WAITING);cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(d){},isOpacityModifyRGB:function(){return !1},_itemForTouch:function(p){p=p.getLocation();var o=this._children,n;if(o&&0<o.length){for(var m=o.length-1;0<=m;m--){if(n=o[m],n.isVisible()&&n.isEnabled()){var k=n.convertToNodeSpace(p),j=n.rect();j.x=0;j.y=0;if(cc.rectContainsPoint(j,k)){return n}}}}return null}});_p=cc.Menu.prototype;cc.Menu.create=function(f){var e=arguments.length;0<e&&null==arguments[e-1]&&cc.log("parameters should not be ending with null in Javascript");return 0===e?new cc.Menu:1===e?new cc.Menu(f):new cc.Menu(Array.prototype.slice.call(arguments,0))};(function(){var f=cc.sys,e={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1,ONE_SOURCE:!1};f.browserType===f.BROWSER_TYPE_FIREFOX&&(e.DELAY_CREATE_CTX=!0,e.USE_LOADER_EVENT="canplay");f.os===f.OS_ANDROID&&f.browserType===f.BROWSER_TYPE_UC&&(e.ONE_SOURCE=!0);window.__audioSupport=e})();cc.Audio=cc.Class.extend({src:null,_element:null,_AUDIO_TYPE:"AUDIO",ctor:function(d){this.src=d},setBuffer:function(d){this._AUDIO_TYPE="WEBAUDIO";this._element=new cc.Audio.WebAudio(d)},setElement:function(d){this._AUDIO_TYPE="AUDIO";this._element=d;d.addEventListener("ended",function(){d.loop||(d.paused=!0)})},play:function(f,e){this._element&&(this._element.loop=e,this._element.play(),"AUDIO"===this._AUDIO_TYPE&&this._element.paused&&(this.stop(),cc.Audio.touchPlayList.push({loop:e,offset:f,audio:this._element})),!1===cc.Audio.bindTouch&&(cc.Audio.bindTouch=!0,cc.game.canvas.addEventListener("touchstart",cc.Audio.touchStart)))},getPlaying:function(){return this._element?!this._element.paused:!0},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(d){}}},pause:function(){this._element&&this._element.pause()},resume:function(){this._element&&this._element.play()},setVolume:function(d){this._element&&(this._element.volume=d)},getVolume:function(){if(this._element){return this._element.volume}},cloneNode:function(){var k=new cc.Audio(this.src);if("AUDIO"===this._AUDIO_TYPE){for(var j=document.createElement("audio"),h=j.getElementsByTagName("source"),g=0;g<h.length;g++){j.appendChild(h[g])}j.src=this.src;k.setElement(j)}else{k.setBuffer(this._element.buffer)}return k}});cc.Audio.touchPlayList=[];cc.Audio.bindTouch=!1;cc.Audio.touchStart=function(){for(var f=cc.Audio.touchPlayList,e=null;e=f.pop();){e.audio.loop=!!e.loop,e.audio.play(e.offset)}};cc.Audio.WebAudio=function(d){this.buffer=d;this.context=cc.Audio._context;d=this.context.createGain();d.gain.value=1;d.connect(this.context.destination);this._volume=d;this._loop=!1;this._startTime=-1;this._currentSource=null;this.playedLength=0;this._currextTimer=null};cc.Audio.WebAudio.prototype={constructor:cc.Audio.WebAudio,get paused(){return this._currentSource&&this._currentSource.loop?!1:-1===this._startTime?!0:this.context.currentTime-this._startTime>this.buffer.duration},set paused(d){},get loop(){return this._loop},set loop(d){return this._loop=d},get volume(){return this._volume.gain.value},set volume(d){return this._volume.gain.value=d},get currentTime(){return this.playedLength},set currentTime(d){return this.playedLength=d},play:function(k){this._currentSource&&!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var j=this.context.createBufferSource();j.buffer=this.buffer;j.connect(this._volume);j.loop=this._loop;this._startTime=this.context.currentTime;k=k||this.playedLength;var h=this.buffer.duration;this._loop?j.start?j.start(0):j.notoGrainOn?j.noteGrainOn(0):j.noteOn(0):j.start?j.start(0,k,h-k):j.notoGrainOn?j.noteGrainOn(0,k,h-k):j.noteOn(0,k,h-k);this._currentSource=j;if(0===this.context.currentTime){var g=this;clearTimeout(this._currextTimer);this._currextTimer=setTimeout(function(){0===g.context.currentTime&&cc.Audio.touchPlayList.push({offset:k,audio:g})},10)}},pause:function(){this.playedLength=this.context.currentTime-this._startTime;this.playedLength%=this.buffer.duration;var d=this._currentSource;this._currentSource=null;this._startTime=-1;d&&d.stop(0)}};(function(s){var r=s.WEB_AUDIO,p=s.ONLY_ONE,o=[];(function(){var f=document.createElement("audio");if(f.canPlayType){var e=f.canPlayType('audio/ogg; codecs\x3d"vorbis"');e&&""!==e&&o.push(".ogg");(e=f.canPlayType("audio/mpeg"))&&""!==e&&o.push(".mp3");(e=f.canPlayType('audio/wav; codecs\x3d"1"'))&&""!==e&&o.push(".wav");(e=f.canPlayType("audio/mp4"))&&""!==e&&o.push(".mp4");(f=f.canPlayType("audio/x-m4a"))&&""!==f&&o.push(".m4a")}})();try{if(r){var n=new (window.AudioContext||window.webkitAudioContext||window.mozAudioContext);cc.Audio._context=n;s.DELAY_CREATE_CTX&&setTimeout(function(){n=new (window.AudioContext||window.webkitAudioContext||window.mozAudioContext);cc.Audio._context=n},0)}}catch(m){r=!1,cc.log("browser don't support web audio")}var j={cache:{},useWebAudio:!1,loadBuffer:function(h,g){if(r){var d=new XMLHttpRequest;d.open("GET",h,!0);d.responseType="arraybuffer";d.onload=function(){n.decodeAudioData(d.response,function(e){g(null,e)},function(){g("decode error - "+h)})};d.onerror=function(){g("request error - "+h)};d.send()}},load:function(x,w,v,u){if(0===o.length){return u("can not support audio!")}var t=cc.loader.getRes(w);if(t){return u(null,t)}cc.loader.audioPath&&(x=cc.path.join(cc.loader.audioPath,x));var f=cc.path.extname(x);v=[f];for(t=0;t<o.length;t++){f!==o[t]&&v.push(o[t])}t=new cc.Audio(x);cc.loader.cache[w]=t;this.loadAudioFromExtList(x,v,t,u);return t},loadAudioFromExtList:function(C,z,y,f){if(0===z.length){var I="can not found the resource of audio! Last match url is : ",I=I+C.replace(/\.(.*)?$/,"(");o.forEach(function(e){I+=e+"|"});I=I.replace(/\|$/,")");return f({status:520,errorMessage:I},null)}if(r&&this.useWebAudio){this.loadBuffer(C,function(g,e){g&&cc.log(g);e&&y.setBuffer(e);f(null,y)})}else{for(var F=s.ONE_SOURCE?1:z.length,H=document.createElement("audio"),E=0;E<F;E++){var G=document.createElement("source");G.src=cc.path.changeExtname(C,z[E]);H.appendChild(G)}y.setElement(H);var d=setTimeout(function(){0===H.readyState?c():D()},8000),D=function(){H.removeEventListener("canplaythrough",D,!1);H.removeEventListener("error",c,!1);H.removeEventListener("emptied",D,!1);s.USE_LOADER_EVENT&&H.removeEventListener(s.USE_LOADER_EVENT,D,!1);clearTimeout(d);f(null,y)},c=function(){cc.log("load audio failure - "+C);D()};H.addEventListener("canplaythrough",D,!1);H.addEventListener("error",c,!1);s.USE_LOADER_EVENT&&H.addEventListener(s.USE_LOADER_EVENT,D,!1)}}};cc.loader.register(["mp3","ogg","wav","mp4","m4a"],j);cc.audioEngine={_currMusic:null,_musicVolume:1,features:s,willPlayMusic:function(){return !1},playMusic:function(h,g){var f=this._currMusic;f&&f.getPlaying()&&f.stop();f=cc.loader.getRes(h);f||(cc.loader.load(h),f=cc.loader.getRes(h));f.setVolume(this._musicVolume);f.play(0,g||!1);this._currMusic=f},stopMusic:function(f){var e=this._currMusic;e&&(e.stop(),this._currMusic=null,f&&cc.loader.release(e.src))},pauseMusic:function(){var d=this._currMusic;d&&d.pause()},resumeMusic:function(){var d=this._currMusic;d&&d.resume()},rewindMusic:function(){var d=this._currMusic;d&&(d.stop(),d.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(f){f-=0;isNaN(f)&&(f=1);1<f&&(f=1);0>f&&(f=0);this._musicVolume=f;var e=this._currMusic;e&&e.setVolume(f)},isMusicPlaying:function(){var d=this._currMusic;return d?d.getPlaying():!1},_audioPool:{},_maxAudioInstance:10,_effectVolume:1,playEffect:function(u,t){if(p&&this._currMusic&&this._currMusic.getPlaying()){return cc.log("Browser is only allowed to play one audio"),null}var k=this._audioPool[u];k||(k=this._audioPool[u]=[]);var e;for(e=0;e<k.length&&k[e].getPlaying();e++){}!r&&e>this._maxAudioInstance&&(e=k.shift(),e.stop(),k.push(e),e=k.length-1);var d;if(k[e]){return d=k[e],d.setVolume(this._effectVolume),d.play(0,t||!1),d}(d=cc.loader.getRes(u))&&r&&"AUDIO"===d._AUDIO_TYPE&&(cc.loader.release(u),d=null);if(d){if(r&&"AUDIO"===d._AUDIO_TYPE){j.loadBuffer(u,function(g,f){d.setBuffer(f);d.setVolume(cc.audioEngine._effectVolume);d.getPlaying()||d.play(0,t||!1)})}else{return d=d.cloneNode(),d.setVolume(this._effectVolume),d.play(0,t||!1),k.push(d),d}}j.useWebAudio=!0;cc.loader.load(u,function(c){c=cc.loader.getRes(u);c=c.cloneNode();c.setVolume(cc.audioEngine._effectVolume);c.play(0,t||!1);k.push(c)});j.useWebAudio=!1;return d},setEffectsVolume:function(v){v-=0;isNaN(v)&&(v=1);1<v&&(v=1);0>v&&(v=0);this._effectVolume=v;var u=this._audioPool,t;for(t in u){var k=u[t];if(Array.isArray(k)){for(var h=0;h<k.length;h++){k[h].setVolume(v)}}}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(d){d&&d.pause()},pauseAllEffects:function(){var t=this._audioPool,k;for(k in t){for(var h=t[k],g=0;g<t[k].length;g++){h[g].getPlaying()&&h[g].pause()}}},resumeEffect:function(d){d&&d.resume()},resumeAllEffects:function(){var t=this._audioPool,k;for(k in t){for(var h=t[k],g=0;g<t[k].length;g++){h[g].resume()}}},stopEffect:function(d){d&&d.stop()},stopAllEffects:function(){var t=this._audioPool,k;for(k in t){for(var h=t[k],g=0;g<h.length;g++){h[g].stop()}h.length=0}},unloadEffect:function(f){if(f){cc.loader.release(f);var e=this._audioPool[f];e&&(e.length=0);delete this._audioPool[f]}},end:function(){this.stopMusic();this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t=this._currMusic;t&&t.getPlaying()&&(t.pause(),this._pauseCache.push(t));var t=this._audioPool,k;for(k in t){for(var h=t[k],g=0;g<t[k].length;g++){h[g].getPlaying()&&(h[g].pause(),this._pauseCache.push(h[g]))}}},_resumePlaying:function(){for(var f=this._pauseCache,e=0;e<f.length;e++){f[e].resume()}f.length=0}}})(window.__audioSupport);(function(){cc.PhysicsSprite=cc.Sprite.extend({_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(j,h){cc.Sprite.prototype.ctor.call(this);if(void 0===j){cc.PhysicsSprite.prototype.init.call(this)}else{if(cc.isString(j)){if("#"===j[0]){var g=j.substr(1,j.length-1),g=cc.spriteFrameCache.getSpriteFrame(g);this.initWithSpriteFrame(g)}else{this.init(j,h)}}else{cc.isObject(j)&&(j instanceof cc.Texture2D?this.initWithTexture(j,h):j instanceof cc.SpriteFrame&&this.initWithSpriteFrame(j))}}cc.renderer.pushRenderCommand(this._renderCmd)},visit:function(){cc.renderer.pushRenderCommand(this._renderCmd);cc.Sprite.prototype.visit.call(this)},setBody:function(e){this._body=e},getBody:function(){return this._body},getPosition:function(){var e=this._body;return{x:e.p.x,y:e.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(g,f){void 0===f?(this._body.p.x=g.x,this._body.p.y=g.y):(this._body.p.x=g,this._body.p.y=f)},setPositionX:function(e){this._body.p.x=e},setPositionY:function(e){this._body.p.y=e},_syncPosition:function(){var g=this._position,f=this._body;g.x===f.p.x&&g.y===f.p.y||cc.Sprite.prototype.setPosition.call(this,f.p.x,f.p.y)},getRotation:function(){return this._ignoreBodyRotation?this._rotationX:-cc.radiansToDegrees(this._body.a)},setRotation:function(e){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,e):this._body.a=-cc.degreesToRadians(e)},_syncRotation:function(){var e=-cc.radiansToDegrees(this._body.a);this._rotationX!==e&&cc.Sprite.prototype.setRotation.call(this,e)},getNodeToParentTransform:function(){return this._renderCmd.getNodeToParentTransform()},isDirty:function(){return !this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(e){this._ignoreBodyRotation=e},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsSprite.CanvasRenderCmd(this):new cc.PhysicsSprite.WebGLRenderCmd(this)}});cc.PhysicsSprite._className="PhysicsSprite";var d=cc.PhysicsSprite.prototype;cc.defineGetterSetter(d,"body",d.getBody,d.setBody);cc.defineGetterSetter(d,"dirty",d.isDirty,d.setDirty);cc.PhysicsSprite.create=function(g,f){return new cc.PhysicsSprite(g,f)};cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create;cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create})();cc.__convertVerts=function(h){for(var g=[],f=0;f<h.length/2;f++){g[f]={x:h[2*f],y:h[2*f+1]}}return g};cc.ColorForBody=function(d){return d.isRogue()||d.isSleeping()?cc.color(128,128,128,128):d.nodeIdleTime>d.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)};cc.DrawShape=function(k,j){var h=k.body,g=cc.ColorForBody(h);switch(k.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(k.tc,Math.max(k.r,1),g);this.drawSegment(k.tc,cp.v.add(k.tc,cp.v.mult(h.rot,k.r)),1,g);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(k.ta,k.tb,Math.max(k.r,2),g);break;case cp.PolyShape.prototype.collisionCode:h=cc.color(g.r,g.g,g.b,cc.lerp(g.a,255,0.5));this.drawPoly(cc.__convertVerts(k.tVerts),g,1,h);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}};cc.DrawConstraint=function(n,m){var k=n.a,j=n.b,h;n instanceof cp.PinJoint?(h=k.local2World(n.anchr1),k=j.local2World(n.anchr2),this.drawDot(h,3,cc.CONSTRAINT_COLOR),this.drawDot(k,3,cc.CONSTRAINT_COLOR),this.drawSegment(h,k,1,cc.CONSTRAINT_COLOR)):n instanceof cp.SlideJoint?(h=k.local2World(n.anchr1),k=j.local2World(n.anchr2),this.drawDot(h,3,cc.CONSTRAINT_COLOR),this.drawDot(k,3,cc.CONSTRAINT_COLOR),this.drawSegment(h,k,1,cc.CONSTRAINT_COLOR)):n instanceof cp.PivotJoint?(h=k.local2World(n.anchr1),k=j.local2World(n.anchr2),this.drawDot(h,3,cc.CONSTRAINT_COLOR),this.drawDot(k,3,cc.CONSTRAINT_COLOR)):n instanceof cp.GrooveJoint&&(h=k.local2World(n.grv_a),k=k.local2World(n.grv_b),j=j.local2World(n.anchr2),this.drawDot(j,3,cc.CONSTRAINT_COLOR),this.drawSegment(h,k,1,cc.CONSTRAINT_COLOR))};cc.CONSTRAINT_COLOR=cc.color(0,255,0,128);cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(d){cc.DrawNode.prototype.ctor.call(this);this._space=d},getSpace:function(){return this._space},setSpace:function(d){this._space=d},draw:function(d){this._space&&(this._space.eachShape(cc.DrawShape.bind(this)),this._space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.PhysicsDebugNode.CanvasRenderCmd(this):new cc.PhysicsDebugNode.WebGLRenderCmd(this)}});cc.PhysicsDebugNode.create=function(d){return new cc.PhysicsDebugNode(d)};(function(){cc.PhysicsDebugNode.CanvasRenderCmd=function(e){cc.Node.CanvasRenderCmd.call(this,e);this._buffer=e._buffer;this._needDraw=!0};var d=cc.PhysicsDebugNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);d.constructor=cc.PhysicsDebugNode.CanvasRenderCmd;d.rendering=function(m,k,j){var h=this._node;h._space&&(h._space.eachShape(cc.DrawShape.bind(h)),h._space.eachConstraint(cc.DrawConstraint.bind(h)),cc.DrawNode.CanvasRenderCmd.prototype.rendering.call(this,m,k,j),h.clear())};d._drawDot=cc.DrawNode.CanvasRenderCmd.prototype._drawDot;d._drawSegment=cc.DrawNode.CanvasRenderCmd.prototype._drawSegment;d._drawPoly=cc.DrawNode.CanvasRenderCmd.prototype._drawPoly})();(function(){cc.PhysicsDebugNode.WebGLRenderCmd=function(d){cc.Node.WebGLRenderCmd.call(this,d);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity()};cc.PhysicsDebugNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.PhysicsDebugNode.WebGLRenderCmd.prototype.constructor=cc.PhysicsDebugNode.WebGLRenderCmd;cc.PhysicsDebugNode.WebGLRenderCmd.prototype.rendering=function(f){f=this._node;if(f._space){f._space.eachShape(cc.DrawShape.bind(f));f._space.eachConstraint(cc.DrawConstraint.bind(f));var e=this._worldTransform;this._matrix.mat[0]=e.a;this._matrix.mat[4]=e.c;this._matrix.mat[12]=e.tx;this._matrix.mat[1]=e.b;this._matrix.mat[5]=e.d;this._matrix.mat[13]=e.ty;cc.glBlendFunc(f._blendFunc.src,f._blendFunc.dst);this._shaderProgram.use();this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix);f._render();f.clear()}}})();(function(){cc.PhysicsSprite.CanvasRenderCmd=function(e){cc.Sprite.CanvasRenderCmd.call(this,e);this._needDraw=!0};var d=cc.PhysicsSprite.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);d.constructor=cc.PhysicsSprite.CanvasRenderCmd;d.rendering=function(m,k,j){var h=this._node;h._syncPosition();h._ignoreBodyRotation||h._syncRotation();this.transform(this.getParentRenderCmd());cc.Sprite.CanvasRenderCmd.prototype.rendering.call(this,m,k,j)}})();(function(){cc.PhysicsSprite.WebGLRenderCmd=function(e){cc.Sprite.WebGLRenderCmd.call(this,e);this._needDraw=!0};var d=cc.PhysicsSprite.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);d.constructor=cc.PhysicsSprite.WebGLRenderCmd;d.spUploadData=cc.Sprite.WebGLRenderCmd.prototype.uploadData;d.uploadData=function(m,k,j){var h=this._node;h._syncPosition();h._ignoreBodyRotation||h._syncRotation();this.transform(this.getParentRenderCmd(),!0);return this.spUploadData(m,k,j)}})();(function(){Object.create=Object.create||function(f){function e(){}e.prototype=f;return new e};var a1;"undefined"===typeof exports?(a1={},"object"===typeof window&&(window.cp=a1)):a1=exports;var aZ=function(f,e){if(!f){throw Error("Assertion failed: "+e)}},aW=function(f,e){!f&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+e),console.trace&&console.trace())},aV=function(f,e){return f<e?f:e},aU=function(f,e){return f>e?f:e},aT,aP;"object"===typeof window&&-1<window.navigator.userAgent.indexOf("Firefox")?(aT=Math.min,aP=Math.max):(aT=aV,aP=aU);var aO=function(f,e){return f<e?f+" "+e:e+" "+f},aN=function(h,g){for(var f=0;f<h.length;f++){if(h[f]===g){h[f]=h[h.length-1];h.length--;break}}};a1.momentForCircle=function(m,k,h,g){return m*(0.5*(k*k+h*h)+bo(g))};a1.areaForCircle=function(f,e){return Math.PI*Math.abs(f*f-e*e)};a1.momentForSegment=function(m,k,h){var g=bC(aA(k,h),0.5);return m*(bc(h,k)/12+bo(g))};a1.areaForSegment=function(h,g,f){return f*(Math.PI*f+2*be(h,g))};a1.momentForPoly=function(D,C,B){for(var A=0,z=0,y=C.length,x=0;x<y;x+=2){var w=C[x]+B.x,v=C[x+1]+B.y,u=C[(x+2)%y]+B.x,t=C[(x+3)%y]+B.y,E=u*v-t*w,A=A+E*(w*w+v*v+(w*u+v*t)+(u*u+t*t)),z=z+E}return D*A/(6*z)};a1.areaForPoly=function(m){for(var k=0,h=0,g=m.length;h<g;h+=2){k+=bt(new aG(m[h],m[h+1]),new aG(m[(h+2)%g],m[(h+3)%g]))}return -k/2};a1.centroidForPoly=function(w){for(var v=0,u=new aG(0,0),t=0,s=w.length;t<s;t+=2){var r=new aG(w[t],w[t+1]),p=new aG(w[(t+2)%s],w[(t+3)%s]),n=bt(r,p),v=v+n,u=aA(u,bC(aA(r,p),n))}return bC(u,1/(3*v))};a1.recenterPoly=function(h){for(var g=a1.centroidForPoly(h),c=0;c<h.length;c+=2){h[c]-=g.x,h[c+1]-=g.y}};a1.momentForBox=function(h,g,f){return h*(g*g+f*f)/12};a1.momentForBox2=function(p,n){var m=n.r-n.l,k=n.t-n.b,c=bC([n.l+n.r,n.b+n.t],0.5);return a1.momentForBox(p,m,k)+p*bo(c)};var aK=a1.loopIndexes=function(C){var B=0,A=0,z,y,x,w;z=x=C[0];y=w=C[1];for(var v=C.length>>1,u=1;u<v;u++){var t=C[2*u],s=C[2*u+1];if(t<z||t==z&&s<y){z=t,y=s,B=u}else{if(t>x||t==x&&s>w){x=t,w=s,A=u}}}return[B,A]},aJ=function(m,k,h){var g=m[2*k];m[2*k]=m[2*h];m[2*h]=g;g=m[2*k+1];m[2*k+1]=m[2*h+1];m[2*h+1]=g},aI=function(A,z,y,x,w,v){if(0===y){return 0}var u=0,t=z;w=aB(w,x);v*=bF(w);var s=z;for(y=z+y-1;s<=y;){var r=new aG(A[2*s],A[2*s+1]),r=bt(w,aB(r,x));r>v?(r>u&&(u=r,t=s),s++):(aJ(A,s,y),y--)}t!=z&&aJ(A,z,t);return s-z},aF=function(A,z,y,x,w,v,u,t){if(0>x){return 0}if(0==x){return z[2*t]=v.x,z[2*t+1]=v.y,1}var s=aI(z,y,x,w,v,A),r=new aG(z[2*y],z[2*y+1]);w=aF(A,z,y+1,s-1,w,r,v,t);r=t+w++;z[2*r]=v.x;z[2*r+1]=v.y;x=aI(z,y+s,x-s,v,u,A);r=new aG(z[2*(y+s)],z[2*(y+s)+1]);return w+aF(A,z,y+s+1,x-1,v,r,u,t+w)};a1.convexHull=function(p,n,m){if(n){for(var k=0;k<p.length;k++){n[k]=p[k]}}else{n=p}var e=aK(p),k=e[0],e=e[1];if(k==e){return n.length=2,n}aJ(n,0,k);aJ(n,1,0==e?k:e);k=new aG(n[0],n[1]);e=new aG(n[2],n[3]);p=aF(m,n,2,(p.length>>1)-2,k,e,k,1)+1;n.length=2*p;aW(bJ(n),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can.");return n};var aH=function(h,g,f){return aT(aP(h,g),f)},aE=function(d){return aP(0,aT(d,1))},aG=a1.Vect=function(f,e){this.x=f;this.y=e};a1.v=function(f,e){return new aG(f,e)};var bH=a1.vzero=new aG(0,0),aD=a1.v.dot=function(f,e){return f.x*e.x+f.y*e.y},bF=a1.v.len=function(d){return Math.sqrt(aD(d,d))},bx=a1.v.len2=function(f,e){return Math.sqrt(f*f+e*e)};a1.v.eql=function(f,e){return f.x===e.x&&f.y===e.y};var aA=a1.v.add=function(f,e){return new aG(f.x+e.x,f.y+e.y)};aG.prototype.add=function(d){this.x+=d.x;this.y+=d.y;return this};var aB=a1.v.sub=function(f,e){return new aG(f.x-e.x,f.y-e.y)};aG.prototype.sub=function(d){this.x-=d.x;this.y-=d.y;return this};var bq=a1.v.neg=function(d){return new aG(-d.x,-d.y)};aG.prototype.neg=function(){this.x=-this.x;this.y=-this.y;return this};var bC=a1.v.mult=function(f,e){return new aG(f.x*e,f.y*e)};aG.prototype.mult=function(d){this.x*=d;this.y*=d;return this};var bt=a1.v.cross=function(f,e){return f.x*e.y-f.y*e.x},bm=a1.v.perp=function(d){return new aG(-d.y,d.x)};a1.v.pvrperp=function(d){return new aG(d.y,-d.x)};var a7=a1.v.project=function(f,e){return bC(e,aD(f,e)/bo(e))};aG.prototype.project=function(d){this.mult(aD(this,d)/bo(d));return this};var bw=a1.v.rotate=function(f,e){return new aG(f.x*e.x-f.y*e.y,f.x*e.y+f.y*e.x)};aG.prototype.rotate=function(d){this.x=this.x*d.x-this.y*d.y;this.y=this.x*d.y+this.y*d.x;return this};var a5=a1.v.unrotate=function(f,e){return new aG(f.x*e.x+f.y*e.y,f.y*e.x-f.x*e.y)},bo=a1.v.lengthsq=function(d){return aD(d,d)},bU=a1.v.lengthsq2=function(f,e){return f*f+e*e},bf=a1.v.lerp=function(h,g,f){return aA(bC(h,1-f),bC(g,f))},bl=a1.v.normalize=function(d){return bC(d,1/bF(d))},bd=a1.v.normalize_safe=function(d){return 0===d.x&&0===d.y?bH:bl(d)},bg=a1.v.clamp=function(f,e){return aD(f,f)>e*e?bC(bl(f),e):f};a1.v.lerpconst=function(h,g,f){return aA(h,bg(aB(g,h),f))};var be=a1.v.dist=function(f,e){return bF(aB(f,e))},bc=a1.v.distsq=function(f,e){return bo(aB(f,e))};a1.v.near=function(h,g,f){return bc(h,g)<f*f};var ar=a1.v.slerp=function(p,n,m){var k=Math.acos(aD(p,n));if(k){var h=1/Math.sin(k);return aA(bC(p,Math.sin((1-m)*k)*h),bC(n,Math.sin(m*k)*h))}return p};a1.v.slerpconst=function(m,k,h){var g=Math.acos(aD(m,k));return ar(m,k,aT(h,g)/g)};a1.v.forangle=function(d){return new aG(Math.cos(d),Math.sin(d))};a1.v.toangle=function(d){return Math.atan2(d.y,d.x)};a1.v.str=function(d){return"("+d.x.toFixed(3)+", "+d.y.toFixed(3)+")"};var aq=0,ae=a1.BB=function(m,k,h,g){this.l=m;this.b=k;this.r=h;this.t=g;aq++};a1.bb=function(m,k,h,g){return new ae(m,k,h,g)};var a4=function(f,e){return new ae(f.x-e,f.y-e,f.x+e,f.y+e)},az=0;a1.NO_GROUP=0;var af=a1.ALL_LAYERS=-1;a1.ALL_CATEGORIES=-1;a1.resetShapeIdCounter=function(){az=0};var bj=a1.Shape=function(d){this.body=d;this.bb_l=this.bb_b=this.bb_r=this.bb_t=0;this.hashid=az++;this.sensor=!1;this.u=this.e=0;this.surface_v=bH;this.group=this.collision_type=0;this.layers=af;this.space=null;this.collisionCode=this.collisionCode};bj.prototype.setElasticity=function(d){this.e=d};bj.prototype.setFriction=function(d){this.body.activate();this.u=d};bj.prototype.setLayers=function(d){this.body.activate();this.layers=d};bj.prototype.setSensor=function(d){this.body.activate();this.sensor=d};bj.prototype.setCollisionType=function(d){this.body.activate();this.collision_type=d};bj.prototype.getBody=function(){return this.body};bj.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)};bj.prototype.setBody=function(d){aZ(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body.");this.body=d};bj.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)};bj.prototype.update=function(f,d){aZ(!isNaN(d.x),"Rotation is NaN");aZ(!isNaN(f.x),"Position is NaN");this.cacheData(f,d)};bj.prototype.pointQuery=function(d){d=this.nearestPointQuery(d);if(0>d.d){return d}};bj.prototype.getBB=function(){return new ae(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var j=function(h,g,f){this.shape=h;this.p=g;this.d=f},bS=function(h,g,f){this.shape=h;this.t=g;this.n=f};bS.prototype.hitPoint=function(f,e){return bf(f,e,this.t)};bS.prototype.hitDist=function(f,e){return be(f,e)*this.t};var ag=a1.CircleShape=function(h,g,f){this.c=this.tc=f;this.r=g;this.type="circle";bj.call(this,h)};ag.prototype=Object.create(bj.prototype);ag.prototype.cacheData=function(m,k){var h=this.tc=bw(this.c,k).add(m),g=this.r;this.bb_l=h.x-g;this.bb_b=h.y-g;this.bb_r=h.x+g;this.bb_t=h.y+g};ag.prototype.nearestPointQuery=function(m){var k=m.x-this.tc.x,h=m.y-this.tc.y;m=bx(k,h);var g=this.r,k=new aG(this.tc.x+k*g/m,this.tc.y+h*g/m);return new j(this,k,m-g)};var bY=function(s,r,p,n,m,k){n=aB(n,r);m=aB(m,r);r=aD(n,n)-2*aD(n,m)+aD(m,m);k=-2*aD(n,n)+2*aD(n,m);p=aD(n,n)-p*p;p=k*k-4*r*p;if(0<=p&&(p=(-k-Math.sqrt(p))/(2*r),0<=p&&1>=p)){return new bS(s,p,bl(bf(n,m,p)))}};ag.prototype.segmentQuery=function(f,e){return bY(this,this.tc,this.r,f,e)};var b2=a1.SegmentShape=function(m,k,h,g){this.a=k;this.b=h;this.n=bm(bl(aB(h,k)));this.ta=this.tb=this.tn=null;this.r=g;this.b_tangent=this.a_tangent=bH;this.type="segment";bj.call(this,m)};b2.prototype=Object.create(bj.prototype);b2.prototype.cacheData=function(u,t){this.ta=aA(u,bw(this.a,t));this.tb=aA(u,bw(this.b,t));this.tn=bw(this.n,t);var s,r,p,n;this.ta.x<this.tb.x?(s=this.ta.x,r=this.tb.x):(s=this.tb.x,r=this.ta.x);this.ta.y<this.tb.y?(p=this.ta.y,n=this.tb.y):(p=this.tb.y,n=this.ta.y);var m=this.r;this.bb_l=s-m;this.bb_b=p-m;this.bb_r=r+m;this.bb_t=n+m};b2.prototype.nearestPointQuery=function(p){var n;n=this.tb;var m=aB(this.ta,n),k=aE(aD(m,aB(p,n))/bo(m));n=aA(n,bC(m,k));var m=p.x-n.x,h=p.y-n.y;p=bx(m,h);k=this.r;n=p?aA(n,bC(new aG(m,h),k/p)):n;return new j(this,n,p-k)};b2.prototype.segmentQuery=function(y,x){var w=this.tn,v=aD(aB(this.ta,y),w),u=this.r,t=0<v?bq(w):w,s=aB(bC(t,u),y),r=aA(this.ta,s),p=aA(this.tb,s),s=aB(x,y);if(0>=bt(s,r)*bt(s,p)){if(u=v+(0<v?-u:u),v=-u,w=aD(s,w)-u,0>v*w){return new bS(this,v/(v-w),t)}}else{if(0!==u){return t=bY(this,this.ta,this.r,y,x),w=bY(this,this.tb,this.r,y,x),t?w&&w.t<t.t?w:t:w}}};b2.prototype.setNeighbors=function(f,e){this.a_tangent=aB(f,this.a);this.b_tangent=aB(e,this.b)};b2.prototype.setEndpoints=function(f,e){this.a=f;this.b=e;this.n=bm(bl(aB(e,f)))};var bJ=function(p){for(var n=p.length,m=0;m<n;m+=2){var k=p[(m+2)%n],h=p[(m+3)%n];if(0<(k-p[m])*(p[(m+5)%n]-h)-(h-p[m+1])*(p[(m+4)%n]-k)){return !1}}return !0},bh=a1.PolyShape=function(h,g,f){this.setVerts(g,f);this.type="poly";bj.call(this,h)};bh.prototype=Object.create(bj.prototype);var bK=function(f,e){this.n=f;this.d=e};bK.prototype.compare=function(d){return aD(this.n,d)-this.d};bh.prototype.setVerts=function(u,t){aZ(4<=u.length,"Polygons require some verts");aZ("number"===typeof u[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])");aZ(bJ(u),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var s=u.length,r=s>>1;this.verts=Array(s);this.tVerts=Array(s);this.planes=Array(r);this.tPlanes=Array(r);for(r=0;r<s;r+=2){var p=u[r]+t.x,n=u[r+1]+t.y,d=bl(bm(new aG(u[(r+2)%s]+t.x-p,u[(r+3)%s]+t.y-n)));this.verts[r]=p;this.verts[r+1]=n;this.planes[r>>1]=new bK(d,d.x*p+d.y*n);this.tPlanes[r>>1]=new bK(new aG(0,0),0)}};a1.BoxShape=function(h,g,f){g/=2;f/=2;return b4(h,new ae(-g,-f,g,f))};var b4=a1.BoxShape2=function(f,e){return new bh(f,[e.l,e.b,e.l,e.t,e.r,e.t,e.r,e.b],bH)};bh.prototype.transformVerts=function(B,A){for(var z=this.verts,y=this.tVerts,x=Infinity,w=-Infinity,v=Infinity,k=-Infinity,h=0;h<z.length;h+=2){var E=z[h],D=z[h+1],C=B.x+E*A.x-D*A.y,E=B.y+E*A.y+D*A.x;y[h]=C;y[h+1]=E;x=aT(x,C);w=aP(w,C);v=aT(v,E);k=aP(k,E)}this.bb_l=x;this.bb_b=v;this.bb_r=w;this.bb_t=k};bh.prototype.transformAxes=function(s,r){for(var p=this.planes,n=this.tPlanes,m=0;m<p.length;m++){var k=bw(p[m].n,r);n[m].n=k;n[m].d=aD(s,k)+p[m].d}};bh.prototype.cacheData=function(f,e){this.transformAxes(f,e);this.transformVerts(f,e)};bh.prototype.nearestPointQuery=function(F){for(var E=this.tPlanes,D=this.tVerts,C=D[D.length-2],B=D[D.length-1],A=Infinity,z=bH,y=!1,x=0;x<E.length;x++){0<E[x].compare(F)&&(y=!0);var w=D[2*x],u=D[2*x+1],I;I=w;var H=u,C=C-I,B=B-H,G=aE((C*(F.x-I)+B*(F.y-H))/bU(C,B));I=new aG(I+C*G,H+B*G);H=be(F,I);H<A&&(A=H,z=I);C=w;B=u}return new j(this,z,y?A:-A)};bh.prototype.segmentQuery=function(C,B){for(var A=this.tPlanes,z=this.tVerts,y=A.length,x=2*y,w=0;w<y;w++){var v=A[w].n,u=aD(C,v);if(!(A[w].d>u)){var t=aD(B,v),u=(A[w].d-u)/(t-u);if(!(0>u||1<u)){var t=bf(C,B,u),t=-bt(v,t),s=-(v.x*z[(2*w+3)%x]-v.y*z[(2*w+2)%x]);if(-(v.x*z[2*w+1]-v.y*z[2*w])<=t&&t<=s){return new bS(this,u,v)}}}}};bh.prototype.valueOnAxis=function(p,n){for(var m=this.tVerts,k=p.x*m[0]+p.y*m[1],h=2;h<m.length;h+=2){k=aT(k,p.x*m[h]+p.y*m[h+1])}return k-n};bh.prototype.containsVert=function(p,n){for(var m=this.tPlanes,k=0;k<m.length;k++){var h=m[k].n;if(0<h.x*p+h.y*n-m[k].d){return !1}}return !0};bh.prototype.containsVertPartial=function(s,r,p){for(var n=this.tPlanes,m=0;m<n.length;m++){var k=n[m].n;if(!(0>aD(k,p))&&0<k.x*s+k.y*r-n[m].d){return !1}}return !0};bh.prototype.getNumVerts=function(){return this.verts.length/2};bh.prototype.getCount=bh.prototype.getNumVerts;bh.prototype.getVert=function(d){return new aG(this.verts[2*d],this.verts[2*d+1])};var bE=a1.Body=function(f,e){this.p=new aG(0,0);this.vx=this.vy=0;this.f=new aG(0,0);this.t=this.w=0;this.w_limit=this.v_limit=Infinity;this.w_bias=this.v_biasx=this.v_biasy=0;this.space=null;this.shapeList=[];this.nodeNext=this.nodeRoot=this.constraintList=this.arbiterList=null;this.nodeIdleTime=0;this.setMass(f);this.setMoment(e);this.rot=new aG(0,0);this.setAngle(0)};a1.StaticBody=function(){var d=new bE(Infinity,Infinity);d.nodeIdleTime=Infinity;return d};if("undefined"!==typeof DEBUG&&DEBUG){var b3=function(f,d){aZ(f.x==f.x&&f.y==f.y,d)},bQ=function(f,d){aZ(Infinity!==Math.abs(f.x)&&Infinity!==Math.abs(f.y),d)};bE.prototype.sanityCheck=function(){aZ(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid.");aZ(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid.");var d=this.p;b3(d,"Body's position is invalid.");bQ(d,"Body's position is invalid.");d=this.f;b3(d,"Body's force is invalid.");bQ(d,"Body's force is invalid.");aZ(this.vx===this.vx&&Infinity!==Math.abs(this.vx),"Body's velocity is invalid.");aZ(this.vy===this.vy&&Infinity!==Math.abs(this.vy),"Body's velocity is invalid.");aZ(this.a===this.a&&Infinity!==Math.abs(this.a),"Body's angle is invalid.");aZ(this.w===this.w&&Infinity!==Math.abs(this.w),"Body's angular velocity is invalid.");aZ(this.t===this.t&&Infinity!==Math.abs(this.t),"Body's torque is invalid.");d=this.rot;b3(d,"Body's rotation vector is invalid.");bQ(d,"Body's rotation vector is invalid.");aZ(this.v_limit===this.v_limit,"Body's velocity limit is invalid.");aZ(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else{bE.prototype.sanityCheck=function(){}}bE.prototype.getPos=function(){return this.p};bE.prototype.getVel=function(){return new aG(this.vx,this.vy)};bE.prototype.getAngVel=function(){return this.w};bE.prototype.getPosition=bE.prototype.getPos;bE.prototype.getVelocity=bE.prototype.getVel;bE.prototype.getAngularVelocity=bE.prototype.getAngVel;bE.prototype.getCenterOfGravity=function(){return this.p};bE.prototype.isSleeping=function(){return null!==this.nodeRoot};bE.prototype.isStatic=function(){return Infinity===this.nodeIdleTime};bE.prototype.isRogue=function(){return null===this.space};bE.prototype.setMass=function(d){aZ(0<d,"Mass must be positive and non-zero.");this.activate();this.m=d;this.m_inv=1/d};bE.prototype.setMoment=function(d){aZ(0<d,"Moment of Inertia must be positive and non-zero.");this.activate();this.i=d;this.i_inv=1/d};bE.prototype.addShape=function(d){this.shapeList.push(d)};bE.prototype.removeShape=function(d){aN(this.shapeList,d)};var bu=function(h,g,f){if(h===f){return h.next(g)}h.a===g?h.next_a=bu(h.next_a,g,f):h.next_b=bu(h.next_b,g,f);return h};bE.prototype.removeConstraint=function(d){this.constraintList=bu(this.constraintList,this,d)};bE.prototype.setPos=function(c){this.activate();this.sanityCheck();c===bH&&(c=a1.v(0,0));this.p=c};bE.prototype.setVel=function(d){this.activate();this.vx=d.x;this.vy=d.y};bE.prototype.setAngVel=function(d){this.activate();this.w=d};bE.prototype.setAngleInternal=function(d){aZ(!isNaN(d),"Internal Error: Attempting to set body's angle to NaN");this.a=d;this.rot.x=Math.cos(d);this.rot.y=Math.sin(d)};bE.prototype.setAngle=function(d){this.activate();this.sanityCheck();this.setAngleInternal(d)};bE.prototype.velocity_func=function(s,r,p){var n=this.vx*r+(s.x+this.f.x*this.m_inv)*p;s=this.vy*r+(s.y+this.f.y*this.m_inv)*p;var m=this.v_limit,k=n*n+s*s,m=k>m*m?m/Math.sqrt(k):1;this.vx=n*m;this.vy=s*m;n=this.w_limit;this.w=aH(this.w*r+this.t*this.i_inv*p,-n,n);this.sanityCheck()};bE.prototype.position_func=function(d){this.p.x+=(this.vx+this.v_biasx)*d;this.p.y+=(this.vy+this.v_biasy)*d;this.setAngleInternal(this.a+(this.w+this.w_bias)*d);this.w_bias=this.v_biasx=this.v_biasy=0;this.sanityCheck()};bE.prototype.resetForces=function(){this.activate();this.f=new aG(0,0);this.t=0};bE.prototype.applyForce=function(f,e){this.activate();this.f=aA(this.f,f);this.t+=bt(e,f)};bE.prototype.applyImpulse=function(f,e){this.activate();aS(this,f.x,f.y,e)};bE.prototype.getVelAtPoint=function(d){return aA(new aG(this.vx,this.vy),bC(bm(d),this.w))};bE.prototype.getVelAtWorldPoint=function(d){return this.getVelAtPoint(aB(d,this.p))};bE.prototype.getVelAtLocalPoint=function(d){return this.getVelAtPoint(bw(d,this.rot))};bE.prototype.eachShape=function(h){for(var g=0,f=this.shapeList.length;g<f;g++){h(this.shapeList[g])}};bE.prototype.eachConstraint=function(h){for(var g=this.constraintList;g;){var f=g.next(this);h(g);g=f}};bE.prototype.eachArbiter=function(h){for(var g=this.arbiterList;g;){var f=g.next(this);g.swappedColl=this===g.body_b;h(g);g=f}};bE.prototype.local2World=function(d){return aA(this.p,bw(d,this.rot))};bE.prototype.world2Local=function(d){return a5(aB(d,this.p),this.rot)};bE.prototype.localToWorld=bE.prototype.local2World;bE.prototype.worldToLocal=bE.prototype.world2Local;bE.prototype.kineticEnergy=function(){var f=this.vx*this.vx+this.vy*this.vy,e=this.w*this.w;return(f?f*this.m:0)+(e?e*this.i:0)};var at=a1.SpatialIndex=function(d){if(this.staticIndex=d){if(d.dynamicIndex){throw Error("This static index is already associated with a dynamic index.")}d.dynamicIndex=this}};at.prototype.collideStatic=function(h,g){if(0<h.count){var f=h.query;this.each(function(d){f(d,new ae(d.bb_l,d.bb_b,d.bb_r,d.bb_t),g)})}};var bs=a1.BBTree=function(d){at.call(this,d);this.velocityFunc=null;this.leaves={};this.count=0;this.pooledPairs=this.pooledNodes=this.root=null;this.stamp=0};bs.prototype=Object.create(at.prototype);var bR=0,bN=function(h,g,f){this.obj=null;this.bb_l=aT(g.bb_l,f.bb_l);this.bb_b=aT(g.bb_b,f.bb_b);this.bb_r=aP(g.bb_r,f.bb_r);this.bb_t=aP(g.bb_t,f.bb_t);this.parent=null;this.setA(g);this.setB(f)};bs.prototype.makeNode=function(h,g){var f=this.pooledNodes;if(f){return this.pooledNodes=f.parent,f.constructor(this,h,g),f}bR++;return new bN(this,h,g)};var by=0,bk=function(f,e){this.obj=e;f.getBB(e,this);this.parent=null;this.stamp=1;this.pairs=null;by++};bs.prototype.getBB=function(p,n){var m=this.velocityFunc;if(m){var k=0.1*(p.bb_r-p.bb_l),h=0.1*(p.bb_t-p.bb_b),m=bC(m(p),0.1);n.bb_l=p.bb_l+aT(-k,m.x);n.bb_b=p.bb_b+aT(-h,m.y);n.bb_r=p.bb_r+aP(k,m.x);n.bb_t=p.bb_t+aP(h,m.y)}else{n.bb_l=p.bb_l,n.bb_b=p.bb_b,n.bb_r=p.bb_r,n.bb_t=p.bb_t}};bs.prototype.getStamp=function(){var d=this.dynamicIndex;return d&&d.stamp?d.stamp:this.stamp};bs.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var aX=0,am=function(m,k,h,g){this.prevA=null;this.leafA=m;this.nextA=k;this.prevB=null;this.leafB=h;this.nextB=g};bs.prototype.makePair=function(p,n,m,k){var h=this.pooledPairs;if(h){return this.pooledPairs=h.prevA,h.prevA=null,h.leafA=p,h.nextA=n,h.prevB=null,h.leafB=m,h.nextB=k,h}aX++;return new am(p,n,m,k)};am.prototype.recycle=function(d){this.prevA=d.pooledPairs;d.pooledPairs=this};var o=function(h,g,f){f&&(f.leafA===g?f.prevA=h:f.prevB=h);h?h.leafA===g?h.nextA=f:h.nextB=f:g.pairs=f};bk.prototype.clearPairs=function(h){var g=this.pairs,f;for(this.pairs=null;g;){g.leafA===this?(f=g.nextA,o(g.prevB,g.leafB,g.nextB)):(f=g.nextB,o(g.prevA,g.leafA,g.nextA)),g.recycle(h),g=f}};var bZ=function(p,n,m){var k=p.pairs,h=n.pairs;m=m.makePair(p,k,n,h);p.pairs=n.pairs=m;k&&(k.leafA===p?k.prevA=m:k.prevB=m);h&&(h.leafA===n?h.prevA=m:h.prevB=m)};bN.prototype.recycle=function(d){this.parent=d.pooledNodes;d.pooledNodes=this};bk.prototype.recycle=function(d){};bN.prototype.setA=function(d){this.A=d;d.parent=this};bN.prototype.setB=function(d){this.B=d;d.parent=this};bk.prototype.isLeaf=!0;bN.prototype.isLeaf=!1;bN.prototype.otherChild=function(d){return this.A==d?this.B:this.A};bN.prototype.replaceChild=function(h,g,e){aW(h==this.A||h==this.B,"Node is not a child of parent.");this.A==h?(this.A.recycle(e),this.setA(g)):(this.B.recycle(e),this.setB(g));for(h=this;h;h=h.parent){g=h.A,e=h.B,h.bb_l=aT(g.bb_l,e.bb_l),h.bb_b=aT(g.bb_b,e.bb_b),h.bb_r=aP(g.bb_r,e.bb_r),h.bb_t=aP(g.bb_t,e.bb_t)}};bN.prototype.bbArea=bk.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var bL=function(f,e){return(aP(f.bb_r,e.bb_r)-aT(f.bb_l,e.bb_l))*(aP(f.bb_t,e.bb_t)-aT(f.bb_b,e.bb_b))},a6=function(f,e){return Math.abs(f.bb_l+f.bb_r-e.bb_l-e.bb_r)+Math.abs(f.bb_b+f.bb_t-e.bb_b-e.bb_t)},bA=function(p,n,m){if(null==p){return n}if(p.isLeaf){return m.makeNode(n,p)}var k=p.B.bbArea()+bL(p.A,n),h=p.A.bbArea()+bL(p.B,n);k===h&&(k=a6(p.A,n),h=a6(p.B,n));h<k?p.setB(bA(p.B,n,m)):p.setA(bA(p.A,n,m));p.bb_l=aT(p.bb_l,n.bb_l);p.bb_b=aT(p.bb_b,n.bb_b);p.bb_r=aP(p.bb_r,n.bb_r);p.bb_t=aP(p.bb_t,n.bb_t);return p};bN.prototype.intersectsBB=bk.prototype.intersectsBB=function(d){return this.bb_l<=d.r&&d.l<=this.bb_r&&this.bb_b<=d.t&&d.b<=this.bb_t};var ah=function(h,g,f){h.intersectsBB(g)&&(h.isLeaf?f(h.obj):(ah(h.A,g,f),ah(h.B,g,f)))},aC=function(s,r,p){var n=1/(p.x-r.x),k=s.bb_l==r.x?-Infinity:(s.bb_l-r.x)*n,h=s.bb_r==r.x?Infinity:(s.bb_r-r.x)*n,n=aT(k,h),k=aP(k,h),h=1/(p.y-r.y);p=s.bb_b==r.y?-Infinity:(s.bb_b-r.y)*h;r=s.bb_t==r.y?Infinity:(s.bb_t-r.y)*h;s=aT(p,r);r=aP(p,r);return s<=k&&n<=r&&(n=aP(n,s),0<=aT(k,r)&&1>=n)?aP(n,0):Infinity},aY=function(u,t,s,r,p){if(u.isLeaf){return p(u.obj)}var n=aC(u.A,t,s),h=aC(u.B,t,s);n<h?(n<r&&(r=aT(r,aY(u.A,t,s,r,p))),h<r&&(r=aT(r,aY(u.B,t,s,r,p)))):(h<r&&(r=aT(r,aY(u.B,t,s,r,p))),n<r&&(r=aT(r,aY(u.A,t,s,r,p))));return r};bs.prototype.subtreeRecycle=function(d){d.isLeaf&&(this.subtreeRecycle(d.A),this.subtreeRecycle(d.B),d.recycle(this))};var an=function(m,k,h){if(k==m){return null}var g=k.parent;if(g==m){return k=m.otherChild(k),k.parent=m.parent,m.recycle(h),k}g.parent.replaceChild(g,g.otherChild(k),h);return m},ac=function(f,e){return f.bb_l<=e.bb_r&&e.bb_l<=f.bb_r&&f.bb_b<=e.bb_t&&e.bb_b<=f.bb_t};bk.prototype.markLeafQuery=function(m,k,h,g){ac(m,this)&&(k?bZ(m,this,h):(this.stamp<m.stamp&&bZ(this,m,h),g&&g(m.obj,this.obj)))};bN.prototype.markLeafQuery=function(m,k,h,g){ac(m,this)&&(this.A.markLeafQuery(m,k,h,g),this.B.markLeafQuery(m,k,h,g))};bk.prototype.markSubtree=function(h,g,f){if(this.stamp==h.getStamp()){for(g&&g.markLeafQuery(this,!1,h,f),g=this;g.parent;g=g.parent){g==g.parent.A?g.parent.B.markLeafQuery(this,!0,h,f):g.parent.A.markLeafQuery(this,!1,h,f)}}else{for(h=this.pairs;h;){this===h.leafB?(f&&f(h.leafA.obj,this.obj),h=h.nextB):h=h.nextA}}};bN.prototype.markSubtree=function(h,g,f){this.A.markSubtree(h,g,f);this.B.markSubtree(h,g,f)};bk.prototype.containsObj=function(d){return this.bb_l<=d.bb_l&&this.bb_r>=d.bb_r&&this.bb_b<=d.bb_b&&this.bb_t>=d.bb_t};bk.prototype.update=function(f){var e=f.root;return this.containsObj(this.obj)?!1:(f.getBB(this.obj,this),e=an(e,this,f),f.root=bA(e,this,f),this.clearPairs(f),this.stamp=f.getStamp(),!0)};bk.prototype.addPairs=function(f){var e=f.dynamicIndex;e?(f=e.root)&&f.markLeafQuery(this,!0,e,null):this.markSubtree(f,f.staticIndex.root,null)};bs.prototype.insert=function(h,g){var f=new bk(this,h);this.leaves[g]=f;this.root=bA(this.root,f,this);this.count++;f.stamp=this.getStamp();f.addPairs(this);this.incrementStamp()};bs.prototype.remove=function(h,g){var f=this.leaves[g];delete this.leaves[g];this.root=an(this.root,f,this);this.count--;f.clearPairs(this);f.recycle(this)};bs.prototype.contains=function(f,e){return null!=this.leaves[e]};var au=function(f,e){};bs.prototype.reindexQuery=function(h){if(this.root){var g,f=this.leaves;for(g in f){f[g].update(this)}f=(g=this.staticIndex)&&g.root;this.root.markSubtree(this,f,h);g&&!f&&this.collideStatic(this,g,h);this.incrementStamp()}};bs.prototype.reindex=function(){this.reindexQuery(au)};bs.prototype.reindexObject=function(h,g){var f=this.leaves[g];f&&(f.update(this)&&f.addPairs(this),this.incrementStamp())};bs.prototype.pointQuery=function(f,e){this.query(new ae(f.x,f.y,f.x,f.y),e)};bs.prototype.segmentQuery=function(m,k,h,g){this.root&&aY(this.root,m,k,h,g)};bs.prototype.query=function(f,e){this.root&&ah(this.root,f,e)};bs.prototype.count=function(){return this.count};bs.prototype.each=function(f){for(var e in this.leaves){f(this.leaves[e].obj)}};var b0=function(p,n,m,k,h){return(aP(p.bb_r,k)-aT(p.bb_l,n))*(aP(p.bb_t,h)-aT(p.bb_b,m))},b6=function(F,E,D,C){if(1==C){return E[D]}if(2==C){return F.makeNode(E[D],E[D+1])}for(var B=E[D],A=B.bb_l,z=B.bb_b,k=B.bb_r,h=B.bb_t,M=D+C,L=D+1;L<M;L++){B=E[L],A=aT(A,B.bb_l),z=aT(z,B.bb_b),k=aP(k,B.bb_r),h=aP(h,B.bb_t)}var B=k-A>h-z,K=Array(2*C);if(B){for(L=D;L<M;L++){K[2*L+0]=E[L].bb_l,K[2*L+1]=E[L].bb_r}}else{for(L=D;L<M;L++){K[2*L+0]=E[L].bb_b,K[2*L+1]=E[L].bb_t}}K.sort(function(f,e){return f-e});var J=0.5*(K[C-1]+K[C]),L=A,K=z,I=k,H=h;B?I=A=J:H=z=J;for(var J=M,G=D;G<J;){B=E[G],b0(B,A,z,k,h)<b0(B,L,K,I,H)?(J--,E[G]=E[J],E[J]=B):G++}if(J==C){B=null;for(L=D;L<M;L++){B=bA(B,E[L],F)}return B}return NodeNew(F,b6(F,E,D,J-D),b6(F,E,J,M-J))};bs.prototype.optimize=function(){var h=Array(this.count),g=0,f;for(f in this.leaves){h[g++]=this.nodes[f]}tree.subtreeRecycle(root);this.root=b6(tree,h,h.length)};var bT=function(m,k){!m.isLeaf&&10>=k&&(bT(m.A,k+1),bT(m.B,k+1));for(var h="",g=0;g<k;g++){h+=" "}console.log(h+m.bb_b+" "+m.bb_t)};bs.prototype.log=function(){this.root&&bT(this.root,0)};var aR=a1.CollisionHandler=function(){this.a=this.b=0};aR.prototype.begin=function(f,e){return !0};aR.prototype.preSolve=function(f,e){return !0};aR.prototype.postSolve=function(f,e){};aR.prototype.separate=function(f,e){};var bn=function(f,e){this.u=this.e=0;this.surface_vr=bH;this.a=f;this.body_a=f.body;this.b=e;this.body_b=e.body;this.contacts=this.thread_b_next=this.thread_b_prev=this.thread_a_next=this.thread_a_prev=null;this.stamp=0;this.handler=null;this.swappedColl=!1;this.state="first coll"};bn.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]};bn.prototype.totalImpulse=function(){for(var p=this.contacts,n=new aG(0,0),m=0,k=p.length;m<k;m++){var h=p[m];n.add(bC(h.n,h.jnAcc))}return this.swappedColl?n:n.neg()};bn.prototype.totalImpulseWithFriction=function(){for(var p=this.contacts,n=new aG(0,0),m=0,k=p.length;m<k;m++){var h=p[m];n.add((new aG(h.jnAcc,h.jtAcc)).rotate(h.n))}return this.swappedColl?n:n.neg()};bn.prototype.totalKE=function(){for(var w=(1-this.e)/(1+this.e),v=0,u=this.contacts,t=0,s=u.length;t<s;t++){var r=u[t],p=r.jnAcc,n=r.jtAcc,v=v+(w*p*p/r.nMass+n*n/r.tMass)}return v};bn.prototype.ignore=function(){this.state="ignore"};bn.prototype.getA=function(){return this.swappedColl?this.b:this.a};bn.prototype.getB=function(){return this.swappedColl?this.a:this.b};bn.prototype.isFirstContact=function(){return"first coll"===this.state};var bD=function(h,g,f){this.point=h;this.normal=g;this.dist=f};bn.prototype.getContactPointSet=function(){var f=Array(this.contacts.length),e;for(e=0;e<f.length;e++){f[e]=new bD(this.contacts[e].p,this.contacts[e].n,this.contacts[e].dist)}return f};bn.prototype.getNormal=function(d){d=this.contacts[d].n;return this.swappedColl?bq(d):d};bn.prototype.getPoint=function(d){return this.contacts[d].p};bn.prototype.getDepth=function(d){return this.contacts[d].dist};var bM=function(m,k,h,g){h?h.body_a===k?h.thread_a_next=g:h.thread_b_next=g:k.arbiterList=g;g&&(g.body_a===k?g.thread_a_prev=h:g.thread_b_prev=h)};bn.prototype.unthread=function(){bM(this,this.body_a,this.thread_a_prev,this.thread_a_next);bM(this,this.body_b,this.thread_b_prev,this.thread_b_next);this.thread_b_prev=this.thread_b_next=this.thread_a_prev=this.thread_a_next=null};bn.prototype.update=function(w,v,u,t){if(this.contacts){for(var s=0;s<this.contacts.length;s++){for(var r=this.contacts[s],p=0;p<w.length;p++){var n=w[p];n.hash===r.hash&&(n.jnAcc=r.jnAcc,n.jtAcc=r.jtAcc)}}}this.contacts=w;this.handler=v;this.swappedColl=u.collision_type!==v.a;this.e=u.e*t.e;this.u=u.u*t.u;this.surface_vr=aB(u.surface_v,t.surface_v);this.a=u;this.body_a=u.body;this.b=t;this.body_b=t.body;"cached"==this.state&&(this.state="first coll")};bn.prototype.preStep=function(u,t,s){for(var r=this.body_a,p=this.body_b,n=0;n<this.contacts.length;n++){var h=this.contacts[n];h.r1=aB(h.p,r.p);h.r2=aB(h.p,p.p);h.nMass=1/av(r,p,h.r1,h.r2,h.n);h.tMass=1/av(r,p,h.r1,h.r2,bm(h.n));h.bias=-s*aT(0,h.dist+t)/u;h.jBias=0;h.bounce=bB(r,p,h.r1,h.r2,h.n)*this.e}};bn.prototype.applyCachedImpulse=function(u){if(!this.isFirstContact()){for(var t=this.body_a,s=this.body_b,r=0;r<this.contacts.length;r++){var p=this.contacts[r],n=p.n.x,m=p.n.y;a9(t,s,p.r1,p.r2,(n*p.jnAcc-m*p.jtAcc)*u,(n*p.jtAcc+m*p.jnAcc)*u)}}};var ai=0,b7=0;bn.prototype.applyImpulse=function(){ai++;for(var E=this.body_a,D=this.body_b,C=this.surface_vr,B=this.u,A=0;A<this.contacts.length;A++){b7++;var z=this.contacts[A],y=z.nMass,x=z.n,t=z.r1,k=z.r2,I=D.vx-k.y*D.w-(E.vx-t.y*E.w),H=D.vy+k.x*D.w-(E.vy+t.x*E.w),G=I*x.x+H*x.y,F=(I+C.x)*-x.y+(H+C.y)*x.x,H=z.jBias;z.jBias=aP(H+(z.bias-(x.x*(D.v_biasx-k.y*D.w_bias-E.v_biasx+t.y*E.w_bias)+x.y*(k.x*D.w_bias+D.v_biasy-t.x*E.w_bias-E.v_biasy)))*y,0);I=z.jnAcc;z.jnAcc=aP(I+-(z.bounce+G)*y,0);G=B*z.jnAcc;y=z.jtAcc;z.jtAcc=aH(y+-F*z.tMass,-G,G);G=x.x*(z.jBias-H);H=x.y*(z.jBias-H);bi(E,-G,-H,t);bi(D,G,H,k);I=z.jnAcc-I;z=z.jtAcc-y;a9(E,D,t,k,x.x*I-x.y*z,x.x*z+x.y*I)}};bn.prototype.callSeparate=function(d){d.lookupHandler(this.a.collision_type,this.b.collision_type).separate(this,d)};bn.prototype.next=function(d){return this.body_a==d?this.thread_a_next:this.thread_b_next};var bV=0,ap=function(m,k,h,g){this.p=m;this.n=k;this.dist=h;this.r1=this.r2=bH;this.jnAcc=this.jtAcc=this.jBias=this.nMass=this.tMass=this.bounce=this.bias=0;this.hash=g;bV++},a8=[],bP=function(p,n,m,k){k=m+k;n=aB(n,p);var h=bo(n);if(!(h>=k*k)){return h=Math.sqrt(h),new ap(aA(p,bC(n,0.5+(m-0.5*k)/(h?h:Infinity))),h?bC(n,1/h):new aG(1,0),h-k,0)}},a0=0,aL=function(s,r){var p=0,n=s.valueOnAxis(r[0].n,r[0].d);if(0<n){return -1}for(var m=1;m<r.length;m++){var k=s.valueOnAxis(r[m].n,r[m].d);if(0<k){return -1}k>n&&(n=k,p=m)}a0=n;return p},ao=function(y,x,w,v){for(var u=[],t=y.tVerts,s=0;s<t.length;s+=2){var r=t[s],m=t[s+1];x.containsVert(r,m)&&u.push(new ap(new aG(r,m),w,v,aO(y.hashid,s>>1)))}t=x.tVerts;for(s=0;s<t.length;s+=2){r=t[s],m=t[s+1],y.containsVert(r,m)&&u.push(new ap(new aG(r,m),w,v,aO(x.hashid,s>>1)))}if(!u.length){u=[];t=y.tVerts;for(s=0;s<t.length;s+=2){r=t[s],m=t[s+1],x.containsVertPartial(r,m,bq(w))&&u.push(new ap(new aG(r,m),w,v,aO(y.hashid,s)))}t=x.tVerts;for(s=0;s<t.length;s+=2){r=t[s],m=t[s+1],y.containsVertPartial(r,m,w)&&u.push(new ap(new aG(r,m),w,v,aO(x.hashid,s)))}}return y=u},ad=function(m,k,h){var g=aD(k,m.ta)-m.r;m=aD(k,m.tb)-m.r;return aT(g,m)-h},b1=function(D,C,B,A,z){for(var y=bt(C.tn,C.ta),x=bt(C.tn,C.tb),w=bC(C.tn,z),u=B.tVerts,m=0;m<u.length;m+=2){var G=u[m],F=u[m+1];if(G*w.x+F*w.y<aD(C.tn,C.ta)*z+C.r){var E=C.tn.x*F-C.tn.y*G;y>=E&&E>=x&&D.push(new ap(new aG(G,F),w,A,aO(B.hashid,m)))}}};ag.prototype.collisionCode=0;b2.prototype.collisionCode=1;bh.prototype.collisionCode=2;ag.prototype.collisionTable=[function(h,g){var f=bP(h.tc,g.tc,h.r,g.r);return f?[f]:a8},function(s,r){var p=r.ta,n=s.tc,m=aB(r.tb,p),k=aE(aD(m,aB(n,p))/bo(m)),p=aA(p,bC(m,k));return(n=bP(n,p,s.r,r.r))?(p=n.n,0===k&&0>aD(p,r.a_tangent)||1===k&&0>aD(p,r.b_tangent)?a8:[n]):a8},function(D,C){for(var B=C.tPlanes,A=0,z=aD(B[0].n,D.tc)-B[0].d-D.r,y=0;y<B.length;y++){var x=aD(B[y].n,D.tc)-B[y].d-D.r;if(0<x){return a8}x>z&&(z=x,A=y)}var B=B[A].n,w=C.tVerts,v=w.length,u=A<<1,A=w[u],y=w[u+1],x=w[(u+2)%v],w=w[(u+3)%v],v=B.x*y-B.y*A,u=B.x*w-B.y*x,t=bt(B,D.tc);if(t<u){var E=bP(D.tc,new aG(x,w),D.r,0,E);return E?[E]:a8}return t<v?[new ap(aB(D.tc,bC(B,D.r+z/2)),bq(B),z,0)]:(E=bP(D.tc,new aG(A,y),D.r,0,E))?[E]:a8}];b2.prototype.collisionTable=[null,function(f,e){return a8},function(B,A){var z=[],y=A.tPlanes,x=y.length,w=aD(B.tn,B.ta),v=A.valueOnAxis(B.tn,w)-B.r,w=A.valueOnAxis(bq(B.tn),-w)-B.r;if(0<w||0<v){return a8}var u=0,t=ad(B,y[0].n,y[0].d);if(0<t){return a8}for(var m=0;m<x;m++){var C=ad(B,y[m].n,y[m].d);if(0<C){return a8}C>t&&(t=C,u=m)}y=bq(y[u].n);m=aA(B.ta,bC(y,B.r));C=aA(B.tb,bC(y,B.r));A.containsVert(m.x,m.y)&&z.push(new ap(m,y,t,aO(B.hashid,0)));A.containsVert(C.x,C.y)&&z.push(new ap(C,y,t,aO(B.hashid,1)));if(v>=t||w>=t){v>w?b1(z,B,A,v,1):b1(z,B,A,w,-1)}if(0===z.length){v=2*u;w=A.tVerts;t=new aG(w[v],w[v+1]);if((u=bP(B.ta,t,B.r,0,z))||(u=bP(B.tb,t,B.r,0,z))){return[u]}x*=2;x=new aG(w[(v+2)%x],w[(v+3)%x]);if((u=bP(B.ta,x,B.r,0,z))||(u=bP(B.tb,x,B.r,0,z))){return[u]}}return z}];bh.prototype.collisionTable=[null,null,function(s,r){var p=aL(r,s.tPlanes);if(-1==p){return a8}var n=a0,m=aL(s,r.tPlanes);if(-1==m){return a8}var k=a0;return n>k?ao(s,r,s.tPlanes[p].n,n):ao(s,r,bq(r.tPlanes[m].n),k)}];var aw=a1.collideShapes=function(f,d){aZ(f.collisionCode<=d.collisionCode,"Collided shapes must be sorted by type");return f.collisionTable[d.collisionCode](f,d)},bO=new aR,bz=a1.Space=function(){this.curr_dt=this.stamp=0;this.bodies=[];this.rousedBodies=[];this.sleepingComponents=[];this.staticShapes=new bs(null);this.activeShapes=new bs(this.staticShapes);this.arbiters=[];this.contactBuffersHead=null;this.cachedArbiters={};this.constraints=[];this.locked=0;this.collisionHandlers={};this.defaultHandler=bO;this.postStepCallbacks=[];this.iterations=10;this.gravity=bH;this.damping=1;this.idleSpeedThreshold=0;this.sleepTimeThreshold=Infinity;this.collisionSlop=0.1;this.collisionBias=Math.pow(0.9,60);this.collisionPersistence=3;this.enableContactGraph=!1;this.staticBody=new bE(Infinity,Infinity);this.staticBody.nodeIdleTime=Infinity;this.collideShapes=this.makeCollideShapes()};bz.prototype.getCurrentTimeStep=function(){return this.curr_dt};bz.prototype.setIterations=function(d){this.iterations=d};bz.prototype.isLocked=function(){return this.locked};var aM=function(d){aZ(!d.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};bz.prototype.addCollisionHandler=function(u,t,s,r,p,n){aM(this);this.removeCollisionHandler(u,t);var m=new aR;m.a=u;m.b=t;s&&(m.begin=s);r&&(m.preSolve=r);p&&(m.postSolve=p);n&&(m.separate=n);this.collisionHandlers[aO(u,t)]=m};bz.prototype.removeCollisionHandler=function(f,e){aM(this);delete this.collisionHandlers[aO(f,e)]};bz.prototype.setDefaultCollisionHandler=function(p,n,m,k){aM(this);var h=new aR;p&&(h.begin=p);n&&(h.preSolve=n);m&&(h.postSolve=m);k&&(h.separate=k);this.defaultHandler=h};bz.prototype.lookupHandler=function(f,e){return this.collisionHandlers[aO(f,e)]||this.defaultHandler};bz.prototype.addShape=function(f){var d=f.body;if(d.isStatic()){return this.addStaticShape(f)}aZ(!f.space,"This shape is already added to a space and cannot be added to another.");aM(this);d.activate();d.addShape(f);f.update(d.p,d.rot);this.activeShapes.insert(f,f.hashid);f.space=this;return f};bz.prototype.addStaticShape=function(f){aZ(!f.space,"This shape is already added to a space and cannot be added to another.");aM(this);var d=f.body;d.addShape(f);f.update(d.p,d.rot);this.staticShapes.insert(f,f.hashid);f.space=this;return f};bz.prototype.addBody=function(d){aZ(!d.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated.");aZ(!d.space,"This body is already added to a space and cannot be added to another.");aM(this);this.bodies.push(d);d.space=this;return d};bz.prototype.addConstraint=function(h){aZ(!h.space,"This shape is already added to a space and cannot be added to another.");aM(this);var g=h.a,d=h.b;g.activate();d.activate();this.constraints.push(h);h.next_a=g.constraintList;g.constraintList=h;h.next_b=d.constraintList;d.constraintList=h;h.space=this;return h};bz.prototype.filterArbiters=function(m,k){for(var h in this.cachedArbiters){var g=this.cachedArbiters[h];if(m===g.body_a&&(k===g.a||null===k)||m===g.body_b&&(k===g.b||null===k)){k&&"cached"!==g.state&&g.callSeparate(this),g.unthread(),aN(this.arbiters,g),delete this.cachedArbiters[h]}}};bz.prototype.removeShape=function(f){var d=f.body;d.isStatic()?this.removeStaticShape(f):(aZ(this.containsShape(f),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),aM(this),d.activate(),d.removeShape(f),this.filterArbiters(d,f),this.activeShapes.remove(f,f.hashid),f.space=null)};bz.prototype.removeStaticShape=function(f){aZ(this.containsShape(f),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)");aM(this);var d=f.body;d.isStatic()&&d.activateStatic(f);d.removeShape(f);this.filterArbiters(d,f);this.staticShapes.remove(f,f.hashid);f.space=null};bz.prototype.removeBody=function(d){aZ(this.containsBody(d),"Cannot remove a body that was not added to the space. (Removed twice maybe?)");aM(this);d.activate();aN(this.bodies,d);d.space=null};bz.prototype.removeConstraint=function(d){aZ(this.containsConstraint(d),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)");aM(this);d.a.activate();d.b.activate();aN(this.constraints,d);d.a.removeConstraint(d);d.b.removeConstraint(d);d.space=null};bz.prototype.containsShape=function(d){return d.space===this};bz.prototype.containsBody=function(d){return d.space==this};bz.prototype.containsConstraint=function(d){return d.space==this};bz.prototype.uncacheArbiter=function(d){delete this.cachedArbiters[aO(d.a.hashid,d.b.hashid)];aN(this.arbiters,d)};bz.prototype.eachBody=function(p){this.lock();for(var n=this.bodies,m=0;m<n.length;m++){p(n[m])}n=this.sleepingComponents;for(m=0;m<n.length;m++){for(var k=n[m];k;){var h=k.nodeNext;p(k);k=h}}this.unlock(!0)};bz.prototype.eachShape=function(d){this.lock();this.activeShapes.each(d);this.staticShapes.each(d);this.unlock(!0)};bz.prototype.eachConstraint=function(h){this.lock();for(var g=this.constraints,f=0;f<g.length;f++){h(g[f])}this.unlock(!0)};bz.prototype.reindexStatic=function(){aZ(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");this.staticShapes.each(function(f){var e=f.body;f.update(e.p,e.rot)});this.staticShapes.reindex()};bz.prototype.reindexShape=function(f){aZ(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var d=f.body;f.update(d.p,d.rot);this.activeShapes.reindexObject(f,f.hashid);this.staticShapes.reindexObject(f,f.hashid)};bz.prototype.reindexShapesForBody=function(d){for(d=d.shapeList;d;d=d.next){this.reindexShape(d)}};bz.prototype.useSpatialHash=function(f,e){throw Error("Spatial Hash not implemented.")};bz.prototype.activateBody=function(m){aZ(!m.isRogue(),"Internal error: Attempting to activate a rogue body.");if(this.locked){-1===this.rousedBodies.indexOf(m)&&this.rousedBodies.push(m)}else{this.bodies.push(m);for(var k=0;k<m.shapeList.length;k++){var h=m.shapeList[k];this.staticShapes.remove(h,h.hashid);this.activeShapes.insert(h,h.hashid)}for(k=m.arbiterList;k;k=k.next(m)){if(h=k.body_a,m===h||h.isStatic()){var h=k.a,d=k.b;this.cachedArbiters[aO(h.hashid,d.hashid)]=k;k.stamp=this.stamp;k.handler=this.lookupHandler(h.collision_type,d.collision_type);this.arbiters.push(k)}}for(k=m.constraintList;k;k=k.nodeNext){h=k.a,(m===h||h.isStatic())&&this.constraints.push(k)}}};bz.prototype.deactivateBody=function(h){aZ(!h.isRogue(),"Internal error: Attempting to deactivate a rogue body.");aN(this.bodies,h);for(var g=0;g<h.shapeList.length;g++){var d=h.shapeList[g];this.activeShapes.remove(d,d.hashid);this.staticShapes.insert(d,d.hashid)}for(d=h.arbiterList;d;d=d.next(h)){g=d.body_a,(h===g||g.isStatic())&&this.uncacheArbiter(d)}for(d=h.constraintList;d;d=d.nodeNext){g=d.a,(h===g||g.isStatic())&&aN(this.constraints,d)}};bE.prototype.activate=function(){if(!this.isRogue()){this.nodeIdleTime=0;var m=this?this.nodeRoot:null;if(m&&m.isSleeping(m)){aZ(!m.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var k=m.space,h=m;h;){var d=h.nodeNext;h.nodeIdleTime=0;h.nodeRoot=null;h.nodeNext=null;k.activateBody(h);h=d}aN(k.sleepingComponents,m)}}};bE.prototype.activateStatic=function(f){aZ(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var d=this.arbiterList;d;d=d.next(this)){f&&f!=d.a&&f!=d.b||(d.body_a==this?d.body_b:d.body_a).activate()}};bE.prototype.pushArbiter=function(f){aW(null===(f.body_a===this?f.thread_a_next:f.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)");aW(null===(f.body_a===this?f.thread_a_prev:f.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var e=this.arbiterList;aW(null===e||null===(e.body_a===this?e.thread_a_prev:e.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)");f.body_a===this?f.thread_a_next=e:f.thread_b_next=e;e&&(e.body_a===this?e.thread_a_prev=f:e.thread_b_prev=f);this.arbiterList=f};var ak=function(h,g){if(!g.isRogue()){var e=g?g.nodeRoot:null;if(null==e){g.nodeRoot=h;g!==h&&(g.nodeNext=h.nodeNext,h.nodeNext=g);for(e=g.arbiterList;e;e=e.next(g)){ak(h,g==e.body_a?e.body_b:e.body_a)}for(e=g.constraintList;e;e=e.next(g)){ak(h,g==e.a?e.b:e.a)}}else{aW(e===h,"Internal Error: Inconsistency detected in the contact graph.")}}};bz.prototype.processComponents=function(w){for(var u=Infinity!==this.sleepTimeThreshold,t=this.bodies,s=0;s<t.length;s++){var r=t[s];aW(null===r.nodeNext,"Internal Error: Dangling next pointer detected in contact graph.");aW(null===r.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(u){for(var p=(s=this.idleSpeedThreshold)?s*s:bo(this.gravity)*w*w,s=0;s<t.length;s++){var r=t[s],e=p?r.m*p:0;r.nodeIdleTime=r.kineticEnergy()>e?0:r.nodeIdleTime+w}}p=this.arbiters;s=0;for(e=p.length;s<e;s++){var v=p[s],r=v.body_a;w=v.body_b;u&&((w.isRogue()&&!w.isStatic()||r.isSleeping())&&r.activate(),(r.isRogue()&&!r.isStatic()||w.isSleeping())&&w.activate());r.pushArbiter(v);w.pushArbiter(v)}if(u){u=this.constraints;for(s=0;s<u.length;s++){w=u[s],r=w.a,w=w.b,w.isRogue()&&!w.isStatic()&&r.activate(),r.isRogue()&&!r.isStatic()&&w.activate()}for(s=0;s<t.length;){r=t[s];if(null===(r?r.nodeRoot:null)){ak(r,r);a:{for(u=r;u;u=u.nodeNext){if(u.nodeIdleTime<this.sleepTimeThreshold){u=!0;break a}}u=!1}if(!u){this.sleepingComponents.push(r);for(u=r;u;u=u.nodeNext){this.deactivateBody(u)}continue}}s++;r.nodeRoot=null;r.nodeNext=null}}};bE.prototype.sleep=function(){this.sleepWithGroup(null)};bE.prototype.sleepWithGroup=function(h){aZ(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var g=this.space;aZ(g,"Cannot put a rogue body to sleep.");aZ(!g.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback.");aZ(null===h||h.isSleeping(),"Cannot use a non-sleeping body as a group identifier.");if(this.isSleeping()){aZ((this?this.nodeRoot:null)===(h?h.nodeRoot:null),"The body is already sleeping and it's group cannot be reassigned.")}else{for(var d=0;d<this.shapeList.length;d++){this.shapeList[d].update(this.p,this.rot)}g.deactivateBody(this);h?(this.nodeRoot=h=h?h.nodeRoot:null,this.nodeNext=h.nodeNext,this.nodeIdleTime=0,h.nodeNext=this):(this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,g.sleepingComponents.push(this));aN(g.bodies,this)}};bz.prototype.activateShapesTouchingShape=function(d){Infinity!==this.sleepTimeThreshold&&this.shapeQuery(d,function(f,e){f.body.activate()})};bz.prototype.pointQuery=function(s,r,p,n){var m=function(c){(!c.group||p!==c.group)&&r&c.layers&&c.pointQuery(s)&&n(c)},k=new ae(s.x,s.y,s.x,s.y);this.lock();this.activeShapes.query(k,m);this.staticShapes.query(k,m);this.unlock(!0)};bz.prototype.pointQueryFirst=function(m,k,h){var g=null;this.pointQuery(m,k,h,function(d){d.sensor||(g=d)});return g};bz.prototype.nearestPointQuery=function(u,t,s,r,p){var n=function(d){if((!d.group||r!==d.group)&&s&d.layers){var c=d.nearestPointQuery(u);c.d<t&&p(d,c.d,c.p)}},m=a4(u,t);this.lock();this.activeShapes.query(m,n);this.staticShapes.query(m,n);this.unlock(!0)};bz.prototype.nearestPointQueryNearest=function(u,t,s,r){var p,n=function(c){c.group&&r===c.group||!(s&c.layers)||c.sensor||(c=c.nearestPointQuery(u),c.d<t&&(!p||c.d<p.d)&&(p=c))},m=a4(u,t);this.activeShapes.query(m,n);this.staticShapes.query(m,n);return p};a1.SHAPE_FILTER_ALL={group:a1.NO_GROUP,categories:a1.ALL_CATEGORIES,mask:a1.ALL_CATEGORIES};bz.prototype.pointQueryNearest=function(h,g,f){h=this.nearestPointQueryNearest(h,g,f.mask,f.group);"undefined"!=typeof h&&(h.distance=h.d,h.point=h.p);return h};bz.prototype.segmentQuery=function(s,r,p,n,m){var k=function(d){var c;(!d.group||n!==d.group)&&p&d.layers&&(c=d.segmentQuery(s,r))&&m(d,c.t,c.n);return 1};this.lock();this.staticShapes.segmentQuery(s,r,1,k);this.activeShapes.segmentQuery(s,r,1,k);this.unlock(!0)};bz.prototype.segmentQueryFirst=function(s,r,p,n){var m=null,c=function(e){var d;(!e.group||n!==e.group)&&p&e.layers&&!e.sensor&&(d=e.segmentQuery(s,r))&&(null===m||d.t<m.t)&&(m=d);return m?m.t:1};this.staticShapes.segmentQuery(s,r,1,c);this.activeShapes.segmentQuery(s,r,m?m.t:1,c);m&&"null"!==m&&"undefined"!==m&&(m.normal=m.n,m.alpha=m.t,m.p=m.point=a1.v.lerp(s,r,m.t));return m};bz.prototype.bbQuery=function(p,n,m,k){var h=function(c){(!c.group||m!==c.group)&&n&c.layers&&p.l<=c.bb_r&&c.bb_l<=p.r&&p.b<=c.bb_t&&c.bb_b<=p.t&&k(c)};this.lock();this.activeShapes.query(p,h);this.staticShapes.query(p,h);this.unlock(!0)};bz.prototype.shapeQuery=function(p,n){var m=p.body;m&&p.update(m.p,m.rot);var m=new ae(p.bb_l,p.bb_b,p.bb_r,p.bb_t),k=!1,h=function(r){if((!p.group||p.group!==r.group)&&p.layers&r.layers&&p!==r){var f;if(p.collisionCode<=r.collisionCode){f=aw(p,r)}else{f=aw(r,p);for(var d=0;d<f.length;d++){f[d].n=bq(f[d].n)}}if(f.length&&(k=!(p.sensor||r.sensor),n)){for(var c=Array(f.length),d=0;d<f.length;d++){c[d]=new bD(f[d].p,f[d].n,f[d].dist)}n(r,c)}}};this.lock();this.activeShapes.query(m,h);this.staticShapes.query(m,h);this.unlock(!0);return k};bz.prototype.addPostStepCallback=function(d){aW(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query.");this.postStepCallbacks.push(d)};bz.prototype.runPostStepCallbacks=function(){for(var d=0;d<this.postStepCallbacks.length;d++){this.postStepCallbacks[d]()}this.postStepCallbacks=[]};bz.prototype.lock=function(){this.locked++};bz.prototype.unlock=function(f){this.locked--;aZ(0<=this.locked,"Internal Error: Space lock underflow.");if(0===this.locked&&f){f=this.rousedBodies;for(var d=0;d<f.length;d++){this.activateBody(f[d])}f.length=0;this.runPostStepCallbacks()}};bz.prototype.makeCollideShapes=function(){var d=this;return function(t,s){if(t.bb_l<=s.bb_r&&s.bb_l<=t.bb_r&&t.bb_b<=s.bb_t&&s.bb_b<=t.bb_t&&t.body!==s.body&&(!t.group||t.group!==s.group)&&t.layers&s.layers){var r=d.lookupHandler(t.collision_type,s.collision_type),p=t.sensor||s.sensor;if(!p||r!==bO){if(t.collisionCode>s.collisionCode){var m=t;t=s;s=m}m=aw(t,s);if(0!==m.length){var c=aO(t.hashid,s.hashid),u=d.cachedArbiters[c];u||(u=d.cachedArbiters[c]=new bn(t,s));u.update(m,r,t,s);"first coll"!=u.state||r.begin(u,d)||u.ignore();"ignore"!==u.state&&r.preSolve(u,d)&&!p?d.arbiters.push(u):(u.contacts=null,"ignore"!==u.state&&(u.state="normal"));u.stamp=d.stamp}}}}};bz.prototype.arbiterSetFilter=function(m){var k=this.stamp-m.stamp,h=m.body_a,g=m.body_b;if((h.isStatic()||h.isSleeping())&&(g.isStatic()||g.isSleeping())){return !0}1<=k&&"cached"!=m.state&&(m.callSeparate(this),m.state="cached");return k>=this.collisionPersistence?(m.contacts=null,!1):!0};var bG=function(f){var e=f.body;f.update(e.p,e.rot)};bz.prototype.step=function(w){if(0!==w){aZ(0===bH.x&&0===bH.y,"vzero is invalid");this.stamp++;var u=this.curr_dt;this.curr_dt=w;var t,s,r=this.bodies,p=this.constraints,d=this.arbiters;for(t=0;t<d.length;t++){var v=d[t];v.state="normal";v.body_a.isSleeping()||v.body_b.isSleeping()||v.unthread()}d.length=0;this.lock();for(t=0;t<r.length;t++){r[t].position_func(w)}this.activeShapes.each(bG);this.activeShapes.reindexQuery(this.collideShapes);this.unlock(!1);this.processComponents(w);this.lock();for(s in this.cachedArbiters){this.arbiterSetFilter(this.cachedArbiters[s])||delete this.cachedArbiters[s]}s=this.collisionSlop;v=1-Math.pow(this.collisionBias,w);for(t=0;t<d.length;t++){d[t].preStep(w,s,v)}for(t=0;t<p.length;t++){s=p[t],s.preSolve(this),s.preStep(w)}s=Math.pow(this.damping,w);v=this.gravity;for(t=0;t<r.length;t++){r[t].velocity_func(v,s,w)}w=0===u?0:w/u;for(t=0;t<d.length;t++){d[t].applyCachedImpulse(w)}for(t=0;t<p.length;t++){p[t].applyCachedImpulse(w)}for(t=0;t<this.iterations;t++){for(w=0;w<d.length;w++){d[w].applyImpulse()}for(w=0;w<p.length;w++){p[w].applyImpulse()}}for(t=0;t<p.length;t++){p[t].postSolve(this)}for(t=0;t<d.length;t++){d[t].handler.postSolve(d[t],this)}this.unlock(!0)}};var b9=function(m,k,h,g){return new aG(k.vx+-g.y*k.w-(m.vx+-h.y*m.w),k.vy+g.x*k.w-(m.vy+h.x*m.w))},bB=function(p,n,m,k,h){return(n.vx+-k.y*n.w-(p.vx+-m.y*p.w))*h.x+(n.vy+k.x*n.w-(p.vy+m.x*p.w))*h.y},aS=function(m,k,h,g){m.vx+=k*m.m_inv;m.vy+=h*m.m_inv;m.w+=m.i_inv*(g.x*h-g.y*k)},a9=function(s,r,p,n,m,k){aS(s,-m,-k,p);aS(r,m,k,n)},bi=function(m,k,h,g){m.v_biasx+=k*m.m_inv;m.v_biasy+=h*m.m_inv;m.w_bias+=m.i_inv*(g.x*h-g.y*k)},bp=function(h,g,f){g=bt(g,f);return h.m_inv+h.i_inv*g*g},av=function(p,n,m,k,e){p=bp(p,m,e)+bp(n,k,e);aW(0!==p,"Unsolvable collision or constraint.");return p},aQ=function(y,x,w,v,u,t){var s;s=y.m_inv+x.m_inv;var r=y.i_inv,e=w.x*w.x*r;y=-w.x*w.y*r;w=s+w.y*w.y*r;s+=e;r=x.i_inv;x=v.x*v.x*r;e=-v.x*v.y*r;w+=v.y*v.y*r;v=0+y+e;y=0+y+e;s+=x;x=w*s-v*y;aW(0!==x,"Unsolvable constraint.");x=1/x;u.x=s*x;u.y=-v*x;t.x=-y*x;t.y=w*x},bv=a1.Constraint=function(f,e){this.a=f;this.b=e;this.next_b=this.next_a=this.space=null;this.maxForce=Infinity;this.errorBias=Math.pow(0.9,60);this.maxBias=Infinity};bv.prototype.activateBodies=function(){this.a&&this.a.activate();this.b&&this.b.activate()};bv.prototype.preStep=function(d){};bv.prototype.applyCachedImpulse=function(d){};bv.prototype.applyImpulse=function(){};bv.prototype.getImpulse=function(){return 0};bv.prototype.preSolve=function(d){};bv.prototype.postSolve=function(d){};bv.prototype.next=function(d){return this.a===d?this.next_a:this.next_b};var aj=a1.PinJoint=function(m,k,h,e){bv.call(this,m,k);this.anchr1=h;this.anchr2=e;m=m?aA(m.p,bw(h,m.rot)):h;k=k?aA(k.p,bw(e,k.rot)):e;this.dist=bF(aB(k,m));aW(0<this.dist,"You created a 0 length pin joint. A pivot joint will be much more stable.");this.n=this.r1=this.r2=null;this.bias=this.jnAcc=this.jnMax=this.nMass=0};aj.prototype=Object.create(bv.prototype);aj.prototype.preStep=function(p){var n=this.a,m=this.b;this.r1=bw(this.anchr1,n.rot);this.r2=bw(this.anchr2,m.rot);var k=aB(aA(m.p,this.r2),aA(n.p,this.r1)),h=bF(k);this.n=bC(k,1/(h?h:Infinity));this.nMass=1/av(n,m,this.r1,this.r2,this.n);n=this.maxBias;this.bias=aH(-(1-Math.pow(this.errorBias,p))*(h-this.dist)/p,-n,n);this.jnMax=this.maxForce*p};aj.prototype.applyCachedImpulse=function(d){d=bC(this.n,this.jnAcc*d);a9(this.a,this.b,this.r1,this.r2,d.x,d.y)};aj.prototype.applyImpulse=function(){var p=this.a,n=this.b,m=this.n,k=bB(p,n,this.r1,this.r2,m),k=(this.bias-k)*this.nMass,h=this.jnAcc;this.jnAcc=aH(h+k,-this.jnMax,this.jnMax);k=this.jnAcc-h;a9(p,n,this.r1,this.r2,m.x*k,m.y*k)};aj.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var b8=a1.SlideJoint=function(s,r,p,n,m,k){bv.call(this,s,r);this.anchr1=p;this.anchr2=n;this.min=m;this.max=k;this.r1=this.r2=this.n=null;this.bias=this.jnAcc=this.jnMax=this.nMass=0};b8.prototype=Object.create(bv.prototype);b8.prototype.preStep=function(s){var r=this.a,p=this.b;this.r1=bw(this.anchr1,r.rot);this.r2=bw(this.anchr2,p.rot);var n=aB(aA(p.p,this.r2),aA(r.p,this.r1)),m=bF(n),k=0;m>this.max?(k=m-this.max,this.n=bd(n)):m<this.min?(k=this.min-m,this.n=bq(bd(n))):(this.n=bH,this.jnAcc=0);this.nMass=1/av(r,p,this.r1,this.r2,this.n);r=this.maxBias;this.bias=aH(-(1-Math.pow(this.errorBias,s))*k/s,-r,r);this.jnMax=this.maxForce*s};b8.prototype.applyCachedImpulse=function(d){d*=this.jnAcc;a9(this.a,this.b,this.r1,this.r2,this.n.x*d,this.n.y*d)};b8.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var p=this.a,n=this.b,m=this.n,k=b9(p,n,this.r1,this.r2),k=aD(k,m),k=(this.bias-k)*this.nMass,h=this.jnAcc;this.jnAcc=aH(h+k,-this.jnMax,0);k=this.jnAcc-h;a9(p,n,this.r1,this.r2,m.x*k,m.y*k)}};b8.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var bW=a1.PivotJoint=function(m,k,h,g){bv.call(this,m,k);"undefined"===typeof g&&(g=h,h=m?m.world2Local(g):g,g=k?k.world2Local(g):g);this.anchr1=h;this.anchr2=g;this.r1=this.r2=bH;this.k1=new aG(0,0);this.k2=new aG(0,0);this.jAcc=bH;this.jMaxLen=0;this.bias=bH};bW.prototype=Object.create(bv.prototype);bW.prototype.preStep=function(h){var g=this.a,f=this.b;this.r1=bw(this.anchr1,g.rot);this.r2=bw(this.anchr2,f.rot);aQ(g,f,this.r1,this.r2,this.k1,this.k2);this.jMaxLen=this.maxForce*h;g=aB(aA(f.p,this.r2),aA(g.p,this.r1));this.bias=bg(bC(g,-(1-Math.pow(this.errorBias,h))/h),this.maxBias)};bW.prototype.applyCachedImpulse=function(d){a9(this.a,this.b,this.r1,this.r2,this.jAcc.x*d,this.jAcc.y*d)};bW.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=b9(m,k,this.r1,this.r2),h=aB(this.bias,h),g=this.k2,h=new aG(aD(h,this.k1),aD(h,g)),g=this.jAcc;this.jAcc=bg(aA(this.jAcc,h),this.jMaxLen);a9(m,k,this.r1,this.r2,this.jAcc.x-g.x,this.jAcc.y-g.y)};bW.prototype.getImpulse=function(){return bF(this.jAcc)};var br=a1.GrooveJoint=function(p,n,m,k,h){bv.call(this,p,n);this.grv_a=m;this.grv_b=k;this.grv_n=bm(bl(aB(k,m)));this.anchr2=h;this.grv_tn=null;this.clamp=0;this.r1=this.r2=null;this.k1=new aG(0,0);this.k2=new aG(0,0);this.jAcc=bH;this.jMaxLen=0;this.bias=null};br.prototype=Object.create(bv.prototype);br.prototype.preStep=function(w){var v=this.a,u=this.b,t=v.local2World(this.grv_a),s=v.local2World(this.grv_b),r=bw(this.grv_n,v.rot),p=aD(t,r);this.grv_tn=r;this.r2=bw(this.anchr2,u.rot);var n=bt(aA(u.p,this.r2),r);n<=bt(t,r)?(this.clamp=1,this.r1=aB(t,v.p)):n>=bt(s,r)?(this.clamp=-1,this.r1=aB(s,v.p)):(this.clamp=0,this.r1=aB(aA(bC(bm(r),-n),bC(r,p)),v.p));aQ(v,u,this.r1,this.r2,this.k1,this.k2);this.jMaxLen=this.maxForce*w;v=aB(aA(u.p,this.r2),aA(v.p,this.r1));this.bias=bg(bC(v,-(1-Math.pow(this.errorBias,w))/w),this.maxBias)};br.prototype.applyCachedImpulse=function(d){a9(this.a,this.b,this.r1,this.r2,this.jAcc.x*d,this.jAcc.y*d)};br.prototype.grooveConstrain=function(f){var e=this.grv_tn;f=0<this.clamp*bt(f,e)?f:a7(f,e);return bg(f,this.jMaxLen)};br.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=b9(m,k,this.r1,this.r2),h=aB(this.bias,h),g=this.k2,h=new aG(aD(h,this.k1),aD(h,g)),g=this.jAcc;this.jAcc=this.grooveConstrain(aA(g,h));a9(m,k,this.r1,this.r2,this.jAcc.x-g.x,this.jAcc.y-g.y)};br.prototype.getImpulse=function(){return bF(this.jAcc)};br.prototype.setGrooveA=function(d){this.grv_a=d;this.grv_n=bm(bl(aB(this.grv_b,d)));this.activateBodies()};br.prototype.setGrooveB=function(d){this.grv_b=d;this.grv_n=bm(bl(aB(d,this.grv_a)));this.activateBodies()};var a2=function(f,e){return(f.restLength-e)*f.stiffness},bI=a1.DampedSpring=function(u,t,s,r,p,n,m){bv.call(this,u,t);this.anchr1=s;this.anchr2=r;this.restLength=p;this.stiffness=n;this.damping=m;this.springForceFunc=a2;this.target_vrn=this.v_coef=0;this.r1=this.r2=null;this.nMass=0;this.n=null};bI.prototype=Object.create(bv.prototype);bI.prototype.preStep=function(p){var n=this.a,m=this.b;this.r1=bw(this.anchr1,n.rot);this.r2=bw(this.anchr2,m.rot);var k=aB(aA(m.p,this.r2),aA(n.p,this.r1)),e=bF(k);this.n=bC(k,1/(e?e:Infinity));k=av(n,m,this.r1,this.r2,this.n);aW(0!==k,"Unsolvable this.");this.nMass=1/k;this.target_vrn=0;this.v_coef=1-Math.exp(-this.damping*p*k);e=this.springForceFunc(this,e);a9(n,m,this.r1,this.r2,this.n.x*e*p,this.n.y*e*p)};bI.prototype.applyCachedImpulse=function(d){};bI.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=bB(m,k,this.r1,this.r2,this.n),g=(this.target_vrn-h)*this.v_coef;this.target_vrn=h+g;g*=this.nMass;a9(m,k,this.r1,this.r2,this.n.x*g,this.n.y*g)};bI.prototype.getImpulse=function(){return 0};var ax=function(f,e){return(e-f.restAngle)*f.stiffness},bX=a1.DampedRotarySpring=function(p,n,m,k,h){bv.call(this,p,n);this.restAngle=m;this.stiffness=k;this.damping=h;this.springTorqueFunc=ax;this.iSum=this.w_coef=this.target_wrn=0};bX.prototype=Object.create(bv.prototype);bX.prototype.preStep=function(m){var k=this.a,h=this.b,e=k.i_inv+h.i_inv;aW(0!==e,"Unsolvable spring.");this.iSum=1/e;this.w_coef=1-Math.exp(-this.damping*m*e);this.target_wrn=0;m*=this.springTorqueFunc(this,k.a-h.a);k.w-=m*k.i_inv;h.w+=m*h.i_inv};bX.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=m.w-k.w,g=(this.target_wrn-h)*this.w_coef;this.target_wrn=h+g;h=g*this.iSum;m.w+=h*m.i_inv;k.w-=h*k.i_inv};var a3=a1.RotaryLimitJoint=function(m,k,h,g){bv.call(this,m,k);this.min=h;this.max=g;this.iSum=this.bias=this.jMax=this.jAcc=0};a3.prototype=Object.create(bv.prototype);a3.prototype.preStep=function(p){var n=this.a,m=this.b,k=m.a-n.a,h=0;k>this.max?h=this.max-k:k<this.min&&(h=this.min-k);this.iSum=1/(1/n.i+1/m.i);n=this.maxBias;this.bias=aH(-(1-Math.pow(this.errorBias,p))*h/p,-n,n);this.jMax=this.maxForce*p;this.bias||(this.jAcc=0)};a3.prototype.applyCachedImpulse=function(h){var g=this.a,f=this.b;h*=this.jAcc;g.w-=h*g.i_inv;f.w+=h*f.i_inv};a3.prototype.applyImpulse=function(){if(this.bias){var m=this.a,k=this.b,h=-(this.bias+(k.w-m.w))*this.iSum,g=this.jAcc;this.jAcc=0>this.bias?aH(g+h,0,this.jMax):aH(g+h,-this.jMax,0);h=this.jAcc-g;m.w-=h*m.i_inv;k.w+=h*k.i_inv}};a3.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var ay=a1.RatchetJoint=function(m,k,h,g){bv.call(this,m,k);this.angle=0;this.phase=h;this.ratchet=g;this.angle=(k?k.a:0)-(m?m.a:0);this.iSum=this.bias=this.jAcc=this.jMax=0};ay.prototype=Object.create(bv.prototype);ay.prototype.preStep=function(w){var v=this.a,u=this.b,t=this.phase,s=this.ratchet,r=u.a-v.a,p=this.angle-r,n=0;0<p*s?n=p:this.angle=Math.floor((r-t)/s)*s+t;this.iSum=1/(v.i_inv+u.i_inv);v=this.maxBias;this.bias=aH(-(1-Math.pow(this.errorBias,w))*n/w,-v,v);this.jMax=this.maxForce*w;this.bias||(this.jAcc=0)};ay.prototype.applyCachedImpulse=function(h){var g=this.a,f=this.b;h*=this.jAcc;g.w-=h*g.i_inv;f.w+=h*f.i_inv};ay.prototype.applyImpulse=function(){if(this.bias){var p=this.a,n=this.b,m=this.ratchet,k=-(this.bias+(n.w-p.w))*this.iSum,h=this.jAcc;this.jAcc=aH((h+k)*m,0,this.jMax*Math.abs(m))/m;k=this.jAcc-h;p.w-=k*p.i_inv;n.w+=k*n.i_inv}};ay.prototype.getImpulse=function(d){return Math.abs(d.jAcc)};var b5=a1.GearJoint=function(m,k,h,g){bv.call(this,m,k);this.phase=h;this.ratio=g;this.ratio_inv=1/g;this.iSum=this.bias=this.jMax=this.jAcc=0};b5.prototype=Object.create(bv.prototype);b5.prototype.preStep=function(m){var k=this.a,h=this.b;this.iSum=1/(k.i_inv*this.ratio_inv+this.ratio*h.i_inv);var g=this.maxBias;this.bias=aH(-(1-Math.pow(this.errorBias,m))*(h.a*this.ratio-k.a-this.phase)/m,-g,g);this.jMax=this.maxForce*m};b5.prototype.applyCachedImpulse=function(h){var g=this.a,f=this.b;h*=this.jAcc;g.w-=h*g.i_inv*this.ratio_inv;f.w+=h*f.i_inv};b5.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=(this.bias-(k.w*this.ratio-m.w))*this.iSum,g=this.jAcc;this.jAcc=aH(g+h,-this.jMax,this.jMax);h=this.jAcc-g;m.w-=h*m.i_inv*this.ratio_inv;k.w+=h*k.i_inv};b5.prototype.getImpulse=function(){return Math.abs(this.jAcc)};b5.prototype.setRatio=function(d){this.ratio=d;this.ratio_inv=1/d;this.activateBodies()};var al=a1.SimpleMotor=function(h,g,f){bv.call(this,h,g);this.rate=f;this.iSum=this.jMax=this.jAcc=0};al.prototype=Object.create(bv.prototype);al.prototype.preStep=function(d){this.iSum=1/(this.a.i_inv+this.b.i_inv);this.jMax=this.maxForce*d};al.prototype.applyCachedImpulse=function(h){var g=this.a,f=this.b;h*=this.jAcc;g.w-=h*g.i_inv;f.w+=h*f.i_inv};al.prototype.applyImpulse=function(){var m=this.a,k=this.b,h=-(k.w-m.w+this.rate)*this.iSum,g=this.jAcc;this.jAcc=aH(g+h,-this.jMax,this.jMax);h=this.jAcc-g;m.w-=h*m.i_inv;k.w+=h*k.i_inv};al.prototype.getImpulse=function(){return Math.abs(this.jAcc)}})();var res={number_png:"res/game/number.png",bg_png:"res/game/bg.png",apple1_png:"res/game/apple2.png",apple2_png:"res/game/apple5.png",apple3_png:"res/game/apple6.png",apple4_png:"res/game/apple7.png",apple5_png:"res/game/apple8.png",panZi1_png:"res/game/panzi1.png",panZi2_png:"res/game/panzi2.png",s1_png:"res/game/s.png",sy1_png:"res/game/sy1.png",sy2_png:"res/game/sy2.png",sy3_png:"res/game/sy3.png",sy4_png:"res/game/sy4.png",st1_png:"res/game/st1.png",st2_png:"res/game/st2.png",st3_png:"res/game/st3.png",st4_png:"res/game/st4.png",grass_png:"res/game/grass.png"},music={openLayer:"res/music/openLayer",gameover:"res/music/gameover",moveSound:"res/music/moveSound",clickSound:"res/music/clickSound",posui:"res/music/posui",p:"res/music/p",zhalie:"res/music/zhalie"},comRes={share_png:"res/game/share.png",ad_png:"res/commonUI/btn_ad.png",game_over1_png:"res/commonUI/ChineseRes/game_over.png",game_over2_png:"res/commonUI/EnglishRes/game_over.png",btn_again_png:"res/commonUI/ChineseRes/btn_again.png",btn_more_png:"res/commonUI/ChineseRes/btn_more.png",btn_gz_png:"res/commonUI/ChineseRes/btn_gz.png",btn_link_png:"res/commonUI/btn_link.png",btn_jiantou_png:"res/commonUI/btn_jiantou.png",button1_png:"res/commonUI/button1.png",button2_png:"res/commonUI/button2.png",game_over_png:"res/commonUI/EnglishRes/game_over.png",icon_facebook_png:"res/commonUI/EnglishRes/icon_facebook.png",icon_replay_png:"res/commonUI/EnglishRes/icon_replay.png",icon_twitter_png:"res/commonUI/EnglishRes/icon_twitter.png",icon_moregame_png:"res/commonUI/EnglishRes/icon_moregame.png",score_bg_png:"res/commonUI/EnglishRes/score_bg.png"},g_resources=[],a;for(a in comRes){g_resources.push(comRes[a])}for(var b in res){g_resources.push(res[b])}var PopLayer=cc.Layer.extend({m_touchListener:null,selfPopLayer:null,popName:null,ctor:function(){this._super();selfPopLayer=this;var d={event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouch};cc.eventManager.addListener(d,this);this.m_touchListener=d},setData:function(){},onTouch:function(h,g){var f=g.getCurrentTarget();return f.isVisible()&&selfPopLayer.isTouchInside(f,h)?!0:!1},isTouchInside:function(h,g){if(!h||!h.getParent()){return !1}var f=g.getLocation(),f=h.getParent().convertToNodeSpace(f);return cc.rectContainsPoint(h.getBoundingBox(),f)},setLayerVisible:function(d){this.setVisible(d)},hide:function(){this.popName=this.selfPopLayer=this.m_touchListener=null;this.getParent()&&(this.removeAllChildrenWithCleanup(!0),this.removeFromParent(!0))}});var UIManager={downLayer:null,centreLayer:null,upLayer:null,effectLayer:null,loadingLayer:null,messageLayer:null,uiDic:null,init:function(){this.uiDic={};this.downLayer=new cc.Layer;this.downLayer.retain();this.centreLayer=new cc.Layer;this.centreLayer.retain();this.upLayer=new cc.Layer;this.upLayer.retain();this.messageLayer=new cc.Layer;this.messageLayer.retain()},register:function(d){this.downLayer.getParent()&&this.downLayer.removeFromParent();this.centreLayer.getParent()&&this.centreLayer.removeFromParent();this.upLayer.getParent()&&this.upLayer.removeFromParent();this.messageLayer.getParent()&&this.messageLayer.removeFromParent();d.addChild(this.downLayer);d.addChild(this.centreLayer);d.addChild(this.upLayer);d.addChild(this.messageLayer)},show:function(c,d,e,f){if(!f&&this.isPop(c)){return cc.log("\u5df2\u7ecf\u6709\u6253\u5f00\u7684\u9875\u9762\u4e86...:"+c),!1}e=e||this.downLayer;var g=new (eval("("+c+")"));e.addChild(g);g.setData(d);cc.log("show : "+c);f||(this.uiDic[c]=g);return !0},hide:function(f){var e=this.uiDic[f];e&&(cc.log("hide : "+f),e.hide(),delete this.uiDic[f])},getView:function(d){return this.uiDic[d]},isPop:function(d){return(d=this.uiDic[d])&&d.getParent()?!0:!1}},UIName=UIName||{};UIName.EndLayer="EndLayer";UIName.MainLayer="MainLayer";UIName.StartLayer="StartLayer";UIName.EndLayerEnglish="EndLayerEnglish";UIName.LinkLayer="LinkLayer";UIName.AdLayer="AdLayer";var UIToolManager={getSprite:function(n,m,k,j,h){n=new cc.Sprite(n);null!=m&&null!=k&&n.setAnchorPoint(m,k);null!=j&&null!=h&&n.setPosition(j,h);return n},getLabelTTF:function(s,r,p,o,n,m,j){s=new cc.LabelTTF(""+s,"Arial \u7c97\u4f53",r);s.setAnchorPoint(p,o);s.setPosition(n,m);null!=j&&s.setFontFillColor(j);return s},getTest:function(){}};var HttpManager=cc.Class.extend({URL:"http://www.wesane.com/h5service.php/Interface/services",cacheList:null,isBusy:null,req:null,perform:null,ctor:function(){this.cacheList=[]},checkHave:function(){this.isBusy||this.sendOne()},send:function(k,j,h,g){this.cacheList.push({type:k,data:j,func:h,target:g});this.isBusy||this.sendOne()},sendOne:function(){if(0!=this.cacheList.length){this.isBusy=!0;this.perform=this.cacheList.shift();this.req=cc.loader.getXMLHttpRequest();this.req.onreadystatechange=this.onDataHandler.bind(this);this.req.onerror=this.onErrorHandler.bind(this);this.req.ontimeout=this.onTimeoutHandler.bind(this);this.req.timeout=2000;this.req.open("POST",this.URL);this.req.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset\x3dUTF-8");var d="send\x3d"+JSON.stringify({type:this.perform.type,gid:null,mid:null,data:this.perform.data});this.req.send(d)}},onDataHandler:function(){if(4==this.req.readyState&&200<=this.req.status&&207>=this.req.status){var d=JSON.parse(this.req.responseText);this.isBusy=!1;this.perform.target?this.perform.func.call(this.perform.target,d.errorcode,d.data):this.perform.func(d)}},onErrorHandler:function(){cc.log("\u7f51\u7edc\u9519\u8bef");this.isBusy=!1;this.perform.target?this.perform.func.call(this.perform.target,-1):this.perform.func(-1)},onTimeoutHandler:function(){cc.log("\u8bf7\u6c42\u8d85\u65f6");this.isBusy=!1;this.perform.target?this.perform.func.call(this.perform.target,-1):this.perform.func(-1)},clearAll:function(){for(var h=this.cacheList.length,g=0;g<h;g++){var f=this.cacheList[g];f&&(f.target?f.func.call(f.target,-1):f.func(-1))}this.cacheList.length=0}});HttpManager.instance=null;HttpManager.register=function(){HttpManager.instance=new HttpManager};var UserDataManager={isWX:!0,isLogin:!1,mid:null,isContinue:!1,getGold:null,continueData:{},init:function(){this.noLoginAccount()},getAccountReturn:function(f,e){0==f&&(this.getGold={},this.getGold.type=e.type,this.getGold.reward_money=e.reward_money,this.getGold.reward_info=e.reward_info,e.isContinue&&1==e.isContinue&&(this.isContinue=e.isContinue,this.continueData={},this.continueData.cost=e.cost,this.continueData.score=e.score,this.continueData.save=e.save),this.loginAccount(e.mid))},noLoginAccount:function(){this.isLogin=!1},loginAccount:function(d){this.mid=d;this.isLogin=!0;cc.log("\u5f53\u524d\u767b\u5f55\u7528\u6237\uff1a"+this.mid);MainManager.startGame()},exitLogin:function(){this.mid=null;this.isLogin=!1}};var LocalManager={scoreKey:null,timeKey:null,init:function(){this.scoreKey="game_"+GameManager.gid;this.timeKey="time_"+GameManager.gid},setMaxData:function(){var f=this.getItem(this.scoreKey),e=GameManager.score;f||this.setItem(this.scoreKey,e);e>f&&this.setItem(this.scoreKey,e);GameManager.maxScore=this.getItem(this.scoreKey);score_submit(e,1)},getMaxScore:function(){var d=this.getItem(this.scoreKey);return d?d:0},setLastShowAd:function(){var d=(new Date).getTime()/1000;this.setItem(this.timeKey,d)},getLastShowAd:function(){var d=this.getItem(this.timeKey);return 0<d?d:null},getNowTime:function(){return(new Date).getTime()/1000},getItem:function(d){return cc.sys.localStorage.getItem(d)},setItem:function(f,e){cc.sys.localStorage.setItem(f,e)},clearData:function(){cc.sys.localStorage.clear()},resetData:function(){this.clearData()}};var GameManager={gameName:null,playNum:0,touchNum:0,levelNum:1,score:0,totalNum:0,clickRightNum:0,clickErrorNum:0,init:function(){this.gameName=LanguageManager.getText("game_name");this.averageScore=10;this.touchNum=this.playNum=0;this.levelNum=1},setData:function(){this.resetData()},resetData:function(){this.playNum++;this.score=this.touchNum=0;this.levelNum=1;this.clickErrorNum=this.clickRightNum=0;this.totalNum=30},addScore:function(d){this.score+=d},addRightScore:function(d){this.clickRightNum+=d},reduceTotalScore:function(d){this.totalNum-=d},testFunc:function(){}},upload=!0,GC=GC||{};GC.appleArr=[];GC.appleDropBool=!1;GC.appleStopBool=!1;GC.canTouchBool=!1;GC.chaEyeBool=!1;GC.canEffectBool=!1;var MainManager={linkData:null,lastAdTime:0,init:function(){this.lastAdTime=0;this.URL_moreGame="//h5.woaiyx.com";this.id_facebookShare=1762033237455715;this.getLinkGame()},gotoMoreGame:function(){window.location.href=this.URL_moreGame},gotoEndLayer:function(){score_submit(GameManager.score,1);FaceBookFlag||TwitterFlag||!LanguageManager.chineseFlag?UIManager.show(UIName.EndLayerEnglish):UIManager.show(UIName.EndLayer);upload&&(0==this.lastAdTime||30<this.getInterval())&&UIManager.show(UIName.AdLayer)},setLastShowAd:function(){this.lastAdTime=(new Date).getTime()/1000},getInterval:function(){var d=(new Date).getTime()/1000-this.lastAdTime;cc.log("nt-\x3e"+d);return d},gamePause:function(){this.isPause=!0;this.canTouch=!1;mainSelf&&mainSelf.unscheduleUpdate();AudioManager.pauseMusic()},gameResume:function(){this.isPause=!1;this.canTouch=!0;mainSelf&&mainSelf.scheduleUpdate();AudioManager.resumeMusic()},randomInt:function(f,e){return f+Math.floor(Math.random()*(e-f+1))},getDist:function(k,j,h,g){return cc.pDistance(cc.p(k,j),cc.p(h,g))},gotoCover:function(){MainManager.loadGame();cc.director.runScene(new LoadScene)},loadGame:function(){cc.log("loadGame");HttpManager.register();LanguageManager.init();GameManager.init();MainManager.init()},startGame:function(){cc.log("startGame");cc.director.runScene(new GameScene)},getLinkGame:function(){HttpManager.instance.send("101",null,this.getLinkGameReturn,this)},getLinkGameReturn:function(f,e){0==f?this.linkData=e:cc.log("\u83b7\u53d6\u5931\u8d25")},testFunc:function(){}},setO=200,AdLayer=cc.Layer.extend({lis1:null,state:1,ctor:function(){this._super()},setData:function(){var h=cc.director.getWinSize().height/1280,g=0,f=0;0.76<=h?(g=1,f=0):0.73<h?(g=0.9,f=0.1):0.7<=h?(g=h,f=1-h):0.6<=h?f=g=0.5:0.5<=h?(g=0.4,f=0.6):0.4<=h?(g=0.2,f=0.8):0.1<=h?(g=0.1,f=0.9):0<=h&&(g=0.05,f=0.95);this.scaleNum=g+CH/1280*f;this.setState(1);this.init();this.createListener()},init:function(){this.bg=new cc.DrawNode;this.bg.drawRect(cc.p(0,0),cc.p(CW,CH),cc.color(0,0,0,120),-1);this.addChild(this.bg);this.node=new cc.Node;this.addChild(this.node);this.bgColor=new cc.DrawNode;this.bgColor.drawRect(cc.p(0,CH/2-300*this.scaleNum),cc.p(CW,CH/2+300*this.scaleNum),cc.color(0,0,0,170),-1);this.node.addChild(this.bgColor);var d=UIToolManager.getSprite(comRes.share_png,0.5,0.5,CW/2-150*this.scaleNum,CH/2+50*this.scaleNum);this.node.addChild(d);d.setScale(this.scaleNum);d=UIToolManager.getSprite(comRes.ad_png,0.5,0.5,CW/2+200*this.scaleNum,CH/2+50*this.scaleNum);this.node.addChild(d);d.setScale(this.scaleNum);d=UIToolManager.getLabelTTF("Continue",40*this.scaleNum,0.5,0.5,d.x,d.y-110*this.scaleNum);this.node.addChild(d);this.layerIn()},layerIn:function(){this.node.x=-CW;this.node.runAction(cc.sequence(cc.moveTo(0.3,0,0),cc.callFunc(this.setState.bind(this,2))))},layerOut:function(){this.node.runAction(cc.sequence(cc.moveTo(0.3,-CW,0),cc.callFunc(this.destroy.bind(this))))},createListener:function(){this.lis1=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)});cc.eventManager.addListener(this.lis1,this)},removeListener:function(){cc.eventManager.removeListener(this.lis1);this.lis1=null},onTouchBegan:function(f,e){return !0},onTouchMoved:function(f,e){},onTouchEnded:function(f,e){2==this.state&&(this.state=3,showMyAds(),MainManager.setLastShowAd(),this.runAction(cc.sequence(cc.callFunc(this.layerOut.bind(this)))))},setState:function(d){this.state=d;cc.log(this.state)},destroy:function(){this.stopAllActions();this.removeListener();this.removeAllChildren(!0);this.removeFromParent(!0)}});var AudioManager={init:function(){},playBGMusic:function(d){cc.audioEngine.isMusicPlaying()&&this.stopAllMusic();cc.audioEngine.playMusic(d,!0)},playEffect:function(d){d=cc.sys.os===cc.sys.OS_IOS?d+".mp3":d+".ogg";cc.audioEngine.playEffect(d,!1)},pauseMusic:function(){cc.audioEngine.pauseMusic()},resumeMusic:function(){cc.audioEngine.resumeMusic()},stopAllMusic:function(){cc.audioEngine.stopMusic();cc.audioEngine.stopAllEffects()}};var LanguageManager={chineseFlag:!1,txtShow:null,init:function(){this.txtShow={};cc.sys.language==cc.sys.LANGUAGE_CHINESE?(this.txtShow.data=language_Chinese,this.chineseFlag=!0):this.txtShow.data=language_English;document.title=LanguageManager.getText("game_name")},getText:function(d){return this.txtShow.data[d]}},language_Chinese={game_name:"30\u4e2a\u82f9\u679c",game_info:"\u6811\u4e0a\u670930\u4e2a\u82f9\u679c\uff0c\u770b\u770b\u4f60\u80fd\u63a5\u4f4f\u591a\u5c11\u4e2a\uff1f",start:"\u5f00\u59cb\u6e38\u620f",link_top_tip:"\u522b\u4eba\u90fd\u5728\u73a9 : ",game_center:"\u6e38\u620f\u4e2d\u5fc3"},language_English={game_name:"Thirty Apples",game_info:"There are 30 apples on the tree and see how many can you catch?",start:"Start",link_top_tip:"Others are playing : ",game_center:"Game center"},language_Japanese={game_name:"",game_info:"",start:"\u30b2\u30fc\u30e0\u3092\u59cb\u3081\u308b",link_top_tip:"\u307f\u3093\u306a\u3067\u6e38\u3093\u3067 : ",game_center:"\u30b2\u30fc\u30e0\u306e\u4e2d\u5fc3"},language_Korean={game_name:"",game_info:"",start:"\ubd80\ud130 \uac8c\uc784",link_top_tip:"\ub0a8 \ub4e4 \uc740 \ub180 : ",game_center:"\uac8c\uc784 \uc13c\ud130"};var MainLayer=cc.Layer.extend({lis1:null,bg:null,scoreView:null,_speed:5,_speedSign:1,_colorArr:[],_countTime:0,_norCountTime:7,_countTime1:0,_countEyeTime:0,_countEyeTotalTime:0,_countNorEyeTime:70,_countNorTime:60,_indexN:0,_indexN1:0,_indexN2:1,_touchRightNum:0,_touchErrorNum:0,ctor:function(){this._super();mainSelf=this},setData:function(h){h=cc.director.getWinSize().height/1280;var g=0,f=0;0.76<=h?(g=1,f=0):0.73<h?(g=0.9,f=0.1):0.7<=h?(g=h,f=1-h):0.6<=h?f=g=0.5:0.5<=h?(g=0.4,f=0.6):0.4<=h?(g=0.2,f=0.8):0.1<=h?(g=0.1,f=0.9):0<=h&&(g=0.05,f=0.95);this.scaleNum=g+CH/1280*f;this._speed=5*this.scaleNum;this.initUI();this.initPhysics();this.initDropApple();this.initPanZi();this.initCollisionFunc();this.addLinkGame()},initUI:function(){this._colorArr=[1,2,3,4];this.bg=new cc.LayerColor(cc.color("#17d9ff"),CW,CH);this.addChild(this.bg,0);this.treeSpr=new cc.Sprite(res.bg_png);this.treeSpr.x=CW/2;this.treeSpr.y=0;this.treeSpr.setAnchorPoint(cc.p(0.5,0));this.addChild(this.treeSpr);this.treeSpr.setScale(this.scaleNum);this.grassSpr=new cc.Sprite(res.grass_png);this.grassSpr.setAnchorPoint(cc.p(0.5,0));this.grassSpr.x=CW/2;this.grassSpr.y=0;this.addChild(this.grassSpr);this.scoreView=new ScoreView1(0,1,63,CH-16,this.scaleNum);this.aniSpr1=UIToolManager.getSprite(res.s1_png,0.5,0,CW/2,86*this.scaleNum);this.addChild(this.aniSpr1,1);this.aniSpr1.setScale(this.scaleNum);this.aniSpr2=UIToolManager.getSprite(res.sy4_png,0.5,0,CW/2,86*this.scaleNum);this.addChild(this.aniSpr2,1);this.aniSpr2.setScale(this.scaleNum);this.aniSpr3=UIToolManager.getSprite(res.st1_png,0.5,0,CW/2,86*this.scaleNum);this.addChild(this.aniSpr3,1);this.aniSpr3.setScale(this.scaleNum);this.panZiSpr1=UIToolManager.getSprite(res.panZi1_png,0.5,0.5,CW/2-15,146*this.scaleNum);this.addChild(this.panZiSpr1,4);this.panZiSpr1.setScale(this.scaleNum);this.panZiSpr2=UIToolManager.getSprite(res.panZi2_png,0.5,0.5,CW/2-15,146*this.scaleNum);this.addChild(this.panZiSpr2,2);this.panZiSpr2.setScale(this.scaleNum);this.scoreTotalView=new ScoreView2(0,1,20,CH-16,this.scaleNum);this.addChild(this.scoreTotalView,1)},initPhysics:function(){this.space=new cp.Space;this.space.gravity=cp.v(0,0);this.walls=[new cp.SegmentShape(this.space.staticBody,cp.v(0,CH),cp.v(CW,CH),2)];for(var f=0;f<this.walls.length;f++){var e=this.walls[f];e.setElasticity(0);e.setFriction(1);this.space.addStaticShape(e)}},setupDebugNode:function(){this._debugNode=new cc.PhysicsDebugNode(this.space);this._debugNode.visible=!0;this.addChild(this._debugNode)},initPanZi:function(){this.wall1={};this.wall1.body=new cp.StaticBody(1,cp.momentForCircle(1,0,15*this.scaleNum,cp.v(0,0)));this.wall1.body.setPos(cc.p(this.panZiSpr1.x-78*this.scaleNum,this.panZiSpr1.y+9*this.scaleNum));this.wall1.shape=new cp.CircleShape(this.wall1.body,15*this.scaleNum,cp.v(0,0));this.wall1.shape.setElasticity(0.1);this.wall1.shape.setFriction(0.2);this.space.addStaticShape(this.wall1.shape,10);this.wall1.shape.setCollisionType(1);this.wall1.sprite=new cc.PhysicsSprite;this.wall1.sprite.setBody(this.wall1.body);this.wall1.sprite.setPosition(cc.p(this.panZiSpr1.x-78*this.scaleNum,this.panZiSpr1.y+9*this.scaleNum));this.addChild(this.wall1.sprite,10);this.wall1.body.setAngleInternal(0);this.space.reindexStatic();this.space.reindexShape(this.wall1.shape);this.wall2={};this.wall2.body=new cp.StaticBody(1,cp.momentForCircle(1,0,15*this.scaleNum,cp.v(0,0)));this.wall2.body.setPos(cc.p(this.panZiSpr1.x+78*this.scaleNum,this.panZiSpr1.y+9*this.scaleNum));this.wall2.shape=new cp.CircleShape(this.wall2.body,15*this.scaleNum,cp.v(0,0));this.wall2.shape.setElasticity(0.1);this.wall2.shape.setFriction(0.2);this.space.addStaticShape(this.wall2.shape,10);this.wall2.shape.setCollisionType(1);this.wall2.sprite=new cc.PhysicsSprite;this.wall2.sprite.setBody(this.wall2.body);this.wall2.sprite.setPosition(cc.p(this.panZiSpr1.x+78*this.scaleNum,this.panZiSpr1.y+9*this.scaleNum));this.addChild(this.wall2.sprite,10);this.wall2.body.setAngleInternal(0);this.space.reindexStatic();this.space.reindexShape(this.wall2.shape);this.wall3={};this.wall3.body=new cp.StaticBody(1,cp.momentForBox(1,135*this.scaleNum,5*this.scaleNum));this.wall3.body.setPos(cc.p(this.panZiSpr1.x,this.panZiSpr1.y-7*this.scaleNum));this.wall3.shape=new cp.BoxShape(this.wall3.body,135*this.scaleNum,5*this.scaleNum);this.wall3.shape.setElasticity(0);this.wall3.shape.setFriction(0);this.space.addStaticShape(this.wall3.shape,10);this.wall3.shape.setCollisionType(2);this.wall3.sprite=new cc.PhysicsSprite;this.wall3.sprite.setBody(this.wall3.body);this.wall3.sprite.setPosition(cc.p(this.panZiSpr1.x,this.panZiSpr1.y-7*this.scaleNum));this.addChild(this.wall3.sprite,10);this.wall3.body.setAngleInternal(0);this.space.reindexStatic();this.space.reindexShape(this.wall3.shape);this.wall4={};this.wall4.body=new cp.StaticBody(1,cp.momentForBox(1,610*this.scaleNum,10*this.scaleNum));this.wall4.body.setPos(cc.p(this.panZiSpr1.x-395*this.scaleNum,45*this.scaleNum));this.wall4.shape=new cp.BoxShape(this.wall4.body,610*this.scaleNum,10*this.scaleNum);this.wall4.shape.setElasticity(0);this.wall4.shape.setFriction(0.1);this.space.addStaticShape(this.wall4.shape,10);this.wall4.shape.setCollisionType(3);this.wall4.sprite=new cc.PhysicsSprite;this.wall4.sprite.setBody(this.wall4.body);this.wall4.sprite.setPosition(cc.p(this.panZiSpr1.x-395*this.scaleNum,45*this.scaleNum));this.addChild(this.wall4.sprite,10);this.wall4.body.setAngleInternal(0);this.space.reindexStatic();this.space.reindexShape(this.wall4.shape);this.wall5={};this.wall5.body=new cp.StaticBody(1,cp.momentForBox(1,610*this.scaleNum,10*this.scaleNum));this.wall5.body.setPos(cc.p(this.panZiSpr1.x+395*this.scaleNum,45*this.scaleNum));this.wall5.shape=new cp.BoxShape(this.wall5.body,610*this.scaleNum,10*this.scaleNum);this.wall5.shape.setElasticity(0);this.wall5.shape.setFriction(0.1);this.space.addStaticShape(this.wall5.shape,10);this.wall5.shape.setCollisionType(3);this.wall5.sprite=new cc.PhysicsSprite;this.wall5.sprite.setBody(this.wall5.body);this.wall5.sprite.setPosition(cc.p(this.panZiSpr1.x+395*this.scaleNum,45*this.scaleNum));this.addChild(this.wall5.sprite,10);this.wall5.body.setAngleInternal(0);this.space.reindexStatic();this.space.reindexShape(this.wall5.shape)},initCollisionFunc:function(){this.space.addCollisionHandler(1,2,this.collisionBegin.bind(this),this.collisionPre.bind(this),this.collisionPost.bind(this),this.collisionSeparate.bind(this));this.space.addCollisionHandler(1,3,this.collisionBegin.bind(this),this.collisionPre.bind(this),this.collisionPost.bind(this),this.collisionSeparate.bind(this));this.space.addCollisionHandler(1,1,this.collisionBegin.bind(this),this.collisionPre.bind(this),this.collisionPost.bind(this),this.collisionSeparate.bind(this))},collisionBegin:function(f,e){switch(f.getShapes()[1].collision_type){case 1:this.space.addPostStepCallback(function(){!1==GC.canEffectBool&&(GC.canEffectBool=!0,AudioManager.playEffect(music.p))}.bind(this));break;case 2:this.space.addPostStepCallback(function(){GC.chaEyeBool=!0;!1==GC.canEffectBool&&AudioManager.playEffect(music.p);MainManager.getDist(this.objApple.sprite.x,this.objApple.sprite.y,20,CH-20);this.space.removeBody(this.objApple.body);this.space.removeShape(this.objApple.shape);this.objApple.sprite.moveState=1;this.objApple.sprite.runAction(cc.sequence(cc.moveBy(0.1,0,9),cc.moveBy(0.1,0,-9),cc.delayTime(0.02),cc.fadeOut(0.1),cc.callFunc(function(){mainSelf._touchRightNum++}),cc.callFunc(this.goToNext.bind(this)),cc.callFunc(function(){GameManager.addRightScore(1);mainSelf.judgeGameOver()}),cc.removeSelf(!0)))}.bind(this));break;case 3:this.space.addPostStepCallback(function(){GameManager.clickErrorNum++;!1==GC.canEffectBool&&AudioManager.playEffect(music.posui);this.space.removeBody(this.objApple.body);this.space.removeShape(this.objApple.shape);this.objApple.sprite.moveState=0;this.objApple.sprite.setLocalZOrder(5);this.objApple.sprite.runAction(cc.sequence(cc.moveBy(0.1,0,10),cc.moveBy(0.1,0,-10),cc.callFunc(function(){mainSelf._touchErrorNum++;GameManager.reduceTotalScore(1);0<=GameManager.totalNum&&mainSelf.scoreTotalView.setScore()}),cc.callFunc(function(){mainSelf.objApple.sprite.setTexture(res.apple2_png)}),cc.delayTime(0.039),cc.callFunc(function(){mainSelf.objApple.sprite.setTexture(res.apple3_png)}),cc.delayTime(0.039),cc.callFunc(function(){mainSelf.objApple.sprite.setTexture(res.apple4_png)}),cc.delayTime(0.039),cc.callFunc(function(){mainSelf.objApple.sprite.setTexture(res.apple5_png)}),cc.callFunc(this.goToNext.bind(this)),cc.callFunc(function(){mainSelf.judgeGameOver()}),cc.delayTime(0.1),cc.fadeOut(0.1),cc.removeSelf(!0)))}.bind(this))}return !0},addNewAppleAction:function(){var d=UIToolManager.getSprite(res.apple1_png,0,1,8,CH-60);d.setScale(0.6*this.scaleNum);this.addChild(d,21);d.runAction(cc.sequence(cc.moveBy(0.1,cc.p(0,46)),cc.removeSelf(!0)))},judgeGameOver:function(){var d=this._touchErrorNum+this._touchRightNum;10>=d?this._norCountTime=7:15>=d?this._norCountTime=6:20>=d?this._norCountTime=6:25>=d?this._norCountTime=5:30>=d&&(this._norCountTime=4);this._speed=5+0.1*(this._touchErrorNum+this._touchRightNum);30<=this._touchErrorNum+this._touchRightNum&&(GameManager.score=GameManager.clickRightNum,cc.log("GameScore",GameManager.score),this.gameEnd())},collisionPre:function(f,e){return !0},collisionPost:function(f,e){},collisionSeparate:function(f,e){},initDropApple:function(){var f=0,e=0;1==MainManager.randomInt(1,2)?(f=MainManager.randomInt(100,CW-100)*this.scaleNum,e=MainManager.randomInt(500,800)*this.scaleNum):(f=MainManager.randomInt(190,590)*this.scaleNum,e=MainManager.randomInt(800,880)*this.scaleNum);f=cc.p(f,e);this.objApple={};this.objApple.body=new cp.Body(1,cp.momentForCircle(1,0,36*this.scaleNum,cp.v(0,0)));this.objApple.body.setPos(f);this.space.addBody(this.objApple.body);this.objApple.shape=new cp.CircleShape(this.objApple.body,36*this.scaleNum,cp.v(0,0));this.objApple.shape.setElasticity(0);this.objApple.shape.setFriction(1);this.space.addShape(this.objApple.shape);this.objApple.shape.setCollisionType(1);this.objApple.sprite=new cc.PhysicsSprite(res.apple1_png);this.objApple.sprite.setBody(this.objApple.body);this.objApple.sprite.setPosition(f.x,f.y);this.objApple.sprite.dropState=1;this.objApple.sprite.moveState=0;this.objApple.sprite.setScale(this.scaleNum);this.addChild(this.objApple.sprite,3);2<=GameManager.levelNum&&(this.objApple.sprite.setOpacity(0),this.objApple.sprite.runAction(cc.sequence(cc.fadeIn(0.15))))},gameStart:function(){if(10<=document.body.scrollTop){return document.documentElement.scrollTop=document.body.scrollTop=0,!1}MainManager.gameResume();this.createListener();this.unscheduleUpdate();this.scheduleUpdate()},gameEnd:function(){this.removeListener();MainManager.isPause=!0;MainManager.canTouch=!1;this.scoreView.setScore();this.runAction(cc.sequence(cc.delayTime(0.5),cc.callFunc(this.gameEnd1.bind(this))))},gameEnd1:function(){this.unscheduleUpdate();AudioManager.playEffect(music.gameover);var d=1,d=LanguageManager.chineseFlag?1:2,d=UIToolManager.getSprite(comRes["game_over"+d+"_png"],0.5,0.5,CW/2,CH/2+50);this.addChild(d,30);d.setOpacity(0);d.setScale(this.scaleNum);d.runAction(cc.sequence(cc.delayTime(0.2),cc.spawn(cc.fadeIn(0.8),cc.moveBy(0.8,0,-50)),cc.delayTime(0.5),cc.callFunc(this.initEndLayer.bind(this)),cc.removeSelf()))},initEndLayer:function(){MainManager.gotoEndLayer()},createListener:function(){this.lis1=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchEnded:this.onTouchEnded.bind(this)});cc.eventManager.addListener(this.lis1,this)},removeListener:function(){cc.eventManager.removeListener(this.lis1);this.lis1=null},onTouchBegan:function(f,e){if(0>f.getLocation().y){return document.documentElement.scrollTop=document.body.scrollTop=0,!1}MainManager.canTouch&&!1==GC.canTouchBool&&(this.touchBeganApple(),GC.canTouchBool=!0);return !0},onTouchEnded:function(){},touchBeganApple:function(){this.objApple.sprite.runAction(cc.sequence(cc.moveBy(0.07,0,15),cc.delayTime(0.02),cc.callFunc(function(){GC.appleDropBool=!0;mainSelf.space.gravity=cp.v(0,-600)})))},update:function(d){this.space.step(0.03);this.scoreView.addScoreFunc();this.updateAniMove();this.updateChangeSpeedSign()},updateAniMove:function(){this._countTime++;this._countTime1++;this._countTime>=this._norCountTime&&(this._countTime=0,this._indexN++,5<=this._indexN&&(this._indexN=1),this.aniSpr3.setTexture(res["st"+this._indexN+"_png"]));50<=this._countTime1&&(this._countTime1=0,this._indexN1++,3<=this._indexN1&&(this._indexN1=1));this.aniSpr1.setPositionX(this.aniSpr1.getPositionX()+this._speedSign*this._speed);this.aniSpr2.setPositionX(this.aniSpr2.getPositionX()+this._speedSign*this._speed);this.aniSpr3.setPositionX(this.aniSpr3.getPositionX()+this._speedSign*this._speed);this.panZiSpr1.setPositionX(this.panZiSpr1.getPositionX()+this._speedSign*this._speed);this.panZiSpr2.setPositionX(this.panZiSpr2.getPositionX()+this._speedSign*this._speed);this.wall1.sprite.setPositionX(this.wall1.sprite.getPositionX()+this._speedSign*this._speed);this.wall2.sprite.setPositionX(this.wall2.sprite.getPositionX()+this._speedSign*this._speed);this.wall3.sprite.setPositionX(this.wall3.sprite.getPositionX()+this._speedSign*this._speed);this.wall4.sprite.setPositionX(this.wall4.sprite.getPositionX()+this._speedSign*this._speed);this.wall5.sprite.setPositionX(this.wall5.sprite.getPositionX()+this._speedSign*this._speed);null!=this.objApple.sprite&&1==this.objApple.sprite.moveState&&this.objApple.sprite.setPositionX(this.objApple.sprite.getPositionX()+this._speedSign*this._speed);this.space.reindexStatic();this.space.reindexShape(this.wall1.shape);this.space.reindexShape(this.wall2.shape);this.space.reindexShape(this.wall3.shape);this.space.reindexShape(this.wall4.shape);this.space.reindexShape(this.wall5.shape)},updateChangeSpeedSign:function(){this.aniSpr1.getPositionX()>=CW/2+310*this.scaleNum?(this._speedSign=-1,this._indexN2=3,this.aniSpr2.setTexture(res.sy3_png)):this.aniSpr1.getPositionX()<=CW/2-280*this.scaleNum&&(this.aniSpr2.setTexture(res.sy4_png),this._indexN2=4,this._speedSign=1)},updateChaAniEye:function(){!1==GC.chaEyeBool&&(this._countEyeTotalTime++,this._countEyeTotalTime>=this._countNorEyeTime&&(this._countNorEyeTime=MainManager.randomInt(260,500),this._countEyeTime=this._countEyeTotalTime=0,GC.chaEyeBool=!0,this.aniSpr2.setTexture(res.sy1_png),this.runAction(cc.sequence(cc.delayTime(0.1),cc.callFunc(function(){mainSelf.aniSpr2.setTexture(res["sy"+this._indexN2+"_png"])})))))},goToNext:function(){mainSelf.space.gravity=cp.v(0,0);GameManager.levelNum++;this.objApple.sprite=null;GC.appleStopBool=!1;GC.appleDropBool=!1;GC.canTouchBool=!1;GC.canEffectBool=!1;this.initDropApple()},addLinkGame:function(){if(null!=MainManager.linkData){this.btnLink=new cc.MenuItemImage(comRes.btn_link_png,comRes.btn_link_png,this.openLinkGame.bind(this));this.btnLink.setOpacity(150);this.btnLink.setScaleX(0.8);this.btnLink.setPosition(CW-40,CH-40);var d;d=new cc.Menu(this.btnLink);d.setPosition(0,0);this.addChild(d)}},openLinkGame:function(){MainManager.isPause||(MainManager.gamePause(),UIManager.show(UIName.LinkLayer,MainManager.linkData))},hide:function(){this.stopAllActions();this.unscheduleUpdate();this.bg=this.scoreView=this.lis1=null;this.removeAllChildren(!0);this.removeFromParent(!0);mainSelf=null},onExit:function(){this._super();cc.log("main ----- delete")}});var StartLayer=cc.Layer.extend({ctor:function(){this._super()},setData:function(h){h=cc.director.getWinSize().height/1280;var g=0,f=0;0.76<=h?(g=1,f=0):0.73<h?(g=0.9,f=0.1):0.7<=h?(g=h,f=1-h):0.6<=h?f=g=0.5:0.5<=h?(g=0.4,f=0.6):0.4<=h?(g=0.2,f=0.8):0.1<=h?(g=0.1,f=0.9):0<=h&&(g=0.05,f=0.95);this.scaleNum=g+CH/1280*f;this.init();this.createListener()},init:function(){var k=new cc.LayerColor(cc.color(0,0,0,150));this.addChild(k);if(10<=document.body.scrollTop){return document.documentElement.scrollTop=document.body.scrollTop=0,!1}var j=46*this.scaleNum,k=66*this.scaleNum,h=LanguageManager.getText("game_info"),g=LanguageManager.getText("start"),j=new cc.LabelTTF(h,"Arial",j,cc.size(600,600),cc.TEXT_ALIGNMENT_LEFT);j.setAnchorPoint(0.5,1);j.x=CW/2;j.y=3*CH/4;this.addChild(j);k=UIToolManager.getLabelTTF(g,k,0.5,0.5,CW/2,100);this.addChild(k)},createListener:function(){this.lis1=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)});cc.eventManager.addListener(this.lis1,this)},removeListener:function(){cc.eventManager.removeListener(this.lis1);this.lis1=null},onTouchBegan:function(f,e){return !0},onTouchMoved:function(f,e){},onTouchEnded:function(f,e){this.closeLayer()},closeLayer:function(){UIManager.hide(UIName.StartLayer);mainSelf.gameStart()},hide:function(){this.removeListener();this.lis1=null;this.cleanup();this.removeAllChildren(!0)},onExit:function(){this._super();cc.log("game start ----- delete");this.hide()}});var EndLayer=PopLayer.extend({standardScore:0,minScore:0,ctor:function(){this._super();EndLayerSelf=this;this.standardScore=10;cc.log("\u6e38\u620f\u7ed3\u675f\u4e86");this.setData();var d=new cc.LayerColor(cc.color(54,152,197,255));this.addChild(d);score_share(GameManager.gameName+"\uff0c\uff5e\u6211"+GameManager.score+"\u5206\uff0c\u4f60\u5462\uff1f");this.initUI1()},setData:function(){var h=cc.director.getWinSize().height/1280,g=0,f=0;0.76<=h?(g=1,f=0):0.73<h?(g=0.9,f=0.1):0.7<=h?(g=h,f=1-h):0.6<=h?f=g=0.5:0.5<=h?(g=0.4,f=0.6):0.4<=h?(g=0.2,f=0.8):0.1<=h?(g=0.1,f=0.9):0<=h&&(g=0.05,f=0.95);this.scaleNum=g+CH/1280*f;cc.log("this.scale",this.scaleNum)},initUI1:function(){var d=46*this.scaleNum;this.tipLabel=new cc.LabelTTF(this.getContentByScore(GameManager.score,GameManager.gameName),"Arial",d,cc.size(600,600),cc.TEXT_ALIGNMENT_LEFT);this.tipLabel.setAnchorPoint(0.5,1);this.tipLabel.setPosition(CW/2,CH/2+150*this.scaleNum);this.addChild(this.tipLabel);this.btnMore=new cc.MenuItemImage(comRes.btn_more_png,comRes.btn_more_png,function(){MainManager.gotoMoreGame()},this);this.btnMore.setPosition(CW/2,CH/2-130);this.btnAgain=new cc.MenuItemImage(comRes.btn_again_png,comRes.btn_again_png,function(){cc.director.runScene(new GameScene);cc.director.resume()},this);this.btnAgain.setPosition(CW/2-150,this.btnMore.y-190);this.btnGz=new cc.MenuItemImage(comRes.btn_gz_png,comRes.btn_gz_png,function(){window.location.href="http://mp.weixin.qq.com/s?__biz\x3dMzA5NzQxMzU4NQ\x3d\x3d\x26mid\x3d207293871\x26idx\x3d1\x26sn\x3d173662dd6d0b62ec9f19382a5368f270#rd"},this);this.btnGz.setPosition(CW/2+150,this.btnMore.y-190);d=new cc.Menu(this.btnAgain,this.btnMore,this.btnGz);d.setPosition(0,0);this.addChild(d);d.setScale(this.scaleNum);cc.loader.loadImg(cc._Img,{isCrossOrigin:!1},function(g,f){EndLayerSelf.initStage(f)})},initStage:function(f){var e=new cc.Texture2D;e.initWithElement(f);e.handleLoadedTexture();f=new cc.Sprite(e);f.setScale(this.scaleNum);f.setAnchorPoint(0.5,0.5);f.setPosition(CW/2,this.tipLabel.y+(CH-this.tipLabel.y)/2-40);EndLayerSelf.addChild(f,10)},getContentByScore:function(s,r){var p="\u6211\u771f\u662f\u592a\u5389\u5bb3\uff0c\u5728"+r+"\u4e2d\u63a5\u53ea\u63a5\u4f4f\u4e860\u4e2a\u82f9\u679c\uff0c\u5168\u7403\u53ea\u67091\u4e2a\u4eba\u63a5\u4f4f\u4e860\u4e2a\uff01",o=parseInt(0.3*this.standardScore),n=parseInt(1.5*this.standardScore),m=parseInt(2.5*this.standardScore),j=parseInt(4*this.standardScore);0<s&&s<=o?p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u771f\u662f\u592a\u68d2\u4e86\uff0c\u518d\u7ec3\u7ec3\u5c31\u80fd\u5f97\u5fc3\u5e94\u624b\uff01":s>o&&s<=this.standardScore?p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u771f\u662f\u592a\u68d2\u4e86\uff0c\u518d\u7ec3\u7ec3\u5c31\u80fd\u8fbe\u5230\u6e38\u5203\u6709\u4f59\u7684\u5883\u754c\uff01":s>this.standardScore&&s<=n?p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u51fb\u8d25\u4e86\u5168\u7403"+(Math.floor(12*(s-this.standardScore)/(n-this.standardScore))+80)+"%\u7684\u73a9\u5bb6\uff0c\u8fdb\u5165\u4e86\u4fe1\u624b\u62c8\u6765\u7684\u5883\u754c\uff01":s>n&&s<=m?p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u51fb\u8d25\u4e86\u5168\u7403"+(Math.floor(7*(s-n)/(m-n))+92)+"%\u7684\u73a9\u5bb6\uff0c\u8fdb\u5165\u4e86\u8fd0\u7528\u81ea\u5982\u7684\u5883\u754c\uff01":s>m&&s<=j?p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u51fb\u8d25\u4e86\u5168\u740399%\u7684\u73a9\u5bb6\uff0c\u8fbe\u5230\u4e86\u884c\u4e91\u6d41\u6c34\u7684\u5883\u754c\uff01":s>j&&s<game_max_score?(Math.ceil(17*(s-j)/(game_max_score-j)),p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u636e\u8bf4\u5168\u7403\u53ea\u6709 16\u4e2a\u4eba\u8fbe\u5230\u8fd9\u4e2a\u6c34\u5e73\uff0c\u72ec\u5b64\u6c42\u8d25\uff01"):s>=game_max_score&&(p="\u6211\u5728"+r+"\u4e2d\u63a5\u4f4f\u4e86"+s+"\u4e2a\u82f9\u679c\uff0c\u8d85\u8d8a\u4e86\u72ec\u5b64\u6c42\u8d25\uff0c\u5fc3\u6709\u7075\u7280\uff01");s>=game_max_score&&(game_max_score=s);score_share(p);return p},hide:function(){this.removeAllChildren(!0);this.removeFromParent(!0)},onExit:function(){this._super();cc.log("end Layer-----delete")}});cc._Img="res/logo.png";var EndLayerEnglish=PopLayer.extend({tipLabel:null,chouJiangItem:null,moreGameItem:null,_shareLabel:null,size:null,bestScore:0,ctor:function(){this._super()},setData:function(d){this.initUI();this.showScore(GameManager.score)},initUI:function(){var p=cc.director.getVisibleSize();this.scale=p.width/720;this.size=p;var o=new cc.LayerColor(cc.color(150,150,150));this.addChild(o);o.scale=1/this.scale;this.tipLabel=UIToolManager.getLabelTTF("Best : "+GameManager.score,45,0.5,1,p.width/2,2*p.height/3-130);this.tipLabel.setAnchorPoint(0.5,1);o=p.height/2-200;0.95>this.scale&&(this.tipLabel.y+=50,o.y-=50);var n=new cc.MenuItemImage(comRes.icon_moregame_png,comRes.icon_moregame_png,function(){MainManager.gotoMoreGame()},this);n.attr({x:p.width/2,y:o+80,anchorX:0.5,anchorY:0.5});n.color=cc.color("#fcf253");n.scale=0.8;n.y-=0.1*n.height;var m=new cc.MenuItemImage(comRes.icon_facebook_png,comRes.icon_facebook_png,function(){this.onFacebookClick()},this);m.attr({x:p.width/2-160,y:o-80,anchorX:0.5,anchorY:0.5});var k=new cc.MenuItemImage(comRes.icon_replay_png,comRes.icon_replay_png,function(){cc.director.runScene(new GameScene);cc.director.resume()},this);k.attr({x:p.width/2+160,y:m.y,anchorX:0.5,anchorY:0.5});var j=new cc.MenuItemImage(comRes.icon_twitter_png,comRes.icon_twitter_png,function(){this.onTwitterClick()},this);j.attr({x:p.width/2,y:m.y,anchorX:0.5,anchorY:0.5});p=new cc.Menu(j,m,k,n);p.x=0;p.y=0;this.addChild(p);p=m.x-m.width/2;k=k.x+k.width/2;m=o-1;o+=1;n=new cc.DrawNode;n.drawRect(cc.p(p,m),cc.p(k,o),cc.color("#ffffff"),0,cc.color("#ffffff"));this.addChild(n)},showScore:function(h){var g=this.size,f=UIToolManager.getSprite(comRes.score_bg_png,0.5,0.5,g.width/2,this.tipLabel.y+130);this.addChild(f);h=UIToolManager.getLabelTTF(h.toString(),70,0.5,0.5,g.width/2,f.y,cc.color("#000000"));this.addChild(h)},onTwitterClick:function(){var f,e;f=location.href;e=document.title+" is very interesting, come play with me, click play now!";f="http://twitter.com/share/?url\x3d"+encodeURIComponent(f)+"\x26text\x3d"+encodeURIComponent(e);window.location.href=f},onFacebookClick:function(){var h,g;h=location.href;g=document.title+" my best score: "+GameManager.score+", come play with me, click play now!";var f=LanguageManager.getText("game_name");h="https://www.facebook.com/dialog/feed?app_id\x3d"+MainManager.id_facebookShare+"\x26link\x3d"+encodeURIComponent(h)+"\x26redirect_uri\x3d"+encodeURIComponent(h)+"\x26name\x3d"+g+"\x26description\x3d"+f;window.location.href=h},hide:function(){this.removeAllChildren(!0);this.removeFromParent(!0)},onExit:function(){this._super();cc.log("end EngilshLayer ----- delete")}});var LinkLayer=cc.Layer.extend({lis1:null,bg:null,ctor:function(){this._super();var h=cc.director.getWinSize().height/1280,g=0,f=0;0.76<=h?(g=1,f=0):0.73<h?(g=0.9,f=0.1):0.7<=h?(g=h,f=1-h):0.6<=h?f=g=0.5:0.5<=h?(g=0.4,f=0.6):0.4<=h?(g=0.2,f=0.8):0.1<=h?(g=0.1,f=0.9):0<=h&&(g=0.05,f=0.95);this.scaleNum=g+CH/1280*f;this.bg=new cc.DrawNode;this.bg.drawRect(cc.p(0,0),cc.p(CW,CH),cc.color(0,0,0,100),-1);this.addChild(this.bg);this.nodeContainer=new cc.Node;this.addChild(this.nodeContainer)},setData:function(d){this.initUI(d);this.layerIn()},createListener:function(){this.lis1=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)});cc.eventManager.addListener(this.lis1,this)},removeListener:function(){cc.eventManager.removeListener(this.lis1);this.lis1=null},onTouchBegan:function(f,e){return !0},onTouchMoved:function(f,e){},onTouchEnded:function(f,e){f.getLocation().x>this.LW&&this.layerOut()},initUI:function(w){this.LW=CW/2+100*this.scaleNum;this.bgColor=new cc.DrawNode;this.bgColor.drawRect(cc.p(0,0),cc.p(this.LW,CH),cc.color(0,0,0,255),-1);this.nodeContainer.addChild(this.bgColor);var v=this.LW/2,u=CH-100*this.scaleNum,t=340,s=0.8;switch(cc.sys.language){case cc.sys.LANGUAGE_CHINESE:s=0.65,t=280}this.txt1=UIToolManager.getLabelTTF("  "+LanguageManager.getText("link_top_tip"),42*this.scaleNum,0.5,0.5,v-47,u);this.nodeContainer.addChild(this.txt1);this.txt1.width>t&&(this.txt1.scale=t/this.txt1.width);t=new cc.Menu;t.setPosition(0,0);this.nodeContainer.addChild(t);for(var r=w.gameList.length,p=0;p<r;p++){var u=u-100*this.scaleNum,o=new cc.MenuItemImage(comRes.button1_png,comRes.button1_png,this.openLink.bind(this,w.gameList[p][1]));o.setPosition(v,u);o.setScaleX(s*this.scaleNum);o.setScaleY(0.75*this.scaleNum);var j=UIToolManager.getLabelTTF(""+w.gameList[p][0],40*this.scaleNum,0.5,0.5,v,u);this.nodeContainer.addChild(j);t.addChild(o);o=(o.width-20)*o.scaleX;j.width>o&&(j.scale=o/j.width)}u=CH/2;s=new cc.MenuItemImage(comRes.btn_jiantou_png,comRes.btn_jiantou_png,this.layerOut.bind(this));s.setAnchorPoint(1,0.5);s.setScale(this.scaleNum);s.setPosition(this.LW-15,u);t.addChild(s);u=145*this.scaleNum;this.btnCenter=new cc.MenuItemImage(comRes.button2_png,comRes.button2_png,this.openLink.bind(this,w.gameCenter));this.btnCenter.setPosition(v,u);this.btnCenter.setScale(0.85*this.scaleNum);j=UIToolManager.getLabelTTF(""+LanguageManager.getText("game_center"),44*this.scaleNum,0.5,0.5,v,u);this.nodeContainer.addChild(j);t.addChild(this.btnCenter);200<j.width&&(j.scale=200/j.width)},openLink:function(d){window.location.href=d},layerIn:function(){AudioManager.playEffect(music.openLayer);this.nodeContainer.x=-CW/2;this.nodeContainer.runAction(cc.sequence(cc.moveTo(0.2,0,0),cc.callFunc(this.layerInEnd.bind(this))))},layerInEnd:function(){this.createListener()},layerOut:function(){AudioManager.playEffect(music.openLayer);this.removeListener();this.nodeContainer.runAction(cc.sequence(cc.moveTo(0.2,-CW/2,0),cc.callFunc(this.closeLayer.bind(this))))},closeLayer:function(){UIManager.hide(UIName.LinkLayer);MainManager.gameResume()},hide:function(){this.removeListener();this.removeAllChildren(!0);this.removeFromParent(!0)},onExit:function(){this._super();cc.log("link ----- delete")}});var sw=39.8,sh=52,ScoreView1=cc.Node.extend({scoreTxt:null,nowScore:0,addV:2,speed:0,ctor:function(n,m,k,j,h){this._super();this.nowScore=0;this.initUI(n,m,k,j,h)},initUI:function(n,m,k,j,h){this.scoreTxt=new cc.LabelAtlas("0",res.number_png,sw,sh,"0");this.scoreTxt.setAnchorPoint(n,m);this.scoreTxt.setPosition(k,j);this.addChild(this.scoreTxt);this.scoreTxt.setScale(0.8*h);this.setScore()},setScore:function(){this.nowScore=GameManager.clickRightNum;this.scoreTxt.string=GameManager.clickRightNum.toString()},addScoreFunc:function(){GameManager.clickRightNum>this.nowScore&&(this.speed++,this.speed==this.addV&&(this.speed=0,this.nowScore++,this.scoreTxt.string=this.nowScore.toString()))}}),ScoreView2=cc.Node.extend({scoreTxt:null,nowScore:0,addV:2,speed:0,ctor:function(n,m,k,j,h){this._super();this.nowScore=0;this.initUI(n,m,k,j,h)},initUI:function(n,m,k,j,h){this.scoreTxt=new cc.LabelAtlas("0",res.number_png,sw,sh,"0");this.scoreTxt.setAnchorPoint(n,m);this.scoreTxt.setPosition(k,j);this.addChild(this.scoreTxt);this.scoreTxt.setScale(h);this.setScore()},setScore:function(){this.nowScore=GameManager.totalNum;this.scoreTxt.string=GameManager.clickRightNum.toString()+" / "+GameManager.totalNum.toString()},addScoreFunc:function(){GameManager.totalNum>this.nowScore&&(this.speed++,this.speed==this.addV&&(this.speed=0,this.nowScore++,this.scoreTxt.string=this.nowScore.toString()))}}),AddTxt=cc.Node.extend({add:null,txt:null,ctor:function(d){this._super();this.setCascadeOpacityEnabled(!0);this.init(d)},init:function(d){this.txt=new cc.LabelAtlas(""+d,res.number1_png,60,56,"0");this.txt.setAnchorPoint(0.5,0.5);this.addChild(this.txt);this.txt.string=d.toString();this.show()},show:function(){this.runAction(cc.sequence(cc.spawn(cc.moveBy(0.5,0,100),cc.fadeOut(0.5)),cc.callFunc(this.destroy.bind(this))))},destroy:function(){this.removeAllChildrenWithCleanup(!0);this.removeFromParent(!0)}});var loadLayer=cc.Layer.extend({lis1:null,resEnd:!1,ctor:function(){this._super();loadSelf=this;this.init()},init:function(){this.btnStartFunc()},btnStartFunc:function(){cc.log("\u5f00\u59cb\u6e38\u620f");cc.LoaderScene.preload(g_resources,function(){MainManager.startGame()},this)}}),LoadScene=cc.Scene.extend({onEnter:function(){this._super();var d=new loadLayer;this.addChild(d)},onExit:function(){this._super();cc.log("load scene ----- delete")}}),CW=0,CH=0;var GameLayer=cc.Layer.extend({lis1:null,GameSelf:null,ctor:function(){this._super();GameSelf=this;this.setData()},setData:function(){CW=parseInt(cc.director.getVisibleSize().width);CH=parseInt(cc.director.getVisibleSize().height);GameManager.setData();UIManager.init();UIManager.register(this);this.init()},init:function(){UIManager.show(UIName.MainLayer);if(1<GameManager.playNum){return mainSelf.gameStart(),!0}MainManager.gamePause();UIManager.show(UIName.StartLayer)},onExit:function(){this._super();GameSelf=null}}),GameScene=cc.Scene.extend({onEnter:function(){this._super();this.initGame()},initGame:function(){var d=new GameLayer;this.addChild(d)},hide:function(){this.unscheduleUpdate();this.cleanup();this.removeAllChildren(!0)},onExit:function(){this._super();cc.log("game scene ----- delete");this.hide()}});var PC_FLAG=!1,IOS_FLAG=!1;cc.game.onStart=function(){!cc.sys.isNative&&document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading"));cc.log("xitong : "+cc.sys.os);cc.view.enableRetina(!0);cc.view.adjustViewPort(!0);cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_BLACKBERRY||cc.sys.os===cc.sys.OS_WP8||cc.sys.os===cc.sys.OS_BADA?cc.view.setDesignResolutionSize(720,1280,cc.ResolutionPolicy.FIXED_WIDTH):(PC_FLAG=!0,cc.view.setDesignResolutionSize(720,1280,cc.ResolutionPolicy.SHOW_ALL));cc.view.resizeWithBrowserSize(!0);document.getElementById("loadingImg")&&document.body.removeChild(document.getElementById("loadingImg"));upload&&checkShowAd();MainManager.gotoCover()};cc.game.run();function checkShowAd(){1==getLocalStorage("old_key_jiepinguoWS")?showMyAds():setLocalStorage("old_key_jiepinguoWS",1)}function setLocalStorage(h,g){try{return cc.sys.localStorage.setItem(h,g),!0}catch(f){return !1}}function getLocalStorage(f){try{return cc.sys.localStorage.getItem(f)}catch(e){return !1}};